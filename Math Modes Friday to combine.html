<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.6">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px 'Helvetica Neue'; color: #dbdbdf; -webkit-text-stroke: #dbdbdf; background-color: #171717}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px 'Helvetica Neue'; color: #dbdbdf; -webkit-text-stroke: #dbdbdf; background-color: #171717; min-height: 16.0px}
    span.s1 {font-kerning: none}
  </style>
</head>
<body>
<p class="p1"><span class="s1">&lt;!DOCTYPE html&gt;</span></p>
<p class="p1"><span class="s1">&lt;html lang="en"&gt;</span></p>
<p class="p1"><span class="s1">&lt;head&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;meta charset="UTF-8"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;title&gt;Custom Math Machine&lt;/title&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;script src="https://cdn.tailwindcss.com"&gt;&lt;/script&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&amp;display=swap" rel="stylesheet"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;link href="https://fonts.googleapis.com/css?family=Comic+Sans+MS" rel="stylesheet"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"&gt;&lt;/script&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"&gt;&lt;/script&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/renderers/CSS2DRenderer.js"&gt;&lt;/script&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;script&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>MathJax = {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>tex: {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>inlineMath: [['$', '$'], ['\\(', '\\)']],</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>displayMath: [ ['$$', '$$'], ['\\[', '\\]'] ],</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>svg: {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>fontCache: 'global'</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>};</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/script&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"&gt;&lt;/script&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;style&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>body {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>font-family: 'Montserrat', sans-serif !important;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>font-weight: 400 !important;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>background-color: #f9fafb;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.message-box {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>position: fixed; top: 20px; left: 50%;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>transform: translateX(-50%);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>background-color: #ef4444; color: white;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>padding: 1rem 1.5rem; border-radius: 0.5rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>z-index: 1000; display: none;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>font-size: 1rem; font-weight: bold;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>select {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>-webkit-appearance: none; -moz-appearance: none; appearance: none;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>background-repeat: no-repeat;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>background-position: right 0.5rem center;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>background-size: 1.5em 1.5em;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>padding-right: 2.5rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>#comparatorInputsContainer select.comparator-unit, #measurementType, #equivalency-rows-container select, #integer-ops-container select, #chartTypeLeft, #chartTypeRight {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">             </span>background-image: none !important;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">             </span>padding-right: 1rem !important;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.full-width-section { width: 100%; background-color: #f8fafc; padding: 1rem; border-radius: 0.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.hidden { display: none !important; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.toggle-btn { width: 3.5rem; height: 2rem; border-radius: 9999px; padding: 0.25rem; transition: background-color 0.2s ease-in-out; cursor: pointer; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.toggle-dot { width: 1.5rem; height: 1.5rem; background-color: white; border-radius: 9999px; box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06); transition: transform 0.2s ease-in-out; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.toggle-on { background-image: linear-gradient(130deg, #2B6DFE, #00F2FF); }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.toggle-off { background-color: #d1d5db; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.dot-on { transform: translateX(1.5rem); }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.dimension-label { background-color: rgba(0, 0, 0, 0.7); color: white; padding: 4px 8px; border-radius: 5px; font-size: 1.1em; white-space: nowrap; pointer-events: none; font-weight: bold; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.dimension-label-2d { position: absolute; background-color: rgba(0, 0, 0, 0.7); color: white; padding: 3px 8px; border-radius: 4px; font-size: 1.1em; font-weight: bold; transform: translate(-50%, -50%); pointer-events: none; display: block; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.css2d-container { position: absolute !important; top: 0px !important; left: 0px !important; pointer-events: none !important; overflow: hidden; z-index: 2; }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>/* Layout-specific styles */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.display-area { min-height: 400px; background-color: #dbeafe; border: 2px solid #e5e7eb; display: flex; flex-direction: column; justify-content: center; align-items: center; overflow: auto; position: relative; width: 100%; border-radius: 0.5rem; padding: 1rem; user-select: none; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.canvas-layout-wrapper { display: flex; flex-direction: column; gap: 1rem; width: 100%; flex-grow: 1; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.canvas-layout-inputs { width: 100%; background-color: #f8fafc; padding: 1rem; border-radius: 0.5rem; display: flex; flex-direction: column; gap: 0.5rem; transition: all 0.3s ease-in-out; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.canvas-layout-canvas { width: 100%; height: auto; aspect-ratio: 16/10; background-color: white; border-radius: 0.5rem; overflow: hidden; border: 2px solid #e5e7eb; transition: width 0.3s ease-in-out; box-shadow: 0 2px 4px rgba(0,0,0,0.05); position: relative; }</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>@media (min-width: 1024px) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>.standard-layout.layout-side-by-side { flex-direction: row; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>.canvas-layout-wrapper { flex-direction: row; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>.canvas-layout-inputs { width: 33.333333%; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>.canvas-layout-inputs.panel-hidden { width: 0; padding: 0; margin: 0; overflow: hidden; border: none; opacity: 0; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>.canvas-layout-canvas { width: 66.666666%; height: 600px; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>.canvas-layout-canvas.canvas-expanded { width: 100%; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>/* Cardinality Tool Styles */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.emoji-item { position: absolute; cursor: pointer; user-select: none; transition: transform 0.1s ease-out; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.emoji-item.clicked { background-color: rgba(253, 224, 71, 0.6); border-radius: 50%; transform: scale(1.1); }</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>/* Numeral Display Drawing Canvas */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>#numeralDrawingCanvas { position: absolute; top: 0; left: 0; cursor: none; z-index: 10; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>#customCursor { position: absolute; width: 30px; height: 30px; border-radius: 50%; background-color: #22c55e; opacity: 0.5; pointer-events: none; transform: translate(-50%, -50%); display: none; z-index: 20; }</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>/* Place Value Chart Styles */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.place-value-col {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>display: flex;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>flex-direction: column;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>align-items: center;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>justify-content: flex-end;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>padding: 0 0.5rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>min-height: 100px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>text-align: center;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.place-value-label {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>margin-bottom: 0.5rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.place-value-digit {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>font-size: 4.5rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>font-weight: 700;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>border-bottom: 2px solid #6b7280;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>padding: 0 0.5rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>min-width: 50px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>color: #111827;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.decimal-point-col {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>display: flex;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>align-items: flex-end;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>padding-bottom: 0.5rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>/* Tally Chart Styles */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.tally-marks {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>font-family: 'monospace';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>letter-spacing: 0.1em;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>color: #1e3a8a;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>font-size: 3rem; /* Increased size */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.tally-group {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>display: inline-block;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>position: relative;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>margin-right: 0.5rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>padding-right: 0.2rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.tally-slash {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>position: absolute;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>left: -0.2rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>top: 50%;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>width: 110%;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>height: 2px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>background-color: #1e3a8a;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>transform: translateY(-50%) rotate(-15deg);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/style&gt;</span></p>
<p class="p1"><span class="s1">&lt;/head&gt;</span></p>
<p class="p1"><span class="s1">&lt;body class="bg-gray-50 flex items-center justify-center p-4"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;div class="w-full max-w-7xl mx-auto bg-white rounded-2xl p-6 flex flex-col gap-4 min-h-screen shadow-lg"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;!-- Top controls row --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div id="topControlsRow" class="flex flex-wrap items-center justify-between gap-4"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div id="menu-controls" class="flex flex-wrap items-center gap-4 justify-center md:justify-start"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;select id="modeSelector" class="bg-slate-100 text-slate-800 font-bold py-2 px-4 text-sm md:text-base rounded-lg transition border-2 border-slate-200 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;option value="cardinality" selected&gt;1. Cardinality Counter&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;option value="verticalComparison"&gt;1b. Vertical Object Counter&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;option value="numeralDisplay"&gt;2. Numeral Display&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;option value="wordProblemVisualizer"&gt;3. Word Problem Visualizer&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;option value="measurementComparator"&gt;4. Measurement Comparison&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;option value="shapeClassifier"&gt;5. 2D/3D Shape Classifier&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;option value="tallyChart"&gt;7. Tally Chart&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;option value="placeValue"&gt;8. Place Value Tool&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;option value="equivalencyTool"&gt;9. Fraction/Decimal/Percent Equivalence&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;option value="unitRateCalculator"&gt;11. Unit Rate Calculator&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;option value="integerOperations"&gt;12. Integer Operations Visualizer&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;option value="dataSetAnalyzer"&gt;14. Data Set Analyzer&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;option value="volumeOfSphere"&gt;16. Sphere Volume&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;option value="surfaceAreaOfSphere"&gt;16b. Sphere Surface Area&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/select&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div id="dimensionInputsInline" class="flex flex-wrap justify-center lg:justify-start items-center gap-x-4 gap-y-2"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="flex items-center gap-6 ml-auto"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="flex items-center gap-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;span class="text-sm font-semibold"&gt;Menu&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;button id="menu-toggle-btn" class="toggle-btn toggle-on"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div id="menu-toggle-dot" class="toggle-dot dot-on"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div id="answer-toggle-container" class="flex items-center gap-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;span class="text-sm font-semibold"&gt;Answer&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;button id="answer-toggle-btn" class="toggle-btn toggle-on"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div id="answer-toggle-dot" class="toggle-dot dot-on"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;!-- Layout for Standard Tools --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div id="standardLayout" class="flex flex-1 flex-col lg:flex-row gap-4 hidden"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div id="standardDisplayArea" class="display-area"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;canvas id="canvas3DGlobal" class="hidden w-full h-full"&gt;&lt;/canvas&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div id="htmlDisplay" class="w-full h-full flex items-center justify-center gap-4"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div id="calculationStepsColumn" class="flex-1 mt-4 lg:mt-0"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="full-width-section h-full flex flex-col"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;h3 id="stepsContentTitle" class="text-lg font-bold text-slate-800 mb-2"&gt;Result / Steps:&lt;/h3&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div id="stepsContentContainer" class="bg-slate-50 p-4 rounded-lg border border-slate-200 flex-grow overflow-y-auto flex items-center justify-center font-serif"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;!-- Layout for Interactive Canvas Tools --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div id="canvasLayout" class="hidden flex-grow"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="canvas-layout-wrapper"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div id="canvasInputsPanel" class="canvas-layout-inputs"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="canvas-layout-canvas"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;canvas id="mainCanvas" class="w-full h-full"&gt;&lt;/canvas&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div id="zoomControls" class="absolute top-4 right-4 flex flex-col gap-2 z-10 hidden"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;button id="zoomInButton" class="bg-indigo-600 text-white font-semibold py-1 px-3 rounded-md shadow-md text-xl h-8 w-8 flex items-center justify-center"&gt;+&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;button id="zoomOutButton" class="bg-indigo-600 text-white font-semibold py-1 px-3 rounded-md shadow-md text-xl h-8 w-8 flex items-center justify-center"&gt;-&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;!-- Layout for Interactive Manipulative-style Tools --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div id="interactiveLayout" class="hidden w-full flex flex-col flex-grow gap-4"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div id="interactiveDisplay" class="display-area flex-grow"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div id="interactiveResult" class="full-width-section hidden"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;h3 id="interactiveResultTitle" class="text-lg font-bold text-slate-800 mb-2"&gt;Result:&lt;/h3&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div id="interactiveResultContent" class="bg-slate-50 p-4 rounded-lg border border-slate-200 min-h-[60px] overflow-x-auto flex flex-col justify-center items-center font-serif"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div id="messageBox" class="message-box"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">&lt;script&gt;</span></p>
<p class="p1"><span class="s1">// --- GLOBAL DOM ELEMENTS &amp; STATE ---</span></p>
<p class="p1"><span class="s1">const modeSelector = document.getElementById('modeSelector');</span></p>
<p class="p1"><span class="s1">const messageBox = document.getElementById('messageBox');</span></p>
<p class="p1"><span class="s1">const standardLayout = document.getElementById('standardLayout');</span></p>
<p class="p1"><span class="s1">const canvasLayout = document.getElementById('canvasLayout');</span></p>
<p class="p1"><span class="s1">const interactiveLayout = document.getElementById('interactiveLayout');</span></p>
<p class="p1"><span class="s1">const dimensionInputsInline = document.getElementById('dimensionInputsInline');</span></p>
<p class="p1"><span class="s1">const canvasInputsPanel = document.getElementById('canvasInputsPanel');</span></p>
<p class="p1"><span class="s1">const standardDisplayArea = document.getElementById('standardDisplayArea');</span></p>
<p class="p1"><span class="s1">const htmlDisplay = document.getElementById('htmlDisplay');</span></p>
<p class="p1"><span class="s1">const canvas3DGlobal = document.getElementById('canvas3DGlobal'); // Changed name for clarity</span></p>
<p class="p1"><span class="s1">const interactiveDisplay = document.getElementById('interactiveDisplay');</span></p>
<p class="p1"><span class="s1">const mainCanvas = document.getElementById('mainCanvas');</span></p>
<p class="p1"><span class="s1">const mainCtx = mainCanvas.getContext('2d');</span></p>
<p class="p1"><span class="s1">const calculationStepsColumn = document.getElementById('calculationStepsColumn');</span></p>
<p class="p1"><span class="s1">const stepsContentTitle = document.getElementById('stepsContentTitle');</span></p>
<p class="p1"><span class="s1">const stepsContentContainer = document.getElementById('stepsContentContainer');</span></p>
<p class="p1"><span class="s1">const interactiveResult = document.getElementById('interactiveResult');</span></p>
<p class="p1"><span class="s1">const interactiveResultTitle = document.getElementById('interactiveResultTitle');</span></p>
<p class="p1"><span class="s1">const interactiveResultContent = document.getElementById('interactiveResultContent');</span></p>
<p class="p1"><span class="s1">const menuToggleBtn = document.getElementById('menu-toggle-btn');</span></p>
<p class="p1"><span class="s1">const menuToggleDot = document.getElementById('menu-toggle-dot');</span></p>
<p class="p1"><span class="s1">const menuControls = document.getElementById('menu-controls');</span></p>
<p class="p1"><span class="s1">const answerToggleBtn = document.getElementById('answer-toggle-btn');</span></p>
<p class="p1"><span class="s1">const answerToggleDot = document.getElementById('answer-toggle-dot');</span></p>
<p class="p1"><span class="s1">const answerToggleContainer = document.getElementById('answer-toggle-container');</span></p>
<p class="p1"><span class="s1">const zoomControls = document.getElementById('zoomControls');</span></p>
<p class="p1"><span class="s1">const zoomInButton = document.getElementById('zoomInButton');</span></p>
<p class="p1"><span class="s1">const zoomOutButton = document.getElementById('zoomOutButton');</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">// State Variables</span></p>
<p class="p1"><span class="s1">let currentMode = 'cardinality';</span></p>
<p class="p1"><span class="s1">let scene, camera, renderer, object3D, controls, labelRenderer, animationFrameId;</span></p>
<p class="p1"><span class="s1">let cardinalityCounter = 0;</span></p>
<p class="p1"><span class="s1">let verticalComparisonState = { leftItems: [], rightItems: [], leftCount: 0, rightCount: 0, canvas: null, ctx: null };</span></p>
<p class="p1"><span class="s1">let numeralDisplayState = { canvas: null, ctx: null, cursor: null, drawing: false, paths: [], currentPath: [] };</span></p>
<p class="p1"><span class="s1">let measurementComparatorState = { mode: 'teach' };</span></p>
<p class="p1"><span class="s1">let shapeClassifierState = { mode: 'teach' };</span></p>
<p class="p1"><span class="s1">let equivalencyToolState = { showLabels: true, showCircles: true };</span></p>
<p class="p1"><span class="s1">let integerOperationsState = { currentStep: 0, story: [] };</span></p>
<p class="p1"><span class="s1">let dataSetAnalyzerState = { showEquation: true, showGraph: true };</span></p>
<p class="p1"><span class="s1">let activeListeners = [];</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">// --- CATEGORIZATION OF TOOLS ---</span></p>
<p class="p1"><span class="s1">const STANDARD_LAYOUT_TOOLS = ['numeralDisplay', 'wordProblemVisualizer', 'shapeClassifier', 'volumeOfSphere', 'surfaceAreaOfSphere'];</span></p>
<p class="p1"><span class="s1">const CANVAS_LAYOUT_TOOLS = [];</span></p>
<p class="p1"><span class="s1">const INTERACTIVE_LAYOUT_TOOLS = ['cardinality', 'verticalComparison', 'measurementComparator', 'tallyChart', 'placeValue', 'equivalencyTool', 'unitRateCalculator', 'integerOperations', 'dataSetAnalyzer'];</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">// --- INPUT TEMPLATES ---</span></p>
<p class="p1"><span class="s1">const inputTemplates = {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>cardinality: `</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="flex items-center gap-2"&gt;&lt;label class="text-sm font-semibold"&gt;Emoji:&lt;/label&gt;&lt;select id="emojiSelect" class="bg-slate-100 p-1 rounded-md border border-slate-200"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;option&gt;🍎&lt;/option&gt;&lt;option&gt;⭐&lt;/option&gt;&lt;option&gt;⚽️&lt;/option&gt;&lt;option&gt;🚗&lt;/option&gt;&lt;option&gt;❤️&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/select&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="flex items-center gap-2"&gt;&lt;label class="text-sm font-semibold"&gt;Count:&lt;/label&gt;&lt;input type="number" id="emojiCount" value="5" min="1" max="50" class="w-16 p-1 border-2 rounded-lg text-center"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="flex items-center gap-2"&gt;&lt;input type="checkbox" id="scatterCheck" class="h-4 w-4 rounded"&gt;&lt;label for="scatterCheck" class="text-sm font-semibold"&gt;Scatter&lt;/label&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>`,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>verticalComparison: `</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="flex flex-col gap-4 lg:flex-row"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="p-2 border rounded-lg flex flex-wrap gap-x-4 gap-y-2 items-center"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;span class="font-bold text-green-700"&gt;Left Set (Nature):&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="flex items-center gap-2"&gt;&lt;label class="text-sm"&gt;Object:&lt;/label&gt;&lt;select id="emojiSelect1" class="bg-slate-100 p-1 rounded-md border border-slate-200"&gt;&lt;option&gt;🌳&lt;/option&gt;&lt;option&gt;🍁&lt;/option&gt;&lt;option&gt;🌻&lt;/option&gt;&lt;/select&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="flex items-center gap-2"&gt;&lt;label class="text-sm"&gt;Count:&lt;/label&gt;&lt;input type="number" id="emojiCount1" value="7" min="1" max="50" class="w-16 p-1 border-2 rounded-lg text-center"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="flex items-center gap-2"&gt;&lt;input type="checkbox" id="scatterCheck1" class="h-4 w-4 rounded" checked&gt;&lt;label for="scatterCheck1" class="text-sm"&gt;Scatter&lt;/label&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="p-2 border rounded-lg flex flex-wrap gap-x-4 gap-y-2 items-center"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;span class="font-bold text-blue-700"&gt;Right Set (Space):&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="flex items-center gap-2"&gt;&lt;label class="text-sm"&gt;Object:&lt;/label&gt;&lt;select id="emojiSelect2" class="bg-slate-100 p-1 rounded-md border border-slate-200"&gt;&lt;option&gt;🚀&lt;/option&gt;&lt;option&gt;🪐&lt;/option&gt;&lt;option&gt;🌟&lt;/option&gt;&lt;/select&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="flex items-center gap-2"&gt;&lt;label class="text-sm"&gt;Count:&lt;/label&gt;&lt;input type="number" id="emojiCount2" value="5" min="1" max="50" class="w-16 p-1 border-2 rounded-lg text-center"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="flex items-center gap-2"&gt;&lt;input type="checkbox" id="scatterCheck2" class="h-4 w-4 rounded" checked&gt;&lt;label for="scatterCheck2" class-sm"&gt;Scatter&lt;/label&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>`,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>numeralDisplay: `</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="flex items-center gap-2"&gt;&lt;label class="text-sm font-semibold"&gt;Number:&lt;/label&gt;&lt;input type="number" id="numeralInput" value="7" class="w-24 p-1 border-2 rounded-lg text-center"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;button id="undoBtn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold p-1 rounded-full w-8 h-8 flex items-center justify-center"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"&gt;&lt;path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/&gt;&lt;/svg&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;button id="clearBtn" class="bg-red-500 text-white font-bold py-1 px-3 rounded-lg text-sm"&gt;Clear&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>`,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>wordProblemVisualizer: `</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="flex flex-col gap-2 w-full"&gt;&lt;label class="text-sm font-semibold"&gt;Word Problem:&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;textarea id="wordProblemText" class="w-full p-2 border-2 rounded-lg" rows="4"&gt;Sarah has 3 boxes of crayons. Each box has 12 crayons. How many crayons does Sarah have in total?&lt;/textarea&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>`,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>measurementComparator: `</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="flex flex-col gap-4 w-full"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="flex items-center gap-4 flex-wrap"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;label for="measurementType" class="text-sm font-semibold"&gt;Type:&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;select id="measurementType" class="bg-slate-100 p-1 rounded-md border border-slate-200"&gt;&lt;/select&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;button id="teachQuestionToggle" class="bg-indigo-600 text-white font-semibold py-1 px-3 rounded-lg text-sm ml-auto"&gt;Mode: Teach&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div id="comparatorInputsContainer" class="flex flex-col gap-2"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;button id="addComparatorItem" class="bg-blue-500 text-white font-semibold py-1 px-3 rounded-lg text-sm self-start"&gt;+ Add Measurement&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>`,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>shapeClassifier: `</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="flex items-center gap-4 w-full flex-wrap"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;label for="shapeSelect" class="text-sm font-semibold"&gt;Shape:&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;select id="shapeSelect" class="flex-grow bg-slate-100 p-2 rounded-md border border-slate-200"&gt;&lt;/select&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;button id="shapeClassifierToggle" class="bg-indigo-600 text-white font-semibold py-1 px-3 rounded-lg text-sm"&gt;Mode: Teach&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>`,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>tallyChart: `</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="flex flex-col gap-2 w-full"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div id="tally-rows-container" class="flex flex-col gap-2"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;button id="add-tally-row" class="bg-blue-500 text-white font-semibold py-1 px-3 rounded-lg text-sm self-start mt-2"&gt;+ Add Row&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;`,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>placeValue: `&lt;div class="flex items-center gap-2"&gt;&lt;label class="text-sm font-semibold"&gt;Number:&lt;/label&gt;&lt;input type="text" id="placeValueNumber" value="482.15" class="w-48 p-1 border-2 rounded-lg text-center"&gt;&lt;/div&gt;`,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>equivalencyTool: `</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="flex flex-col gap-4 w-full"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="flex items-center justify-between"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                 </span>&lt;div class="flex items-center gap-4"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                     </span>&lt;div class="flex items-center gap-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;span class="text-sm font-semibold"&gt;Circles&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;button id="equivalency-circle-toggle-btn" class="toggle-btn toggle-on"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;div class="toggle-dot dot-on"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="flex items-center gap-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;span class="text-sm font-semibold"&gt;Labels&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;button id="equivalency-label-toggle-btn" class="toggle-btn toggle-on"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;div class="toggle-dot dot-on"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div id="equivalency-rows-container" class="flex flex-col gap-2"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;button id="add-equivalency-row" class="bg-blue-500 text-white font-semibold py-1 px-3 rounded-lg text-sm self-start mt-2"&gt;+ Add Item&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;`,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>unitRateCalculator: `</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="flex flex-col gap-2 w-full"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div id="unitrate-rows-container" class="flex flex-col gap-2"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;button id="add-unitrate-row" class="bg-blue-500 text-white font-semibold py-1 px-3 rounded-lg text-sm self-start mt-2"&gt;+ Add Item&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;`,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>integerOperations: `</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="flex flex-col gap-2 w-full"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">             </span>&lt;div class="flex items-center gap-4"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="flex items-center gap-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;label class="text-sm font-semibold"&gt;Start Number:&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;input type="number" id="integerStart" value="0" class="w-24 p-1 border-2 rounded-lg text-center"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="flex items-center gap-2 ml-auto"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;button id="integer-op-prev" class="bg-gray-300 hover:bg-gray-400 font-bold py-1 px-3 rounded-lg text-sm disabled:opacity-50 disabled:cursor-not-allowed"&gt;Prev&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;button id="integer-op-next" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-1 px-3 rounded-lg text-sm disabled:opacity-50 disabled:cursor-not-allowed"&gt;Next&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;button id="integer-op-reset" class="bg-red-500 text-white font-bold py-1 px-3 rounded-lg text-sm"&gt;Reset&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div id="integer-ops-container" class="flex flex-col gap-2 mt-2"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;button id="add-integer-op-row" class="bg-blue-500 text-white font-semibold py-1 px-3 rounded-lg text-sm self-start mt-2"&gt;+ Add Operation&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;`,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>dataSetAnalyzer: `</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="flex flex-col gap-2 w-full"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;label class="text-sm font-semibold"&gt;Data (comma-separated):&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;input type="text" id="dataSetInput" value="5, 8, 12, 5, 9, 11, 8, 15" class="w-full p-2 border-2 rounded-lg"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div id="dataSetCalcTypeContainer" class="flex flex-wrap gap-x-4 gap-y-2 mt-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;label&gt;&lt;input type="radio" name="calcType" value="mean" checked&gt; Mean&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;label&gt;&lt;input type="radio" name="calcType" value="median"&gt; Median&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;label&gt;&lt;input type="radio" name="calcType" value="mode"&gt; Mode&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;label&gt;&lt;input type="radio" name="calcType" value="range"&gt; Range&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;label&gt;&lt;input type="radio" name="calcType" value="mad"&gt; MAD&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>`,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>volumeOfSphere: `&lt;div class="flex items-center gap-2"&gt;&lt;label class="text-sm font-semibold"&gt;Radius (r):&lt;/label&gt;&lt;input type="number" id="sphereRadius" value="5" min="0.1" step="0.1" class="w-20 p-1 border-2 rounded-lg text-center"&gt;&lt;/div&gt;`,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>surfaceAreaOfSphere: `&lt;div class="flex items-center gap-2"&gt;&lt;label class="text-sm font-semibold"&gt;Radius (r):&lt;/label&gt;&lt;input type="number" id="sphereRadius" value="5" min="0.1" step="0.1" class="w-20 p-1 border-2 rounded-lg text-center"&gt;&lt;/div&gt;`</span></p>
<p class="p1"><span class="s1">};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">// --- HELPER &amp; CLEANUP FUNCTIONS ---</span></p>
<p class="p1"><span class="s1">function showMessage(message, duration = 3000) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>messageBox.textContent = message;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>messageBox.style.display = 'block';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>setTimeout(() =&gt; { messageBox.style.display = 'none'; }, duration);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function cleanupEventListeners() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>activeListeners.forEach(({ target, type, handler }) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>target.removeEventListener(type, handler);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>activeListeners = [];</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function addManagedListener(target, type, handler) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>target.addEventListener(type, handler);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>activeListeners.push({ target, type, handler });</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function cleanupThreeScene() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (animationFrameId) cancelAnimationFrame(animationFrameId);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (scene) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>scene.traverse(object =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (object.geometry) object.geometry.dispose();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (object.material) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>if (Array.isArray(object.material)) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>object.material.forEach(material =&gt; material.dispose());</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>object.material.dispose();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>scene.clear();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (renderer) renderer.dispose();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (labelRenderer &amp;&amp; labelRenderer.domElement.parentNode) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>labelRenderer.domElement.parentNode.removeChild(labelRenderer.domElement);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>labelRenderer = null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>canvas3DGlobal.classList.add('hidden');</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function resetDisplayAreas() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>cleanupThreeScene();<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>htmlDisplay.innerHTML = '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>htmlDisplay.className = 'w-full h-full flex items-center justify-center gap-4';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>interactiveDisplay.innerHTML = '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>interactiveResultContent.innerHTML = '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>standardDisplayArea.className = 'display-area';</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">// --- TOOL-SPECIFIC FUNCTIONS ---</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">// Tool: Cardinality Counter</span></p>
<p class="p1"><span class="s1">function setupCardinality() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addManagedListener(interactiveDisplay, 'click', handleCardinalityClick);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function drawCardinality() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>cardinalityCounter = 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>interactiveResultTitle.textContent = "Count:";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>interactiveResultContent.innerHTML = `&lt;div class="text-3xl md:text-4xl lg:text-5xl"&gt;$$0$$&lt;/div&gt;`;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const emoji = document.getElementById('emojiSelect').value;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const count = parseInt(document.getElementById('emojiCount').value);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const scatter = document.getElementById('scatterCheck').checked;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const container = interactiveDisplay;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>container.innerHTML = '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const padding = 30;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const w = container.clientWidth - padding * 2;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const h = container.clientHeight - padding * 2;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const size = Math.max(20, Math.min(60, w / Math.sqrt(count * 2.5)));</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>for (let i = 0; i &lt; count; i++) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const el = document.createElement('div');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>el.className = 'emoji-item';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>el.textContent = emoji;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>el.style.fontSize = `${size}px`;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>let x, y;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (scatter) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>x = Math.random() * (w - size) + padding;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>y = Math.random() * (h - size) + padding;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const itemsPerRow = Math.floor(w / (size * 1.2));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const row = Math.floor(i / itemsPerRow);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const col = i % itemsPerRow;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>x = padding + col * (size * 1.2);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>y = padding + row * (size * 1.2);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>el.style.left = `${x}px`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>el.style.top = `${y}px`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>container.appendChild(el);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function handleCardinalityClick(event) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const target = event.target;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (target.classList.contains('emoji-item') &amp;&amp; !target.classList.contains('clicked')) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>target.classList.add('clicked');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>cardinalityCounter++;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>interactiveResultContent.innerHTML = `&lt;div class="text-3xl md:text-4xl lg:text-5xl"&gt;$$${cardinalityCounter}$$&lt;/div&gt;`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (window.MathJax) MathJax.typesetPromise([interactiveResultContent]);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">// Tool: Vertical Object Counter</span></p>
<p class="p1"><span class="s1">function setupVerticalComparison() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addManagedListener(interactiveDisplay, 'click', handleVerticalComparisonClick);</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addManagedListener(interactiveDisplay, 'mousemove', (event) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const { canvas, leftItems, rightItems } = verticalComparisonState;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (!canvas) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const rect = canvas.getBoundingClientRect();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const x = event.clientX - rect.left;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const y = event.clientY - rect.top;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const checkHit = (item) =&gt; (x &gt;= item.x &amp;&amp; x &lt;= item.x + item.size &amp;&amp; y &gt;= item.y &amp;&amp; y &lt;= item.y + item.size);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const allItems = [...leftItems, ...rightItems];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const isHoveringClickable = allItems.some(item =&gt; !item.clicked &amp;&amp; checkHit(item));</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>canvas.style.cursor = isHoveringClickable ? 'pointer' : 'default';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function drawVerticalComparison() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>verticalComparisonState = { leftItems: [], rightItems: [], leftCount: 0, rightCount: 0, canvas: null, ctx: null };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>interactiveResultTitle.textContent = "Comparison Counts:";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>interactiveResultContent.innerHTML = `&lt;div class="text-3xl md:text-4xl lg:text-5xl" id="verticalComparisonResult"&gt;$$ \\text{Nature: } 0 \\quad \\text{Space: } 0 $$&lt;/div&gt;`;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>interactiveDisplay.innerHTML = '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const canvas = document.createElement('canvas');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>canvas.width = interactiveDisplay.clientWidth;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>canvas.height = interactiveDisplay.clientHeight;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>interactiveDisplay.appendChild(canvas);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>verticalComparisonState.canvas = canvas;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>verticalComparisonState.ctx = canvas.getContext('2d');</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const midX = canvas.width / 2;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const count1 = parseInt(document.getElementById('emojiCount1').value);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const emoji1 = document.getElementById('emojiSelect1').value;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const scatter1 = document.getElementById('scatterCheck1').checked;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>verticalComparisonState.leftItems = generateCanvasItems(count1, emoji1, scatter1, { x: 0, y: 0, w: midX, h: canvas.height });</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const count2 = parseInt(document.getElementById('emojiCount2').value);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const emoji2 = document.getElementById('emojiSelect2').value;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const scatter2 = document.getElementById('scatterCheck2').checked;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>verticalComparisonState.rightItems = generateCanvasItems(count2, emoji2, scatter2, { x: midX, y: 0, w: midX, h: canvas.height });</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>redrawComparisonCanvas();</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function generateCanvasItems(count, emoji, scatter, bounds) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const items = [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const paddingX = 30;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const paddingY = 10;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const w = bounds.w - paddingX * 2;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const h = bounds.h - paddingY * 2;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const size = Math.max(20, Math.min(50, w / Math.sqrt(count * 2.5)));</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>for (let i = 0; i &lt; count; i++) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>let x, y;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (scatter) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>x = Math.random() * (w - size) + paddingX + bounds.x;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>y = Math.random() * (h - size) + paddingY + bounds.y;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const itemsPerRow = Math.floor(w / (size * 1.2));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const row = Math.floor(i / itemsPerRow);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const col = i % itemsPerRow;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>x = paddingX + col * (size * 1.2) + bounds.x;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>y = paddingY + row * (size * 1.2) + bounds.y;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>items.push({ x, y, size, emoji, clicked: false });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return items;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function redrawComparisonCanvas() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const { canvas, ctx, leftItems, rightItems } = verticalComparisonState;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (!ctx) return;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.clearRect(0, 0, canvas.width, canvas.height);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const midX = canvas.width / 2;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.fillStyle = '#dbeafe';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.fillRect(0, 0, canvas.width, canvas.height);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.strokeStyle = '#94a3b8'; // slate-400</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.lineWidth = 2;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.setLineDash([5, 5]);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.beginPath();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.moveTo(midX, 0);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.lineTo(midX, canvas.height);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.stroke();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.setLineDash([]);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const drawItems = (items) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>items.forEach(item =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>ctx.font = `${item.size}px Montserrat`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>ctx.textAlign = 'left';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>ctx.textBaseline = 'top';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (item.clicked) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>ctx.fillStyle = 'rgba(253, 224, 71, 0.6)';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>ctx.beginPath();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>ctx.arc(item.x + item.size / 2, item.y + item.size / 2, item.size * 0.6, 0, 2 * Math.PI);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>ctx.fill();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>ctx.fillStyle = '#000000';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>ctx.fillText(item.emoji, item.x, item.y);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>};</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>drawItems(leftItems);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>drawItems(rightItems);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function handleVerticalComparisonClick(event) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const { canvas, leftItems, rightItems } = verticalComparisonState;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const rect = canvas.getBoundingClientRect();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const x = event.clientX - rect.left;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const y = event.clientY - rect.top;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const midX = canvas.width / 2;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const checkHit = (item) =&gt; (x &gt;= item.x &amp;&amp; x &lt;= item.x + item.size &amp;&amp; y &gt;= item.y &amp;&amp; y &lt;= item.y + item.size);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const itemsToCheck = (x &lt; midX) ? leftItems : rightItems;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const clickedItem = itemsToCheck.find(item =&gt; !item.clicked &amp;&amp; checkHit(item));</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (clickedItem) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>clickedItem.clicked = true;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (x &lt; midX) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>verticalComparisonState.leftCount++;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>verticalComparisonState.rightCount++;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const resultDiv = document.getElementById('verticalComparisonResult');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (resultDiv) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>resultDiv.innerHTML = `$$ \\text{Nature: } ${verticalComparisonState.leftCount} \\quad \\text{Space: } ${verticalComparisonState.rightCount} $$`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (window.MathJax) MathJax.typesetPromise([resultDiv]);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>redrawComparisonCanvas();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">// Tool: Numeral Display</span></p>
<p class="p1"><span class="s1">function setupNumeralDisplay() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (!numeralDisplayState.canvas) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const state = numeralDisplayState;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const getMousePos = (e) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const rect = state.canvas.getBoundingClientRect();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>return { x: e.clientX - rect.left, y: e.clientY - rect.top };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const startDrawing = (e) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>state.drawing = true;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>state.currentPath = [getMousePos(e)];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>};</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const draw = (e) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const pos = getMousePos(e);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>state.cursor.style.left = `${pos.x}px`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>state.cursor.style.top = `${pos.y}px`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (!state.drawing) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>state.currentPath.push(pos);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>redrawNumeralCanvas();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>};</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const stopDrawing = () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (!state.drawing) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>state.drawing = false;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>state.paths.push(state.currentPath);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addManagedListener(state.canvas, 'mousedown', startDrawing);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addManagedListener(state.canvas, 'mousemove', draw);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addManagedListener(state.canvas, 'mouseup', stopDrawing);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addManagedListener(state.canvas, 'mouseleave', () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>stopDrawing();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>state.cursor.style.display = 'none';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addManagedListener(state.canvas, 'mouseenter', () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>state.cursor.style.display = 'block';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addManagedListener(document.getElementById('clearBtn'), 'click', () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>state.paths = [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>state.currentPath = [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>redrawNumeralCanvas();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addManagedListener(document.getElementById('undoBtn'), 'click', () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>state.paths.pop();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>state.currentPath = [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>redrawNumeralCanvas();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function redrawNumeralCanvas() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const { ctx, canvas, paths, currentPath } = numeralDisplayState;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (!ctx) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.clearRect(0, 0, canvas.width, canvas.height);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.strokeStyle = "#22c55e";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.lineWidth = 30;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.globalAlpha = 0.5;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.lineCap = 'round';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.lineJoin = 'round';</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const drawPath = (path) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (path.length &lt; 2) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.beginPath();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.moveTo(path[0].x, path[0].y);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>for (let i = 1; i &lt; path.length; i++) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>ctx.lineTo(path[i].x, path[i].y);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.stroke();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>paths.forEach(drawPath);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (currentPath.length &gt; 0) drawPath(currentPath);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function drawNumeralDisplay() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>htmlDisplay.classList.remove('hidden');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>canvas3DGlobal.classList.add('hidden');</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const numStr = document.getElementById('numeralInput').value.toString();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (!numStr) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>htmlDisplay.innerHTML = '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>stepsContentContainer.innerHTML = `&lt;p class="text-xl text-slate-500"&gt;Enter a number to see it displayed.&lt;/p&gt;`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>htmlDisplay.innerHTML = `&lt;span id="numeralText" style="font-family: 'Comic Sans MS', cursive, sans-serif; line-height: 1;"&gt;${numStr}&lt;/span&gt;`;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>requestAnimationFrame(() =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const textSpan = document.getElementById('numeralText');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (!textSpan) return;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const containerWidth = htmlDisplay.clientWidth;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const fontSize = Math.min(320, containerWidth / (numStr.length * 0.6 + 0.4));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>textSpan.style.fontSize = `${fontSize}px`;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>requestAnimationFrame(() =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const canvas = document.createElement('canvas');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>canvas.id = 'numeralDrawingCanvas';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>canvas.width = htmlDisplay.clientWidth;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>canvas.height = htmlDisplay.clientHeight;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>htmlDisplay.appendChild(canvas);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const cursor = document.createElement('div');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>cursor.id = 'customCursor';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>htmlDisplay.appendChild(cursor);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>numeralDisplayState = {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>canvas,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>ctx: canvas.getContext('2d'),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>cursor,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>drawing: false,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>paths: [],</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>currentPath: []</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>};</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>setupNumeralDisplay();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const answerIsOn = answerToggleBtn.classList.contains('toggle-on');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>calculationStepsColumn.style.display = answerIsOn ? 'flex' : 'none';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>stepsContentContainer.innerHTML = `&lt;p class="text-xl text-slate-700"&gt;Trace over the number with the drawing tool.&lt;/p&gt;`;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">// Tool: Word Problem Visualizer</span></p>
<p class="p1"><span class="s1">function drawWordProblemVisualizer() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>htmlDisplay.innerHTML = '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>htmlDisplay.className = 'display-area p-8 items-center justify-center';</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const text = document.getElementById('wordProblemText').value;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const textContainer = document.createElement('div');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>textContainer.textContent = text;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>textContainer.className = 'text-3xl md:text-4xl lg:text-5xl';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>textContainer.style.fontFamily = "'Times New Roman', Times, serif";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>textContainer.style.textAlign = 'center';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>textContainer.style.lineHeight = '1.4';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>textContainer.style.color = '#1e293b';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>htmlDisplay.appendChild(textContainer);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const answerIsOn = answerToggleBtn.classList.contains('toggle-on');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>calculationStepsColumn.style.display = answerIsOn ? 'flex' : 'none';</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const resultData = calculateWordProblem();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>stepsContentContainer.innerHTML = `&lt;div class="text-3xl md:text-4xl lg:text-5xl"&gt;${resultData.html}&lt;/div&gt;`;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (window.MathJax &amp;&amp; window.MathJax.startup) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>MathJax.startup.promise.then(() =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>MathJax.typesetPromise([stepsContentContainer]).catch(err =&gt; console.error('MathJax typeset error:', err));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function calculateWordProblem() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const text = document.getElementById('wordProblemText').value;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const numbers = text.match(/\d+(\.\d+)?/g)?.map(Number);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (!numbers || numbers.length &lt; 2) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>return { html: "&lt;p class='text-xl'&gt;Not enough numbers found.&lt;/p&gt;", equation: "" };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let op = '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let result = 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let opSymbol = '';</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (/\beach\b|product|times/i.test(text)) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>op = 'multiplication';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>opSymbol = '\\times';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>result = numbers.reduce((a, b) =&gt; a * b);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>} else if (/\b(total|sum|altogether|in all)\b/i.test(text)) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>op = 'addition';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>opSymbol = '+';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>result = numbers.reduce((a, b) =&gt; a + b);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>} else if (/\b(left|difference|how many more)\b/i.test(text)) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>op = 'subtraction';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>opSymbol = '-';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>numbers.sort((a, b) =&gt; b - a);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>result = numbers[0] - numbers[1];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>} else if (/\b(split|share|divide)\b/i.test(text)) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>op = 'division';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>opSymbol = '\\div';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>numbers.sort((a, b) =&gt; b - a);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>result = numbers[0] / numbers[1];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>return { html: "&lt;p class='text-xl'&gt;Could not determine operation.&lt;/p&gt;", equation: "" };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const equation = numbers.join(` ${opSymbol} `) + ` = ${result}`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const html = `$$${equation}$$`;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return { html, equation };</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">// Tool: Measurement Comparison</span></p>
<p class="p1"><span class="s1">const measurementUnits = {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>length: { base: 'm', units: { 'mm': 0.001, 'cm': 0.01, 'dm': 0.1, 'm': 1, 'dam': 10, 'hm': 100, 'km': 1000, 'in': 0.0254, 'ft': 0.3048, 'yd': 0.9144, 'mi': 1609.34 } },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>weight: { base: 'g', units: { 'mg': 0.001, 'g': 1, 'kg': 1000, 'oz': 28.3495, 'lb': 453.592 } },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>volume: { base: 'L', units: { 'mL': 0.001, 'L': 1, 'fl oz': 0.0295735, 'c': 0.24, 'pt': 0.473176, 'qt': 0.946353, 'gal': 3.78541 } }</span></p>
<p class="p1"><span class="s1">};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">const barColors = ['#16a34a', '#2563eb', '#ca8a04', '#c026d3', '#db2777', '#d97706'];</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function setupMeasurementComparator() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const typeSelector = document.getElementById('measurementType');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const toggleButton = document.getElementById('teachQuestionToggle');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const addButton = document.getElementById('addComparatorItem');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const container = document.getElementById('comparatorInputsContainer');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>container.innerHTML = '';</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>typeSelector.innerHTML = Object.keys(measurementUnits).map(key =&gt; `&lt;option value="${key}"&gt;${key.charAt(0).toUpperCase() + key.slice(1)}&lt;/option&gt;`).join('');</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addManagedListener(typeSelector, 'change', () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>updateAllMeasurementUnits();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>handleDraw();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addManagedListener(toggleButton, 'click', () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>measurementComparatorState.mode = measurementComparatorState.mode === 'teach' ? 'question' : 'teach';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>toggleButton.textContent = `Mode: ${measurementComparatorState.mode.charAt(0).toUpperCase() + measurementComparatorState.mode.slice(1)}`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>handleDraw();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addManagedListener(addButton, 'click', () =&gt; addComparatorItem());</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addComparatorItem(null, '1', 'km');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addComparatorItem(null, '1200', 'm');</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function addComparatorItem(id = null, value = '1', unit = null) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const container = document.getElementById('comparatorInputsContainer');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (!id) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>id = String.fromCharCode(65 + container.children.length);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const itemIndex = container.children.length;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const color = barColors[itemIndex % barColors.length];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const bgColor = `${color}1A`;<span class="Apple-converted-space"> </span></span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const itemDiv = document.createElement('div');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>itemDiv.id = `comparator-item-${id}`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>itemDiv.className = 'p-3 border rounded-lg flex-1 flex items-center gap-x-4 gap-y-2 flex-wrap';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>itemDiv.style.borderColor = color;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>itemDiv.style.backgroundColor = bgColor;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>itemDiv.innerHTML = `</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;span class="font-bold text-lg" style="color: ${color};"&gt;${id}:&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;input type="number" value="${value}" min="0" class="w-24 p-1 border-2 rounded-lg text-center comparator-value"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;select class="bg-white p-1 rounded-md border border-slate-200 text-sm comparator-unit"&gt;&lt;/select&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;button class="remove-item-btn font-bold text-red-500 ml-auto text-xl"&gt;×&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>`;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>container.appendChild(itemDiv);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const unitSelect = itemDiv.querySelector('.comparator-unit');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>populateUnitSelect(unitSelect);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (unit) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>unitSelect.value = unit;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addManagedListener(itemDiv.querySelector('.remove-item-btn'), 'click', () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>itemDiv.remove();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const remainingItems = container.children;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>for(let i=0; i &lt; remainingItems.length; i++) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const newId = String.fromCharCode(65 + i);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const label = remainingItems[i].querySelector('span');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const color = barColors[i % barColors.length];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>label.textContent = `${newId}:`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>label.style.color = color;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>remainingItems[i].style.borderColor = color;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>remainingItems[i].style.backgroundColor = `${color}1A`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>handleDraw();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>itemDiv.querySelectorAll('input, select').forEach(el =&gt; addManagedListener(el, 'input', handleDraw));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>handleDraw();</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function populateUnitSelect(selectElement) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const type = document.getElementById('measurementType').value;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (!type) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const { units } = measurementUnits[type];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const currentVal = selectElement.value;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>selectElement.innerHTML = Object.keys(units).map(unit =&gt; `&lt;option value="${unit}"&gt;${unit}&lt;/option&gt;`).join('');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (Object.keys(units).includes(currentVal)) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>selectElement.value = currentVal;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function updateAllMeasurementUnits() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>document.querySelectorAll('.comparator-unit').forEach(populateUnitSelect);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function calculateAllMeasurements() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const values = [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const items = document.querySelectorAll('#comparatorInputsContainer &gt; div');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const type = document.getElementById('measurementType').value;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (!type) return [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const conversionInfo = measurementUnits[type];</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>items.forEach((item, index) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const id = String.fromCharCode(65 + index);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const valueInput = item.querySelector('.comparator-value');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const unitSelect = item.querySelector('.comparator-unit');</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (valueInput &amp;&amp; unitSelect) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const value = parseFloat(valueInput.value) || 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const unit = unitSelect.value;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const totalInBase = value * (conversionInfo.units[unit] || 1);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>values.push({ id, value, unit, totalInBase, baseUnit: conversionInfo.base });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return values;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function drawMeasurementComparator() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>interactiveDisplay.innerHTML = '';<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const canvas = document.createElement('canvas');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>canvas.width = interactiveDisplay.clientWidth;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>canvas.height = interactiveDisplay.clientHeight;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>interactiveDisplay.appendChild(canvas);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const ctx = canvas.getContext('2d');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const allValues = calculateAllMeasurements();</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>updateComparatorLayout();</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (measurementComparatorState.mode === 'teach' || (measurementComparatorState.mode === 'question' &amp;&amp; answerToggleBtn.classList.contains('toggle-on'))) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>drawComparisonBars(ctx, allValues);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>calculateAndDisplayMeasurementResult(allValues);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function updateComparatorLayout() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const isTeachMode = measurementComparatorState.mode === 'teach';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const answerIsOn = answerToggleBtn.classList.contains('toggle-on');</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>interactiveResult.classList.remove('hidden');</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (isTeachMode) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>interactiveDisplay.classList.remove('hidden');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>interactiveResult.classList.toggle('hidden', !answerIsOn);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>interactiveResultTitle.textContent = "Comparison Result:";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>interactiveResult.classList.remove('hidden');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>interactiveDisplay.classList.toggle('hidden', !answerIsOn);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>interactiveResultTitle.textContent = "Which is greatest?";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function drawComparisonBars(ctx, values) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const w = ctx.canvas.width;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const h = ctx.canvas.height;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.clearRect(0, 0, w, h);</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (!values || values.length === 0) return;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const padding = 50;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const topY = padding;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const bottomY = h - padding;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const availableHeight = bottomY - topY;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const numItems = values.length;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const totalGapWidth = (padding / 2) * (numItems - 1);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const barWidth = (w - 2 * padding - totalGapWidth) / numItems;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const maxValue = Math.max(1, ...values.map(v =&gt; v.totalInBase));</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.lineWidth = 1;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>for (let i = 1; i &lt; 10; i++) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const y = topY + i * (availableHeight / 10);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.beginPath();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.moveTo(padding, y);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.lineTo(w - padding, y);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.stroke();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>values.forEach((item, index) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const barHeight = (item.totalInBase / maxValue) * availableHeight;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const barX = padding + index * (barWidth + padding / 2);</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.save();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.shadowColor = 'rgba(0,0,0,0.3)';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.shadowBlur = 8;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.shadowOffsetX = 4;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.shadowOffsetY = 4;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const gradient = ctx.createLinearGradient(0, bottomY - barHeight, 0, bottomY);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>gradient.addColorStop(0, '#87CEFA');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>gradient.addColorStop(1, '#007bff');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.fillStyle = gradient;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.fillRect(barX, bottomY - barHeight, barWidth, barHeight);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.restore();</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.strokeStyle = '#000000';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.lineWidth = 2;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.strokeRect(barX, bottomY - barHeight, barWidth, barHeight);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.fillStyle = '#111827';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.font = 'bold 16px Montserrat';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.textAlign = 'center';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const displayValue = item.value &lt; 0.01 &amp;&amp; item.value &gt; 0 ? item.value.toExponential(2) : item.value.toLocaleString();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.fillText(`${displayValue} ${item.unit}`, barX + barWidth / 2, bottomY + 25);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function calculateAndDisplayMeasurementResult(values) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (!values || values.length === 0) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>interactiveResultContent.innerHTML = `&lt;p class="text-slate-400"&gt;Add a measurement to begin.&lt;/p&gt;`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const sorted = [...values].sort((a, b) =&gt; b.totalInBase - a.totalInBase);</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let resultHtml;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (measurementComparatorState.mode === 'teach') {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>interactiveResultTitle.textContent = "Comparison Results (Ranked):";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>let mathjaxStr = '\\begin{align*}';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>sorted.forEach(v =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>mathjaxStr += `\\text{${v.id}:} &amp;\\quad ${v.value.toLocaleString()}\\,\\text{${v.unit}} \\\\`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>mathjaxStr += '\\end{align*}';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>resultHtml = `&lt;div class="text-3xl md:text-4xl lg:text-5xl text-left"&gt;$$${mathjaxStr}$$&lt;/div&gt;`;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>} else { // Question mode</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>interactiveResultTitle.textContent = "Which is greatest?";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const greatest = sorted[0];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>resultHtml = `&lt;div class="text-3xl md:text-4xl lg:text-5xl"&gt;$$${greatest.value.toLocaleString()}\\,\\text{${greatest.unit}}$$&lt;/div&gt;`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>interactiveResultContent.innerHTML = resultHtml;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">// Tool: Shape Classifier</span></p>
<p class="p1"><span class="s1">const shapeProperties = {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// 2D Shapes</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>square: { name: "Square", type: "2D", sides: 4, vertices: 4, parallel_sides: 2, line_symmetry: 4, angleInfo: "All 4 angles are 90°." },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>rectangle: { name: "Rectangle", type: "2D", sides: 4, vertices: 4, parallel_sides: 2, line_symmetry: 2, angleInfo: "All 4 angles are 90°." },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>circle: { name: "Circle", type: "2D", sides: 1, vertices: 0, parallel_sides: "N/A", line_symmetry: "Infinite", angleInfo: "360° total angle." },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ellipse: { name: "Ellipse", type: "2D", sides: 1, vertices: 0, parallel_sides: "N/A", line_symmetry: 2, angleInfo: "A stretched circle." },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>triangle_eq: { name: "Equilateral Triangle", type: "2D", sides: 3, vertices: 3, parallel_sides: 0, line_symmetry: 3, angleInfo: "All 3 angles are 60°." },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>triangle_iso: { name: "Isosceles Triangle", type: "2D", sides: 3, vertices: 3, parallel_sides: 0, line_symmetry: 1, angleInfo: "Two equal sides, two equal angles." },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>triangle_right: { name: "Right-Angled Triangle", type: "2D", sides: 3, vertices: 3, parallel_sides: 0, line_symmetry: "Varies (0 or 1)", angleInfo: "One angle is 90°." },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>triangle_scalene: { name: "Scalene Triangle", type: "2D", sides: 3, vertices: 3, parallel_sides: 0, line_symmetry: 0, angleInfo: "No equal sides or angles." },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>rhombus: { name: "Rhombus", type: "2D", sides: 4, vertices: 4, parallel_sides: 2, line_symmetry: 2, angleInfo: "All sides equal length. Opposite angles are equal." },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>parallelogram: { name: "Parallelogram", type: "2D", sides: 4, vertices: 4, parallel_sides: 2, line_symmetry: 0, angleInfo: "Opposite sides are parallel and equal in length." },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>trapezoid: { name: "Trapezoid", type: "2D", sides: 4, vertices: 4, parallel_sides: 1, line_symmetry: "Varies (0 or 1)", angleInfo: "One pair of parallel sides." },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>kite: { name: "Kite", type: "2D", sides: 4, vertices: 4, parallel_sides: 0, line_symmetry: 1, angleInfo: "Two pairs of equal-length sides that are adjacent to each other." },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>pentagon: { name: "Regular Pentagon", type: "2D", sides: 5, vertices: 5, parallel_sides: 0, line_symmetry: 5, angleInfo: "Each interior angle is 108°." },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>hexagon: { name: "Regular Hexagon", type: "2D", sides: 6, vertices: 6, parallel_sides: 3, line_symmetry: 6, angleInfo: "Each interior angle is 120°." },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>octagon: { name: "Regular Octagon", type: "2D", sides: 8, vertices: 8, parallel_sides: 4, line_symmetry: 8, angleInfo: "Each interior angle is 135°." },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// 3D Shapes</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>cube: { name: "Cube", type: "3D", faces: 6, vertices: 8, edges: 12, face_shape: "Square" },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>cuboid: { name: "Cuboid (Rectangular Prism)", type: "3D", faces: 6, vertices: 8, edges: 12, face_shape: "Rectangle" },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>sphere: { name: "Sphere", type: "3D", faces: 1, vertices: 0, edges: 0, face_shape: "Curved surface" },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>cylinder: { name: "Cylinder", type: "3D", faces: 3, vertices: 0, edges: 2, face_shape: "2 Circles, 1 Rectangle (unrolled)" },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>cone: { name: "Cone", type: "3D", faces: 2, vertices: 1, edges: 1, face_shape: "1 Circle, 1 Sector (unrolled)" },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>pyramid_sq: { name: "Square-Based Pyramid", type: "3D", faces: 5, vertices: 5, edges: 8, face_shape: "1 Square, 4 Triangles" },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>prism_tri: { name: "Triangular Prism", type: "3D", faces: 5, vertices: 6, edges: 9, face_shape: "2 Triangles, 3 Rectangles" },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>tetrahedron: { name: "Tetrahedron (Regular)", type: "3D", faces: 4, vertices: 4, edges: 6, face_shape: "Equilateral Triangle" },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>torus: { name: "Torus", type: "3D", faces: 1, vertices: 0, edges: 0, face_shape: "Curved surface (donut)" },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>prism_pent: { name: "Pentagonal Prism", type: "3D", faces: 7, vertices: 10, edges: 15, face_shape: "2 Pentagons, 5 Rectangles" },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>prism_hex: { name: "Hexagonal Prism", type: "3D", faces: 8, vertices: 12, edges: 18, face_shape: "2 Hexagons, 6 Rectangles" },</span></p>
<p class="p1"><span class="s1">};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function setupShapeClassifier() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const selector = document.getElementById('shapeSelect');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>selector.innerHTML = Object.keys(shapeProperties).map(key =&gt; `&lt;option value="${key}"&gt;${shapeProperties[key].name}&lt;/option&gt;`).join('');</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addManagedListener(selector, 'change', handleDraw);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const toggleButton = document.getElementById('shapeClassifierToggle');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addManagedListener(toggleButton, 'click', () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>shapeClassifierState.mode = shapeClassifierState.mode === 'teach' ? 'question' : 'teach';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>toggleButton.textContent = `Mode: ${shapeClassifierState.mode.charAt(0).toUpperCase() + shapeClassifierState.mode.slice(1)}`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>handleDraw();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function drawShapeClassifier() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const shapeKey = document.getElementById('shapeSelect').value;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const shape = shapeProperties[shapeKey];</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const isTeachMode = shapeClassifierState.mode === 'teach';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const answerIsOn = answerToggleBtn.classList.contains('toggle-on');</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let showShape;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (isTeachMode) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>showShape = true;<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>stepsContentTitle.textContent = "Properties:";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>calculationStepsColumn.style.display = answerIsOn ? 'flex' : 'none';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>} else { // Question Mode</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>showShape = answerIsOn;<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>stepsContentTitle.textContent = "What shape has these properties?";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>calculationStepsColumn.style.display = 'flex';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (showShape) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (shape.type === '3D') {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>draw3DShape(shapeKey, standardDisplayArea);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>draw2DShape(shapeKey, htmlDisplay);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>cleanupThreeScene();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>htmlDisplay.classList.remove('hidden');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>htmlDisplay.innerHTML = '&lt;p class="text-8xl text-slate-500 font-bold"&gt;?&lt;/p&gt;';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>stepsContentContainer.innerHTML = calculateShapeProperties(shape, isTeachMode);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function draw3DShape(key, container, dims = null) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>cleanupThreeScene();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>htmlDisplay.classList.add('hidden');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>canvas3DGlobal.classList.remove('hidden');</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const width = canvas3DGlobal.clientWidth;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const height = canvas3DGlobal.clientHeight;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>scene = new THREE.Scene();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>scene.background = new THREE.Color(0xdbeafe);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>camera = new THREE.PerspectiveCamera(50, width / height, 0.1, 1000);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>renderer = new THREE.WebGLRenderer({ canvas: canvas3DGlobal, antialias: true, alpha: true });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>renderer.setSize(width, height);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>renderer.setPixelRatio(window.devicePixelRatio);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>labelRenderer = new THREE.CSS2DRenderer();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>labelRenderer.setSize(width, height);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>labelRenderer.domElement.style.position = 'absolute';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>labelRenderer.domElement.style.top = '0px';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>labelRenderer.domElement.style.pointerEvents = 'none';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>labelRenderer.domElement.classList.add('css2d-container');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>container.appendChild(labelRenderer.domElement);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const ambientLight = new THREE.AmbientLight(0xffffff, 0.7);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>scene.add(ambientLight);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const light = new THREE.DirectionalLight(0xffffff, 0.9);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>light.position.set(5, 10, 7);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>scene.add(light);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let geometry;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const s = 1.5;<span class="Apple-converted-space"> </span></span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>switch (key) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case 'cube': geometry = new THREE.BoxGeometry(s, s, s); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case 'cuboid': geometry = new THREE.BoxGeometry(s * 1.5, s * 0.8, s); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case 'sphere': geometry = new THREE.SphereGeometry(s * 0.9, 32, 16); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case 'cylinder': geometry = new THREE.CylinderGeometry(s / 2, s / 2, s * 1.5, 32); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case 'cone': geometry = new THREE.ConeGeometry(s / 1.5, s * 1.5, 32); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case 'pyramid_sq': geometry = new THREE.ConeGeometry(s, s * 1.2, 4); geometry.rotateY(Math.PI / 4); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case 'prism_tri': geometry = new THREE.CylinderGeometry(s / 1.5, s / 1.5, s * 1.8, 3); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case 'tetrahedron': geometry = new THREE.TetrahedronGeometry(s); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case 'torus': geometry = new THREE.TorusGeometry(s * 0.8, s * 0.3, 16, 100); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case 'prism_pent': geometry = new THREE.CylinderGeometry(s / 1.5, s / 1.5, s * 1.8, 5); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case 'prism_hex': geometry = new THREE.CylinderGeometry(s / 1.5, s / 1.5, s * 1.8, 6); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>default: geometry = new THREE.BoxGeometry(s, s, s);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const material = new THREE.MeshStandardMaterial({</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>color: 0x007bff,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>roughness: 0.7,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>metalness: 0.1,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>transparent: true,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>opacity: 0.75,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>object3D = new THREE.Mesh(geometry, material);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>scene.add(object3D);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const edges = new THREE.EdgesGeometry(geometry);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>object3D.add(new THREE.LineSegments(edges, new THREE.LineBasicMaterial({ color: 0x000000, linewidth: 2 })));</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (dims) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const createLabel = (text, position) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const div = document.createElement('div');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>div.className = 'dimension-label';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>div.textContent = text;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const label = new THREE.CSS2DObject(div);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>label.position.copy(position);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>return label;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>};</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const geomDims = {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>s: s,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>cuboidW: s * 1.5, cuboidH: s * 0.8, cuboidD: s,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>sphereR: s * 0.9,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>cylR: s / 2, cylH: s * 1.5,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>coneR: s / 1.5, coneH: s * 1.5,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>pyrBase: s, pyrH: s * 1.2</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>switch (key) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>case 'sphere': {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const radiusLineMat = new THREE.LineBasicMaterial({ color: 0xff0000, linewidth: 3 });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const radiusPoints = [new THREE.Vector3(0, 0, 0), new THREE.Vector3(geomDims.sphereR, 0, 0)];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const radiusLineGeom = new THREE.BufferGeometry().setFromPoints(radiusPoints);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const radiusLine = new THREE.Line(radiusLineGeom, radiusLineMat);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>object3D.add(radiusLine);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>object3D.add(createLabel(`r = ${dims.r}`, new THREE.Vector3(geomDims.sphereR / 2, geomDims.sphereR * 0.2, 0)));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>case 'cube':</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>object3D.add(createLabel(`s = ${dims.s}`, new THREE.Vector3(0, geomDims.s / 2 + 0.2, 0)));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>case 'cuboid':</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>object3D.add(createLabel(`l=${dims.l}`, new THREE.Vector3(0, geomDims.cuboidH / 2 + 0.2, 0)));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>object3D.add(createLabel(`w=${dims.w}`, new THREE.Vector3(geomDims.cuboidW / 2 + 0.2, 0, 0)));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>object3D.add(createLabel(`h=${dims.h}`, new THREE.Vector3(0, 0, geomDims.cuboidD / 2 + 0.2)));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>case 'cylinder': {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const radiusLineMat = new THREE.LineBasicMaterial({ color: 0xff0000, linewidth: 3 });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const radiusPoints = [new THREE.Vector3(0, -geomDims.cylH/2, 0), new THREE.Vector3(geomDims.cylR, -geomDims.cylH/2, 0)];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const radiusLineGeom = new THREE.BufferGeometry().setFromPoints(radiusPoints);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>object3D.add(new THREE.Line(radiusLineGeom, radiusLineMat));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>object3D.add(createLabel(`r = ${dims.r}`, new THREE.Vector3(geomDims.cylR / 2, -geomDims.cylH/2, 0)));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>object3D.add(createLabel(`h = ${dims.h}`, new THREE.Vector3(-geomDims.cylR - 0.2, 0, 0)));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>case 'cone': {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const radiusLineMat = new THREE.LineBasicMaterial({ color: 0xff0000, linewidth: 3 });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const radiusPoints = [new THREE.Vector3(0, -geomDims.coneH/2, 0), new THREE.Vector3(geomDims.coneR, -geomDims.coneH/2, 0)];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const radiusLineGeom = new THREE.BufferGeometry().setFromPoints(radiusPoints);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>object3D.add(new THREE.Line(radiusLineGeom, radiusLineMat));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>object3D.add(createLabel(`r = ${dims.r}`, new THREE.Vector3(geomDims.coneR / 2, -geomDims.coneH/2, 0)));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>object3D.add(createLabel(`h = ${dims.h}`, new THREE.Vector3(-geomDims.coneR/2 - 0.2, 0, 0)));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>case 'pyramid_sq':</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>object3D.add(createLabel(`h = ${dims.h}`, new THREE.Vector3(0.2, 0, 0)));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>object3D.add(createLabel(`base = ${dims.b}`, new THREE.Vector3(0, -geomDims.pyrH/2 - 0.2, 0)));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>camera.position.z = s * 3.5;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>controls = new THREE.OrbitControls(camera, renderer.domElement);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>controls.autoRotate = true;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>controls.autoRotateSpeed = 0.8;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>controls.enableDamping = true;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function animate() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>animationFrameId = requestAnimationFrame(animate);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>controls.update();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>renderer.render(scene, camera);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (labelRenderer) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>labelRenderer.render(scene, camera);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>animate();</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function draw2DShape(key, container) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>container.classList.remove('hidden');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>canvas3DGlobal.classList.add('hidden');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>container.innerHTML = '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const canvas = document.createElement('canvas');</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const parentDisplayArea = document.getElementById('standardDisplayArea');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let size = Math.min(parentDisplayArea.clientWidth, parentDisplayArea.clientHeight) * 0.8;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (size &lt;= 0) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>size = 300;<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>canvas.width = size;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>canvas.height = size;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>container.appendChild(canvas);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const ctx = canvas.getContext('2d');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const w = canvas.width;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const h = canvas.height;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const r = w / 2 * 0.8;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const cx = w/2, cy = h/2;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.save();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.shadowColor = 'rgba(0,0,0,0.3)';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.shadowBlur = 10;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.shadowOffsetX = 5;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.shadowOffsetY = 5;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const gradient = ctx.createLinearGradient(cx - r, cy - r, cx + r, cy + r);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>gradient.addColorStop(0, '#87CEFA');<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>gradient.addColorStop(1, '#007bff');<span class="Apple-converted-space"> </span></span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.fillStyle = gradient;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.strokeStyle = '#000000';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.lineWidth = 3;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.beginPath();</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let angle, startAngle;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>switch(key) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case 'square': ctx.rect(cx - r/Math.sqrt(2), cy - r/Math.sqrt(2), 2*r/Math.sqrt(2), 2*r/Math.sqrt(2)); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case 'rectangle': ctx.rect(cx-r, cy-r/2, r*2, r); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case 'circle': ctx.arc(cx, cy, r, 0, 2*Math.PI); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case 'ellipse': ctx.ellipse(cx, cy, r, r * 0.6, 0, 0, 2 * Math.PI); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case 'triangle_eq': for(let i=0; i&lt;3; i++) { ctx[i===0?'moveTo':'lineTo'](cx + r * Math.cos(-Math.PI/2 + i*2*Math.PI/3), cy + r * Math.sin(-Math.PI/2 + i*2*Math.PI/3)); } break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case 'triangle_iso': ctx.moveTo(cx, cy-r); ctx.lineTo(cx-r, cy+r/2); ctx.lineTo(cx+r, cy+r/2); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case 'triangle_right': ctx.moveTo(cx - r, cy - r); ctx.lineTo(cx - r, cy + r); ctx.lineTo(cx + r, cy + r); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case 'triangle_scalene': ctx.moveTo(cx - r, cy + r); ctx.lineTo(cx + r, cy + r); ctx.lineTo(cx, cy - r*0.8); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case 'rhombus': ctx.moveTo(cx, cy-r); ctx.lineTo(cx-r/1.5, cy); ctx.lineTo(cx, cy+r); ctx.lineTo(cx+r/1.5, cy); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case 'parallelogram': ctx.moveTo(cx - r, cy - r/2); ctx.lineTo(cx, cy - r/2); ctx.lineTo(cx + r, cy + r/2); ctx.lineTo(cx, cy + r/2); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case 'trapezoid': ctx.moveTo(cx - r, cy + r/2); ctx.lineTo(cx + r, cy + r/2); ctx.lineTo(cx + r/2, cy - r/2); ctx.lineTo(cx - r/2, cy - r/2); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case 'kite': ctx.moveTo(cx, cy - r); ctx.lineTo(cx - r/2, cy); ctx.lineTo(cx, cy + r); ctx.lineTo(cx + r/2, cy); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case 'pentagon': angle=2*Math.PI/5; startAngle=-Math.PI/2; for(let i=0; i&lt;5; i++) {ctx[i===0?'moveTo':'lineTo'](cx+r*Math.cos(startAngle+i*angle),cy+r*Math.sin(startAngle+i*angle));} break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case 'hexagon': angle=2*Math.PI/6; startAngle=-Math.PI/6; for(let i=0; i&lt;6; i++) {ctx[i===0?'moveTo':'lineTo'](cx+r*Math.cos(startAngle+i*angle),cy+r*Math.sin(startAngle+i*angle));} break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case 'octagon': angle=2*Math.PI/8; startAngle=-Math.PI/8; for(let i=0; i&lt;8; i++) {ctx[i===0?'moveTo':'lineTo'](cx+r*Math.cos(startAngle+i*angle),cy+r*Math.sin(startAngle+i*angle));} break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.closePath();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.fill();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.stroke();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.restore();</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function calculateShapeProperties(shape, isTeachMode) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (!isTeachMode) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>return `&lt;div class="text-3xl md:text-4xl lg:text-5xl"&gt;$$${shape.name}$$&lt;/div&gt;`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let mathjaxStr = '\\begin{align*}';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>for(const [key, value] of Object.entries(shape)) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (key === 'name') continue;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const formattedKey = key.replace(/_/g, ' ').replace(/\b\w/g, l =&gt; l.toUpperCase());</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>mathjaxStr += `\\text{${formattedKey}:} &amp; \\quad \\text{${value}} \\\\`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>mathjaxStr += '\\end{align*}';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return `&lt;div class="text-3xl md:text-4xl lg:text-5xl text-left"&gt;$$${mathjaxStr}$$&lt;/div&gt;`;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">// Tool: Sphere Volume &amp; SA</span></p>
<p class="p1"><span class="s1">function calculateSphereVolumeSteps(radius) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (isNaN(radius) || radius &lt;= 0) return ["Error: Radius must be a positive number."];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const volume = (4 / 3) * Math.PI * Math.pow(radius, 3);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return [</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>`V = \\frac{4}{3} \\pi r^3`,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>`V = \\frac{4}{3} \\pi (${radius})^3`,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>`V \\approx ${volume.toFixed(2)}`</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>];</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function calculateSphereSurfaceAreaSteps(radius) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (isNaN(radius) || radius &lt;= 0) return ["Error: Radius must be a positive number."];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const surfaceArea = 4 * Math.PI * Math.pow(radius, 2);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return [</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>`SA = 4 \\pi r^2`,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>`SA = 4 \\pi (${radius})^2`,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>`SA \\approx ${surfaceArea.toFixed(2)}`</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>];</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">// Tool: Tally Chart</span></p>
<p class="p1"><span class="s1">function setupTallyChart() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const addBtn = document.getElementById('add-tally-row');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addManagedListener(addBtn, 'click', () =&gt; addTallyRow());</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addTallyRow('Apples', 7);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addTallyRow('Oranges', 12);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function addTallyRow(category = '', count = 5) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const container = document.getElementById('tally-rows-container');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const rowDiv = document.createElement('div');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>rowDiv.className = 'flex items-center gap-2 p-2 border rounded-lg bg-slate-50';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>rowDiv.innerHTML = `</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;input type="text" value="${category}" placeholder="Category" class="tally-category w-32 p-1 border-2 rounded-lg"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;input type="number" value="${count}" min="0" class="tally-count w-20 p-1 border-2 rounded-lg text-center"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;button class="remove-tally-row font-bold text-red-500 ml-auto text-xl px-2"&gt;×&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>container.appendChild(rowDiv);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addManagedListener(rowDiv.querySelector('.tally-category'), 'input', handleDraw);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addManagedListener(rowDiv.querySelector('.tally-count'), 'input', handleDraw);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addManagedListener(rowDiv.querySelector('.remove-tally-row'), 'click', (e) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>e.target.closest('div').remove();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>handleDraw();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>handleDraw();</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function drawTallyChart() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>interactiveDisplay.innerHTML = '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const rows = document.querySelectorAll('#tally-rows-container &gt; div');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (rows.length === 0) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>interactiveDisplay.innerHTML = `&lt;p class="text-slate-500"&gt;Add a row to start creating a tally chart.&lt;/p&gt;`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const table = document.createElement('table');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>table.className = 'w-full max-w-2xl text-left border-collapse';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>table.innerHTML = `</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;thead class="bg-slate-200"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;tr&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;th class="p-3 text-lg font-semibold text-slate-700"&gt;Category&lt;/th&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;th class="p-3 text-lg font-semibold text-slate-700"&gt;Tally&lt;/th&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;th class="p-3 text-lg font-semibold text-slate-700"&gt;Frequency&lt;/th&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/tr&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/thead&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;tbody&gt;&lt;/tbody&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const tbody = table.querySelector('tbody');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>rows.forEach(row =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const category = row.querySelector('.tally-category').value || 'Unnamed';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const count = parseInt(row.querySelector('.tally-count').value, 10) || 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const numGroups = Math.floor(count / 5);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const remainder = count % 5;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>let tallyHtml = '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>for (let i = 0; i &lt; numGroups; i++) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>tallyHtml += `&lt;span class="tally-group"&gt;||||&lt;span class="tally-slash"&gt;&lt;/span&gt;&lt;/span&gt;`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (remainder &gt; 0) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>tallyHtml += '&lt;span&gt;' + '|'.repeat(remainder) + '&lt;/span&gt;';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const tr = document.createElement('tr');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>tr.className = 'border-b border-slate-200';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>tr.innerHTML = `</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;td class="p-3 font-medium text-slate-800 text-3xl"&gt;$$\\text{${category}}$$&lt;/td&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;td class="p-3 tally-marks"&gt;${tallyHtml}&lt;/td&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;td class="p-3 font-bold text-slate-800 text-center text-5xl"&gt;$$${count}$$&lt;/td&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>tbody.appendChild(tr);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>interactiveDisplay.appendChild(table);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">// Tool: Place Value</span></p>
<p class="p1"><span class="s1">function drawPlaceValue() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const numStr = document.getElementById('placeValueNumber').value.trim();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>interactiveDisplay.innerHTML = '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (numStr === '' || isNaN(parseFloat(numStr))) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>interactiveDisplay.innerHTML = '&lt;p class="text-slate-500"&gt;Please enter a valid number.&lt;/p&gt;';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const [integerPart, fractionalPart] = numStr.split('.');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const integerNames = ['Ones', 'Tens', 'Hundreds', 'Thousands', 'Ten Thousands', 'Hundred Thousands', 'Millions'];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const fractionalNames = ['Tenths', 'Hundredths', 'Thousandths', 'Ten Thousandths'];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const container = document.createElement('div');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>container.className = 'flex flex-wrap items-end justify-center';</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>integerPart.split('').reverse().forEach((digit, i) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const col = document.createElement('div');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>col.className = 'place-value-col';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>col.innerHTML = `</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="place-value-label text-xl"&gt;$$\\text{${integerNames[i] || `10^${i}`}}$$&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="place-value-digit"&gt;$$${digit}$$&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>container.prepend(col);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (fractionalPart !== undefined) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const decimalCol = document.createElement('div');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>decimalCol.className = 'decimal-point-col';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>decimalCol.innerHTML = '&lt;div class="place-value-digit" style="border-bottom: none;"&gt;$$ . $$&lt;/div&gt;';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>container.appendChild(decimalCol);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>fractionalPart.split('').forEach((digit, i) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const col = document.createElement('div');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>col.className = 'place-value-col';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>col.innerHTML = `</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="place-value-label text-xl"&gt;$$\\text{${fractionalNames[i] || `10^{-${i+1}}`}}$$&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="place-value-digit"&gt;$$${digit}$$&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>container.appendChild(col);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>interactiveDisplay.appendChild(container);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">// Tool: Equivalency Tool</span></p>
<p class="p1"><span class="s1">function setupEquivalencyTool() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const addBtn = document.getElementById('add-equivalency-row');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const labelToggleBtn = document.getElementById('equivalency-label-toggle-btn');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const circleToggleBtn = document.getElementById('equivalency-circle-toggle-btn');</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addManagedListener(addBtn, 'click', () =&gt; addEquivalencyItem());</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const createToggleHandler = (stateKey, button) =&gt; () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>equivalencyToolState[stateKey] = !equivalencyToolState[stateKey];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>button.classList.toggle('toggle-on', equivalencyToolState[stateKey]);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>button.classList.toggle('toggle-off', !equivalencyToolState[stateKey]);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>button.firstElementChild.classList.toggle('dot-on', equivalencyToolState[stateKey]);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>handleDraw();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>};</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addManagedListener(labelToggleBtn, 'click', createToggleHandler('showLabels', labelToggleBtn));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addManagedListener(circleToggleBtn, 'click', createToggleHandler('showCircles', circleToggleBtn));</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addEquivalencyItem("1/2", "Fraction");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addEquivalencyItem("50", "Percent");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addEquivalencyItem("0.5", "Decimal");</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function addEquivalencyItem(value = '', type = 'Fraction') {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const container = document.getElementById('equivalency-rows-container');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const rowDiv = document.createElement('div');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>rowDiv.className = 'flex items-center gap-2 p-2 border rounded-lg bg-slate-50';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>rowDiv.innerHTML = `</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;input type="text" value="${value}" placeholder="Value" class="equivalency-value flex-grow p-1 border-2 rounded-lg"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;select class="equivalency-type bg-white p-1 rounded-md border border-slate-200"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;option&gt;Fraction&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;option&gt;Decimal&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;option&gt;Percent&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;option&gt;Ratio&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/select&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;button class="remove-equivalency-row font-bold text-red-500 ml-auto text-xl px-2"&gt;×&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>container.appendChild(rowDiv);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>rowDiv.querySelector('.equivalency-type').value = type;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addManagedListener(rowDiv.querySelector('.equivalency-value'), 'input', handleDraw);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addManagedListener(rowDiv.querySelector('.equivalency-type'), 'change', handleDraw);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addManagedListener(rowDiv.querySelector('.remove-equivalency-row'), 'click', (e) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>e.target.closest('div').remove();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>handleDraw();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>handleDraw();</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function parseEquivalencyInput(valueStr, type) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let numericValue = NaN;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (!valueStr) return { value: null, error: 'Empty input' };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>try {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>switch (type) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>case 'Fraction': {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>if (valueStr.includes('/')) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>const [num, den] = valueStr.split('/').map(s =&gt; parseFloat(s));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>if (!isNaN(num) &amp;&amp; !isNaN(den) &amp;&amp; den !== 0) numericValue = num / den;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>} else if (!isNaN(parseFloat(valueStr))) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>numericValue = parseFloat(valueStr);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>return { value: null, error: "Invalid Fraction. Use format like 1/2." };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>case 'Decimal':</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>numericValue = parseFloat(valueStr);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>case 'Percent':</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>numericValue = parseFloat(valueStr.replace('%', '')) / 100;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>case 'Ratio': {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>if (valueStr.includes(':')) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>const [num, den] = valueStr.split(':').map(s =&gt; parseFloat(s));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>if (!isNaN(num) &amp;&amp; !isNaN(den) &amp;&amp; den !== 0) numericValue = num / den;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>} catch { numericValue = NaN; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (isNaN(numericValue)) return { value: null, error: `Invalid ${type.toLowerCase()}` };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return { value: numericValue, error: null };</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function drawEquivalencyTool() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const allValues = Array.from(document.querySelectorAll('#equivalency-rows-container &gt; div')).map((row, index) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const valueStr = row.querySelector('.equivalency-value').value;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const type = row.querySelector('.equivalency-type').value;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const result = parseEquivalencyInput(valueStr, type);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>return {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>id: index,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>originalStr: valueStr,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>type: type,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>numericValue: result.value,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>error: result.error,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>color: barColors[index % barColors.length]</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>};</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>interactiveDisplay.innerHTML = '';</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const container = document.createElement('div');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>container.className = 'flex flex-wrap items-start justify-center gap-8 p-4';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>interactiveDisplay.appendChild(container);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (allValues.length === 0) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>container.innerHTML = `&lt;p class="text-slate-500"&gt;Add an item to begin.&lt;/p&gt;`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>allValues.forEach(val =&gt; drawEquivalencyItem(container, val));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function drawEquivalencyItem(parent, data) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const wrapper = document.createElement('div');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>wrapper.className = 'flex flex-col items-center gap-2';</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (equivalencyToolState.showCircles) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const canvas = document.createElement('canvas');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const size = 150;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>canvas.width = size; canvas.height = size;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const ctx = canvas.getContext('2d');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const radius = size / 2 - 10, centerX = size / 2, centerY = size / 2;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.beginPath(); ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.fillStyle = '#e5e7eb'; ctx.fill();</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (data.numericValue !== null &amp;&amp; !isNaN(data.numericValue)) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>ctx.beginPath(); ctx.moveTo(centerX, centerY);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>ctx.arc(centerX, centerY, radius, -Math.PI / 2, -Math.PI / 2 + (data.numericValue * 2 * Math.PI));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>ctx.closePath(); ctx.fillStyle = data.color; ctx.fill();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.beginPath(); ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.strokeStyle = '#6b7280'; ctx.lineWidth = 3; ctx.stroke();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>wrapper.appendChild(canvas);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (equivalencyToolState.showLabels) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const labelP = document.createElement('p');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>labelP.className = 'text-3xl md:text-4xl lg:text-5xl font-serif text-slate-700 text-center';</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>let displayStr = data.originalStr || '...';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (data.type === 'Percent' &amp;&amp; displayStr !== '...' &amp;&amp; !displayStr.endsWith('%')) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>displayStr += '%';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>displayStr = displayStr.replace(/%/g, '\\%');</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (data.type === 'Fraction' &amp;&amp; displayStr.includes('/')) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const parts = displayStr.split('/');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>displayStr = `\\frac{${parts[0]}}{${parts[1]}}`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>labelP.innerHTML = `$$${displayStr}$$`;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if(data.error) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>labelP.classList.add('text-red-500');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>labelP.classList.remove('font-serif','text-3xl', 'md:text-4xl', 'lg:text-5xl');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>labelP.classList.add('text-lg');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>labelP.innerHTML = data.error;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>wrapper.appendChild(labelP);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// Only append if it has content</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (wrapper.children.length &gt; 0) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>parent.appendChild(wrapper);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">// Tool: Unit Rate Calculator</span></p>
<p class="p1"><span class="s1">function setupUnitRateCalculator() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const addBtn = document.getElementById('add-unitrate-row');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addManagedListener(addBtn, 'click', () =&gt; addUnitRateRow());</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addUnitRateRow('Car A', 300, 10, 'Gallons', 'Miles');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addUnitRateRow('Car B', 400, 15, 'Gallons', 'Miles');</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function addUnitRateRow(name = '', numValue = 0, denValue = 1, denUnit = 'items', numUnit = '$') {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const container = document.getElementById('unitrate-rows-container');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const rowDiv = document.createElement('div');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>rowDiv.className = 'flex flex-wrap items-center gap-x-4 gap-y-2 p-2 border rounded-lg bg-slate-50';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>rowDiv.innerHTML = `</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;input type="text" value="${name}" placeholder="Item Name" class="unitrate-name flex-grow p-1 border-2 rounded-lg"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="flex items-center gap-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;input type="number" value="${numValue}" min="0" step="0.01" class="unitrate-numerator w-20 p-1 border-2 rounded-lg text-center"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;input type="text" value="${numUnit}" placeholder="unit" class="unitrate-num-unit w-20 p-1 border-2 rounded-lg"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="flex items-center gap-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">             </span>&lt;label class="text-sm font-semibold"&gt;per&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;input type="number" value="${denValue}" min="0.01" step="0.01" class="unitrate-denominator w-20 p-1 border-2 rounded-lg text-center"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;input type="text" value="${denUnit}" placeholder="unit" class="unitrate-den-unit w-20 p-1 border-2 rounded-lg"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;button class="remove-unitrate-row font-bold text-red-500 ml-auto text-xl px-2"&gt;×&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>container.appendChild(rowDiv);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>rowDiv.querySelectorAll('input').forEach(el =&gt; addManagedListener(el, 'input', handleDraw));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addManagedListener(rowDiv.querySelector('.remove-unitrate-row'), 'click', (e) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>e.target.closest('.flex-wrap').remove();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>handleDraw();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>handleDraw();</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function drawUnitRateCalculator() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const allValues = Array.from(document.querySelectorAll('#unitrate-rows-container &gt; div')).map((row, index) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const name = row.querySelector('.unitrate-name').value || `Item ${index + 1}`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const numerator = parseFloat(row.querySelector('.unitrate-numerator').value);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const denominator = parseFloat(row.querySelector('.unitrate-denominator').value);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const numUnit = row.querySelector('.unitrate-num-unit').value || 'unit';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const denUnit = row.querySelector('.unitrate-den-unit').value || 'item';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const unitRate = (!isNaN(numerator) &amp;&amp; !isNaN(denominator) &amp;&amp; denominator &gt; 0) ? numerator / denominator : null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>return { id: index, name, numerator, denominator, numUnit, denUnit, unitRate, color: barColors[index % barColors.length] };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>drawUnitRateBars(allValues);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>calculateAndDisplayUnitRateResult(allValues);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function drawUnitRateBars(values) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>interactiveDisplay.innerHTML = '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const validValues = values.filter(v =&gt; v.unitRate !== null);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (validValues.length === 0) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>interactiveDisplay.innerHTML = `&lt;p class="text-slate-500"&gt;Enter item details to see a comparison.&lt;/p&gt;`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const container = document.createElement('div');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>container.className = 'w-full flex flex-col gap-4 p-4';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>interactiveDisplay.appendChild(container);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const maxUnitRate = Math.max(0.0001, ...validValues.map(v =&gt; v.unitRate));</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>validValues.forEach(item =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const row = document.createElement('div');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>row.className = 'flex items-center gap-4 w-full';</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const label = document.createElement('div');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>label.className = 'w-1/4 text-right font-bold text-xl';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>label.textContent = item.name;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const barContainer = document.createElement('div');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>barContainer.className = 'w-1/2 bg-gray-200 rounded-full h-10';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const bar = document.createElement('div');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const barWidth = (item.unitRate / maxUnitRate) * 100;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>bar.className = 'h-10 rounded-full';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>bar.style.width = `${barWidth}%`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>bar.style.backgroundColor = item.color;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>barContainer.appendChild(bar);</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const rateText = document.createElement('div');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>rateText.className = 'w-1/4 font-bold text-xl text-left';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>rateText.textContent = item.unitRate.toFixed(2);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>row.appendChild(label);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>row.appendChild(barContainer);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>row.appendChild(rateText);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>container.appendChild(row);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function calculateAndDisplayUnitRateResult(values) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>interactiveResult.classList.remove('hidden');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>interactiveResultTitle.textContent = "Unit Rate Comparison";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const validValues = values.filter(v =&gt; v.unitRate !== null);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (validValues.length === 0) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>interactiveResultContent.innerHTML = `&lt;p class="text-slate-400"&gt;Enter valid item details to see a comparison.&lt;/p&gt;`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const sorted = [...validValues].sort((a, b) =&gt; a.unitRate - b.unitRate);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const best = sorted[0];</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let resultTex = '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (best) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">         </span>resultTex = `\\begin{align*} \\text{Best Rate:} &amp;\\quad \\text{${best.name}} \\\\ &amp; ${best.unitRate.toFixed(3)} \\, \\text{${best.numUnit}/${best.denUnit}} \\end{align*}`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>interactiveResultContent.innerHTML = `&lt;div class="text-3xl md:text-4xl lg:text-5xl"&gt;$$${resultTex}$$&lt;/div&gt;`;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">// Tool: Integer Operations</span></p>
<p class="p1"><span class="s1">function setupIntegerOperations() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>integerOperationsState = { currentStep: 0, story: [] };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const startInput = document.getElementById('integerStart');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addManagedListener(startInput, 'input', () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>integerOperationsState.currentStep = 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>handleDraw();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const addBtn = document.getElementById('add-integer-op-row');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const prevBtn = document.getElementById('integer-op-prev');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const nextBtn = document.getElementById('integer-op-next');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const resetBtn = document.getElementById('integer-op-reset');</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addManagedListener(addBtn, 'click', () =&gt; addIntegerOpRow());</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addManagedListener(nextBtn, 'click', () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (integerOperationsState.currentStep &lt; integerOperationsState.story.length) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>integerOperationsState.currentStep++;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>handleDraw();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addManagedListener(prevBtn, 'click', () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (integerOperationsState.currentStep &gt; 0) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>integerOperationsState.currentStep--;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>handleDraw();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addManagedListener(resetBtn, 'click', () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>integerOperationsState.currentStep = 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>handleDraw();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addIntegerOpRow('+', 5);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addIntegerOpRow('-', 8);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function addIntegerOpRow(op = '+', value = 5) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const container = document.getElementById('integer-ops-container');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const rowDiv = document.createElement('div');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>rowDiv.className = 'flex items-center gap-2 p-2 border rounded-lg bg-slate-50 transition-all';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>rowDiv.innerHTML = `</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;select class="integer-op-type bg-white p-1 rounded-md border border-slate-200"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;option value="+"&gt;+&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;option value="-"&gt;-&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;option value="*"&gt;x&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;option value="/"&gt;÷&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/select&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;input type="text" value="${value}" class="integer-op-value flex-grow p-1 border-2 rounded-lg text-center"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;button class="remove-integer-op-row font-bold text-red-500 ml-auto text-xl px-2"&gt;×&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>container.appendChild(rowDiv);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>rowDiv.querySelector('.integer-op-type').value = op;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const resetAndDraw = () =&gt; { integerOperationsState.currentStep = 0; handleDraw(); };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addManagedListener(rowDiv.querySelector('.integer-op-type'), 'change', resetAndDraw);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addManagedListener(rowDiv.querySelector('.integer-op-value'), 'input', resetAndDraw);</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addManagedListener(rowDiv.querySelector('.remove-integer-op-row'), 'click', (e) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>e.target.closest('div').remove();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>resetAndDraw();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>handleDraw();</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function drawIntegerOperations() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const startInput = document.getElementById('integerStart');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (!startInput) return;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const startValue = parseInt(startInput.value);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (isNaN(startValue)) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>interactiveDisplay.innerHTML = `&lt;p class="text-red-500 p-4 text-xl"&gt;Invalid Start Value. Please enter a number.&lt;/p&gt;`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>interactiveResult.classList.add('hidden');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">         </span>interactiveResult.classList.remove('hidden');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const opRows = document.querySelectorAll('#integer-ops-container &gt; div');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const story = [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let currentValue = startValue;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let errorOccurred = false;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>opRows.forEach((row) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (errorOccurred) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>story.push({ error: true, isFuture: true });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const op = row.querySelector('.integer-op-type').value;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const valueStr = row.querySelector('.integer-op-value').value;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const value = parseInt(valueStr);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (valueStr.trim() === '' || isNaN(value)) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>story.push({ op, value: 'Invalid', startValue: currentValue, endValue: currentValue, error: true });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>errorOccurred = true;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const step = { op, value, startValue: currentValue, endValue: 0 };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>switch (op) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>case '+': step.endValue = currentValue + value; break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>case '-': step.endValue = currentValue - value; break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>case '*': step.endValue = currentValue * value; break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>case '/': step.endValue = (value !== 0) ? currentValue / value : currentValue; break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>step.endValue = Math.round(step.endValue * 100) / 100;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>story.push(step);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>currentValue = step.endValue;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>integerOperationsState.story = story;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>opRows.forEach((row, index) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>row.classList.remove('border-blue-500', 'bg-blue-50', 'shadow-md', 'border-red-500', 'bg-red-50');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const step = story[index];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">         </span>if (step &amp;&amp; step.error) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>row.classList.add('border-red-500', 'bg-red-50');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>} else if ((index + 1) === integerOperationsState.currentStep) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>row.classList.add('border-blue-500', 'bg-blue-50', 'shadow-md');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>drawIntegerNumberLine();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>updateIntegerResults();</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const hasError = story.some(s =&gt; s.error);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>document.getElementById('integer-op-prev').disabled = integerOperationsState.currentStep === 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>document.getElementById('integer-op-next').disabled = integerOperationsState.currentStep &gt;= story.length || hasError;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function drawIntegerNumberLine() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>interactiveDisplay.innerHTML = '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const startNum = parseInt(document.getElementById('integerStart').value);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (isNaN(startNum)) return;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const canvas = document.createElement('canvas');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>canvas.width = interactiveDisplay.clientWidth;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>canvas.height = interactiveDisplay.clientHeight &gt; 150 ? interactiveDisplay.clientHeight : 250;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>interactiveDisplay.appendChild(canvas);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const ctx = canvas.getContext('2d');</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const { story, currentStep } = integerOperationsState;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const validValues = story.filter(s =&gt; !s.error).flatMap(s =&gt; [s.startValue, s.endValue]);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let min = startNum, max = startNum;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>[startNum, ...validValues].forEach(v =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (v &lt; min) min = v;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (v &gt; max) max = v;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const range = max - min;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const padding = 50;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>min -= Math.ceil(range * 0.1) + 2;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>max += Math.ceil(range * 0.1) + 2;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const effectiveWidth = canvas.width - 2 * padding;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const yAxis = canvas.height * 0.6;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if(effectiveWidth &lt;= 0) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const scale = effectiveWidth / (max - min);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const toX = num =&gt; padding + (num - min) * scale;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.beginPath();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.moveTo(0, yAxis); ctx.lineTo(canvas.width, yAxis);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.strokeStyle = '#334155'; ctx.lineWidth = 2; ctx.stroke();</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const tickInterval = Math.max(1, Math.round((max - min) / (effectiveWidth / 80)));</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>for (let i = Math.floor(min / tickInterval) * tickInterval; i &lt;= max; i = Math.round((i+tickInterval)*100)/100) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const x = toX(i);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.beginPath(); ctx.moveTo(x, yAxis - 5); ctx.lineTo(x, yAxis + 5);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.strokeStyle = '#64748b'; ctx.stroke();</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const label = document.createElement('div');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>label.className = 'absolute text-xl';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>label.style.left = `${x}px`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>label.style.top = `${yAxis + 10}px`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>label.style.transform = 'translateX(-50%)';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>label.innerHTML = `$$${i}$$`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>interactiveDisplay.appendChild(label);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.lineWidth = 2.5; ctx.font = 'bold 14px Montserrat';</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>for (let i = 0; i &lt; currentStep; i++) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const step = story[i];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (step.error) break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const x1 = toX(step.startValue);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const x2 = toX(step.endValue);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const midX = (x1 + x2) / 2;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>let arcHeight = Math.min(Math.abs(x2 - x1) * 0.3, yAxis - 40);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const change = step.endValue - step.startValue;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.strokeStyle = change &gt;= 0 ? '#16a34a' : '#dc2626';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.fillStyle = ctx.strokeStyle;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.beginPath(); ctx.moveTo(x1, yAxis);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.quadraticCurveTo(midX, yAxis - arcHeight, x2, yAxis);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.stroke();</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const arrowAngle = Math.atan2(yAxis - (yAxis-arcHeight), x2 - midX);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.beginPath();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.moveTo(x2, yAxis);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.lineTo(x2 - 10 * Math.cos(arrowAngle - Math.PI / 8), yAxis - 10 * Math.sin(arrowAngle - Math.PI / 8));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.moveTo(x2, yAxis);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.lineTo(x2 - 10 * Math.cos(arrowAngle + Math.PI / 8), yAxis - 10 * Math.sin(arrowAngle + Math.PI / 8));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.stroke();</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.textAlign = 'center';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>let opSymbol = step.op;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (opSymbol === '*') opSymbol = '\\times';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (opSymbol === '/') opSymbol = '\\div';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const labelText = `${opSymbol} ${step.value}`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.fillText(labelText, midX, yAxis - arcHeight - 15);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const finalValue = (currentStep &gt; 0 &amp;&amp; !story[currentStep - 1].error) ? story[currentStep - 1].endValue : startNum;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const finalX = toX(finalValue);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.beginPath(); ctx.arc(finalX, yAxis, 8, 0, 2 * Math.PI);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.fillStyle = '#0ea5e9'; ctx.fill();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.strokeStyle = 'white'; ctx.lineWidth = 2; ctx.stroke();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.fillStyle = '#0369a1'; ctx.font = 'bold 16px Montserrat';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.textAlign = 'center';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.fillText(finalValue, finalX, yAxis - 20);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function updateIntegerResults() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>interactiveResultTitle.textContent = "Calculation Steps:";</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const { story, currentStep } = integerOperationsState;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const startValue = parseInt(document.getElementById('integerStart').value);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if(isNaN(startValue)) return;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let mathjaxString = '\\begin{align*}';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>mathjaxString += `\\text{Start:} &amp;\\quad ${startValue} \\\\`;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let finalValue = startValue;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>story.forEach((step, index) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (index &gt;= currentStep) return;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (step.error) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>mathjaxString += `\\text{Step ${index + 1}:} &amp;\\quad \\color{red}{\\text{Invalid Input}} \\\\`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>finalValue = story[index - 1] ? story[index-1].endValue : startValue;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>let opSymbol;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>switch (step.op) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>case '*': opSymbol = '\\times'; break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>case '/': opSymbol = '\\div'; break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>default: opSymbol = step.op;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>mathjaxString += `\\text{Step ${index + 1}:} &amp;\\quad ${step.startValue} ${opSymbol} ${step.value} = ${step.endValue} \\\\`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>finalValue = step.endValue;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (currentStep === 0) finalValue = startValue;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>mathjaxString += `\\hline \\mathbf{\\text{Result:}} &amp;\\quad \\mathbf{${finalValue}}`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>mathjaxString += '\\end{align*}';</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>interactiveResultContent.innerHTML = `&lt;div class="text-3xl md:text-4xl lg:text-5xl text-left"&gt;$$ ${mathjaxString} $$&lt;/div&gt;`;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">// Tool: Data Set Analyzer</span></p>
<p class="p1"><span class="s1">function drawDataSetAnalyzer() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const inputStr = document.getElementById('dataSetInput').value;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const calcType = document.querySelector('input[name="calcType"]:checked').value;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const numbers = inputStr.split(',')</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                           </span>.map(s =&gt; s.trim())</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                           </span>.filter(s =&gt; s !== '')</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                           </span>.map(Number)</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                           </span>.filter(n =&gt; !isNaN(n));</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>interactiveDisplay.innerHTML = `&lt;p class="text-3xl md:text-4xl lg:text-5xl text-blue-700 font-bold p-4 text-center break-words"&gt;$$${numbers.join(',\\ ')}$$&lt;/p&gt;`;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>interactiveResult.classList.remove('hidden');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const result = calculateDataSetAnalytics(numbers, calcType);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>interactiveResultTitle.textContent = "Analysis Result:";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>interactiveResultContent.innerHTML = `</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div id="data-analyzer-toggles" class="flex items-center justify-center gap-6 mb-4"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="flex items-center gap-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;span class="text-sm font-semibold"&gt;Equation&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;button id="equation-toggle-btn" class="toggle-btn ${dataSetAnalyzerState.showEquation ? 'toggle-on' : 'toggle-off'}"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="toggle-dot ${dataSetAnalyzerState.showEquation ? 'dot-on' : ''}"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="flex items-center gap-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;span class="text-sm font-semibold"&gt;Graph&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;button id="graph-toggle-btn" class="toggle-btn ${dataSetAnalyzerState.showGraph ? 'toggle-on' : 'toggle-off'}"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="toggle-dot ${dataSetAnalyzerState.showGraph ? 'dot-on' : ''}"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div id="data-analyzer-equation-container" class="transition-all"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div id="data-analyzer-graph-container" class="w-full mt-4 min-h-[250px] relative transition-all"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>`;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const eqContainer = document.getElementById('data-analyzer-equation-container');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const graphContainer = document.getElementById('data-analyzer-graph-container');</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>eqContainer.innerHTML = `&lt;div class="text-3xl md:text-4xl lg:text-5xl"&gt;${result.html}&lt;/div&gt;`;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>drawDataSetGraph(graphContainer, numbers, calcType);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const eqToggleBtn = document.getElementById('equation-toggle-btn');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const graphToggleBtn = document.getElementById('graph-toggle-btn');</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const updateVisibility = () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>eqContainer.style.display = dataSetAnalyzerState.showEquation ? '' : 'none';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>graphContainer.style.display = dataSetAnalyzerState.showGraph ? '' : 'none';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addManagedListener(eqToggleBtn, 'click', (e) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const btn = e.currentTarget;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>dataSetAnalyzerState.showEquation = !dataSetAnalyzerState.showEquation;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>btn.classList.toggle('toggle-on', dataSetAnalyzerState.showEquation);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>btn.classList.toggle('toggle-off', !dataSetAnalyzerState.showEquation);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>btn.firstElementChild.classList.toggle('dot-on', dataSetAnalyzerState.showEquation);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>updateVisibility();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>addManagedListener(graphToggleBtn, 'click', (e) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const btn = e.currentTarget;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>dataSetAnalyzerState.showGraph = !dataSetAnalyzerState.showGraph;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>btn.classList.toggle('toggle-on', dataSetAnalyzerState.showGraph);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>btn.classList.toggle('toggle-off', !dataSetAnalyzerState.showGraph);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>btn.firstElementChild.classList.toggle('dot-on', dataSetAnalyzerState.showGraph);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>updateVisibility();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>updateVisibility();</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function calculateDataSetAnalytics(numbers, type) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (numbers.length === 0) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>return { html: '$$ \\text{Please enter data} $$' };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const round = (val) =&gt; Math.round(val * 1000) / 1000;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>switch(type) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case 'mean': {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const sum = numbers.reduce((acc, val) =&gt; acc + val, 0);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const mean = sum / numbers.length;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>return { html: `$$ \\text{Mean} = \\frac{${sum}}{${numbers.length}} = ${round(mean)} $$` };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case 'median': {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const sorted = [...numbers].sort((a, b) =&gt; a - b);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const mid = Math.floor(sorted.length / 2);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const median = sorted.length % 2 !== 0 ? sorted[mid] : (sorted[mid - 1] + sorted[mid]) / 2;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>return { html: `$$ \\text{Median} = ${round(median)} $$` };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case 'mode': {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const freqMap = new Map();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>numbers.forEach(num =&gt; freqMap.set(num, (freqMap.get(num) || 0) + 1));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>let maxFreq = 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>for (const freq of freqMap.values()) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>if (freq &gt; maxFreq) maxFreq = freq;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (maxFreq &lt;= 1 &amp;&amp; numbers.length &gt; 1 &amp;&amp; new Set(numbers).size === numbers.length) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>return { html: '$$ \\text{No unique mode} $$' };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const modes = [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>for (const [num, freq] of freqMap.entries()) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>if (freq === maxFreq) modes.push(num);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>return { html: `$$ \\text{Mode} = ${modes.sort((a,b) =&gt; a-b).join(', ')} $$` };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case 'range': {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const min = Math.min(...numbers);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const max = Math.max(...numbers);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>return { html: `$$ \\text{Range} = ${max} - ${min} = ${round(max - min)} $$` };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case 'mad': {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const sum = numbers.reduce((acc, val) =&gt; acc + val, 0);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const mean = sum / numbers.length;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const absDeviations = numbers.map(num =&gt; Math.abs(num - mean));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const madSum = absDeviations.reduce((acc, val) =&gt; acc + val, 0);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const mad = madSum / numbers.length;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>return { html: `$$ \\text{MAD} \\approx ${round(mad)} $$` };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>default: return { html: '$$ \\text{Invalid calculation} $$' };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function drawDataSetGraph(container, numbers, calcType) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>container.innerHTML = '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const canvas = document.createElement('canvas');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>container.appendChild(canvas);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (numbers.length === 0) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const ctx = canvas.getContext('2d');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>canvas.width = container.clientWidth;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>canvas.height = container.clientHeight;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.fillStyle = '#64748b';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.textAlign = 'center';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.font = '16px Montserrat';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.fillText('No data to display.', canvas.width / 2, canvas.height / 2);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let canvasHeight = 250;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let madLineRowHeight = 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (calcType === 'mad') {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>madLineRowHeight = 15;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const baseHeight = 200;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>canvasHeight = baseHeight + numbers.length * madLineRowHeight;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>canvas.width = container.clientWidth;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>canvas.height = canvasHeight;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const ctx = canvas.getContext('2d');</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const padding = { top: 20, right: 30, bottom: 60, left: 30 };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const chartWidth = canvas.width - padding.left - padding.right;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const yAxis = padding.top + 100;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const min = Math.min(...numbers);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const max = Math.max(...numbers);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const range = max - min === 0 ? 10 : max - min;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const viewMin = min - range * 0.1;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const viewMax = max + range * 0.1;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const toX = val =&gt; padding.left + ((val - viewMin) / (viewMax - viewMin)) * chartWidth;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.beginPath();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.moveTo(padding.left, yAxis);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.lineTo(padding.left + chartWidth, yAxis);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.strokeStyle = '#9ca3af';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.stroke();</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.font = '14px Montserrat';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.textAlign = 'center';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.textBaseline = 'top';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>ctx.fillStyle = '#4b5563';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const tickCount = Math.min(8, Math.round(chartWidth / 100));<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (tickCount &gt; 0) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const tickValues = Array.from({length: tickCount + 1}, (_, i) =&gt; viewMin + i * (viewMax - viewMin) / tickCount);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>tickValues.forEach(val =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const x = toX(val);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>ctx.beginPath();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>ctx.moveTo(x, yAxis);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>ctx.lineTo(x, yAxis + 5);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>ctx.stroke();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>ctx.fillText(val.toFixed(1).replace('.0', ''), x, yAxis + 12);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const dotRadius = 6;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const plottedDots = [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const freqMapForPlotting = new Map();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>numbers.forEach(num =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const x = toX(num);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const count = freqMapForPlotting.get(num) || 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const y = yAxis - dotRadius - (count * dotRadius * 2.5);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>plottedDots.push({ x, y, value: num });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.beginPath();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.arc(x, y, dotRadius, 0, 2 * Math.PI);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.fillStyle = '#3b82f6';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.fill();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.strokeStyle = 'white';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.lineWidth = 1;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.stroke();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>freqMapForPlotting.set(num, count + 1);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const meanResult = calculateDataSetAnalytics(numbers, 'mean');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const mean = parseFloat(meanResult.html.split('=')[1].trim().replace('$$',''));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const meanX = toX(mean);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (calcType === 'mad') {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const madLinesStartY = yAxis + 50;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const madLinesEndY = madLinesStartY + (plottedDots.length - 1) * madLineRowHeight;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.strokeStyle = 'rgba(22, 163, 74, 0.5)';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.lineWidth = 2;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.beginPath();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.moveTo(meanX, yAxis + 2);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.lineTo(meanX, madLinesEndY + 5);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.stroke();</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.strokeStyle = 'rgba(220, 38, 38, 0.7)';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.lineWidth = 1.5;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.setLineDash([3, 4]);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>plottedDots.sort((a,b) =&gt; a.x - b.x).forEach((dot, i) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const currentMadLineY = madLinesStartY + i * madLineRowHeight;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>ctx.beginPath();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>ctx.moveTo(dot.x, dot.y);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>ctx.lineTo(dot.x, currentMadLineY);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>ctx.lineTo(meanX, currentMadLineY);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>ctx.stroke();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.setLineDash([]);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (calcType === 'mean' || calcType === 'mad') {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.fillStyle = '#16a34a';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.beginPath();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.moveTo(meanX, yAxis + 2);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.lineTo(meanX - 8, yAxis + 12);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.lineTo(meanX + 8, yAxis + 12);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.closePath();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>ctx.fill();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">// --- MASTER CONTROL FUNCTIONS ---</span></p>
<p class="p1"><span class="s1">function setupInputsForMode(mode) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>cleanupEventListeners();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>resetDisplayAreas();</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>standardLayout.classList.add('hidden');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>canvasLayout.classList.add('hidden');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>interactiveLayout.classList.add('hidden');</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>dimensionInputsInline.innerHTML = '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>canvasInputsPanel.innerHTML = '';</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>standardLayout.classList.remove('flex-col', 'layout-side-by-side');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>standardLayout.classList.add('lg:flex-row');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>calculationStepsColumn.classList.remove('mt-4', 'lg:mt-0');</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let inputContainer = dimensionInputsInline;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const isStandard = STANDARD_LAYOUT_TOOLS.includes(mode);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const isCanvas = CANVAS_LAYOUT_TOOLS.includes(mode);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const isInteractive = INTERACTIVE_LAYOUT_TOOLS.includes(mode);</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (isStandard) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>standardLayout.classList.remove('hidden');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const stackedLayoutTools = ['numeralDisplay', 'wordProblemVisualizer', 'shapeClassifier', 'volumeOfSphere', 'surfaceAreaOfSphere'];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (stackedLayoutTools.includes(mode)) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>standardLayout.classList.add('flex-col');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>standardLayout.classList.remove('lg:flex-row', 'layout-side-by-side');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>calculationStepsColumn.classList.add('mt-4', 'lg:mt-0');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>standardLayout.classList.add('layout-side-by-side');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>} else if (isCanvas) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>canvasLayout.classList.remove('hidden');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>inputContainer = canvasInputsPanel;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>} else if (isInteractive) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>interactiveLayout.classList.remove('hidden');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>interactiveLayout.appendChild(interactiveDisplay);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>interactiveLayout.appendChild(interactiveResult);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>answerToggleContainer.classList.toggle('hidden', isCanvas || ['placeValue', 'tallyChart', 'equivalencyTool'].includes(mode));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>zoomControls.classList.toggle('hidden', true); // Always hide as tools using it are removed</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const answerIsOn = answerToggleBtn.classList.contains('toggle-on');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (isInteractive) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if(mode === 'equivalencyTool') {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>interactiveResult.classList.add('hidden');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const showResultByDefault = ['unitRateCalculator', 'dataSetAnalyzer', 'integerOperations'].includes(mode);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>interactiveResult.classList.toggle('hidden', !(showResultByDefault || answerIsOn));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>} else if (isStandard) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>calculationStepsColumn.style.display = answerIsOn ? 'flex' : 'none';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const menuIsOn = menuToggleBtn.classList.contains('toggle-on');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (isCanvas) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>canvasInputsPanel.classList.toggle('panel-hidden', !menuIsOn);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>mainCanvas.parentElement.classList.toggle('canvas-expanded', !menuIsOn);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>menuControls.classList.toggle('hidden', !menuIsOn);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (inputContainer &amp;&amp; inputTemplates[mode]) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>inputContainer.innerHTML = inputTemplates[mode];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>} else if (inputContainer) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const toolName = modeSelector.options[modeSelector.selectedIndex].text;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>inputContainer.innerHTML = `&lt;p class="text-sm text-slate-500"&gt;Controls for ${toolName} will be here.&lt;/p&gt;`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const standardInputListeners = () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">         </span>(inputContainer || dimensionInputsInline).querySelectorAll('input, select, button, textarea').forEach(el =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (el.id?.startsWith('equivalency-') || el.id === 'undoBtn' || el.id === 'clearBtn' || el.id === 'shapeClassifierToggle') return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">             </span>addManagedListener(el, 'input', handleDraw);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">             </span>addManagedListener(el, 'change', handleDraw);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>};</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>switch(mode) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case 'cardinality': setupCardinality(); standardInputListeners(); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case 'verticalComparison': setupVerticalComparison(); standardInputListeners(); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case 'numeralDisplay': standardInputListeners(); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case 'wordProblemVisualizer': standardInputListeners(); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case 'measurementComparator': setupMeasurementComparator(); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case 'shapeClassifier':<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>setupShapeClassifier();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>standardInputListeners();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case 'tallyChart': setupTallyChart(); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case 'placeValue': standardInputListeners(); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case 'equivalencyTool':<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>equivalencyToolState = { showLabels: true, showCircles: true };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>setupEquivalencyTool();<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case 'unitRateCalculator': setupUnitRateCalculator(); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case 'integerOperations': setupIntegerOperations(); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>case 'dataSetAnalyzer':</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>dataSetAnalyzerState = { showEquation: true, showGraph: true };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>addManagedListener(document.getElementById('dataSetInput'), 'input', handleDraw);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>document.getElementById('dataSetCalcTypeContainer').querySelectorAll('input').forEach(radio =&gt; addManagedListener(radio, 'change', handleDraw));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>default: standardInputListeners();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>handleDraw();</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function handleDraw() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const mode = currentMode;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>try {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>switch (mode) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>case 'cardinality': drawCardinality(); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>case 'verticalComparison': drawVerticalComparison(); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>case 'numeralDisplay': drawNumeralDisplay(); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>case 'wordProblemVisualizer': drawWordProblemVisualizer(); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>case 'measurementComparator': drawMeasurementComparator(); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>case 'shapeClassifier': drawShapeClassifier(); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>case 'tallyChart': drawTallyChart(); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>case 'placeValue': drawPlaceValue(); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>case 'equivalencyTool': drawEquivalencyTool(); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>case 'unitRateCalculator': drawUnitRateCalculator(); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>case 'integerOperations': drawIntegerOperations(); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>case 'dataSetAnalyzer': drawDataSetAnalyzer(); break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>case 'volumeOfSphere':</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>case 'surfaceAreaOfSphere': {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const r = parseFloat(document.getElementById('sphereRadius').value);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const answerIsOn = answerToggleBtn.classList.contains('toggle-on');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>calculationStepsColumn.style.display = answerIsOn ? 'flex' : 'none';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>if (r &gt; 0) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>draw3DShape('sphere', standardDisplayArea, { r });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>const steps = mode === 'volumeOfSphere' ? calculateSphereVolumeSteps(r) : calculateSphereSurfaceAreaSteps(r);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>const stepsTex = steps.join(' \\\\ ');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>const mathjaxBlock = `\\begin{align*} ${stepsTex} \\end{align*}`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>stepsContentContainer.innerHTML = `&lt;div class="text-3xl md:text-4xl lg:text-5xl"&gt;$$${mathjaxBlock}$$&lt;/div&gt;`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>htmlDisplay.classList.remove('hidden');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>htmlDisplay.innerHTML = `&lt;p class="text-red-500"&gt;Please enter a positive radius.&lt;/p&gt;`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>stepsContentContainer.innerHTML = "Enter a positive radius to see the calculation.";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>} catch (e) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>showMessage(`An error occurred: ${e.message}`);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>console.error(e);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (window.MathJax &amp;&amp; window.MathJax.startup) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>MathJax.startup.promise.then(() =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>MathJax.typesetPromise([document.body]).catch(err =&gt; {});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">// --- INITIALIZATION &amp; EVENT LISTENERS ---</span></p>
<p class="p1"><span class="s1">document.addEventListener('DOMContentLoaded', () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>modeSelector.addEventListener('change', () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>currentMode = modeSelector.value;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>setupInputsForMode(currentMode);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>menuToggleBtn.addEventListener('click', () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const isCanvas = CANVAS_LAYOUT_TOOLS.includes(currentMode);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const isOn = menuToggleBtn.classList.toggle('toggle-on');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>menuToggleBtn.classList.toggle('toggle-off', !isOn);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>menuToggleDot.classList.toggle('dot-on', isOn);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (isCanvas) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>canvasInputsPanel.classList.toggle('panel-hidden', !isOn);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>mainCanvas.parentElement.classList.toggle('canvas-expanded', !isOn);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>setTimeout(() =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const parent = mainCanvas.parentElement;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>if (parent) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>mainCanvas.width = parent.clientWidth;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>mainCanvas.height = parent.clientHeight;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>handleDraw();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}, 300);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>menuControls.classList.toggle('hidden', !isOn);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>answerToggleBtn.addEventListener('click', () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const isOn = answerToggleBtn.classList.toggle('toggle-on');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>answerToggleBtn.classList.toggle('toggle-off', !isOn);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>answerToggleDot.classList.toggle('dot-on', isOn);</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>handleDraw();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>currentMode = modeSelector.value;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>setupInputsForMode(currentMode);</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let resizeTimer;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>window.addEventListener('resize', () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>clearTimeout(resizeTimer);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>resizeTimer = setTimeout(() =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>handleDraw();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}, 150);<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p1"><span class="s1">});</span></p>
<p class="p1"><span class="s1">&lt;/script&gt;</span></p>
<p class="p1"><span class="s1">&lt;/body&gt;</span></p>
<p class="p1"><span class="s1">&lt;/html&gt;</span></p>
</body>
</html>
