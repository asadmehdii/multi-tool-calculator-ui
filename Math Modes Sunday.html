<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.6">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;!DOCTYPE html&gt;</p>
<p class="p1">&lt;html lang="en"&gt;</p>
<p class="p1">&lt;head&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;meta charset="UTF-8"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;title&gt;Integrated Math Machine&lt;/title&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script src="https://cdn.tailwindcss.com"&gt;&lt;/script&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&amp;display=swap" rel="stylesheet"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"&gt;&lt;/script&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"&gt;&lt;/script&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/renderers/CSS2DRenderer.js"&gt;&lt;/script&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>MathJax = {</p>
<p class="p1"><span class="Apple-converted-space">            </span>tex: {</p>
<p class="p1"><span class="Apple-converted-space">                </span>inlineMath: [['$', '$'], ['\\(', '\\)']],</p>
<p class="p1"><span class="Apple-converted-space">                </span>displayMath: [ ['$$', '$$'], ['\\[', '\\]'] ],</p>
<p class="p1"><span class="Apple-converted-space">            </span>},</p>
<p class="p1"><span class="Apple-converted-space">            </span>svg: {</p>
<p class="p1"><span class="Apple-converted-space">                </span>fontCache: 'global'</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>};</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/script&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"&gt;&lt;/script&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;style&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>body {</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-family: 'Montserrat', sans-serif !important;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-weight: 400 !important;</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #ffffff;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.message-box {</p>
<p class="p1"><span class="Apple-converted-space">            </span>position: fixed; top: 20px; left: 50%;</p>
<p class="p1"><span class="Apple-converted-space">            </span>transform: translateX(-50%);</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #ef4444; color: white;</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 1rem 1.5rem; border-radius: 0.5rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);</p>
<p class="p1"><span class="Apple-converted-space">            </span>z-index: 1000; display: none;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-size: 1rem; font-weight: bold;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>select {</p>
<p class="p1"><span class="Apple-converted-space">            </span>-webkit-appearance: none; -moz-appearance: none; appearance: none;</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-repeat: no-repeat;</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-position: right 0.5rem center;</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-size: 1.5em 1.5em;</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding-right: 2.5rem;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>input::placeholder, textarea::placeholder { font-weight: normal; color: #9ca3af; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.full-width-section { width: 100%; background-color: #f8fafc; padding: 1rem; border-radius: 0.5rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }</p>
<p class="p1"><span class="Apple-converted-space">        </span>#shapeDisplayFullWidth, #shapeDisplay2D, #equationDisplayContainer, #graphingCanvasWrapper.graph-mode-layout { min-height: 250px; background-color: #dbeafe; border: 2px solid #e2e8f0; display: flex; justify-content: center; align-items: center; overflow: auto; position: relative; width: 100%; border-radius: 0.5rem; padding: 1rem; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>#mathCanvas3D.three-d-canvas { position: absolute; top: 0; left: 0; z-index: 1; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>#mathCanvas2D, #mathCanvas, #mathCanvas3D { background-color: transparent; display: block; width: 100%; height: 100%; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.hidden-mode, .hidden { display: none !important; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.toggle-btn { width: 3.5rem; height: 2rem; border-radius: 9999px; padding: 0.25rem; transition: background-color 0.2s ease-in-out; cursor: pointer; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.toggle-dot { width: 1.5rem; height: 1.5rem; background-color: white; border-radius: 9999px; box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06); transition: transform 0.2s ease-in-out; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.toggle-on { background-image: linear-gradient(130deg, #2B6DFE, #00F2FF); }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.toggle-off { background-color: #d1d5db; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.dot-on { transform: translateX(1.5rem); }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.dimension-label { background-color: rgba(0, 0, 0, 0.6); color: white; padding: 5px 10px; border-radius: 5px; font-size: 0.9em; white-space: nowrap; pointer-events: none; font-weight: bold; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.dimension-label-2d { position: absolute; background-color: rgba(0, 0, 0, 0.6); color: white; padding: 3px 8px; border-radius: 4px; font-size: 0.8em; font-weight: bold; transform: translate(-50%, -50%); pointer-events: none; display: none; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.css2d-container { position: absolute !important; top: 0px !important; left: 0px !important; pointer-events: none !important; overflow: hidden; z-index: 2; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>#volumeSteps p, #stepsContentContainer p { font-family: serif !important; font-weight: normal !important; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>input[type="color"] { -webkit-appearance: none; -moz-appearance: none; appearance: none; border: none; width: 32px; height: 32px; padding: 0; background: none; cursor: pointer; border-radius: 0.25rem; overflow: hidden; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>input[type="color"]::-webkit-color-swatch-wrapper { padding: 0; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>input[type="color"]::-webkit-color-swatch { border: 1px solid #e2e8f0; border-radius: 0.25rem; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.remove-line-button { background-color: transparent; color: #ef4444; border: none; padding: 0; font-size: 1.5rem; line-height: 1; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: color 0.2s ease-in-out; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.remove-line-button:hover { color: #dc2626; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>#graphingContentWrapper.graph-mode-layout { display: flex; flex-direction: column; gap: 1rem; width: 100%; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>#graphingInputsPanel.graph-mode-layout { position: relative; width: 100%; background-color: #f8fafc; padding: 1rem; border-radius: 0.5rem; display: flex; flex-direction: column; gap: 0.5rem; transition: width 0.3s ease-in-out, opacity 0.3s ease-in-out, padding 0.3s ease-in-out, border 0.3s ease-in-out; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }</p>
<p class="p1"><span class="Apple-converted-space">        </span>#graphingCanvasWrapper.graph-mode-layout { width: 100%; height: auto; aspect-ratio: 16/10; background-color: white; border-radius: 0.5rem; overflow: hidden; border: 2px solid #e2e8f0; transition: width 0.3s ease-in-out; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }</p>
<p class="p1"><span class="Apple-converted-space">        </span>@media (min-width: 768px) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>#oldToolLayout.layout-side-by-side { flex-direction: row; }</p>
<p class="p1"><span class="Apple-converted-space">            </span>#oldToolLayout.layout-side-by-side #displayArea, #oldToolLayout.layout-side-by-side #calculationStepsColumn { height: auto; }</p>
<p class="p1"><span class="Apple-converted-space">            </span>#oldToolLayout.layout-side-by-side #shapeDisplayFullWidth, #oldToolLayout.layout-side-by-side #shapeDisplay2D { height: 100%; }</p>
<p class="p1"><span class="Apple-converted-space">            </span>#graphingContentWrapper.graph-mode-layout { flex-direction: row; }</p>
<p class="p1"><span class="Apple-converted-space">            </span>#graphingInputsPanel.graph-mode-layout { width: 33.333333%; }</p>
<p class="p1"><span class="Apple-converted-space">            </span>#graphingInputsPanel.graph-mode-layout.panel-hidden { width: 0; padding: 0; overflow: hidden; border: none; opacity: 0; }</p>
<p class="p1"><span class="Apple-converted-space">            </span>#graphingCanvasWrapper.graph-mode-layout { width: 66.666666%; height: 600px; }</p>
<p class="p1"><span class="Apple-converted-space">            </span>#graphingCanvasWrapper.graph-mode-layout.canvas-expanded { width: 100%; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>#manipulative_mainManipulativeDisplay { background-color: transparent; border: none; display: flex; justify-content: center; align-items: stretch; overflow: hidden; position: relative; width: 100%; flex-grow: 1; gap: 1rem; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.manipulative_canvas-container { background-color: #dbeafe; border: 2px solid #e2e8f0; border-radius: 0.5rem; padding: 1rem; display: flex; justify-content: center; align-items: flex-start; width: 100%; overflow: auto; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.manipulative_canvas-container.statement-mode-override { display: contents; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>#manipulative_statementLiveText { flex: 1 1 0%; align-self: flex-start; width: 100%; word-break: break-word; line-height: 1.4; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>#manipulative_focusStatementLiveText { width: 100%; word-break: break-word; line-height: 1.4; color: #1f2937; font-size: 2.25rem; margin: 0; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>#manipulative_mathCanvas, #manipulative_leftMathCanvas, #manipulative_rightMathCanvas { display: block; background-color: transparent; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.fraction-input-row-wrapper { display: flex; flex-direction: column; align-items: center; width: 100%; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.fraction-input-row { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.remove-fraction-button { background-color: #ef4444; color: white; font-weight: bold; padding: 4px 8px; border-radius: 0.25rem; cursor: pointer; transition: background-color 0.2s ease-in-out; margin-left: auto; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.remove-fraction-button:hover { background-color: #dc2626; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>#manipulative_stepsContentContainer p { color: #22c55e; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/style&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p1">&lt;body class="bg-white flex items-center justify-center p-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div class="w-full mx-auto bg-white rounded-2xl p-6 flex flex-col gap-4 min-h-screen"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;!-- Top controls row --&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div id="topControlsRow" class="flex flex-wrap items-center justify-between gap-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div id="menu-controls" class="flex flex-wrap items-center gap-4 justify-center md:justify-start"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;select id="modeSelector" class="bg-slate-200 text-slate-800 font-bold py-2 px-4 text-sm md:text-base rounded-lg transition border-2 border-transparent focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;!-- Options from Original Integrated Machine --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="simpleAngle"&gt;Simple Angle&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="correspondingAngles"&gt;Corresponding Angles&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="areaOfRectangle"&gt;Area of Rectangle&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="perimeterOfRectangle"&gt;Perimeter of Rectangle&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="areaOfTriangle"&gt;Area of Triangle&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="perimeterOfTriangle"&gt;Perimeter of Triangle&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="areaOfCircle"&gt;Area of Circle&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="circumferenceOfCircle"&gt;Circumference of Circle&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="volumeOfTriangularPrism"&gt;Volume of Triangular Prism&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="surfaceAreaOfTriangularPrism"&gt;Surface Area of Triangular Prism&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="netOfTriangularPrism"&gt;Net of Triangular Prism&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="volumeOfRectangularPrism"&gt;Volume of Rectangular Prism&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="surfaceAreaOfRectangularPrism"&gt;Surface Area of Rectangular Prism&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="netOfRectangularPrism"&gt;Net of Rectangular Prism&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="volumeOfCylinder"&gt;Volume of Cylinder&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="surfaceAreaOfCylinder"&gt;Surface Area of Cylinder&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="netOfCylinder"&gt;Net of Cylinder&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="volumeOfCone"&gt;Volume of Cone&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="surfaceAreaOfCone"&gt;Surface Area of Cone&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="netOfCone"&gt;Net of Cone&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="volumeOfSquarePyramid"&gt;Volume of Square Pyramid&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="surfaceAreaOfSquarePyramid"&gt;Surface Area of Square Pyramid&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="netOfSquarePyramid"&gt;Net of Square Pyramid&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="linearEquationSolver"&gt;Solving for x (Linear Equation)&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="additionAlgorithm"&gt;Addition Algorithm&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="subtractionAlgorithm"&gt;Subtraction Algorithm&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="multiplicationAlgorithm"&gt;Multiplication Algorithm&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="longDivision"&gt;Long Division&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="bedmasCalculator"&gt;BEDMAS Calculator&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="tableEquation"&gt;Table Equation Finder&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="fractionAddition"&gt;Fraction Addition&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="fractionSubtraction"&gt;Fraction Subtraction&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="fractionMultiplication"&gt;Fraction Multiplication&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="fractionDivision"&gt;Fraction Division&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="mixedAddition"&gt;Mixed Number Addition&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="mixedSubtraction"&gt;Mixed Number Subtraction&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="mixedMultiplication"&gt;Mixed Number Multiplication&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="mixedDivision"&gt;Mixed Number Division&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="numberline"&gt;Numberline&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="lineGraph"&gt;Line Graph (Time Series)&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="barGraph"&gt;Bar Graph&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="pictograph"&gt;Pictograph&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="stemAndLeafPlot"&gt;Stem and Leaf Plot&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="currencyCalculator"&gt;US Currency Calculator&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="canadianCurrencyCalculator"&gt;Canadian Currency Calculator&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="graphingCalculator"&gt;Graphing Calculator&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="shapeTransformationTool"&gt;Shape Transformation Tool&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;!-- Options from Manipulatives Machine --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="baseTenBlocks"&gt;Base Ten Blocks&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="algebraTiles"&gt;Algebra Tiles&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="analogClock"&gt;Analog Clock&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="probabilitySpinner"&gt;Probability Spinner&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="diceRoller"&gt;Dice Roller&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="fractionStrips"&gt;Fraction Strips&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="fractionCircles"&gt;Fraction Circles&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="multiplicationArray"&gt;Multiplication Array&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="tenFrame"&gt;Ten Frame&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="hundredsChart"&gt;Hundreds Chart&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="factorTree"&gt;Factor Tree&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="multiplicationNumberBond"&gt;Multiplication Number Bond&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="additionNumberBond"&gt;Addition Number Bond&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="focusStatement"&gt;Focus Statement Mode&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/select&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div id="dimensionInputsInline" class="flex flex-wrap justify-center lg:justify-start items-center gap-x-2 gap-y-4"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="flex items-center gap-6 ml-auto"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="flex items-center gap-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;span class="text-sm font-semibold"&gt;Menu&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;button id="menu-toggle-btn" class="toggle-btn toggle-on"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div id="menu-toggle-dot" class="toggle-dot dot-on"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div id="answer-toggle-container" class="flex items-center gap-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;span class="text-sm font-semibold"&gt;Answer&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;button id="answer-toggle-btn" class="toggle-btn toggle-off"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div id="answer-toggle-dot" class="toggle-dot"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;!-- Layout for "Old" Tools --&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div id="oldToolLayout" class="flex flex-1 flex-col gap-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div id="displayArea" class="flex-1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div id="shapeDisplayFullWidth" class="hidden-mode h-full"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;canvas id="mathCanvas3D" class="w-full h-full three-d-canvas"&gt;&lt;/canvas&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div id="shapeDisplay2D" class="hidden-mode h-full"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;canvas id="mathCanvas2D" class="w-full h-full"&gt;&lt;/canvas&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div id="equationDisplayContainer" class="hidden-mode h-full"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div id="equationDisplay" class="text-5xl font-bold p-4 w-full h-full flex items-center justify-center text-center"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div id="calculationStepsColumn" class="flex-1 hidden-mode"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div id="volumeStepsBottom" class="full-width-section h-full flex flex-col"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;h3 class="text-lg font-bold text-slate-800 mb-2"&gt;Calculation Steps:&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div id="volumeSteps" class="bg-slate-50 p-4 rounded-lg border border-slate-200 flex-grow overflow-y-auto flex items-center justify-center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div id="stepsContentContainer" class="mx-auto w-full h-full"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;!-- Layout for "New" Canvas Tools --&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div id="newToolLayout" class="hidden"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div id="graphingContentWrapper" class="graph-mode-layout"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div id="graphingInputsPanel" class="graph-mode-layout"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div id="graphingCanvasWrapper" class="graph-mode-layout"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;canvas id="mathCanvas"&gt;&lt;/canvas&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div id="zoomControls" class="absolute top-4 right-4 flex flex-col gap-2 z-10 hidden"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;button id="zoomInButton" class="bg-blue-500 text-white font-semibold py-1 px-3 rounded-md transition-transform transform hover:scale-105 active:scale-100 shadow-md text-xl leading-none h-8 w-8 flex items-center justify-center"&gt;+&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;button id="zoomOutButton" class="bg-blue-500 text-white font-semibold py-1 px-3 rounded-md transition-transform transform hover:scale-105 active:scale-100 shadow-md text-xl leading-none h-8 w-8 flex items-center justify-center"&gt;-&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;!-- Layout for Manipulative Tools --&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div id="manipulativeLayout" class="hidden w-full flex flex-col flex-grow gap-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div id="manipulative_singleModeControls" class="flex flex-wrap items-center gap-4 justify-center md:justify-start"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                 </span>&lt;div id="manipulative_dimensionInputsInline" class="flex flex-wrap justify-center lg:justify-start items-center gap-x-2 gap-y-4"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div id="manipulative_focusStatementModeControls" class="hidden w-full flex flex-col md:flex-row gap-6"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="flex-1 p-4 bg-slate-50 rounded-lg border flex flex-col"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;h3 class="font-bold text-lg mb-3 text-slate-800"&gt;Focus Statement&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;textarea id="manipulative_focusStatementTextArea" class="w-full flex-grow p-2 border-2 border-slate-300 rounded-lg text-lg" placeholder="Enter text or MathJax... e.g., $$f(x) = \int_{-\infty}^\infty \hat{f}(\xi)\,e^{2 \pi i \xi x} \,d\xi$$"&gt;&lt;/textarea&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div id="manipulative_mainManipulativeDisplay" class="flex-grow"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div id="manipulative_singleCanvasContainer" class="manipulative_canvas-container w-full"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;canvas id="manipulative_mathCanvas"&gt;&lt;/canvas&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div id="manipulative_focusStatementDisplayContainer" class="hidden manipulative_canvas-container w-full"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;p id="manipulative_focusStatementLiveText"&gt;&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div id="manipulative_totalValueSection" class="full-width-section flex-1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;h3 id="manipulative_totalValueTitle" class="text-lg font-bold text-slate-800 mb-2"&gt;Total Value:&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div id="manipulative_totalValueContent" class="bg-slate-50 p-4 rounded-lg border border-slate-200 h-full overflow-x-auto flex flex-col justify-center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div id="manipulative_stepsContentContainer" class="mx-auto"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div id="messageBox" class="message-box"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>// --- GLOBAL DOM ELEMENTS &amp; STATE (File 1) ---</p>
<p class="p1"><span class="Apple-converted-space">    </span>const modeSelector = document.getElementById('modeSelector');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const messageBox = document.getElementById('messageBox');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const oldToolLayout = document.getElementById('oldToolLayout');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const newToolLayout = document.getElementById('newToolLayout');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const displayArea = document.getElementById('displayArea');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const calculationStepsColumn = document.getElementById('calculationStepsColumn');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const shapeDisplayFullWidth = document.getElementById('shapeDisplayFullWidth');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const shapeDisplay2D = document.getElementById('shapeDisplay2D');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const equationDisplayContainer = document.getElementById('equationDisplayContainer');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const equationDisplay = document.getElementById('equationDisplay');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const mathCanvas3D = document.getElementById('mathCanvas3D');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const mathCanvas2D = document.getElementById('mathCanvas2D');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const ctx2D = mathCanvas2D.getContext('2d');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const mathCanvas = document.getElementById('mathCanvas');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const ctx = mathCanvas.getContext('2d');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const dimensionInputsInline = document.getElementById('dimensionInputsInline');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const stepsContentContainer = document.getElementById('stepsContentContainer');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const menuToggleBtn = document.getElementById('menu-toggle-btn');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const menuToggleDot = document.getElementById('menu-toggle-dot');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const menuControls = document.getElementById('menu-controls');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const answerToggleBtn = document.getElementById('answer-toggle-btn');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const answerToggleDot = document.getElementById('answer-toggle-dot');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const answerToggleContainer = document.getElementById('answer-toggle-container');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const graphingInputsPanel = document.getElementById('graphingInputsPanel');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const graphingCanvasWrapper = document.getElementById('graphingCanvasWrapper');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const zoomControls = document.getElementById('zoomControls');</p>
<p class="p1"><span class="Apple-converted-space">    </span>let zoomInButton, zoomOutButton;</p>
<p class="p1"><span class="Apple-converted-space">    </span>let currentMode = 'simpleAngle';</p>
<p class="p1"><span class="Apple-converted-space">    </span>let scene, camera, renderer, prism, controls, labelRenderer, outline;</p>
<p class="p1"><span class="Apple-converted-space">    </span>let labels = [];</p>
<p class="p1"><span class="Apple-converted-space">    </span>let animationFrameId = null;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const SHAPE_DISPLAY_SCALE = 2.0;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const TARGET_VIEW_FILL_FACTOR = 0.7;</p>
<p class="p1"><span class="Apple-converted-space">    </span>let pixelsPerUnit = 50;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const defaultLineColors = ['#0000FF', '#FF0000', '#008000', '#800080', '#FFA500', '#00CED1'];</p>
<p class="p1"><span class="Apple-converted-space">    </span>let nextLineColorIndex = 0;</p>
<p class="p1"><span class="Apple-converted-space">    </span>let currentShapeVertices = [];</p>
<p class="p1"><span class="Apple-converted-space">    </span>let originalShapeVertices = [];</p>
<p class="p1"><span class="Apple-converted-space">    </span>let shapeTransformations = { translateX: 0, translateY: 0, rotateAngle: 0, flipX: false, flipY: false, flipYEqualsX: false };</p>
<p class="p1"><span class="Apple-converted-space">    </span>const quickShapeCoordinates = { square: "(1,1),(2,1),(2,2),(1,2)", triangle: "(1,1),(3,1),(2,3)", rectangle: "(1,1),(4,1),(4,2),(1,2)", rhombus: "(1,2),(3,1),(5,2),(3,3)" };</p>
<p class="p1"><span class="Apple-converted-space">    </span>const colors = { main: '#000000', answer: '#059669', point: '#FF0000', grid: '#e2e8f0', axis: '#64748b', primaryBlue: '#007bff', carry: '#ef4444', label: '#94a3b8' };</p>
<p class="p1"><span class="Apple-converted-space">    </span>const newCanvasModes = ['graphingCalculator', 'shapeTransformationTool'];</p>
<p class="p1"><span class="Apple-converted-space">    </span>const visualDisplayOnlyModes = ['numberline', 'lineGraph', 'barGraph', 'pictograph', 'stemAndLeafPlot', 'currencyCalculator', 'canadianCurrencyCalculator'];</p>
<p class="p1"><span class="Apple-converted-space">    </span>const sideBySideModes = [ 'simpleAngle', 'correspondingAngles', 'areaOfRectangle', 'perimeterOfRectangle', 'areaOfTriangle', 'perimeterOfTriangle', 'areaOfCircle', 'circumferenceOfCircle', 'volumeOfTriangularPrism', 'surfaceAreaOfTriangularPrism', 'netOfTriangularPrism', 'volumeOfRectangularPrism', 'surfaceAreaOfRectangularPrism', 'netOfRectangularPrism', 'volumeOfCylinder', 'surfaceAreaOfCylinder', 'netOfCylinder', 'volumeOfCone', 'surfaceAreaOfCone', 'netOfCone', 'volumeOfSquarePyramid', 'surfaceAreaOfSquarePyramid', 'netOfSquarePyramid' ];</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// --- GLOBAL DOM ELEMENTS &amp; STATE (File 2 - Renamed) ---</p>
<p class="p1"><span class="Apple-converted-space">    </span>const manipulativeLayout = document.getElementById('manipulativeLayout');</p>
<p class="p1"><span class="Apple-converted-space">    </span>let manipulative_currentMasterMode = 'baseTenBlocks';</p>
<p class="p1"><span class="Apple-converted-space">    </span>let manipulative_isAnimating = { left: false, right: false, single: false };</p>
<p class="p1"><span class="Apple-converted-space">    </span>let manipulative_lastSpinnerRotation = { left: 0, right: 0, single: 0 };</p>
<p class="p1"><span class="Apple-converted-space">    </span>let manipulative_lastSpinnerResult = { left: null, right: null, single: null };</p>
<p class="p1"><span class="Apple-converted-space">    </span>let manipulative_lastDiceResult = { left: null, right: null, single: null };</p>
<p class="p1"><span class="Apple-converted-space">    </span>const manipulative_singleModeControls = document.getElementById('manipulative_singleModeControls');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const manipulative_focusStatementModeControls = document.getElementById('manipulative_focusStatementModeControls');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const manipulative_dimensionInputsInline = document.getElementById('manipulative_dimensionInputsInline');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const manipulative_mainManipulativeDisplay = document.getElementById('manipulative_mainManipulativeDisplay');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const manipulative_totalValueSection = document.getElementById('manipulative_totalValueSection');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const manipulative_stepsContentContainer = document.getElementById('manipulative_stepsContentContainer');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const manipulative_totalValueTitle = document.getElementById('manipulative_totalValueTitle');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const manipulative_singleCanvasContainer = document.getElementById('manipulative_singleCanvasContainer');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const manipulative_focusStatementDisplayContainer = document.getElementById('manipulative_focusStatementDisplayContainer');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const manipulative_mathCanvas = document.getElementById('manipulative_mathCanvas');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const manipulative_ctx = manipulative_mathCanvas.getContext('2d');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const manipulative_focusStatementLiveText = document.getElementById('manipulative_focusStatementLiveText');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const manipulative_focusStatementTextArea = document.getElementById('manipulative_focusStatementTextArea');</p>
<p class="p1"><span class="Apple-converted-space">    </span>let manipulative_baseSize = 9;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const manipulative_DEPTH_PERSPECTIVE_RATIO = 0.5;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const manipulative_baseTenTransparency = 0.85;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const manipulative_geometricShapeTransparency = 0.75;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const manipulative_unitCubeColor = '#FFEB3B', manipulative_rodColor = '#4CAF50', manipulative_flatColor = '#2196F3', manipulative_block1000Color = '#F44336';</p>
<p class="p1"><span class="Apple-converted-space">    </span>const manipulative_fractionStripColor = '#4DB6AC', manipulative_fractionCircleColor = '#F06292', manipulative_fractionUnfilledColor = '#E0E0E0';</p>
<p class="p1"><span class="Apple-converted-space">    </span>const manipulative_factorTreeNodeColor = '#FFC107', manipulative_multiplicationBondColor = '#8BC34A', manipulative_additionBondColor = '#FF9800', manipulative_numberBondLineColor = '#757575';</p>
<p class="p1"><span class="Apple-converted-space">    </span>const manipulative_NUMBER_BOND_NODE_RADIUS = 30 * 1.25, manipulative_NUMBER_BOND_HORIZONTAL_SPACING = manipulative_NUMBER_BOND_NODE_RADIUS * 3, manipulative_NUMBER_BOND_VERTICAL_SPACING = manipulative_NUMBER_BOND_NODE_RADIUS * 2;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const manipulative_chartCellColor = '#e0e0e0', manipulative_chartBorderColor = '#bbb', manipulative_tenFrameDotColor = '#FF5722';</p>
<p class="p1"><span class="Apple-converted-space">    </span>const manipulative_highlightPrimeColor = '#ffeb3b', manipulative_highlightEvenColor = '#4CAF50', manipulative_highlightOddColor = '#9C27B0', manipulative_highlightMultipleColor = '#2196F3', manipulative_highlightFactorColor = '#F44336';</p>
<p class="p1"><span class="Apple-converted-space">    </span>const manipulative_algebraTilePositiveX2Color = '#2196F3', manipulative_algebraTilePositiveXColor = '#4CAF50', manipulative_algebraTilePositiveOneColor = '#FFEB3B';</p>
<p class="p1"><span class="Apple-converted-space">    </span>const manipulative_algebraTileNegativeColor = '#F44336';</p>
<p class="p1"><span class="Apple-converted-space">    </span>const manipulative_mainOutlineColor = '#000000', manipulative_mainOutlineWidth = 1.5, manipulative_internalLineColor = '#000000', manipulative_internalLineWidth = 1;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const manipulative_padding = 20, manipulative_minEffectiveBlockUnit = 8, manipulative_maxEffectiveBlockUnit = 30;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const manipulative_spinnerColors = ["#ef4444", "#22c55e", "#3b82f6", "#f97316", "#f59e0b", "#8b5cf6", "#ffffff", "#0f172a", "#14b8a6", "#ec4899", "#6366f1", "#84cc16", "#f43f5e", "#0ea5e9", "#a855f7", "#eab308"];</p>
<p class="p1"><span class="Apple-converted-space">    </span>const manipulativeModes = ['baseTenBlocks', 'algebraTiles', 'analogClock', 'probabilitySpinner', 'diceRoller', 'fractionStrips', 'fractionCircles', 'multiplicationArray', 'tenFrame', 'hundredsChart', 'factorTree', 'multiplicationNumberBond', 'additionNumberBond', 'focusStatement'];</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// --- INPUT TEMPLATES (Merged) ---</p>
<p class="p1"><span class="Apple-converted-space">    </span>const inputTemplates = {</p>
<p class="p1"><span class="Apple-converted-space">        </span>simpleAngle:`&lt;div class="flex items-center gap-2"&gt;&lt;label for="angleValue" class="text-sm font-semibold text-slate-700"&gt;Angle (°):&lt;/label&gt;&lt;input type="number" id="angleValue" value="45" min="0" max="360" class="w-20 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>correspondingAngles:`&lt;div class="flex items-center gap-2"&gt;&lt;label for="corrAngleValue" class="text-sm font-semibold text-slate-700"&gt;Angle 1 (°):&lt;/label&gt;&lt;input type="number" id="corrAngleValue" value="60" min="1" max="179" class="w-20 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;input type="checkbox" id="mysteryAngleToggle" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"&gt;&lt;label for="mysteryAngleToggle" class="text-sm font-semibold text-slate-700"&gt;Mystery Mode&lt;/label&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>volumeOfTriangularPrism:`&lt;div class="flex items-center gap-2"&gt;&lt;label for="triangleBase" class="text-sm font-semibold text-slate-700"&gt;Base (b):&lt;/label&gt;&lt;input type="number" id="triangleBase" value="4" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label for="triangleHeight" class="text-sm font-semibold text-slate-700"&gt;Height (h):&lt;/label&gt;&lt;input type="number" id="triangleHeight" value="3" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label for="prismLength" class="text-sm font-semibold text-slate-700"&gt;Length (L):&lt;/label&gt;&lt;input type="number" id="prismLength" value="5" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>surfaceAreaOfTriangularPrism:`&lt;div class="flex items-center gap-2"&gt;&lt;label for="saTriBase" class="text-sm font-semibold text-slate-700"&gt;Base (b):&lt;/label&gt;&lt;input type="number" id="saTriBase" value="3" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label for="saTriHeight" class="text-sm font-semibold text-slate-700"&gt;Height (h):&lt;/label&gt;&lt;input type="number" id="saTriHeight" value="4" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label for="saTriSide1" class="text-sm font-semibold text-slate-700"&gt;Side 1 (s1):&lt;/label&gt;&lt;input type="number" id="saTriSide1" value="3" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label for="saTriSide2" class="text-sm font-semibold text-slate-700"&gt;Side 2 (s2):&lt;/label&gt;&lt;input type="number" id="saTriSide2" value="6" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label for="saTriSide3" class="text-sm font-semibold text-slate-700"&gt;Side 3 (s3):&lt;/label&gt;&lt;input type="number" id="saTriSide3" value="6" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label for="saPrismHeight" class="text-sm font-semibold text-slate-700"&gt;Prism Height (H):&lt;/label&gt;&lt;input type="number" id="saPrismHeight" value="8" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>netOfTriangularPrism:`&lt;div class="flex items-center gap-2"&gt;&lt;label for="netTriBase" class="text-sm font-semibold text-slate-700"&gt;Base (b):&lt;/label&gt;&lt;input type="number" id="netTriBase" value="4" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label for="netTriHeight" class="text-sm font-semibold text-slate-700"&gt;Height (h):&lt;/label&gt;&lt;input type="number" id="netTriHeight" value="3" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label for="netPrismLength" class="text-sm font-semibold text-slate-700"&gt;Length (L):&lt;/label&gt;&lt;input type="number" id="netPrismLength" value="5" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>volumeOfRectangularPrism:`&lt;div class="flex items-center gap-2"&gt;&lt;label for="rectBase" class="text-sm font-semibold text-slate-700"&gt;Base (b):&lt;/label&gt;&lt;input type="number" id="rectBase" value="4" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label for="rectHeightBase" class="text-sm font-semibold text-slate-700"&gt;Height (h):&lt;/label&gt;&lt;input type="number" id="rectHeightBase" value="3" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label for="rectDepthPrism" class="text-sm font-semibold text-slate-700"&gt;Depth (d):&lt;/label&gt;&lt;input type="number" id="rectDepthPrism" value="5" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>surfaceAreaOfRectangularPrism:`&lt;div class="flex items-center gap-2"&gt;&lt;label for="saRectWidth" class="text-sm font-semibold text-slate-700"&gt;Base (b):&lt;/label&gt;&lt;input type="number" id="saRectWidth" value="5" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label for="saRectDepth" class="text-sm font-semibold text-slate-700"&gt;Height (h):&lt;/label&gt;&lt;input type="number" id="saRectDepth" value="4" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label for="saRectHeight" class="text-sm font-semibold text-slate-700"&gt;Depth (d):&lt;/label&gt;&lt;input type="number" id="saRectHeight" value="6" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>netOfRectangularPrism:`&lt;div class="flex items-center gap-2"&gt;&lt;label for="netRectBase" class="text-sm font-semibold text-slate-700"&gt;Base (b):&lt;/label&gt;&lt;input type="number" id="netRectBase" value="4" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label for="netRectHeight" class="text-sm font-semibold text-slate-700"&gt;Height (h):&lt;/label&gt;&lt;input type="number" id="netRectHeight" value="3" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label for="netRectDepth" class="text-sm font-semibold text-slate-700"&gt;Depth (d):&lt;/label&gt;&lt;input type="number" id="netRectDepth" value="5" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>volumeOfCylinder:`&lt;div class="flex items-center gap-2"&gt;&lt;label for="cylinderRadius" class="text-sm font-semibold text-slate-700"&gt;Radius (r):&lt;/label&gt;&lt;input type="number" id="cylinderRadius" value="2" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label for="cylinderHeight" class="text-sm font-semibold text-slate-700"&gt;Height (h):&lt;/label&gt;&lt;input type="number" id="cylinderHeight" value="5" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>surfaceAreaOfCylinder:`&lt;div class="flex items-center gap-2"&gt;&lt;label for="saCylinderRadius" class="text-sm font-semibold text-slate-700"&gt;Radius (r):&lt;/label&gt;&lt;input type="number" id="saCylinderRadius" value="3" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label for="saCylinderHeight" class="text-sm font-semibold text-slate-700"&gt;Height (h):&lt;/label&gt;&lt;input type="number" id="saCylinderHeight" value="7" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>netOfCylinder:`&lt;div class="flex items-center gap-2"&gt;&lt;label for="netCylinderRadius" class="text-sm font-semibold text-slate-700"&gt;Radius (r):&lt;/label&gt;&lt;input type="number" id="netCylinderRadius" value="2" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label for="netCylinderHeight" class="text-sm font-semibold text-slate-700"&gt;Height (h):&lt;/label&gt;&lt;input type="number" id="netCylinderHeight" value="5" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>volumeOfCone:`&lt;div class="flex items-center gap-2"&gt;&lt;label for="coneRadius" class="text-sm font-semibold text-slate-700"&gt;Radius (r):&lt;/label&gt;&lt;input type="number" id="coneRadius" value="3" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label for="coneHeight" class="text-sm font-semibold text-slate-700"&gt;Height (h):&lt;/label&gt;&lt;input type="number" id="coneHeight" value="5" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>surfaceAreaOfCone:`&lt;div class="flex items-center gap-2"&gt;&lt;label for="coneSARadius" class="text-sm font-semibold text-slate-700"&gt;Radius (r):&lt;/label&gt;&lt;input type="number" id="coneSARadius" value="3" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label for="coneSAHeight" class="text-sm font-semibold text-slate-700"&gt;Height (h):&lt;/label&gt;&lt;input type="number" id="coneSAHeight" value="5" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label for="coneSASlantHeight" class="text-sm font-semibold text-slate-700"&gt;Slant (l):&lt;/label&gt;&lt;input type="number" id="coneSASlantHeight" placeholder="auto" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center" disabled&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>netOfCone:`&lt;div class="flex items-center gap-2"&gt;&lt;label for="netConeRadius" class="text-sm font-semibold text-slate-700"&gt;Radius (r):&lt;/label&gt;&lt;input type="number" id="netConeRadius" value="3" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label for="netConeHeight" class="text-sm font-semibold text-slate-700"&gt;Height (h):&lt;/label&gt;&lt;input type="number" id="netConeHeight" value="5" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>volumeOfSquarePyramid:`&lt;div class="flex items-center gap-2"&gt;&lt;label for="pyramidBaseSide" class="text-sm font-semibold text-slate-700"&gt;Base Side (b):&lt;/label&gt;&lt;input type="number" id="pyramidBaseSide" value="4" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label for="pyramidHeight" class="text-sm font-semibold text-slate-700"&gt;Height (h):&lt;/label&gt;&lt;input type="number" id="pyramidHeight" value="6" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>surfaceAreaOfSquarePyramid:`&lt;div class="flex items-center gap-2"&gt;&lt;label for="pyramidSABaseSide" class="text-sm font-semibold text-slate-700"&gt;Base Side (b):&lt;/label&gt;&lt;input type="number" id="pyramidSABaseSide" value="4" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label for="pyramidSAHeight" class="text-sm font-semibold text-slate-700"&gt;Height (h):&lt;/label&gt;&lt;input type="number" id="pyramidSAHeight" value="6" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label for="pyramidSASlantHeight" class="text-sm font-semibold text-slate-700"&gt;Slant (l):&lt;/label&gt;&lt;input type="number" id="pyramidSASlantHeight" placeholder="auto" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center" disabled&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>netOfSquarePyramid:`&lt;div class="flex items-center gap-2"&gt;&lt;label for="netPyramidBaseSide" class="text-sm font-semibold text-slate-700"&gt;Base Side (b):&lt;/label&gt;&lt;input type="number" id="netPyramidBaseSide" value="4" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label for="netPyramidHeight" class="text-sm font-semibold text-slate-700"&gt;Height (h):&lt;/label&gt;&lt;input type="number" id="netPyramidHeight" value="6" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>areaOfRectangle:`&lt;div class="flex items-center gap-2"&gt;&lt;label for="rectAreaLength" class="text-sm font-semibold text-slate-700"&gt;Length (l):&lt;/label&gt;&lt;input type="number" id="rectAreaLength" value="10" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label for="rectAreaWidth" class="text-sm font-semibold text-slate-700"&gt;Width (w):&lt;/label&gt;&lt;input type="number" id="rectAreaWidth" value="5" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>perimeterOfRectangle:`&lt;div class="flex items-center gap-2"&gt;&lt;label for="rectPerimeterLength" class="text-sm font-semibold text-slate-700"&gt;Length (l):&lt;/label&gt;&lt;input type="number" id="rectPerimeterLength" value="10" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label for="rectPerimeterWidth" class="text-sm font-semibold text-slate-700"&gt;Width (w):&lt;/label&gt;&lt;input type="number" id="rectPerimeterWidth" value="5" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>areaOfTriangle:`&lt;div class="flex items-center gap-2"&gt;&lt;label for="triAreaBase" class="text-sm font-semibold text-slate-700"&gt;Base (b):&lt;/label&gt;&lt;input type="number" id="triAreaBase" value="6" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label for="triAreaHeight" class="text-sm font-semibold text-slate-700"&gt;Height (h):&lt;/label&gt;&lt;input type="number" id="triAreaHeight" value="4" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>perimeterOfTriangle:`&lt;div class="flex items-center gap-2"&gt;&lt;label for="triPerimeterSideA" class="text-sm font-semibold text-slate-700"&gt;Side A (a):&lt;/label&gt;&lt;input type="number" id="triPerimeterSideA" value="5" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label for="triPerimeterSideB" class="text-sm font-semibold text-slate-700"&gt;Side B (b):&lt;/label&gt;&lt;input type="number" id="triPerimeterSideB" value="5" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label for="triPerimeterSideC" class="text-sm font-semibold text-slate-700"&gt;Side C (c):&lt;/label&gt;&lt;input type="number" id="triPerimeterSideC" value="6" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>areaOfCircle:`&lt;div class="flex items-center gap-2"&gt;&lt;label for="circleAreaRadius" class="text-sm font-semibold text-slate-700"&gt;Radius (r):&lt;/label&gt;&lt;input type="number" id="circleAreaRadius" value="5" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>circumferenceOfCircle:`&lt;div class="flex items-center gap-2"&gt;&lt;label for="circleCircumferenceRadius" class="text-sm font-semibold text-slate-700"&gt;Radius (r):&lt;/label&gt;&lt;input type="number" id="circleCircumferenceRadius" value="5" class="w-12 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>linearEquationSolver: `&lt;div class="flex items-center gap-2"&gt;&lt;label for="coeffA" class="text-sm font-semibold text-slate-700"&gt;a:&lt;/label&gt;&lt;input type="number" id="coeffA" value="2" class="w-16 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label for="coeffB" class="text-sm font-semibold text-slate-700"&gt;b:&lt;/label&gt;&lt;input type="number" id="coeffB" value="5" class="w-16 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label for="coeffC" class="text-sm font-semibold text-slate-700"&gt;c:&lt;/label&gt;&lt;input type="number" id="coeffC" value="15" class="w-16 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>additionAlgorithm: `&lt;div class="flex items-center gap-2"&gt;&lt;label for="num1" class="text-sm font-semibold text-slate-700"&gt;Num 1:&lt;/label&gt;&lt;input type="number" id="num1" value="123" class="w-24 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label for="num2" class="text-sm font-semibold text-slate-700"&gt;Num 2:&lt;/label&gt;&lt;input type="number" id="num2" value="45" class="w-24 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>subtractionAlgorithm: `&lt;div class="flex items-center gap-2"&gt;&lt;label for="num1" class="text-sm font-semibold text-slate-700"&gt;Num 1:&lt;/label&gt;&lt;input type="number" id="num1" value="100" class="w-24 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label for="num2" class="text-sm font-semibold text-slate-700"&gt;Num 2:&lt;/label&gt;&lt;input type="number" id="num2" value="1" class="w-24 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>multiplicationAlgorithm: `&lt;div class="flex items-center gap-2"&gt;&lt;label for="num1" class="text-sm font-semibold text-slate-700"&gt;Num 1:&lt;/label&gt;&lt;input type="number" id="num1" value="123" class="w-24 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label for="num2" class="text-sm font-semibold text-slate-700"&gt;Num 2:&lt;/label&gt;&lt;input type="number" id="num2" value="45" class="w-24 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>longDivision: `&lt;div class="flex items-center gap-2"&gt;&lt;input type="number" id="dividend" value="3461" min="0" placeholder="Dividend" class="w-24 p-2 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition"&gt;&lt;span class="text-2xl font-bold text-slate-400"&gt;÷&lt;/span&gt;&lt;input type="number" id="divisor" value="35" min="1" placeholder="Divisor" class="w-24 p-2 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition"&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>bedmasCalculator: `&lt;div class="flex items-center gap-2"&gt;&lt;label for="expression" class="text-sm font-semibold text-slate-700"&gt;Expression:&lt;/label&gt;&lt;input type="text" id="expression" value="3 + 4 * 2 / (1 - 5)^2" class="w-64 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition"&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>tableEquation: `&lt;div class="flex items-center justify-center gap-2"&gt;&lt;label for="xVal1" class="text-sm font-semibold text-slate-700"&gt;x:&lt;/label&gt;&lt;input type="number" id="xVal1" value="2" class="table-x w-16 p-1 border-2 border-slate-300 rounded-lg text-center"&gt;&lt;label for="yVal1" class="text-sm font-semibold text-slate-700"&gt;y:&lt;/label&gt;&lt;input type="number" id="yVal1" value="6" class="table-y w-16 p-1 border-2 border-slate-300 rounded-lg text-center"&gt;&lt;/div&gt;&lt;div id="table-container" class="flex flex-col gap-2"&gt;&lt;/div&gt;&lt;button id="add-table-row" class="mt-2 bg-indigo-500 text-white font-bold py-1 px-3 rounded-lg text-sm"&gt;+&lt;/button&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>fractionAddition: `&lt;div class="flex items-center justify-center gap-4"&gt;&lt;div class="flex flex-col items-center"&gt;&lt;input type="number" id="num1" value="1" class="w-16 p-1 text-center border-2 rounded-lg"&gt;&lt;div class="h-px w-16 bg-slate-800 my-1"&gt;&lt;/div&gt;&lt;input type="number" id="den1" value="2" class="w-16 p-1 text-center border-2 rounded-lg"&gt;&lt;/div&gt;&lt;span class="text-4xl font-light"&gt;+&lt;/span&gt;&lt;div class="flex flex-col items-center"&gt;&lt;input type="number" id="num2" value="1" class="w-16 p-1 text-center border-2 rounded-lg"&gt;&lt;div class="h-px w-16 bg-slate-800 my-1"&gt;&lt;/div&gt;&lt;input type="number" id="den2" value="3" class="w-16 p-1 text-center border-2 rounded-lg"&gt;&lt;/div&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>fractionSubtraction: `&lt;div class="flex items-center justify-center gap-4"&gt;&lt;div class="flex flex-col items-center"&gt;&lt;input type="number" id="num1" value="3" class="w-16 p-1 text-center border-2 rounded-lg"&gt;&lt;div class="h-px w-16 bg-slate-800 my-1"&gt;&lt;/div&gt;&lt;input type="number" id="den1" value="4" class="w-16 p-1 text-center border-2 rounded-lg"&gt;&lt;/div&gt;&lt;span class="text-4xl font-light"&gt;-&lt;/span&gt;&lt;div class="flex flex-col items-center"&gt;&lt;input type="number" id="num2" value="1" class="w-16 p-1 text-center border-2 rounded-lg"&gt;&lt;div class="h-px w-16 bg-slate-800 my-1"&gt;&lt;/div&gt;&lt;input type="number" id="den2" value="2" class="w-16 p-1 text-center border-2 rounded-lg"&gt;&lt;/div&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>fractionMultiplication: `&lt;div class="flex items-center justify-center gap-4"&gt;&lt;div class="flex flex-col items-center"&gt;&lt;input type="number" id="num1" value="2" class="w-16 p-1 text-center border-2 rounded-lg"&gt;&lt;div class="h-px w-16 bg-slate-800 my-1"&gt;&lt;/div&gt;&lt;input type="number" id="den1" value="3" class="w-16 p-1 text-center border-2 rounded-lg"&gt;&lt;/div&gt;&lt;span class="text-4xl font-light"&gt;$\\times$&lt;/span&gt;&lt;div class="flex flex-col items-center"&gt;&lt;input type="number" id="num2" value="1" class="w-16 p-1 text-center border-2 rounded-lg"&gt;&lt;div class="h-px w-16 bg-slate-800 my-1"&gt;&lt;/div&gt;&lt;input type="number" id="den2" value="2" class="w-16 p-1 text-center border-2 rounded-lg"&gt;&lt;/div&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>fractionDivision: `&lt;div class="flex items-center justify-center gap-4"&gt;&lt;div class="flex flex-col items-center"&gt;&lt;input type="number" id="num1" value="3" class="w-16 p-1 text-center border-2 rounded-lg"&gt;&lt;div class="h-px w-16 bg-slate-800 my-1"&gt;&lt;/div&gt;&lt;input type="number" id="den1" value="4" class="w-16 p-1 text-center border-2 rounded-lg"&gt;&lt;/div&gt;&lt;span class="text-4xl font-light"&gt;$\\div$&lt;/span&gt;&lt;div class="flex flex-col items-center"&gt;&lt;input type="number" id="num2" value="1" class="w-16 p-1 text-center border-2 rounded-lg"&gt;&lt;div class="h-px w-16 bg-slate-800 my-1"&gt;&lt;/div&gt;&lt;input type="number" id="den2" value="2" class="w-16 p-1 text-center border-2 rounded-lg"&gt;&lt;/div&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>mixedAddition: `&lt;div class="flex items-center justify-center gap-4"&gt;&lt;div class="flex items-center gap-2"&gt;&lt;input type="number" id="whole1" value="1" class="w-16 p-1 text-center border-2 rounded-lg"&gt;&lt;div class="flex flex-col items-center"&gt;&lt;input type="number" id="num1" value="1" class="w-16 p-1 text-center border-2 rounded-lg"&gt;&lt;div class="h-px w-16 bg-slate-800 my-1"&gt;&lt;/div&gt;&lt;input type="number" id="den1" value="2" class="w-16 p-1 text-center border-2 rounded-lg"&gt;&lt;/div&gt;&lt;/div&gt;&lt;span class="text-4xl font-light"&gt;+&lt;/span&gt;&lt;div class="flex items-center gap-2"&gt;&lt;input type="number" id="whole2" value="2" class="w-16 p-1 text-center border-2 rounded-lg"&gt;&lt;div class="flex flex-col items-center"&gt;&lt;input type="number" id="num2" value="1" class="w-16 p-1 text-center border-2 rounded-lg"&gt;&lt;div class="h-px w-16 bg-slate-800 my-1"&gt;&lt;/div&gt;&lt;input type="number" id="den2" value="3" class="w-16 p-1 text-center border-2 rounded-lg"&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>mixedSubtraction: `&lt;div class="flex items-center justify-center gap-4"&gt;&lt;div class="flex items-center gap-2"&gt;&lt;input type="number" id="whole1" value="3" class="w-16 p-1 text-center border-2 rounded-lg"&gt;&lt;div class="flex flex-col items-center"&gt;&lt;input type="number" id="num1" value="1" class="w-16 p-1 text-center border-2 rounded-lg"&gt;&lt;div class="h-px w-16 bg-slate-800 my-1"&gt;&lt;/div&gt;&lt;input type="number" id="den1" value="2" class="w-16 p-1 text-center border-2 rounded-lg"&gt;&lt;/div&gt;&lt;/div&gt;&lt;span class="text-4xl font-light"&gt;-&lt;/span&gt;&lt;div class="flex items-center gap-2"&gt;&lt;input type="number" id="whole2" value="1" class="w-16 p-1 text-center border-2 rounded-lg"&gt;&lt;div class="flex flex-col items-center"&gt;&lt;input type="number" id="num2" value="3" class="w-16 p-1 text-center border-2 rounded-lg"&gt;&lt;div class="h-px w-16 bg-slate-800 my-1"&gt;&lt;/div&gt;&lt;input type="number" id="den2" value="4" class="w-16 p-1 text-center border-2 rounded-lg"&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>mixedMultiplication: `&lt;div class="flex items-center justify-center gap-4"&gt;&lt;div class="flex items-center gap-2"&gt;&lt;input type="number" id="whole1" value="1" class="w-16 p-1 text-center border-2 rounded-lg"&gt;&lt;div class="flex flex-col items-center"&gt;&lt;input type="number" id="num1" value="1" class="w-16 p-1 text-center border-2 rounded-lg"&gt;&lt;div class="h-px w-16 bg-slate-800 my-1"&gt;&lt;/div&gt;&lt;input type="number" id="den1" value="2" class="w-16 p-1 text-center border-2 rounded-lg"&gt;&lt;/div&gt;&lt;/div&gt;&lt;span class="text-4xl font-light"&gt;$\\times$&lt;/span&gt;&lt;div class="flex items-center gap-2"&gt;&lt;input type="number" id="whole2" value="2" class="w-16 p-1 text-center border-2 rounded-lg"&gt;&lt;div class="flex flex-col items-center"&gt;&lt;input type="number" id="num2" value="1" class="w-16 p-1 text-center border-2 rounded-lg"&gt;&lt;div class="h-px w-16 bg-slate-800 my-1"&gt;&lt;/div&gt;&lt;input type="number" id="den2" value="3" class="w-16 p-1 text-center border-2 rounded-lg"&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>mixedDivision: `&lt;div class="flex items-center justify-center gap-4"&gt;&lt;div class="flex items-center gap-2"&gt;&lt;input type="number" id="whole1" value="3" class="w-16 p-1 text-center border-2 rounded-lg"&gt;&lt;div class="flex flex-col items-center"&gt;&lt;input type="number" id="num1" value="1" class="w-16 p-1 text-center border-2 rounded-lg"&gt;&lt;div class="h-px w-16 bg-slate-800 my-1"&gt;&lt;/div&gt;&lt;input type="number" id="den1" value="2" class="w-16 p-1 text-center border-2 rounded-lg"&gt;&lt;/div&gt;&lt;/div&gt;&lt;span class="text-4xl font-light"&gt;$\\div$&lt;/span&gt;&lt;div class="flex items-center gap-2"&gt;&lt;input type="number" id="whole2" value="1" class="w-16 p-1 text-center border-2 rounded-lg"&gt;&lt;div class="flex flex-col items-center"&gt;&lt;input type="number" id="num2" value="3" class="w-16 p-1 text-center border-2 rounded-lg"&gt;&lt;div class="h-px w-16 bg-slate-800 my-1"&gt;&lt;/div&gt;&lt;input type="number" id="den2" value="4" class="w-16 p-1 text-center border-2 rounded-lg"&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>numberline: `&lt;div class="flex items-center gap-2"&gt;&lt;label for="numStart" class="text-sm font-semibold text-slate-700"&gt;Start:&lt;/label&gt;&lt;input type="number" id="numStart" value="-10" class="w-20 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label for="numEnd" class="text-sm font-semibold text-slate-700"&gt;End:&lt;/label&gt;&lt;input type="number" id="numEnd" value="10" class="w-20 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label for="numStep" class="text-sm font-semibold text-slate-700"&gt;Step:&lt;/label&gt;&lt;input type="number" id="numStep" value="1" class="w-20 p-1 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition text-center"&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>lineGraph: `&lt;div id="graph-data-container" class="flex flex-col gap-2"&gt;&lt;/div&gt;&lt;button id="add-graph-row" class="mt-2 bg-indigo-500 text-white font-bold py-1 px-3 rounded-lg text-sm"&gt;+&lt;/button&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>barGraph: `&lt;div id="graph-data-container" class="flex flex-col gap-2"&gt;&lt;/div&gt;&lt;button id="add-graph-row" class="mt-2 bg-indigo-500 text-white font-bold py-1 px-3 rounded-lg text-sm"&gt;+&lt;/button&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>pictograph: `&lt;div class="flex items-center gap-4"&gt;&lt;select id="pico-emoji" class="bg-slate-200 text-slate-800 font-bold py-2 px-4 rounded-lg"&gt;&lt;option&gt;⭐&lt;/option&gt;&lt;option&gt;❤️&lt;/option&gt;&lt;option&gt;👍&lt;/option&gt;&lt;option&gt;🍎&lt;/option&gt;&lt;option&gt;🚗&lt;/option&gt;&lt;option&gt;⚽️&lt;/option&gt;&lt;option&gt;😃&lt;/option&gt;&lt;/select&gt;&lt;div id="graph-data-container" class="flex flex-col gap-2"&gt;&lt;/div&gt;&lt;button id="add-graph-row" class="mt-2 bg-indigo-500 text-white font-bold py-1 px-3 rounded-lg text-sm"&gt;+&lt;/button&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>stemAndLeafPlot: `&lt;div&gt;&lt;textarea id="stem-leaf-data" class="w-full p-2 border-2 border-slate-300 rounded-lg" rows="4" placeholder="Enter numbers separated by commas, e.g., 10, 22, 11, 35, 23, 4, 35"&gt;&lt;/textarea&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>currencyCalculator: `&lt;div class="grid grid-cols-2 md:grid-cols-4 gap-4"&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label class="w-16"&gt;$100:&lt;/label&gt;&lt;input type="number" id="curr-100" class="currency-input w-20 p-1 border-2 rounded-lg text-center" value="0" min="0"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label class="w-16"&gt;$50:&lt;/label&gt;&lt;input type="number" id="curr-50" class="currency-input w-20 p-1 border-2 rounded-lg text-center" value="0" min="0"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label class="w-16"&gt;$20:&lt;/label&gt;&lt;input type="number" id="curr-20" class="currency-input w-20 p-1 border-2 rounded-lg text-center" value="0" min="0"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label class="w-16"&gt;$10:&lt;/label&gt;&lt;input type="number" id="curr-10" class="currency-input w-20 p-1 border-2 rounded-lg text-center" value="0" min="0"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label class="w-16"&gt;$5:&lt;/label&gt;&lt;input type="number" id="curr-5" class="currency-input w-20 p-1 border-2 rounded-lg text-center" value="0" min="0"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label class="w-16"&gt;$1:&lt;/label&gt;&lt;input type="number" id="curr-1" class="currency-input w-20 p-1 border-2 rounded-lg text-center" value="0" min="0"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label class="w-16"&gt;25¢:&lt;/label&gt;&lt;input type="number" id="curr-0.25" class="currency-input w-20 p-1 border-2 rounded-lg text-center" value="0" min="0"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label class="w-16"&gt;10¢:&lt;/label&gt;&lt;input type="number" id="curr-0.10" class="currency-input w-20 p-1 border-2 rounded-lg text-center" value="0" min="0"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label class="w-16"&gt;5¢:&lt;/label&gt;&lt;input type="number" id="curr-0.05" class="currency-input w-20 p-1 border-2 rounded-lg text-center" value="0" min="0"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label class="w-16"&gt;1¢:&lt;/label&gt;&lt;input type="number" id="curr-0.01" class="currency-input w-20 p-1 border-2 rounded-lg text-center" value="0" min="0"&gt;&lt;/div&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>canadianCurrencyCalculator: `&lt;div class="grid grid-cols-2 md:grid-cols-4 gap-4"&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label class="w-16"&gt;$100:&lt;/label&gt;&lt;input type="number" id="can-curr-100" class="canadian-currency-input w-20 p-1 border-2 rounded-lg text-center" value="0" min="0"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label class="w-16"&gt;$50:&lt;/label&gt;&lt;input type="number" id="can-curr-50" class="canadian-currency-input w-20 p-1 border-2 rounded-lg text-center" value="0" min="0"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label class="w-16"&gt;$20:&lt;/label&gt;&lt;input type="number" id="can-curr-20" class="canadian-currency-input w-20 p-1 border-2 rounded-lg text-center" value="0" min="0"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label class="w-16"&gt;$10:&lt;/label&gt;&lt;input type="number" id="can-curr-10" class="canadian-currency-input w-20 p-1 border-2 rounded-lg text-center" value="0" min="0"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label class="w-16"&gt;$5:&lt;/label&gt;&lt;input type="number" id="can-curr-5" class="canadian-currency-input w-20 p-1 border-2 rounded-lg text-center" value="0" min="0"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label class="w-16"&gt;$2:&lt;/label&gt;&lt;input type="number" id="can-curr-2" class="canadian-currency-input w-20 p-1 border-2 rounded-lg text-center" value="0" min="0"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label class="w-16"&gt;$1:&lt;/label&gt;&lt;input type="number" id="can-curr-1" class="canadian-currency-input w-20 p-1 border-2 rounded-lg text-center" value="0" min="0"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label class="w-16"&gt;25¢:&lt;/label&gt;&lt;input type="number" id="can-curr-0.25" class="canadian-currency-input w-20 p-1 border-2 rounded-lg text-center" value="0" min="0"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label class="w-16"&gt;10¢:&lt;/label&gt;&lt;input type="number" id="can-curr-0.10" class="canadian-currency-input w-20 p-1 border-2 rounded-lg text-center" value="0" min="0"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label class="w-16"&gt;5¢:&lt;/label&gt;&lt;input type="number" id="can-curr-0.05" class="canadian-currency-input w-20 p-1 border-2 rounded-lg text-center" value="0" min="0"&gt;&lt;/div&gt;&lt;div class="flex items-center gap-2"&gt;&lt;label class="w-16"&gt;1¢:&lt;/label&gt;&lt;input type="number" id="can-curr-0.01" class="canadian-currency-input w-20 p-1 border-2 rounded-lg text-center" value="0" min="0"&gt;&lt;/div&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>graphingCalculatorInputs: `&lt;div id="equationLinesContainer" class="flex flex-col gap-2 w-full"&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>shapeTransformationToolInputs: `&lt;div class="flex flex-col gap-3 w-full"&gt;&lt;label for="polygonInput" class="text-sm font-normal text-slate-700"&gt;Polygon Co-ordinates:&lt;/label&gt;&lt;input type="text" id="polygonInput" value="(1,1),(2,1),(2,2),(1,2)" placeholder="(x1,y1),(x2,y2),..." class="w-full p-2 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition text-sm font-normal"&gt;&lt;div class="grid grid-cols-2 gap-2 mt-4"&gt;&lt;button type="button" id="squareQuickShape" class="bg-gray-200 text-gray-800 font-semibold py-1 px-2 rounded-lg hover:bg-gray-300 transition text-xs"&gt;Square&lt;/button&gt;&lt;button type="button" id="triangleQuickShape" class="bg-gray-200 text-gray-800 font-semibold py-1 px-2 rounded-lg hover:bg-gray-300 transition text-xs"&gt;Triangle&lt;/button&gt;&lt;button type="button" id="rectangleQuickShape" class="bg-gray-200 text-gray-800 font-semibold py-1 px-2 rounded-lg hover:bg-gray-300 transition text-xs"&gt;Rectangle&lt;/button&gt;&lt;button type="button" id="rhombusQuickShape" class="bg-gray-200 text-gray-800 font-semibold py-1 px-2 rounded-lg hover:bg-gray-300 transition text-xs"&gt;Rhombus&lt;/button&gt;&lt;/div&gt;&lt;div class="grid grid-cols-2 gap-2 mt-4"&gt;&lt;label for="translateX" class="col-span-1 text-sm font-normal text-slate-700"&gt;Translate X:&lt;/label&gt;&lt;input type="number" id="translateX" value="0" class="col-span-1 w-16 p-2 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition font-normal"&gt;&lt;label for="translateY" class="col-span-1 text-sm font-normal text-slate-700"&gt;Translate Y:&lt;/label&gt;&lt;input type="number" id="translateY" value="0" class="col-span-1 w-16 p-2 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition font-normal"&gt;&lt;label for="rotateAngle" class="col-span-1 text-sm font-normal text-slate-700"&gt;Rotate (degrees):&lt;/label&gt;&lt;input type="number" id="rotateAngle" value="0" class="col-span-1 w-16 p-2 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition font-normal"&gt;&lt;label class="col-span-2 text-sm font-normal text-slate-700"&gt;Rotate About (x,y):&lt;/label&gt;&lt;input type="number" id="rotateOriginX" value="" placeholder="X" class="col-span-1 w-16 p-2 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition font-normal"&gt;&lt;input type="number" id="rotateOriginY" value="" placeholder="Y" class="col-span-1 w-16 p-2 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition font-normal"&gt;&lt;/div&gt;&lt;div class="grid grid-cols-2 gap-2 mt-2"&gt;&lt;span class="col-span-2 text-sm font-normal text-slate-700"&gt;Flip:&lt;/span&gt;&lt;div class="flex items-center"&gt;&lt;input type="radio" id="flipNone" name="flipAxis" value="none" checked&gt;&lt;label for="flipNone" class="ml-1 text-sm font-normal text-slate-600"&gt;None&lt;/label&gt;&lt;/div&gt;&lt;div class="flex items-center"&gt;&lt;input type="radio" id="flipX" name="flipAxis" value="x"&gt;&lt;label for="flipX" class="ml-1 text-sm font-normal text-slate-600"&gt;X-axis&lt;/label&gt;&lt;/div&gt;&lt;div class="flex items-center"&gt;&lt;input type="radio" id="flipY" name="flipAxis" value="y"&gt;&lt;label for="flipY" class="ml-1 text-sm font-normal text-slate-600"&gt;Y-axis&lt;/label&gt;&lt;/div&gt;&lt;div class="flex items-center"&gt;&lt;input type="radio" id="flipYEqualsX" name="flipAxis" value="y=x"&gt;&lt;label for="flipYEqualsX" class="ml-1 text-sm font-normal text-slate-600"&gt;Y=X&lt;/label&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="flex justify-start gap-2 mt-4"&gt;&lt;button type="button" id="applyShapeTransform" class="bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-indigo-700 transition-transform transform hover:scale-105 active:scale-100 shadow-md"&gt;Apply Transformation&lt;/button&gt;&lt;button type="button" id="resetShapeTransform" class="bg-red-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-red-600 transition-transform transform hover:scale-105 active:scale-100 shadow-md"&gt;Reset Shape&lt;/button&gt;&lt;/div&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>baseTenBlocks: `&lt;div class="grid grid-cols-2 md:grid-cols-4 gap-4"&gt;&lt;div class="flex flex-col items-center"&gt;&lt;label class="text-sm font-semibold text-slate-700"&gt;Thousands:&lt;/label&gt;&lt;input type="number" id="manipulative_block-1000_{SIDE}" class="block-input w-20 p-1 border-2 border-slate-300 rounded-lg text-center" value="0" min="0"&gt;&lt;/div&gt;&lt;div class="flex flex-col items-center"&gt;&lt;label class="text-sm font-semibold text-slate-700"&gt;Hundreds:&lt;/label&gt;&lt;input type="number" id="manipulative_block-100_{SIDE}" class="block-input w-20 p-1 border-2 border-slate-300 rounded-lg text-center" value="0" min="0"&gt;&lt;/div&gt;&lt;div class="flex flex-col items-center"&gt;&lt;label class="text-sm font-semibold text-slate-700"&gt;Tens:&lt;/label&gt;&lt;input type="number" id="manipulative_block-10_{SIDE}" class="block-input w-20 p-1 border-2 border-slate-300 rounded-lg text-center" value="0" min="0"&gt;&lt;/div&gt;&lt;div class="flex flex-col items-center"&gt;&lt;label class="text-sm font-semibold text-slate-700"&gt;Ones:&lt;/label&gt;&lt;input type="number" id="manipulative_block-1_{SIDE}" class="block-input w-20 p-1 border-2 border-slate-300 rounded-lg text-center" value="0" min="0"&gt;&lt;/div&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>algebraTiles: `&lt;div class="grid grid-cols-3 md:grid-cols-6 gap-x-4 gap-y-2"&gt;&lt;div class="flex flex-col items-center"&gt;&lt;label class="text-sm font-semibold text-blue-600"&gt;$x^2$&lt;/label&gt;&lt;input type="number" id="manipulative_tile-x2_{SIDE}" class="w-16 p-1 border-2 border-slate-300 rounded-lg text-center" value="1" min="0"&gt;&lt;/div&gt;&lt;div class="flex flex-col items-center"&gt;&lt;label class="text-sm font-semibold text-green-600"&gt;$x$&lt;/label&gt;&lt;input type="number" id="manipulative_tile-x_{SIDE}" class="w-16 p-1 border-2 border-slate-300 rounded-lg text-center" value="2" min="0"&gt;&lt;/div&gt;&lt;div class="flex flex-col items-center"&gt;&lt;label class="text-sm font-semibold text-yellow-500"&gt;$1$&lt;/label&gt;&lt;input type="number" id="manipulative_tile-1_{SIDE}" class="w-16 p-1 border-2 border-slate-300 rounded-lg text-center" value="3" min="0"&gt;&lt;/div&gt;&lt;div class="flex flex-col items-center"&gt;&lt;label class="text-sm font-semibold text-red-600"&gt;$-x^2$&lt;/label&gt;&lt;input type="number" id="manipulative_tile-neg-x2_{SIDE}" class="w-16 p-1 border-2 border-slate-300 rounded-lg text-center" value="0" min="0"&gt;&lt;/div&gt;&lt;div class="flex flex-col items-center"&gt;&lt;label class="text-sm font-semibold text-red-600"&gt;$-x$&lt;/label&gt;&lt;input type="number" id="manipulative_tile-neg-x_{SIDE}" class="w-16 p-1 border-2 border-slate-300 rounded-lg text-center" value="1" min="0"&gt;&lt;/div&gt;&lt;div class="flex flex-col items-center"&gt;&lt;label class="text-sm font-semibold text-red-600"&gt;$-1$&lt;/label&gt;&lt;input type="number" id="manipulative_tile-neg-1_{SIDE}" class="w-16 p-1 border-2 border-slate-300 rounded-lg text-center" value="2" min="0"&gt;&lt;/div&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>analogClock: `&lt;div class="flex items-center gap-4"&gt;&lt;label class="text-sm font-semibold text-slate-700"&gt;Hour:&lt;/label&gt;&lt;input type="number" id="manipulative_clockHour_{SIDE}" class="w-20 p-1 border-2 border-slate-300 rounded-lg text-center" value="3" min="1" max="12"&gt;&lt;label class="text-sm font-semibold text-slate-700"&gt;Minute:&lt;/label&gt;&lt;input type="number" id="manipulative_clockMinute_{SIDE}" class="w-20 p-1 border-2 border-slate-300 rounded-lg text-center" value="15" min="0" max="59"&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>probabilitySpinner: `&lt;div class="flex items-center gap-4"&gt;&lt;label class="text-sm font-semibold text-slate-700"&gt;Sections:&lt;/label&gt;&lt;input type="number" id="manipulative_spinnerSections_{SIDE}" class="w-20 p-1 border-2 border-slate-300 rounded-lg text-center" value="6" min="2" max="20"&gt;&lt;button type="button" id="manipulative_spinButton_{SIDE}" class="bg-blue-500 text-white font-semibold py-2 px-4 rounded-lg"&gt;Spin&lt;/button&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>diceRoller: `&lt;div class="flex items-center gap-4"&gt;&lt;label class="text-sm font-semibold text-slate-700"&gt;Sides:&lt;/label&gt;&lt;input type="number" id="manipulative_diceSides_{SIDE}" class="w-20 p-1 border-2 border-slate-300 rounded-lg text-center" value="6" min="1"&gt;&lt;button type="button" id="manipulative_rollButton_{SIDE}" class="bg-blue-500 text-white font-semibold py-2 px-4 rounded-lg"&gt;Roll&lt;/button&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>fractionStrips: `&lt;div id="manipulative_fractionStripInputsContainer_{SIDE}" class="flex flex-col gap-2 w-full"&gt;&lt;/div&gt;&lt;button type="button" id="manipulative_addFractionStrip_{SIDE}" class="mt-2 bg-blue-500 text-white font-semibold py-1 px-3 rounded-lg text-sm"&gt;Add Strip&lt;/button&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>fractionCircles: `&lt;div id="manipulative_fractionCircleInputsContainer_{SIDE}" class="flex flex-col gap-2 w-full"&gt;&lt;/div&gt;&lt;button type="button" id="manipulative_addFractionCircle_{SIDE}" class="mt-2 bg-blue-500 text-white font-semibold py-1 px-3 rounded-lg text-sm"&gt;Add Circle&lt;/button&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>multiplicationArray: `&lt;div class="flex items-center gap-2"&gt;&lt;label class="text-sm font-semibold text-slate-700"&gt;Rows:&lt;/label&gt;&lt;input type="number" id="manipulative_arrayRows_{SIDE}" class="w-20 p-1 border-2 border-slate-300 rounded-lg text-center" value="3" min="1" max="20"&gt;&lt;span class="text-xl font-bold text-slate-700 mx-2"&gt;x&lt;/span&gt;&lt;label class="text-sm font-semibold text-slate-700"&gt;Cols:&lt;/label&gt;&lt;input type="number" id="manipulative_arrayCols_{SIDE}" class="w-20 p-1 border-2 border-slate-300 rounded-lg text-center" value="4" min="1" max="20"&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>tenFrame: `&lt;div class="flex items-center gap-4"&gt;&lt;label class="text-sm font-semibold text-slate-700"&gt;Frame Size:&lt;/label&gt;&lt;select id="manipulative_tenFrameSize_{SIDE}" class="bg-slate-200 text-slate-800 font-bold py-2 px-4 text-sm rounded-lg"&gt;&lt;option value="10"&gt;10-Frame&lt;/option&gt;&lt;option value="20"&gt;20-Frame&lt;/option&gt;&lt;option value="30"&gt;30-Frame&lt;/option&gt;&lt;option value="40"&gt;40-Frame&lt;/option&gt;&lt;option value="50"&gt;50-Frame&lt;/option&gt;&lt;option value="60"&gt;60-Frame&lt;/option&gt;&lt;option value="70"&gt;70-Frame&lt;/option&gt;&lt;option value="80"&gt;80-Frame&lt;/option&gt;&lt;option value="90"&gt;90-Frame&lt;/option&gt;&lt;option value="100"&gt;100-Frame&lt;/option&gt;&lt;/select&gt;&lt;label class="text-sm font-semibold text-slate-700"&gt;Number of Dots:&lt;/label&gt;&lt;input type="number" id="manipulative_tenFrameDots_{SIDE}" class="w-20 p-1 border-2 border-slate-300 rounded-lg text-center" value="7" min="0"&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>hundredsChart: `&lt;div class="flex flex-wrap items-center gap-4"&gt;&lt;label class="text-sm font-semibold text-slate-700"&gt;Highlight:&lt;/label&gt;&lt;select id="manipulative_hundredsChartHighlight_{SIDE}" class="bg-slate-200 text-slate-800 font-bold py-2 px-4 text-sm rounded-lg"&gt;&lt;option value="none"&gt;None&lt;/option&gt;&lt;option value="prime"&gt;Primes&lt;/option&gt;&lt;option value="even"&gt;Evens&lt;/option&gt;&lt;option value="odd"&gt;Odds&lt;/option&gt;&lt;option value="multiples"&gt;Multiples of&lt;/option&gt;&lt;option value="factors"&gt;Factors of&lt;/option&gt;&lt;/select&gt;&lt;input type="number" id="manipulative_hundredsChartNumberInput_{SIDE}" class="w-20 p-1 border-2 border-slate-300 rounded-lg text-center hidden" value="2" min="1" max="100"&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>factorTree: `&lt;div class="flex flex-col items-center gap-2"&gt;&lt;label class="text-sm font-semibold text-slate-700"&gt;Number to Factorize:&lt;/label&gt;&lt;input type="number" id="manipulative_factorTreeNumberInput_{SIDE}" class="w-24 p-1 border-2 border-slate-300 rounded-lg text-center" value="12" min="2" max="1000"&gt;&lt;button type="button" id="manipulative_factorizeButton_{SIDE}" class="mt-2 bg-blue-500 text-white font-semibold py-1 px-3 rounded-lg text-sm"&gt;Factorize&lt;/button&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>multiplicationNumberBond: `&lt;div class="flex items-center gap-2"&gt;&lt;label class="text-sm font-semibold text-slate-700"&gt;Factor 1:&lt;/label&gt;&lt;input type="number" id="manipulative_multFactor1Input_{SIDE}" class="w-24 p-1 border-2 border-slate-300 rounded-lg text-center" value="2" min="0"&gt;&lt;span class="text-xl font-bold text-slate-700 mx-2"&gt;x&lt;/span&gt;&lt;label class="text-sm font-semibold text-slate-700"&gt;Factor 2:&lt;/label&gt;&lt;input type="number" id="manipulative_multFactor2Input_{SIDE}" class="w-24 p-1 border-2 border-slate-300 rounded-lg text-center" value="6" min="0"&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>additionNumberBond: `&lt;div class="flex items-center gap-2"&gt;&lt;label class="text-sm font-semibold text-slate-700"&gt;Addend 1:&lt;/label&gt;&lt;input type="number" id="manipulative_addAddend1Input_{SIDE}" class="w-24 p-1 border-2 border-slate-300 rounded-lg text-center" value="5" min="0"&gt;&lt;span class="text-xl font-bold text-slate-700 mx-2"&gt;+&lt;/span&gt;&lt;label class="text-sm font-semibold text-slate-700"&gt;Addend 2:&lt;/label&gt;&lt;input type="number" id="manipulative_addAddend2Input_{SIDE}" class="w-24 p-1 border-2 border-slate-300 rounded-lg text-center" value="3" min="0"&gt;&lt;/div&gt;`,</p>
<p class="p1"><span class="Apple-converted-space">    </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// --- HELPER FUNCTIONS ---</p>
<p class="p1"><span class="Apple-converted-space">    </span>function showMessage(message, duration = 3000) { messageBox.textContent = message; messageBox.style.display = 'block'; setTimeout(() =&gt; { messageBox.style.display = 'none'; }, duration); }</p>
<p class="p1"><span class="Apple-converted-space">    </span>const clamp = (min, val, max) =&gt; Math.max(min, Math.min(val, max));</p>
<p class="p1"><span class="Apple-converted-space">    </span>const gcd = (a, b) =&gt; b === 0 ? a : gcd(b, a % b);</p>
<p class="p1"><span class="Apple-converted-space">    </span>const lcm = (a, b) =&gt; (a * b) / gcd(a, b);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// --- CLEANUP FUNCTIONS ---</p>
<p class="p1"><span class="Apple-converted-space">    </span>function clear3DScene() { if (animationFrameId) { cancelAnimationFrame(animationFrameId); animationFrameId = null; } if (scene) { scene.traverse((object) =&gt; { if (!object.isMesh &amp;&amp; !object.isLine) return; if (object.geometry) object.geometry.dispose(); if (object.material) { if (Array.isArray(object.material)) { object.material.forEach(material =&gt; material.dispose()); } else { object.material.dispose(); } } }); scene.clear(); } labels.forEach(label =&gt; { if (label.element &amp;&amp; label.element.parentNode) { label.element.parentNode.removeChild(label.element); } }); labels = []; if (renderer) renderer.dispose(); if (labelRenderer &amp;&amp; labelRenderer.domElement.parentNode) { labelRenderer.domElement.parentNode.removeChild(labelRenderer.domElement); } if (controls) controls.dispose(); }</p>
<p class="p1"><span class="Apple-converted-space">    </span>function clear2DCanvas() { if (ctx2D) { ctx2D.clearRect(0, 0, mathCanvas2D.width, mathCanvas2D.height); } const existingLabels = shapeDisplay2D.querySelectorAll('.dimension-label-2d'); existingLabels.forEach(label =&gt; label.remove()); }</p>
<p class="p1"><span class="Apple-converted-space">    </span>function clearCanvas(canvas, context) { context.clearRect(0, 0, canvas.width, canvas.height); context.fillStyle = '#FFFFFF'; context.fillRect(0, 0, canvas.width, canvas.height); }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// --- DRAWING &amp; CALCULATION FUNCTIONS (File 1) ---</p>
<p class="p1"><span class="Apple-converted-space">    </span>function frameObjectInView(object, camera, containerWidth, containerHeight, fillFactor = 0.8) { const box = new THREE.Box3().setFromObject(object); const sphere = box.getBoundingSphere(new THREE.Sphere()); const center = sphere.center; const radius = sphere.radius; const fov = camera.fov * (Math.PI / 180); const distance = (radius / (Math.sin(fov / 2))) / fillFactor; camera.position.copy(center); camera.position.z = center.z + distance; camera.lookAt(center); if (controls) { controls.target.copy(center); controls.update(); } }</p>
<p class="p1"><span class="Apple-converted-space">    </span>function create2DLabel(text, x, y, parentElement, options = {}) { const element = document.createElement('div'); element.className = 'dimension-label-2d'; element.style.display = 'block'; element.innerHTML = text; element.style.left = `${x}px`; element.style.top = `${y}px`; if (options.color) element.style.color = options.color; if (options.backgroundColor) element.style.backgroundColor = options.backgroundColor; parentElement.appendChild(element); }</p>
<p class="p1"><span class="Apple-converted-space">    </span>function drawTriangularPrism3D(baseOfTriangle, heightOfTriangle, prismLength){clear3DScene();const container=shapeDisplayFullWidth;if(!container){return}const width=container.clientWidth;const height=container.clientHeight;mathCanvas3D.width=width;mathCanvas3D.height=height;scene=new THREE.Scene();scene.background=new THREE.Color(0xdbeafe);camera=new THREE.PerspectiveCamera(75,width/height,0.1,1000);renderer=new THREE.WebGLRenderer({canvas:mathCanvas3D,antialias:true,alpha:true});renderer.setSize(width,height);renderer.setPixelRatio(window.devicePixelRatio);labelRenderer=new THREE.CSS2DRenderer();labelRenderer.setSize(width,height);labelRenderer.domElement.style.position='absolute';labelRenderer.domElement.style.top='0px';labelRenderer.domElement.style.left='0px';labelRenderer.domElement.style.pointerEvents='none';labelRenderer.domElement.classList.add('css2d-container');container.appendChild(labelRenderer.domElement);const ambientLight=new THREE.AmbientLight(0xffffff,0.6);scene.add(ambientLight);const directionalLight=new THREE.DirectionalLight(0xffffff,0.8);directionalLight.position.set(2,5,3).normalize();scene.add(directionalLight);const scaledBase=baseOfTriangle*SHAPE_DISPLAY_SCALE;const scaledHeight=heightOfTriangle*SHAPE_DISPLAY_SCALE;const scaledLength=prismLength*SHAPE_DISPLAY_SCALE;const vtx=[new THREE.Vector3(0,0,0),new THREE.Vector3(scaledBase,0,0),new THREE.Vector3(scaledBase/2,scaledHeight,0),new THREE.Vector3(0,0,scaledLength),new THREE.Vector3(scaledBase,0,scaledLength),new THREE.Vector3(scaledBase/2,scaledHeight,scaledLength)];const geometry=new THREE.BufferGeometry();const verticesArray=new Float32Array([vtx[0].x,vtx[0].y,vtx[0].z,vtx[1].x,vtx[1].y,vtx[1].z,vtx[2].x,vtx[2].y,vtx[2].z,vtx[3].x,vtx[3].y,vtx[3].z,vtx[4].x,vtx[4].y,vtx[4].z,vtx[5].x,vtx[5].y,vtx[5].z]);const indices=new Uint16Array([0,1,2,3,5,4,0,1,4,0,4,3,1,2,5,1,5,4,2,0,3,2,3,5]);geometry.setAttribute('position',new THREE.BufferAttribute(verticesArray,3));geometry.setIndex(new THREE.BufferAttribute(indices,1));geometry.computeVertexNormals();geometry.computeBoundingBox();const centerOffset=geometry.boundingBox.getCenter(new THREE.Vector3());geometry.center();const material=new THREE.MeshStandardMaterial({color:colors.primaryBlue,roughness:0.7,metalness:0.1,transparent:true,opacity:0.6});prism=new THREE.Mesh(geometry,material);scene.add(prism);const edges=new THREE.EdgesGeometry(geometry);outline=new THREE.LineSegments(edges,new THREE.LineBasicMaterial({color:0x000000,linewidth:2}));prism.add(outline);frameObjectInView(prism,camera,width,height,TARGET_VIEW_FILL_FACTOR);function createLabel(text,position){const element=document.createElement('div');element.className='dimension-label';element.textContent=text;const label=new THREE.CSS2DObject(element);label.position.copy(position);prism.add(label);labels.push(label);return label}const getCenteredVertex=(index)=&gt;{const vertex=new THREE.Vector3(vtx[index].x,vtx[index].y,vtx[index].z);return vertex.sub(centerOffset)};const centeredV0=getCenteredVertex(0);const centeredV1=getCenteredVertex(1);const midBaseLinePosition=(new THREE.Vector3).addVectors(centeredV0,centeredV1).multiplyScalar(0.5);createLabel(`b = ${baseOfTriangle}`,midBaseLinePosition.add(new THREE.Vector3(0,-0.3,0)));const baseTriangleMidpointFront=getCenteredVertex(0).clone().lerp(getCenteredVertex(1),0.5);const triangleApexPointFront=getCenteredVertex(2);const heightLinePoints=[baseTriangleMidpointFront,triangleApexPointFront];const heightLineGeometry=(new THREE.BufferGeometry).setFromPoints(heightLinePoints);const heightLineMaterial=new THREE.LineDashedMaterial({color:0x666666,dashSize:0.1,gapSize:0.1});const heightLine=new THREE.Line(heightLineGeometry,heightLineMaterial);heightLine.computeLineDistances();prism.add(heightLine);const labelPosHeight=(new THREE.Vector3).addVectors(baseTriangleMidpointFront,triangleApexPointFront).multiplyScalar(0.5);createLabel(`h = ${heightOfTriangle}`,labelPosHeight.add(new THREE.Vector3(-0.3,0,0)));const centeredV3=getCenteredVertex(3);const midLengthLinePosition=(new THREE.Vector3).addVectors(centeredV0,centeredV3).multiplyScalar(0.5);createLabel(`L = ${prismLength}`,midLengthLinePosition.add(new THREE.Vector3(0.3,0,0)));controls=new THREE.OrbitControls(camera,renderer.domElement);controls.enableDamping=true;controls.dampingFactor=0.05;controls.screenSpacePanning=false;controls.autoRotate=true;controls.autoRotateSpeed=0.5; controls.enableZoom = false; window.removeEventListener('resize',onWindowResize);window.addEventListener('resize',onWindowResize,false);if(animationFrameId)cancelAnimationFrame(animationFrameId);animate3D()}</p>
<p class="p1"><span class="Apple-converted-space">    </span>function drawRectangularPrism3D(base,baseHeight,depth){clear3DScene();const container=shapeDisplayFullWidth;if(!container){return}const width=container.clientWidth;const height=container.clientHeight;mathCanvas3D.width=width;mathCanvas3D.height=height;scene=new THREE.Scene();scene.background=new THREE.Color(0xdbeafe);camera=new THREE.PerspectiveCamera(75,width/height,0.1,1000);renderer=new THREE.WebGLRenderer({canvas:mathCanvas3D,antialias:true,alpha:true});renderer.setSize(width,height);renderer.setPixelRatio(window.devicePixelRatio);labelRenderer=new THREE.CSS2DRenderer();labelRenderer.setSize(width,height);labelRenderer.domElement.style.position='absolute';labelRenderer.domElement.style.top='0px';labelRenderer.domElement.style.left='0px';labelRenderer.domElement.style.pointerEvents='none';labelRenderer.domElement.classList.add('css2d-container');container.appendChild(labelRenderer.domElement);const ambientLight=new THREE.AmbientLight(0xffffff,0.6);scene.add(ambientLight);const directionalLight=new THREE.DirectionalLight(0xffffff,0.8);directionalLight.position.set(2,5,3).normalize();scene.add(directionalLight);const scaledBase=base*SHAPE_DISPLAY_SCALE;const scaledBaseHeight=baseHeight*SHAPE_DISPLAY_SCALE;const scaledDepth=depth*SHAPE_DISPLAY_SCALE;const geometry=new THREE.BoxGeometry(scaledBase,scaledBaseHeight,scaledDepth);geometry.center();const material=new THREE.MeshStandardMaterial({color:colors.primaryBlue,roughness:0.7,metalness:0.1,transparent:true,opacity:0.6});prism=new THREE.Mesh(geometry,material);scene.add(prism);const edges=new THREE.EdgesGeometry(geometry);outline=new THREE.LineSegments(edges,new THREE.LineBasicMaterial({color:0x000000,linewidth:2}));prism.add(outline);frameObjectInView(prism,camera,width,height,TARGET_VIEW_FILL_FACTOR);function createLabel(text,position){const element=document.createElement('div');element.className='dimension-label';element.textContent=text;const label=new THREE.CSS2DObject(element);label.position.copy(position);prism.add(label);labels.push(label);return label}const halfScaledBase=scaledBase/2;const halfScaledBaseHeight=scaledBaseHeight/2;createLabel(`b = ${base}`,new THREE.Vector3(0,-halfScaledBaseHeight-0.3,halfScaledBase));createLabel(`h = ${baseHeight}`,new THREE.Vector3(halfScaledBase+0.3,0,halfScaledBase));createLabel(`d = ${depth}`,new THREE.Vector3(-halfScaledBase-0.3,-halfScaledBaseHeight-0.1,0));controls=new THREE.OrbitControls(camera,renderer.domElement);controls.enableDamping=true;controls.dampingFactor=0.05;controls.screenSpacePanning=false;controls.autoRotate=true;controls.autoRotateSpeed=0.5; controls.enableZoom = false; window.removeEventListener('resize',onWindowResize);window.addEventListener('resize',onWindowResize,false);if(animationFrameId)cancelAnimationFrame(animationFrameId);animate3D()}</p>
<p class="p1"><span class="Apple-converted-space">    </span>function drawCylinder3D(radius,height){clear3DScene();const container=shapeDisplayFullWidth;if(!container){return}const width=container.clientWidth;const containerHeight=container.clientHeight;mathCanvas3D.width=width;mathCanvas3D.height=containerHeight;scene=new THREE.Scene();scene.background=new THREE.Color(0xdbeafe);camera=new THREE.PerspectiveCamera(75,width/containerHeight,0.1,1000);renderer=new THREE.WebGLRenderer({canvas:mathCanvas3D,antialias:true,alpha:true});renderer.setSize(width,containerHeight);renderer.setPixelRatio(window.devicePixelRatio);labelRenderer=new THREE.CSS2DRenderer();labelRenderer.setSize(width,containerHeight);labelRenderer.domElement.style.position='absolute';labelRenderer.domElement.style.top='0px';labelRenderer.domElement.style.left='0px';labelRenderer.domElement.style.pointerEvents='none';labelRenderer.domElement.classList.add('css2d-container');container.appendChild(labelRenderer.domElement);const ambientLight=new THREE.AmbientLight(0xffffff,0.6);scene.add(ambientLight);const directionalLight=new THREE.DirectionalLight(0xffffff,0.8);directionalLight.position.set(2,5,3).normalize();scene.add(directionalLight);const scaledRadius=radius*SHAPE_DISPLAY_SCALE;const scaledHeight=height*SHAPE_DISPLAY_SCALE;const geometry=new THREE.CylinderGeometry(scaledRadius,scaledRadius,scaledHeight,32);geometry.center();const material=new THREE.MeshStandardMaterial({color:colors.primaryBlue,roughness:0.7,metalness:0.1,transparent:true,opacity:0.6});prism=new THREE.Mesh(geometry,material);scene.add(prism);frameObjectInView(prism,camera,width,containerHeight,TARGET_VIEW_FILL_FACTOR);const blackLineMaterial=new THREE.LineBasicMaterial({color:0x000000,linewidth:2});const segments=32;const cylinderHalfHeight=scaledHeight/2;const topCirclePoints=[];for(let i=0;i&lt;=segments;i++){const theta=i/segments*Math.PI*2;topCirclePoints.push(new THREE.Vector3(scaledRadius*Math.cos(theta),cylinderHalfHeight,scaledRadius*Math.sin(theta)))}const topCircleGeometry=(new THREE.BufferGeometry).setFromPoints(topCirclePoints);const topCircleOutline=new THREE.LineLoop(topCircleGeometry,blackLineMaterial);prism.add(topCircleOutline);const bottomCirclePoints=[];for(let i=0;i&lt;=segments;i++){const theta=i/segments*Math.PI*2;bottomCirclePoints.push(new THREE.Vector3(scaledRadius*Math.cos(theta),-cylinderHalfHeight,scaledRadius*Math.sin(theta)))}const bottomCircleGeometry=(new THREE.BufferGeometry).setFromPoints(bottomCirclePoints);const bottomCircleOutline=new THREE.LineLoop(bottomCircleGeometry,blackLineMaterial);prism.add(bottomCircleOutline);const verticalLine1Geometry=(new THREE.BufferGeometry).setFromPoints([new THREE.Vector3(scaledRadius,-cylinderHalfHeight,0),new THREE.Vector3(scaledRadius,cylinderHalfHeight,0)]);const verticalLine1=new THREE.Line(verticalLine1Geometry,blackLineMaterial);prism.add(verticalLine1);const verticalLine2Geometry=(new THREE.BufferGeometry).setFromPoints([new THREE.Vector3(-scaledRadius,-cylinderHalfHeight,0),new THREE.Vector3(-scaledRadius,cylinderHalfHeight,0)]);const verticalLine2=new THREE.Line(verticalLine2Geometry,blackLineMaterial);prism.add(verticalLine2);function createLabel(text,position){const element=document.createElement('div');element.className='dimension-label';element.textContent=text;const label=new THREE.CSS2DObject(element);label.position.copy(position);prism.add(label);labels.push(label);return label}createLabel(`h = ${height}`,new THREE.Vector3(scaledRadius+0.3,0,0));const topCenter=new THREE.Vector3(0,cylinderHalfHeight,0);const topEdge=new THREE.Vector3(scaledRadius,cylinderHalfHeight,0);const radiusLinePoints=[topCenter,topEdge];const radiusLineGeometry=(new THREE.BufferGeometry).setFromPoints(radiusLinePoints);const radiusLine=new THREE.Line(radiusLineGeometry,blackLineMaterial);prism.add(radiusLine);const midRadiusPoint=(new THREE.Vector3).addVectors(topCenter,topEdge).multiplyScalar(0.5);createLabel(`r = ${radius}`,midRadiusPoint.add(new THREE.Vector3(0,0.3,0)));controls=new THREE.OrbitControls(camera,renderer.domElement);controls.enableDamping=true;controls.dampingFactor=0.05;controls.screenSpacePanning=false;controls.autoRotate=true;controls.autoRotateSpeed=0.5; controls.enableZoom = false; window.removeEventListener('resize',onWindowResize);window.addEventListener('resize',onWindowResize,false);if(animationFrameId)cancelAnimationFrame(animationFrameId);animate3D()}</p>
<p class="p1"><span class="Apple-converted-space">    </span>function drawCone3D(radius,height,slantHeight=null){clear3DScene();const container=shapeDisplayFullWidth;if(!container){return}const width=container.clientWidth;const containerHeight=container.clientHeight;mathCanvas3D.width=width;mathCanvas3D.height=containerHeight;scene=new THREE.Scene();scene.background=new THREE.Color(0xdbeafe);camera=new THREE.PerspectiveCamera(75,width/containerHeight,0.1,1000);renderer=new THREE.WebGLRenderer({canvas:mathCanvas3D,antialias:true,alpha:true});renderer.setSize(width,containerHeight);renderer.setPixelRatio(window.devicePixelRatio);labelRenderer=new THREE.CSS2DRenderer();labelRenderer.setSize(width,containerHeight);labelRenderer.domElement.style.position='absolute';labelRenderer.domElement.style.top='0px';labelRenderer.domElement.style.left='0px';labelRenderer.domElement.style.pointerEvents='none';labelRenderer.domElement.classList.add('css2d-container');container.appendChild(labelRenderer.domElement);const ambientLight=new THREE.AmbientLight(0xffffff,0.6);scene.add(ambientLight);const directionalLight=new THREE.DirectionalLight(0xffffff,0.8);directionalLight.position.set(2,5,3).normalize();scene.add(directionalLight);const scaledRadius=radius*SHAPE_DISPLAY_SCALE;const scaledHeight=height*SHAPE_DISPLAY_SCALE;const calculatedSlantHeight=Math.sqrt(scaledRadius*scaledRadius+scaledHeight*scaledHeight);const geometry=new THREE.ConeGeometry(scaledRadius,scaledHeight,32);geometry.center();const material=new THREE.MeshStandardMaterial({color:colors.primaryBlue,roughness:0.7,metalness:0.1,transparent:true,opacity:0.6});prism=new THREE.Mesh(geometry,material);scene.add(prism);frameObjectInView(prism,camera,width,containerHeight,TARGET_VIEW_FILL_FACTOR);const blackLineMaterial=new THREE.LineBasicMaterial({color:0x000000,linewidth:2});const segments=32;const baseCirclePoints=[];for(let i=0;i&lt;=segments;i++){const theta=i/segments*Math.PI*2;baseCirclePoints.push(new THREE.Vector3(scaledRadius*Math.cos(theta),-scaledHeight/2,scaledRadius*Math.sin(theta)))}const baseCircleGeometry=(new THREE.BufferGeometry).setFromPoints(baseCirclePoints);const baseCircleOutline=new THREE.LineLoop(baseCircleGeometry,blackLineMaterial);prism.add(baseCircleOutline);const apex=new THREE.Vector3(0,scaledHeight/2,0);const baseEdge1=new THREE.Vector3(scaledRadius,-scaledHeight/2,0);const baseEdge2=new THREE.Vector3(-scaledRadius,-scaledHeight/2,0);const slantLine1Geometry=(new THREE.BufferGeometry).setFromPoints([apex,baseEdge1]);const slantLine1=new THREE.Line(slantLine1Geometry,blackLineMaterial);prism.add(slantLine1);const slantLine2Geometry=(new THREE.BufferGeometry).setFromPoints([apex,baseEdge2]);const slantLine2=new THREE.Line(slantLine2Geometry,blackLineMaterial);prism.add(slantLine2);const centerLineGeometry=(new THREE.BufferGeometry).setFromPoints([new THREE.Vector3(0,-scaledHeight/2,0),apex]);const centerLineMaterial=new THREE.LineDashedMaterial({color:0x666666,dashSize:0.1,gapSize:0.1});const centerLine=new THREE.Line(centerLineGeometry,centerLineMaterial);centerLine.computeLineDistances();prism.add(centerLine);function createLabel(text,position){const element=document.createElement('div');element.className='dimension-label';element.textContent=text;const label=new THREE.CSS2DObject(element);label.position.copy(position);prism.add(label);labels.push(label);return label}createLabel(`r = ${radius}`,new THREE.Vector3(scaledRadius/2,-scaledHeight/2-0.3,0));createLabel(`h = ${height}`,new THREE.Vector3(-0.3,0,0));const midSlant=(new THREE.Vector3).addVectors(apex,baseEdge1).multiplyScalar(0.5);createLabel(`l = ${(slantHeight??calculatedSlantHeight).toFixed(2)}`,midSlant.add(new THREE.Vector3(0.3,0.3,0)));controls=new THREE.OrbitControls(camera,renderer.domElement);controls.enableDamping=true;controls.dampingFactor=0.05;controls.screenSpacePanning=false;controls.autoRotate=true;controls.autoRotateSpeed=0.5; controls.enableZoom = false; window.removeEventListener('resize',onWindowResize);window.addEventListener('resize',onWindowResize,false);if(animationFrameId)cancelAnimationFrame(animationFrameId);animate3D()}</p>
<p class="p1"><span class="Apple-converted-space">    </span>function drawSquarePyramid3D(baseSide,height,slantHeight=null){clear3DScene();const container=shapeDisplayFullWidth;if(!container){return}const width=container.clientWidth;const containerHeight=container.clientHeight;mathCanvas3D.width=width;mathCanvas3D.height=containerHeight;scene=new THREE.Scene();scene.background=new THREE.Color(0xdbeafe);camera=new THREE.PerspectiveCamera(75,width/containerHeight,0.1,1000);renderer=new THREE.WebGLRenderer({canvas:mathCanvas3D,antialias:true,alpha:true});renderer.setSize(width,containerHeight);renderer.setPixelRatio(window.devicePixelRatio);labelRenderer=new THREE.CSS2DRenderer();labelRenderer.setSize(width,containerHeight);labelRenderer.domElement.style.position='absolute';labelRenderer.domElement.style.top='0px';labelRenderer.domElement.style.left='0px';labelRenderer.domElement.style.pointerEvents='none';labelRenderer.domElement.classList.add('css2d-container');container.appendChild(labelRenderer.domElement);const ambientLight=new THREE.AmbientLight(0xffffff,0.6);scene.add(ambientLight);const directionalLight=new THREE.DirectionalLight(0xffffff,0.8);directionalLight.position.set(2,5,3).normalize();scene.add(directionalLight);const scaledBaseSide=baseSide*SHAPE_DISPLAY_SCALE;const scaledHeight=height*SHAPE_DISPLAY_SCALE;const halfBase=scaledBaseSide/2;const calculatedSlantHeight=Math.sqrt(halfBase*halfBase+scaledHeight*scaledHeight);const geometry=new THREE.ConeGeometry(halfBase,scaledHeight,4,1);geometry.rotateY(Math.PI/4);geometry.center();const material=new THREE.MeshStandardMaterial({color:colors.primaryBlue,roughness:0.7,metalness:0.1,transparent:true,opacity:0.6});prism=new THREE.Mesh(geometry,material);scene.add(prism);frameObjectInView(prism,camera,width,containerHeight,TARGET_VIEW_FILL_FACTOR);const edges=new THREE.EdgesGeometry(geometry);outline=new THREE.LineSegments(edges,new THREE.LineBasicMaterial({color:0x000000,linewidth:2}));prism.add(outline);const baseCenter=new THREE.Vector3(0,-scaledHeight/2,0);const apex=new THREE.Vector3(0,scaledHeight/2,0);const centerLineGeometry=(new THREE.BufferGeometry).setFromPoints([baseCenter,apex]);const centerLineMaterial=new THREE.LineDashedMaterial({color:0x666666,dashSize:0.1,gapSize:0.1});const centerLine=new THREE.Line(centerLineGeometry,centerLineMaterial);centerLine.computeLineDistances();prism.add(centerLine);function createLabel(text,position){const element=document.createElement('div');element.className='dimension-label';element.textContent=text;const label=new THREE.CSS2DObject(element);label.position.copy(position);prism.add(label);labels.push(label);return label}createLabel(`b = ${baseSide}`,new THREE.Vector3(0,-scaledHeight/2-0.3,halfBase));createLabel(`h = ${height}`,new THREE.Vector3(-0.3,0,0));const midBaseEdgeFront=new THREE.Vector3(0,-scaledHeight/2,halfBase);const midSlant=(new THREE.Vector3).addVectors(apex,midBaseEdgeFront).multiplyScalar(0.5);createLabel(`l = ${(slantHeight??calculatedSlantHeight).toFixed(2)}`,midSlant.add(new THREE.Vector3(0.3,0.3,0)));controls=new THREE.OrbitControls(camera,renderer.domElement);controls.enableDamping=true;controls.dampingFactor=0.05;controls.screenSpacePanning=false;controls.autoRotate=true;controls.autoRotateSpeed=0.5; controls.enableZoom = false; window.removeEventListener('resize',onWindowResize);window.addEventListener('resize',onWindowResize,false);if(animationFrameId)cancelAnimationFrame(animationFrameId);animate3D()}</p>
<p class="p1"><span class="Apple-converted-space">    </span>function drawSimpleAngle(angle) { clear2DCanvas(); const container = shapeDisplay2D; if (!container || !ctx2D) return; if (isNaN(angle) || angle &lt; 0 || angle &gt; 360) { showMessage("Angle must be between 0 and 360.", 3000); return; } mathCanvas2D.width = container.clientWidth; mathCanvas2D.height = container.clientHeight; const canvasWidth = mathCanvas2D.width; const canvasHeight = mathCanvas2D.height; const centerX = canvasWidth / 2; const centerY = canvasHeight / 2; const rayLength = Math.min(canvasWidth, canvasHeight) / 3; const angleRad = -angle * Math.PI / 180; ctx2D.strokeStyle = colors.main; ctx2D.lineWidth = 3; ctx2D.beginPath(); ctx2D.moveTo(centerX, centerY); ctx2D.lineTo(centerX + rayLength, centerY); ctx2D.stroke(); const endX = centerX + rayLength * Math.cos(angleRad); const endY = centerY + rayLength * Math.sin(angleRad); ctx2D.beginPath(); ctx2D.moveTo(centerX, centerY); ctx2D.lineTo(endX, endY); ctx2D.stroke(); ctx2D.beginPath(); ctx2D.arc(centerX, centerY, rayLength / 3, 0, angleRad, true); ctx2D.strokeStyle = colors.primaryBlue; ctx2D.lineWidth = 2; ctx2D.stroke(); const labelRadius = rayLength / 2.5; const labelAngle = -angle / 2 * Math.PI / 180; const labelX = centerX + labelRadius * Math.cos(labelAngle); const labelY = centerY + labelRadius * Math.sin(labelAngle); create2DLabel(`${angle}°`, labelX, labelY, container, { color: 'white', backgroundColor: 'rgba(0, 123, 255, 0.8)' }); }</p>
<p class="p1"><span class="Apple-converted-space">    </span>function drawCorrespondingAngles(knownAngle, isMystery) { clear2DCanvas(); const container = shapeDisplay2D; if (!container || !ctx2D) return; if (isNaN(knownAngle) || knownAngle &lt;= 0 || knownAngle &gt;= 180) { showMessage("Please enter an angle between 1 and 179.", 3000); return; } mathCanvas2D.width = container.clientWidth; mathCanvas2D.height = container.clientHeight; const cw = mathCanvas2D.width; const ch = mathCanvas2D.height; const padding = 50; const lineSep = ch / 4; ctx2D.strokeStyle = colors.main; ctx2D.lineWidth = 3; ctx2D.beginPath(); ctx2D.moveTo(padding, ch / 2 - lineSep / 2); ctx2D.lineTo(cw - padding, ch / 2 - lineSep / 2); ctx2D.moveTo(padding, ch / 2 + lineSep / 2); ctx2D.lineTo(cw - padding, ch / 2 + lineSep / 2); ctx2D.stroke(); const angleRad = (180 - knownAngle) * Math.PI / 180; const slope = Math.tan(angleRad); const x1 = cw / 2 - (ch / 2) / slope; const y1 = 0; const x2 = cw / 2 + (ch / 2) / slope; const y2 = ch; ctx2D.strokeStyle = '#ef4444'; ctx2D.beginPath(); ctx2D.moveTo(x1, y1); ctx2D.lineTo(x2, y2); ctx2D.stroke(); const int1 = { x: (ch / 2 - lineSep / 2 - (ch / 2 - slope * (cw / 2))) / slope, y: ch / 2 - lineSep / 2 }; const int2 = { x: (ch / 2 + lineSep / 2 - (ch / 2 - slope * (cw / 2))) / slope, y: ch / 2 + lineSep / 2 }; const angle1 = knownAngle; const angle2 = 180 - knownAngle; const angleData = [ [angle1, 'a', -30, -20], [angle2, 'b', 30, -20], [angle2, 'd', -30, 20], [angle1, 'c', 30, 20], [angle1, 'e', -30, -20], [angle2, 'f', 30, -20], [angle2, 'h', -30, 20], [angle1, 'g', 30, 20] ]; const intersections = [int1, int1, int1, int1, int2, int2, int2, int2]; angleData.forEach((data, i) =&gt; { const text = isMystery ? data[1] : `${data[0]}°`; const color = (data[0] === angle1) ? 'rgba(0, 123, 255, 0.8)' : 'rgba(239, 68, 68, 0.8)'; create2DLabel(text, intersections[i].x + data[2], intersections[i].y + data[3], container, { backgroundColor: color }); }); }</p>
<p class="p1"><span class="Apple-converted-space">    </span>function drawRectangle2D(length, width) { clear2DCanvas(); const container = shapeDisplay2D; if (!container || !ctx2D) return; mathCanvas2D.width = container.clientWidth; mathCanvas2D.height = container.clientHeight; const canvasWidth = mathCanvas2D.width; const canvasHeight = mathCanvas2D.height; const padding = 40; const aspectRatio = length / width; let displayWidth = canvasWidth - 2 * padding; let displayHeight = displayWidth / aspectRatio; if (displayHeight &gt; canvasHeight - 2 * padding) { displayHeight = canvasHeight - 2 * padding; displayWidth = displayHeight * aspectRatio; } const startX = (canvasWidth - displayWidth) / 2; const startY = (canvasHeight - displayHeight) / 2; ctx2D.save(); ctx2D.shadowColor = 'rgba(0,0,0,0.3)'; ctx2D.shadowBlur = 10; ctx2D.shadowOffsetX = 5; ctx2D.shadowOffsetY = 5; const hex = colors.primaryBlue.substring(1); const r = parseInt(hex.substring(0, 2), 16), g = parseInt(hex.substring(2, 4), 16), b = parseInt(hex.substring(4, 6), 16); const gradient = ctx2D.createLinearGradient(startX, startY, startX + displayWidth, startY + displayHeight); gradient.addColorStop(0, `rgb(${clamp(0, r + 130, 255)},${clamp(0, g + 50, 255)},${clamp(0, b, 255)})`); gradient.addColorStop(1, `rgb(${r},${g},${b})`); ctx2D.fillStyle = gradient; ctx2D.strokeStyle = colors.main; ctx2D.lineWidth = 3; ctx2D.fillRect(startX, startY, displayWidth, displayHeight); ctx2D.strokeRect(startX, startY, displayWidth, displayHeight); ctx2D.restore(); create2DLabel(`l = ${length}`, startX + displayWidth / 2, startY + 20, container); create2DLabel(`w = ${width}`, startX + 30, startY + displayHeight / 2, container); }</p>
<p class="p1"><span class="Apple-converted-space">    </span>function drawTriangle2D(dim1,dim2,dim3,mode){clear2DCanvas();const container=shapeDisplay2D;if(!container||!ctx2D){return}mathCanvas2D.width=container.clientWidth;mathCanvas2D.height=container.clientHeight;const canvasWidth=mathCanvas2D.width;const canvasHeight=mathCanvas2D.height;const padding=50;let tempP1,tempP2,tempP3;if(mode==='areaOfTriangle'){const base=dim1;const height=dim2;if(base&lt;=0||height&lt;=0){showMessage("Error: Base and height must be positive numbers to draw a triangle.",3000);clear2DCanvas();return}tempP1={x:0,y:0};tempP2={x:base,y:0};tempP3={x:base/2,y:height}}else if(mode==='perimeterOfTriangle'){const s1=dim1;const s2=dim2;const s3=dim3;if(!(s1+s2&gt;s3&amp;&amp;s1+s3&gt;s2&amp;&amp;s2+s3&gt;s1)){showMessage("Error: Invalid triangle sides. The sum of any two sides must be greater than the third side.",5000);clear2DCanvas();return}if(s1&lt;=0||s2&lt;=0||s3&lt;=0){showMessage("Error: All sides must be positive numbers to draw a triangle.",3000);clear2DCanvas();return}tempP1={x:0,y:0};tempP2={x:s1,y:0};const cosAngleP1=(s1*s1+s2*s2-s3*s3)/(2*s1*s2);const angleP1=Math.acos(clamp(-1,cosAngleP1,1));const xC=s2*Math.cos(angleP1);const yC=s2*Math.sin(angleP1);tempP3={x:xC,y:yC};const allX=[tempP1.x,tempP2.x,tempP3.x];const allY=[tempP1.y,tempP2.y,tempP3.y];const minX_raw=Math.min(...allX);const minY_raw=Math.min(...allY);tempP1.x-=minX_raw;tempP1.y-=minY_raw;tempP2.x-=minX_raw;tempP2.y-=minY_raw;tempP3.x-=minX_raw;tempP3.y-=minY_raw}else{return}const shapeWidth=Math.max(tempP1.x,tempP2.x,tempP3.x);const shapeHeight=Math.max(tempP1.y,tempP2.y,tempP3.y);let scale=1;const availableWidth=canvasWidth-2*padding;const availableHeight=canvasHeight-2*padding;if(shapeWidth&gt;0&amp;&amp;shapeHeight&gt;0){scale=Math.min(availableWidth/shapeWidth,availableHeight/shapeHeight)}else{showMessage("Error: Degenerate triangle.",3000);return}const translateX=(canvasWidth/2)-(shapeWidth/2)*scale;const translateY=(canvasHeight/2)-(shapeHeight/2)*scale;ctx2D.save();ctx2D.shadowColor='rgba(0,0,0,0.3)';ctx2D.shadowBlur=10;ctx2D.shadowOffsetX=5;ctx2D.shadowOffsetY=5;const hex=colors.primaryBlue.substring(1);const r=parseInt(hex.substring(0,2),16);const g=parseInt(hex.substring(2,4),16);const b=parseInt(hex.substring(4,6),16);const gradient=ctx2D.createLinearGradient(translateX,translateY,translateX+shapeWidth*scale,translateY+shapeHeight*scale);gradient.addColorStop(0,`rgb(${clamp(0,r+130,255)},${clamp(0,g+50,255)},${clamp(0,b,255)})`);gradient.addColorStop(1,`rgb(${r},${g},${b})`);ctx2D.fillStyle=gradient;ctx2D.strokeStyle=colors.main;ctx2D.lineWidth=3;ctx2D.beginPath();ctx2D.moveTo(tempP1.x*scale+translateX,canvasHeight-(tempP1.y*scale+translateY));ctx2D.lineTo(tempP2.x*scale+translateX,canvasHeight-(tempP2.y*scale+translateY));ctx2D.lineTo(tempP3.x*scale+translateX,canvasHeight-(tempP3.y*scale+translateY));ctx2D.closePath();ctx2D.fill();ctx2D.stroke();ctx2D.restore();const p1={x:tempP1.x*scale+translateX,y:canvasHeight-(tempP1.y*scale+translateY)};const p2={x:tempP2.x*scale+translateX,y:canvasHeight-(tempP2.y*scale+translateY)};const p3={x:tempP3.x*scale+translateX,y:canvasHeight-(tempP3.y*scale+translateY)};if(mode==='areaOfTriangle'){const midBaseX=(p1.x+p2.x)/2;const midBaseY=p1.y+15;create2DLabel(`b = ${dim1}`,midBaseX,midBaseY,container);const baseMidpointX=(p1.x+p2.x)/2;ctx2D.save();ctx2D.beginPath();ctx2D.setLineDash([4,4]);ctx2D.moveTo(baseMidpointX,p1.y);ctx2D.lineTo(p3.x,p3.y);ctx2D.strokeStyle='#334155';ctx2D.lineWidth=1.5;ctx2D.stroke();ctx2D.restore();const midHeightX=(baseMidpointX+p3.x)/2+15;const midHeightY=(p1.y+p3.y)/2;create2DLabel(`h = ${dim2}`,midHeightX,midHeightY,container)}else if(mode==='perimeterOfTriangle'){create2DLabel(`a = ${dim1}`,(p1.x+p2.x)/2,p1.y+15,container);create2DLabel(`b = ${dim2}`,(p1.x+p3.x)/2-15,(p1.y+p3.y)/2,container);create2DLabel(`c = ${dim3}`,(p2.x+p3.x)/2+15,(p2.y+p3.y)/2,container)}}</p>
<p class="p1"><span class="Apple-converted-space">    </span>function drawCircle2D(radius) { clear2DCanvas(); const container = shapeDisplay2D; if (!container || !ctx2D) return; mathCanvas2D.width = container.clientWidth; mathCanvas2D.height = container.clientHeight; const canvasWidth = mathCanvas2D.width; const canvasHeight = mathCanvas2D.height; const padding = 40; const maxRadius = Math.min(canvasWidth - 2 * padding, canvasHeight - 2 * padding) / 2; const displayRadius = Math.min(maxRadius, radius * (TARGET_VIEW_FILL_FACTOR * 30 + 10)); if (displayRadius &lt;= 0) { showMessage("Error: Radius must be positive.", 3000); return; } const centerX = canvasWidth / 2; const centerY = canvasHeight / 2; ctx2D.save(); ctx2D.shadowColor = 'rgba(0,0,0,0.3)'; ctx2D.shadowBlur = 10; ctx2D.shadowOffsetX = 5; ctx2D.shadowOffsetY = 5; const hex = colors.primaryBlue.substring(1); const r = parseInt(hex.substring(0, 2), 16), g = parseInt(hex.substring(2, 4), 16), b = parseInt(hex.substring(4, 6), 16); const gradient = ctx2D.createRadialGradient(centerX, centerY, 0, centerX, centerY, displayRadius); gradient.addColorStop(0, `rgb(${clamp(0, r + 130, 255)},${clamp(0, g + 50, 255)},${clamp(0, b, 255)})`); gradient.addColorStop(1, `rgb(${r},${g},${b})`); ctx2D.fillStyle = gradient; ctx2D.strokeStyle = colors.main; ctx2D.lineWidth = 3; ctx2D.beginPath(); ctx2D.arc(centerX, centerY, displayRadius, 0, Math.PI * 2, false); ctx2D.fill(); ctx2D.stroke(); ctx2D.restore(); ctx2D.save(); ctx2D.beginPath(); ctx2D.moveTo(centerX, centerY); ctx2D.lineTo(centerX + displayRadius, centerY); ctx2D.strokeStyle = colors.main; ctx2D.lineWidth = 2; ctx2D.stroke(); ctx2D.restore(); create2DLabel(`r = ${radius}`, centerX + displayRadius / 2, centerY - 15, container); }</p>
<p class="p1"><span class="Apple-converted-space">    </span>function drawTriangularPrismNet2D(base,height,length){clear2DCanvas();const container=shapeDisplay2D;if(!container||!ctx2D)return;mathCanvas2D.width=container.clientWidth;mathCanvas2D.height=container.clientHeight;const padding=40;if(base&lt;=0||height&lt;=0||length&lt;=0){showMessage("Error: All dimensions must be positive.",3000);return}const halfBase=base/2;const side=Math.sqrt(halfBase*halfBase+height*height);const netBoundingWidth=side+base+side;const netBoundingHeight=height+length+height;const scale=Math.min((container.clientWidth-padding*2)/netBoundingWidth,(container.clientHeight-padding*2)/netBoundingHeight);const scaledBase=base*scale;const scaledHeight=height*scale;const scaledLength=length*scale;const scaledSide=side*scale;const translateX=(container.clientWidth-(scaledSide+scaledBase+scaledSide))/2;const translateY=(container.clientHeight-scaledLength)/2-scaledHeight/2;ctx2D.fillStyle=colors.primaryBlue;ctx2D.strokeStyle='black';ctx2D.lineWidth=2;const rectY=translateY+scaledHeight;const rectMiddleX=translateX+scaledSide;ctx2D.fillRect(translateX,rectY,scaledSide,scaledLength);ctx2D.strokeRect(translateX,rectY,scaledSide,scaledLength);ctx2D.fillRect(rectMiddleX,rectY,scaledBase,scaledLength);ctx2D.strokeRect(rectMiddleX,rectY,scaledBase,scaledLength);ctx2D.fillRect(rectMiddleX+scaledBase,rectY,scaledSide,scaledLength);ctx2D.strokeRect(rectMiddleX+scaledBase,rectY,scaledSide,scaledLength);ctx2D.beginPath();ctx2D.moveTo(rectMiddleX,rectY);ctx2D.lineTo(rectMiddleX+scaledBase,rectY);ctx2D.lineTo(rectMiddleX+scaledBase/2,translateY);ctx2D.closePath();ctx2D.fill();ctx2D.stroke();ctx2D.beginPath();ctx2D.moveTo(rectMiddleX,rectY+scaledLength);ctx2D.lineTo(rectMiddleX+scaledBase,rectY+scaledLength);ctx2D.lineTo(rectMiddleX+scaledBase/2,rectY+scaledLength+scaledHeight);ctx2D.closePath();ctx2D.fill();ctx2D.stroke()}</p>
<p class="p1"><span class="Apple-converted-space">    </span>function drawRectangularPrismNet2D(base,height,depth){clear2DCanvas();const container=shapeDisplay2D;if(!container||!ctx2D){return}mathCanvas2D.width=container.clientWidth;mathCanvas2D.height=container.clientHeight;const padding=40;if(base&lt;=0||height&lt;=0||depth&lt;=0){showMessage("Error: All dimensions must be positive.",3000);return}const netWidth=base+2*depth;const netHeight=height+2*depth;const scale=Math.min((container.clientWidth-padding*2)/netWidth,(container.clientHeight-padding*2)/netHeight);const scaledBase=base*scale;const scaledHeight=height*scale;const scaledDepth=depth*scale;const startX=(container.clientWidth-netWidth*scale)/2;const startY=(container.clientHeight-netHeight*scale)/2;ctx2D.fillStyle=colors.primaryBlue;ctx2D.strokeStyle='black';ctx2D.lineWidth=2;ctx2D.fillRect(startX+scaledDepth,startY+scaledDepth,scaledBase,scaledHeight);ctx2D.strokeRect(startX+scaledDepth,startY+scaledDepth,scaledBase,scaledHeight);ctx2D.fillRect(startX+scaledDepth,startY,scaledBase,scaledDepth);ctx2D.strokeRect(startX+scaledDepth,startY,scaledBase,scaledDepth);ctx2D.fillRect(startX+scaledDepth,startY+scaledDepth+scaledHeight,scaledBase,scaledDepth);ctx2D.strokeRect(startX+scaledDepth,startY+scaledDepth+scaledHeight,scaledBase,scaledDepth);ctx2D.fillRect(startX,startY+scaledDepth,scaledDepth,scaledHeight);ctx2D.strokeRect(startX,startY+scaledDepth,scaledDepth,scaledHeight);ctx2D.fillRect(startX+scaledDepth+scaledBase,startY+scaledDepth,scaledDepth,scaledHeight);ctx2D.strokeRect(startX+scaledDepth+scaledBase,startY+scaledDepth,scaledDepth,scaledHeight)}</p>
<p class="p1"><span class="Apple-converted-space">    </span>function drawCylinderNet2D(radius,height){clear2DCanvas();const container=shapeDisplay2D;if(!container||!ctx2D){return}mathCanvas2D.width=container.clientWidth;mathCanvas2D.height=container.clientHeight;const padding=40;if(radius&lt;=0||height&lt;=0){showMessage("Error: All dimensions must be positive.",3000);return}const circumference=2*Math.PI*radius;const netWidth=circumference;const netHeight=height+2*radius*2;const scale=Math.min((container.clientWidth-padding*2)/netWidth,(container.clientHeight-padding*2)/netHeight);const scaledRadius=radius*scale;const scaledHeight=height*scale;const scaledCircumference=circumference*scale;const rectX=(container.clientWidth-scaledCircumference)/2;const rectY=(container.clientHeight-scaledHeight)/2-scaledRadius;ctx2D.fillStyle=colors.primaryBlue;ctx2D.strokeStyle='black';ctx2D.lineWidth=2;ctx2D.fillRect(rectX,rectY+scaledRadius*2,scaledCircumference,scaledHeight);ctx2D.strokeRect(rectX,rectY+scaledRadius*2,scaledCircumference,scaledHeight);ctx2D.beginPath();ctx2D.arc(rectX+scaledCircumference/2,rectY+scaledRadius,scaledRadius,0,Math.PI*2);ctx2D.fill();ctx2D.stroke();ctx2D.beginPath();ctx2D.arc(rectX+scaledCircumference/2,rectY+scaledRadius*2+scaledHeight+scaledRadius,scaledRadius,0,Math.PI*2);ctx2D.fill();ctx2D.stroke()}</p>
<p class="p1"><span class="Apple-converted-space">    </span>function drawConeNet2D(radius,height){clear2DCanvas();const container=shapeDisplay2D;if(!container||!ctx2D){return}mathCanvas2D.width=container.clientWidth;mathCanvas2D.height=container.clientHeight;const padding=40;if(radius&lt;=0||height&lt;=0){showMessage("Error: All dimensions must be positive.",3000);return}const slantHeight=Math.sqrt(radius*radius+height*height);const sectorAngle=(2*Math.PI*radius)/slantHeight;const netWidth=2*slantHeight*Math.sin(sectorAngle/2);const netHeight=slantHeight-slantHeight*Math.cos(sectorAngle/2)+2*radius;const scale=Math.min((container.clientWidth-padding*2)/netWidth,(container.clientHeight-padding*2)/netHeight);const scaledRadius=radius*scale;const scaledSlantHeight=slantHeight*scale;const sectorCenterX=container.clientWidth/2;const sectorCenterY=(container.clientHeight-netHeight*scale)/2+scaledSlantHeight;ctx2D.fillStyle=colors.primaryBlue;ctx2D.strokeStyle='black';ctx2D.lineWidth=2;ctx2D.beginPath();ctx2D.moveTo(sectorCenterX,sectorCenterY);ctx2D.arc(sectorCenterX,sectorCenterY,scaledSlantHeight,-Math.PI/2-sectorAngle/2,-Math.PI/2+sectorAngle/2);ctx2D.closePath();ctx2D.fill();ctx2D.stroke();const circleCenterY=sectorCenterY+scaledSlantHeight*Math.cos(sectorAngle/2)+scaledRadius;ctx2D.beginPath();ctx2D.arc(sectorCenterX,circleCenterY,scaledRadius,0,Math.PI*2);ctx2D.fill();ctx2D.stroke()}</p>
<p class="p1"><span class="Apple-converted-space">    </span>function drawSquarePyramidNet2D(baseSide,height){clear2DCanvas();const container=shapeDisplay2D;if(!container||!ctx2D){return}mathCanvas2D.width=container.clientWidth;mathCanvas2D.height=container.clientHeight;const padding=40;if(baseSide&lt;=0||height&lt;=0){showMessage("Error: All dimensions must be positive.",3000);return}const halfBase=baseSide/2;const slantHeight=Math.sqrt(halfBase*halfBase+height*height);const netWidth=baseSide+2*slantHeight;const netHeight=baseSide+2*slantHeight;const scale=Math.min((container.clientWidth-padding*2)/netWidth,(container.clientHeight-padding*2)/netHeight);const scaledBase=baseSide*scale;const scaledSlantHeight=slantHeight*scale;const startX=(container.clientWidth-scaledBase)/2;const startY=(container.clientHeight-scaledBase)/2;ctx2D.fillStyle=colors.primaryBlue;ctx2D.strokeStyle='black';ctx2D.lineWidth=2;ctx2D.fillRect(startX,startY,scaledBase,scaledBase);ctx2D.strokeRect(startX,startY,scaledBase,scaledBase);ctx2D.beginPath();ctx2D.moveTo(startX,startY);ctx2D.lineTo(startX+scaledBase,startY);ctx2D.lineTo(startX+scaledBase/2,startY-scaledSlantHeight);ctx2D.closePath();ctx2D.fill();ctx2D.stroke();ctx2D.beginPath();ctx2D.moveTo(startX,startY+scaledBase);ctx2D.lineTo(startX+scaledBase,startY+scaledBase);ctx2D.lineTo(startX+scaledBase/2,startY+scaledBase+scaledSlantHeight);ctx2D.closePath();ctx2D.fill();ctx2D.stroke();ctx2D.beginPath();ctx2D.moveTo(startX,startY);ctx2D.lineTo(startX,startY+scaledBase);ctx2D.lineTo(startX-scaledSlantHeight,startY+scaledBase/2);ctx2D.closePath();ctx2D.fill();ctx2D.stroke();ctx2D.beginPath();ctx2D.moveTo(startX+scaledBase,startY);ctx2D.lineTo(startX+scaledBase,startY+scaledBase);ctx2D.lineTo(startX+scaledBase+scaledSlantHeight,startY+scaledBase/2);ctx2D.closePath();ctx2D.fill();ctx2D.stroke()}</p>
<p class="p1"><span class="Apple-converted-space">    </span>function calculateSimpleAngleSteps(angle) { if (isNaN(angle) || angle &lt; 0 || angle &gt; 360) return ["Error: Angle must be between 0 and 360."]; let type = "Reflex"; if (angle === 0) type = "Zero"; else if (angle &lt; 90) type = "Acute"; else if (angle === 90) type = "Right"; else if (angle &lt; 180) type = "Obtuse"; else if (angle === 180) type = "Straight"; else if (angle === 360) type = "Complete"; return [ `An angle is the figure formed by two rays, called the sides of the angle, sharing a common endpoint, called the vertex.`, ``, `The input angle is $${angle}^{\\circ}$`, `This is a(n) &lt;b&gt;${type}&lt;/b&gt; angle.` ]; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>function calculateCorrespondingAnglesSteps(angle, isMystery) { if (isNaN(angle) || angle &lt;= 0 || angle &gt;= 180) return ["Error: Angle must be between 1 and 179."]; const angle2 = 180 - angle; if (isMystery) { return [ "&lt;b&gt;Angle Relationships:&lt;/b&gt;", "Vertically Opposite: $a=c, b=d, e=g, f=h$", "Corresponding: $a=e, b=f, c=g, d=h$", "Alternate Interior: $c=e, d=f$", "Alternate Exterior: $a=g, b=h$", "Consecutive Interior: $c+f=180^{\\circ}, d+e=180^{\\circ}$", "", "&lt;b&gt;Given:&lt;/b&gt; Angle $a$ is the primary angle.", "Let $a = x$. Then $b=180-x$." ]; } else { return [ "&lt;b&gt;Given:&lt;/b&gt;", `Angle $a = ${angle}^{\\circ}$`, "", "&lt;b&gt;Calculations:&lt;/b&gt;", `Angles on a straight line add to $180^{\\circ}$.`, `$b = 180^{\\circ} - a = 180^{\\circ} - ${angle}^{\\circ} = ${angle2}^{\\circ}$`, "", "Vertically opposite angles are equal:", `$c = a = ${angle}^{\\circ}$`, `$d = b = ${angle2}^{\\circ}$`, "", "Corresponding angles are equal:", `$e = a = ${angle}^{\\circ}$`, `$f = b = ${angle2}^{\\circ}$`, `$g = c = ${angle}^{\\circ}$`, `$h = d = ${angle2}^{\\circ}$` ]; } }</p>
<p class="p1"><span class="Apple-converted-space">    </span>function calculateTriangularPrismVolumeSteps(base,height,length){if(isNaN(base)||base&lt;=0||isNaN(height)||height&lt;=0||isNaN(length)||length&lt;=0)return["Error: All dimensions must be positive numbers."];const area=0.5*base*height;const volume=area*length;return["Formula for Area of Triangle Base ($A_b$):",`$A_b = 0.5 \\times b \\times h$`,`$A_b = 0.5 \\times ${base} \\times ${height}$`,`$A_b = ${area.toFixed(2)}$`,"","Formula for Volume of Triangular Prism ($V$):",`$V = A_b \\times L$`,`$V = ${area.toFixed(2)} \\times ${length}$`,`$V = ${volume.toFixed(2)}$`]}</p>
<p class="p1"><span class="Apple-converted-space">    </span>function calculateRectangularPrismVolumeSteps(base,baseHeight,depth){if(isNaN(base)||base&lt;=0||isNaN(baseHeight)||baseHeight&lt;=0||isNaN(depth)||depth&lt;=0)return["Error: All dimensions must be positive."];const area=base*baseHeight;const volume=area*depth;return["Formula for Area of Rectangle Base ($A_b$):",`$A_b = b \\times h$`,`$A_b = ${base} \\times ${baseHeight}$`,`$A_b = ${area.toFixed(2)}$`,"","Formula for Volume of Rectangular Prism ($V$):",`$V = A_b \\times d$`,`$V = ${area.toFixed(2)} \\times ${depth}$`,`$V = ${volume.toFixed(2)}$`]}</p>
<p class="p1"><span class="Apple-converted-space">    </span>function calculateCylinderVolumeSteps(radius,height){if(isNaN(radius)||radius&lt;=0||isNaN(height)||height&lt;=0)return["Error: Radius and Height must be positive."];const area=Math.PI*radius*radius;const volume=area*height;return["Formula for Area of Circular Base ($A_b$):",`$A_b = \\pi \\times r^2$`,`$A_b = \\pi \\times ${radius}^2$`,`$A_b = ${area.toFixed(2)}$`,"","Formula for Volume of Cylinder ($V$):",`$V = A_b \\times h$`,`$V = ${area.toFixed(2)} \\times ${height}$`,`$V = ${volume.toFixed(2)}$`]}</p>
<p class="p1"><span class="Apple-converted-space">    </span>function calculateConeVolumeSteps(radius,height){if(isNaN(radius)||radius&lt;=0||isNaN(height)||height&lt;=0)return["Error: Radius and Height must be positive."];const volume=(1/3)*Math.PI*radius*radius*height;return["Formula for Volume of Cone ($V$):",`$V = \\frac{1}{3} \\pi r^2 h$`,`$V = \\frac{1}{3} \\pi \\times ${radius}^2 \\times ${height}$`,`$V = ${volume.toFixed(2)}$`]}</p>
<p class="p1"><span class="Apple-converted-space">    </span>function calculateSquarePyramidVolumeSteps(baseSide,height){if(isNaN(baseSide)||baseSide&lt;=0||isNaN(height)||height&lt;=0)return["Error: Base and Height must be positive."];const baseArea=baseSide*baseSide;const volume=(1/3)*baseArea*height;return["Formula for Base Area ($A_{base}$):",`$A_{base} = b^2$`,`$A_{base} = ${baseSide}^2$`,`$A_{base} = ${baseArea.toFixed(2)}$`,"","Formula for Volume of Square Pyramid ($V$):",`$V = \\frac{1}{3} A_{base} h$`,`$V = \\frac{1}{3} \\times ${baseArea.toFixed(2)} \\times ${height}$`,`$V = ${volume.toFixed(2)}$`]}</p>
<p class="p1"><span class="Apple-converted-space">    </span>function calculateTriangularPrismSurfaceAreaSteps(b,h,s1,s2,s3,H){if(isNaN(b)||b&lt;=0||isNaN(h)||h&lt;=0||isNaN(s1)||s1&lt;=0||isNaN(s2)||s2&lt;=0||isNaN(s3)||s3&lt;=0||isNaN(H)||H&lt;=0)return["Error: All dimensions must be positive."];if(!(s1+s2&gt;s3&amp;&amp;s1+s3&gt;s2&amp;&amp;s2+s3&gt;s1))return["Error: Invalid triangle sides."];const area=0.5*b*h;const perimeter=s1+s2+s3;const latArea=perimeter*H;const totalSA=2*area+latArea;return["Formula for Area of One Triangular Base ($A_{base}$):",`$A_{base} = 0.5 \\times b \\times h$`,`$A_{base} = 0.5 \\times ${b} \\times ${h}$`,`$A_{base} = ${area.toFixed(2)}$`,"","Formula for Lateral Surface Area ($A_{lateral}$):",`$A_{lateral} = (s_1 + s_2 + s_3) \\times H$`,`$A_{lateral} = (${s1} + ${s2} + ${s3}) \\times ${H}$`,`$A_{lateral} = ${latArea.toFixed(2)}$`,"","Formula for Total Surface Area ($SA$):",`$SA = 2 \\times A_{base} + A_{lateral}$`,`$SA = 2 \\times ${area.toFixed(2)} + ${latArea.toFixed(2)}$`,`$SA = ${totalSA.toFixed(2)}$`]}</p>
<p class="p1"><span class="Apple-converted-space">    </span>function calculateRectangularPrismSurfaceAreaSteps(b,h,d){if(isNaN(b)||b&lt;=0||isNaN(h)||h&lt;=0||isNaN(d)||d&lt;=0)return["Error: All dimensions must be positive."];const f1=b*h;const f2=b*d;const f3=h*d;const totalSA=2*(f1+f2+f3);return["Formula for Surface Area ($SA$):",`$SA = 2(bh + bd + hd)$`,`$SA = 2((${b} \\times ${h}) + (${b} \\times ${d}) + (${h} \\times ${d}))$`,`$SA = 2(${f1.toFixed(2)} + ${f2.toFixed(2)} + ${f3.toFixed(2)})$`,`$SA = ${totalSA.toFixed(2)}$`]}</p>
<p class="p1"><span class="Apple-converted-space">    </span>function calculateCylinderSurfaceAreaSteps(r,h){if(isNaN(r)||r&lt;=0||isNaN(h)||h&lt;=0)return["Error: All dimensions must be positive."];const baseArea=Math.PI*r*r;const latArea=2*Math.PI*r*h;const totalSA=2*baseArea+latArea;return["Formula for Base Area ($A_{base}$):",`$A_{base} = \\pi r^2$`,`$A_{base} = \\pi \\times ${r}^2$`,`$A_{base} = ${baseArea.toFixed(2)}$`,"","Formula for Lateral Surface Area ($A_{lateral}$):",`$A_{lateral} = 2\\pi rh$`,`$A_{lateral} = 2\\pi \\times ${r} \\times ${h}$`,`$A_{lateral} = ${latArea.toFixed(2)}$`,"","Formula for Total Surface Area ($SA$):",`$SA = 2A_{base} + A_{lateral}$`,`$SA = 2(${baseArea.toFixed(2)}) + ${latArea.toFixed(2)}$`,`$SA = ${totalSA.toFixed(2)}$`]}</p>
<p class="p1"><span class="Apple-converted-space">    </span>function calculateConeSurfaceAreaSteps(radius,height){if(isNaN(radius)||radius&lt;=0||isNaN(height)||height&lt;=0)return["Error: All dimensions must be positive."];const slantHeight=Math.sqrt(radius*radius+height*height);const baseArea=Math.PI*radius*radius;const lateralArea=Math.PI*radius*slantHeight;const totalSA=baseArea+lateralArea;return["Formula for Slant Height ($l$):",`$l = \\sqrt{r^2+h^2}$`,`$l = \\sqrt{${radius}^2+${height}^2}$`,`$l = ${slantHeight.toFixed(2)}$`,"","Formula for Base Area ($A_{base}$):",`$A_{base} = \\pi r^2$`,`$A_{base} = ${baseArea.toFixed(2)}$`,"","Formula for Lateral Area ($A_{lat}$):",`$A_{lat} = \\pi r l$`,`$A_{lat} = ${lateralArea.toFixed(2)}$`,"","Formula for Total Surface Area ($SA$):",`$SA = A_{base} + A_{lat}$`,`$SA = ${totalSA.toFixed(2)}$`]}</p>
<p class="p1"><span class="Apple-converted-space">    </span>function calculateSquarePyramidSurfaceAreaSteps(baseSide,height){if(isNaN(baseSide)||baseSide&lt;=0||isNaN(height)||height&lt;=0)return["Error: All dimensions must be positive."];const slantHeight=Math.sqrt((baseSide/2)**2+height**2);const baseArea=baseSide*baseSide;const latArea=2*baseSide*slantHeight;const totalSA=baseArea+latArea;return["Formula for Slant Height ($l$):",`$l = \\sqrt{(b/2)^2 + h^2}$`,`$l = ${slantHeight.toFixed(2)}$`,"","Formula for Base Area ($A_{base}$):",`$A_{base} = b^2$`,`$A_{base} = ${baseArea.toFixed(2)}$`,"","Formula for Lateral Area ($A_{lat}$):",`$A_{lat} = 2bl$`,`$A_{lat} = ${latArea.toFixed(2)}$`,"","Formula for Total Surface Area ($SA$):",`$SA = A_{base} + A_{lat}$`,`$SA = ${totalSA.toFixed(2)}$`]}</p>
<p class="p1"><span class="Apple-converted-space">    </span>function calculateRectangleAreaSteps(length,width){if(isNaN(length)||length&lt;=0||isNaN(width)||width&lt;=0)return["Error: Dimensions must be positive."];const area=length*width;return["Formula for Area of Rectangle ($A$):",`$A = l \\times w$`,`$A = ${length} \\times ${width}$`,`$A = ${area.toFixed(2)}$`]}</p>
<p class="p1"><span class="Apple-converted-space">    </span>function calculateRectanglePerimeterSteps(length,width){if(isNaN(length)||length&lt;=0||isNaN(width)||width&lt;=0)return["Error: Dimensions must be positive."];const perimeter=2*(length+width);return["Formula for Perimeter of Rectangle ($P$):",`$P = 2(l+w)$`,`$P = 2(${length}+${width})$`,`$P = ${perimeter.toFixed(2)}$`]}</p>
<p class="p1"><span class="Apple-converted-space">    </span>function calculateTriangleAreaSteps(base,height){if(isNaN(base)||base&lt;=0||isNaN(height)||height&lt;=0)return["Error: Dimensions must be positive."];const area=0.5*base*height;return["Formula for Area of Triangle ($A$):",`$A = 0.5 \\times b \\times h$`,`$A = 0.5 \\times ${base} \\times ${height}$`,`$A = ${area.toFixed(2)}$`]}</p>
<p class="p1"><span class="Apple-converted-space">    </span>function calculateTrianglePerimeterSteps(sA,sB,sC){if(isNaN(sA)||sA&lt;=0||isNaN(sB)||sB&lt;=0||isNaN(sC)||sC&lt;=0)return["Error: Dimensions must be positive."];if(!(sA+sB&gt;sC&amp;&amp;sA+sC&gt;sB&amp;&amp;sB+sC&gt;sA))return["Error: Invalid triangle sides."];const perimeter=sA+sB+sC;return["Formula for Perimeter of Triangle ($P$):",`$P = a+b+c$`,`$P = ${sA}+${sB}+${sC}$`,`$P = ${perimeter.toFixed(2)}$`]}</p>
<p class="p1"><span class="Apple-converted-space">    </span>function calculateCircleAreaSteps(radius){if(isNaN(radius)||radius&lt;=0)return["Error: Radius must be positive."];const area=Math.PI*radius*radius;return["Formula for Area of Circle ($A$):",`$A = \\pi r^2$`,`$A = \\pi \\times ${radius}^2$`,`$A = ${area.toFixed(2)}$`]}</p>
<p class="p1"><span class="Apple-converted-space">    </span>function calculateCircleCircumferenceSteps(radius){if(isNaN(radius)||radius&lt;=0)return["Error: Radius must be positive."];const C=2*Math.PI*radius;return["Formula for Circumference of Circle ($C$):",`$C = 2\\pi r$`,`$C = 2\\pi \\times ${radius}$`,`$C = ${C.toFixed(2)}$`]}</p>
<p class="p1"><span class="Apple-converted-space">    </span>function solveLinearEquationSteps(a, b, c) { const steps = []; if (isNaN(a) || isNaN(b) || isNaN(c)) return ["Error: All coefficients must be numbers."]; const formatTerm = (val, isX) =&gt; { if (val === 0) return ''; if (isX) { if (val === 1) return 'x'; if (val === -1) return '-x'; return `${val}x`; } return `${val}`; }; const formatOp = val =&gt; val &lt; 0 ? ` - ${Math.abs(val)}` : ` + ${val}`; let initialEqStr = `${formatTerm(a, true)}`; if (b !== 0) initialEqStr += `${formatOp(b)}`; initialEqStr += ` = ${c}`; steps.push(`$${initialEqStr}$`); const cMinusB = c - b; if (b !== 0) { const oppositeOp = b &gt; 0 ? `-` : `+`; const bAbs = Math.abs(b); steps.push(`$${initialEqStr.split(' = ')[0]} ${oppositeOp} ${bAbs} = ${initialEqStr.split(' = ')[1]} ${oppositeOp} ${bAbs}$`); steps.push(`$${formatTerm(a, true)} = ${cMinusB}$`); } if (a !== 1 &amp;&amp; a !== 0) { if (a === -1) { steps.push(`$x = ${-cMinusB}$`); } else { steps.push(`$\\frac{${a}x}{${a}} = \\frac{${cMinusB}}{${a}}$`); const x = cMinusB / a; steps.push(`$x = ${Number(x.toFixed(4))}$`); } } else if (a === 0) { steps.push(cMinusB === 0 ? "$$\\text{Infinite solutions.}$$" : "$$\\text{No solution.}$$"); } return steps; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>function getAdditionSteps(num1, num2) { if (isNaN(num1) || isNaN(num2)) return ["Error: Please enter valid numbers."]; const sNum1 = String(num1), sNum2 = String(num2), sSum = String(num1 + num2); const maxLength = Math.max(sNum1.length, sNum2.length, sSum.length); let carry = 0; const carries = Array(maxLength).fill(''); for (let i = 0; i &lt; maxLength; i++) { const d1 = parseInt(sNum1.padStart(maxLength, '0')[maxLength - 1 - i] || '0'); const d2 = parseInt(sNum2.padStart(maxLength, '0')[maxLength - 1 - i] || '0'); const colSum = d1 + d2 + carry; carry = Math.floor(colSum / 10); if (carry &gt; 0 &amp;&amp; i &lt; maxLength - 1) { carries[maxLength - 2 - i] = `{\\color{red}\\small{${carry}}}`; } } const colAlignment = 'c'.repeat(maxLength); const content = [ carries.some(c =&gt; c) ? `&amp; ${carries.map(c =&gt; c || '\\phantom{0}').join(' &amp; ')}` : null, `&amp; ${[...sNum1.padStart(maxLength, ' ')].join(' &amp; ')}`, `+ &amp; ${[...sNum2.padStart(maxLength, ' ')].join(' &amp; ')}`, `\\hline`, `&amp; ${[...sSum.padStart(maxLength, ' ')].map(d =&gt; `{\\color{green}\\mathbf{${d}}}`).join(' &amp; ')}` ].filter(Boolean).join(' \\\\ '); return [`$$\\begin{array}{r${colAlignment}}${content}\\end{array}$$`]; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>function getSubtractionSteps(num1, num2) { const steps = []; if (isNaN(num1) || isNaN(num2)) return ["Error: Please enter valid numbers."]; if (num1 &lt; num2) return ["Error: First number must be larger than the second."]; const sNum1 = String(num1), sNum2 = String(num2), sDiff = String(num1 - num2); const maxLength = sNum1.length; const displayDigits = [...sNum1]; const calcDigits = [...sNum1].map(Number); for (let i = maxLength - 1; i &gt;= 0; i--) { const d2 = parseInt(sNum2.padStart(maxLength, '0')[i] || '0'); if (calcDigits[i] &lt; d2) { let j = i - 1; while (j &gt;= 0 &amp;&amp; calcDigits[j] === 0) j--; if (j &lt; 0) return ["Error: Borrowing failed."]; displayDigits[j] = `{\\color{red}\\stackrel{\\small{${calcDigits[j] - 1}}}{\\cancel{${calcDigits[j]}}}}`; calcDigits[j]--; for (let k = j + 1; k &lt; i; k++) { displayDigits[k] = `{\\color{red}\\stackrel{\\small{9}}{\\cancel{0}}}`; calcDigits[k] = 9; } displayDigits[i] = `{\\color{red}\\stackrel{\\small{${calcDigits[i] + 10}}}{\\cancel{${calcDigits[i]}}}}`; calcDigits[i] += 10; } } const colAlignment = 'c'.repeat(maxLength); const content = [ `&amp; ${displayDigits.join(' &amp; ')}`, `-\\quad &amp; ${[...sNum2.padStart(maxLength, ' ')].join(' &amp; ')}`, `\\hline`, `&amp; ${[...sDiff.padStart(maxLength, ' ')].map(d =&gt; `{\\color{green}\\mathbf{${d}}}`).join(' &amp; ')}` ].join(' \\\\ '); steps.push(`$$\\begin{array}{r${colAlignment}}${content}\\end{array}$$`); return steps; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>function getMultiplicationSteps(num1, num2) { const steps = []; if (isNaN(num1) || isNaN(num2)) return ["Error: Please enter valid numbers."]; const sNum1 = String(num1), sNum2 = String(num2), sProd = String(num1 * num2); const maxLength = sProd.length; const partials = [...sNum2].reverse().map((d, i) =&gt; String(d * num1) + '0'.repeat(i)); const colAlignment = 'c'.repeat(maxLength); const content = [`&amp; ${[...sNum1.padStart(maxLength, ' ')].join(' &amp; ')}`, `\\times &amp; ${[...sNum2.padStart(maxLength, ' ')].join(' &amp; ')}`, `\\hline`]; if (partials.length &gt; 1) { const paddedPartials = partials.map(p =&gt; p.padStart(maxLength, '0')); let carry = 0; const carries = Array(maxLength).fill(''); for (let i = 0; i &lt; maxLength; i++) { const colSum = paddedPartials.reduce((acc, p) =&gt; acc + parseInt(p[p.length - 1 - i] || '0'), 0) + carry; carry = Math.floor(colSum / 10); if (carry &gt; 0 &amp;&amp; i &lt; maxLength - 1) { carries[maxLength - 2 - i] = `{\\color{red}\\small{${carry}}}`; } } if (carries.some(c =&gt; c)) { content.push(`&amp; ${carries.map(c =&gt; c || `\\phantom{0}`).join(' &amp; ')}`); } partials.forEach(p =&gt; content.push(`&amp; ${[...p.padStart(maxLength, ' ')].join(' &amp; ')}`)); content.push(`\\hline`); } content.push(`&amp; ${[...sProd.padStart(maxLength, ' ')].map(d =&gt; `{\\color{green}\\mathbf{${d}}}`).join(' &amp; ')}`); steps.push(`$$\\begin{array}{r${colAlignment}}${content.join(' \\\\ ')}\\end{array}$$`); return steps; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>function drawLongDivision(dividend, divisor, canvas, ctx) { ctx.clearRect(0, 0, canvas.width, canvas.height); ctx.fillStyle = '#f8fafc'; ctx.fillRect(0, 0, canvas.width, canvas.height); const container = canvas.parentElement; if (!container) return; const { width, height } = container.getBoundingClientRect(); canvas.width = width; canvas.height = height; const localSafeArea = { x: canvas.width * 0.05, y: canvas.height * 0.05, width: canvas.width * 0.9, height: canvas.height * 0.9, centerX: canvas.width / 2, centerY: canvas.height / 2 }; if (isNaN(dividend) || isNaN(divisor) || dividend &lt; 0 || divisor &lt;= 0) { return; } if (divisor === 0) { return; } const dividendStr = String(dividend); const divisorStr = String(divisor); let steps = []; let quotientStr = ''; const dividendDigitRenderPositions = []; const broughtDownArrowData = []; let tempPart = ''; for(let i=0; i &lt; dividendStr.length; i++) { tempPart += dividendStr[i]; let tempDividend = parseInt(tempPart, 10); if (tempDividend &gt;= divisor) { let qDigit = Math.floor(tempDividend / divisor); quotientStr += qDigit; let product = qDigit * divisor; let remainder = tempDividend - product; steps.push({ dividendPart: tempPart, product: String(product), colEndIndex: i + 1, remainderAfterSubtraction: remainder }); tempPart = String(remainder); } else { if (quotientStr.length &gt; 0) { quotientStr += '0'; } } } if(dividend &lt; divisor) { quotientStr = '0'; steps.push({ dividendPart: dividendStr, product: '0', colEndIndex: dividendStr.length, remainderAfterSubtraction: dividend }); } const finalRemainder = dividend % divisor; let finalSize = clamp(12, localSafeArea.height / (steps.length * 2 + 5), 60); do { ctx.font = `400 ${finalSize}px 'Montserrat'`; const dividendPadding = finalSize * 0.4; const bracketSpacing = finalSize * 0.5; const divisorWidth = ctx.measureText(divisorStr).width; const tempQuotientStr = String(Math.floor(dividend / divisor)); const colWidths = dividendStr.split('').map((c, i) =&gt; Math.max(ctx.measureText(c).width, ctx.measureText(tempQuotientStr[i] || '').width)); const mainBodyWidth = colWidths.reduce((a, b) =&gt; a + b, 0); let remainderWidth = 0; if (finalRemainder &gt; 0) { remainderWidth = ctx.measureText(` R${finalRemainder}`).width; } const estimatedTotalWidth = divisorWidth + bracketSpacing + dividendPadding + mainBodyWidth + remainderWidth; if (estimatedTotalWidth &gt; localSafeArea.width * 0.95) { finalSize *= 0.95; } else { break; } } while (finalSize &gt; 12); ctx.font = `400 ${finalSize}px 'Montserrat'`; const dividendPadding = finalSize * 0.4; const bracketSpacing = finalSize * 0.5; const lineHeight = finalSize * 1.3; const divisorWidth = ctx.measureText(divisorStr).width; const colWidthsCalculated = dividendStr.split('').map((c, i) =&gt; { const qChar = quotientStr.split('').find((qc, qi) =&gt; (steps.length &gt; 0 ? steps[0].colEndIndex - 1 + qi : -1) === i) || ' '; return Math.max(ctx.measureText(c).width, ctx.measureText(qChar).width); }); const columnRightEdges = []; let currentXOffset = 0; for (let i = 0; i &lt; colWidthsCalculated.length; i++) { currentXOffset += colWidthsCalculated[i]; columnRightEdges.push(currentXOffset); } const mainBodyWidth = columnRightEdges.length &gt; 0 ? columnRightEdges[columnRightEdges.length - 1] : 0; let remainderTextWidth = 0; const firstQuotientCol = steps.length &gt; 0 ? steps[0].colEndIndex - 1 : -1; const lastQuotientCol = firstQuotientCol + quotientStr.length - 1; const quotientEndPos = lastQuotientCol &gt;=0 ? columnRightEdges[lastQuotientCol] : 0; if (finalRemainder &gt; 0) { const remainderText = ` R${finalRemainder}`; remainderTextWidth = ctx.measureText(remainderText).width + (finalSize * 0.2); } const rightmostExtent = Math.max(mainBodyWidth, quotientEndPos + remainderTextWidth); const totalWidth = divisorWidth + bracketSpacing + dividendPadding + rightmostExtent; const startX = localSafeArea.centerX - totalWidth / 2; const divisorEndX = startX + divisorWidth; const symbolX = divisorEndX + bracketSpacing; const dividendContentStartX = symbolX + dividendPadding; let currentY = localSafeArea.y + lineHeight; ctx.textBaseline = 'middle'; ctx.fillStyle = colors.main; ctx.textAlign = 'right'; ctx.fillText(divisorStr, divisorEndX, currentY + lineHeight); for(let i=0; i&lt;dividendStr.length; i++) { const digit = dividendStr[i]; const digitWidth = ctx.measureText(digit).width; const digitXRight = dividendContentStartX + columnRightEdges[i]; const digitXCenter = digitXRight - digitWidth / 2; const digitY = currentY + lineHeight; ctx.fillText(digit, digitXRight, digitY); dividendDigitRenderPositions.push({ x: digitXCenter, y: digitY, char: digit, colIndex: i }); } ctx.fillStyle = colors.answer; if (firstQuotientCol !== -1) { for (let i = 0; i &lt; quotientStr.length; i++) { const digit = quotientStr[i]; const colIndex = firstQuotientCol + i; if (colIndex &lt; columnRightEdges.length) { ctx.fillText(digit, dividendContentStartX + columnRightEdges[colIndex], currentY); } } } if (finalRemainder &gt; 0) { ctx.fillStyle = colors.carry; ctx.textAlign = 'left'; const remainderText = ` R${finalRemainder}`; const quotientEndXCoord = dividendContentStartX + quotientEndPos; ctx.fillText(remainderText, quotientEndXCoord + (finalSize * 0.2), currentY); } ctx.fillStyle = colors.main; ctx.textAlign = 'right'; const overlineY = currentY + lineHeight * 0.5; const verticalLineBottomY = currentY + lineHeight * 1.1; ctx.beginPath(); ctx.moveTo(symbolX, overlineY - (finalSize * 0.1)); ctx.lineTo(symbolX, verticalLineBottomY); ctx.moveTo(symbolX, overlineY); ctx.lineTo(dividendContentStartX + mainBodyWidth, overlineY); ctx.lineWidth = finalSize * 0.07; ctx.stroke(); currentY += lineHeight; for (let stepIndex = 0; stepIndex &lt; steps.length; stepIndex++) { const step = steps[stepIndex]; const productDisplayX = dividendContentStartX + columnRightEdges[step.colEndIndex - 1]; const productDisplayY = currentY + lineHeight; ctx.fillText(`-${step.product}`, productDisplayX, productDisplayY); ctx.beginPath(); const startColumnIndex = step.colEndIndex - step.dividendPart.length; const startLineX = dividendContentStartX + (startColumnIndex &gt; 0 ? columnRightEdges[startColumnIndex - 1] : 0); ctx.moveTo(startLineX, productDisplayY + lineHeight * 0.5); ctx.lineTo(productDisplayX, productDisplayY + lineHeight * 0.5); ctx.lineWidth = finalSize * 0.06; ctx.stroke(); const remainderDisplayY = productDisplayY + lineHeight; let remainderToDraw = String(step.remainderAfterSubtraction); let remainderDrawRightX = dividendContentStartX + columnRightEdges[step.colEndIndex - 1]; ctx.fillText(remainderToDraw, remainderDrawRightX, remainderDisplayY); ctx.fillStyle = colors.main; if (step.colEndIndex &lt; dividendStr.length) { const nextDigitOriginalIndex = step.colEndIndex; const broughtDownDigitChar = dividendStr[nextDigitOriginalIndex]; const originalDigitInfo = dividendDigitRenderPositions[nextDigitOriginalIndex]; const broughtDownDigitWidth = ctx.measureText(broughtDownDigitChar).width; const targetDigitXCenter = dividendContentStartX + columnRightEdges[nextDigitOriginalIndex] - (broughtDownDigitWidth / 2); const arrowPadding = finalSize * 0.15; broughtDownArrowData.push({ fromY: originalDigitInfo.y + (finalSize * 0.5) + arrowPadding, toY: remainderDisplayY - (finalSize * 0.5) - arrowPadding, fromX: originalDigitInfo.x, toX: targetDigitXCenter, broughtDownChar: broughtDownDigitChar, broughtDownDisplayX: targetDigitXCenter, broughtDownDisplayY: remainderDisplayY }); } currentY = remainderDisplayY; } ctx.strokeStyle = colors.main; ctx.lineWidth = 1.5; const arrowHeadSize = finalSize * 0.2; ctx.textAlign = 'center'; broughtDownArrowData.forEach(arrow =&gt; { ctx.beginPath(); ctx.moveTo(arrow.fromX, arrow.fromY); ctx.lineTo(arrow.toX, arrow.toY); ctx.stroke(); ctx.beginPath(); ctx.moveTo(arrow.toX, arrow.toY); ctx.lineTo(arrow.toX - arrowHeadSize, arrow.toY - arrowHeadSize); ctx.moveTo(arrow.toX, arrow.toY); ctx.lineTo(arrow.toX + arrowHeadSize, arrow.toY - arrowHeadSize); ctx.stroke(); ctx.fillStyle = colors.label; ctx.fillText(arrow.broughtDownChar, arrow.broughtDownDisplayX, arrow.broughtDownDisplayY); ctx.fillStyle = colors.main; }); }</p>
<p class="p1"><span class="Apple-converted-space">    </span>function getBedmasSteps(expression) { function formatExpr(expr, highlight) { let s = expr.replace(/\s/g, '').replace(/\*/g, ' \\times ').replace(/\//g, ' \\div '); if (highlight) { let hl = highlight.replace(/\s/g, '').replace(/\*/g, ' \\times ').replace(/\//g, ' \\div '); s = s.replace(hl, `\\underline{${hl}}`); } return s; } function solve(expr) { try { return new Function('return ' + String(expr).replace(/\^/g, '**'))(); } catch { return null; } } let currentExpr = expression.replace(/\s/g, ''); const steps = []; while (isNaN(Number(currentExpr))) { let originalExpr = currentExpr; let processed = false; let bracketMatch = currentExpr.match(/\(([^()]+)\)/); if (bracketMatch) { const subExpr = bracketMatch[1]; const subResult = solve(subExpr); if (subResult === null) return ["Error in bracket expression."]; steps.push(`$= ${formatExpr(currentExpr, `(${subExpr})`)}$`); currentExpr = currentExpr.replace(bracketMatch[0], subResult); processed = true; } if (!processed) { let expMatch = currentExpr.match(/(\(-?\d+(?:\.\d+)?\)|\-?\d+(?:\.\d+)?)\^(-?\d+(?:\.\d+)?)/); if (expMatch) { steps.push(`$= ${formatExpr(currentExpr, expMatch[0])}$`); const result = solve(expMatch[0]); if (result === null) return ["Error in exponent expression."]; currentExpr = currentExpr.replace(expMatch[0], result); processed = true; } } if (!processed) { let mdMatch = currentExpr.match(/-?\d+(?:\.\d+)?([*\/])-?\d+(?:\.\d+)?/); if (mdMatch) { steps.push(`$= ${formatExpr(currentExpr, mdMatch[0])}$`); const result = solve(mdMatch[0]); if (result === null) return ["Error in M/D expression."]; currentExpr = currentExpr.replace(mdMatch[0], result); processed = true; } } if (!processed) { let asMatch = currentExpr.match(/^-?\d+(?:\.\d+)?([+\-])-?\d+(?:\.\d+)?/); if (asMatch) { steps.push(`$= ${formatExpr(currentExpr, asMatch[0])}$`); const result = solve(asMatch[0]); if (result === null) return ["Error in A/S expression."]; currentExpr = currentExpr.replace(asMatch[0], result); processed = true; } } if (!processed || currentExpr === originalExpr) break; if (currentExpr !== originalExpr) { steps.push(`$= ${formatExpr(currentExpr)}$`); } } let lastStep = steps[steps.length - 1]; if (lastStep &amp;&amp; lastStep.startsWith('$= ')) { const mathContentWithoutDollars = lastStep.substring(3).slice(0, -1); steps[steps.length - 1] = `$= \\mathbf{${mathContentWithoutDollars}}$`; } else if (lastStep &amp;&amp; lastStep.startsWith('$')) { steps[steps.length - 1] = `$\\mathbf{${lastStep.slice(1, -1)}}$`; } return steps.filter((v, i, a) =&gt; i === 0 || v !== a[i-1]); }</p>
<p class="p1"><span class="Apple-converted-space">    </span>function getTableEquationSteps() { const rows = Array.from(document.querySelectorAll('#table-container .flex, #dimensionInputsInline &gt; .flex')).map(rowDiv =&gt; { const xInput = rowDiv.querySelector('.table-x'); const yInput = rowDiv.querySelector('.table-y'); if (!xInput || !yInput) return null; const x = parseFloat(xInput.value); const y = parseFloat(yInput.value); return {x, y}; }).filter(row =&gt; row &amp;&amp; !isNaN(row.x) &amp;&amp; !isNaN(row.y)); if (rows.length &lt; 2) { return ["Please enter at least two data points."]; } const p1 = rows[0]; const p2 = rows[1]; if (p2.x - p1.x === 0) { const isVertical = rows.every(p =&gt; p.x === p1.x); if (isVertical) { return [`$x = ${p1.x}$`]; } else { return ["The data does not represent a simple linear relationship."]; } } const m = (p2.y - p1.y) / (p2.x - p1.x); const b = p1.y - m * p1.x; const isLinear = rows.every(p =&gt; Math.abs(p.y - (m * p.x + b)) &lt; 1e-9); if (isLinear) { let equationStr = 'y = '; if (m !== 0) { equationStr += (m === 1 ? '' : (m === -1 ? '-' : m)) + 'x'; } if (b !== 0) { if (m !== 0) { equationStr += (b &gt; 0 ? ' + ' : ' - ') + Math.abs(b); } else { equationStr += b; } } else if (m === 0 &amp;&amp; b === 0) { equationStr += '0'; } else if (m === 0) { equationStr = `y = ${b}`; } return [`$\\mathbf{${equationStr}}$`]; } return ["The data does not represent a simple linear relationship."]; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>function getFractionAdditionSteps(n1, d1, n2, d2) { if (!Number.isInteger(n1) || !Number.isInteger(d1) || !Number.isInteger(n2) || !Number.isInteger(d2)) { return ["Error: Please enter whole numbers for fractions."]; } if (d1 === 0 || d2 === 0) return ["Error: Denominators cannot be zero."]; const steps = []; const commonDenominator = lcm(d1, d2); const newN1 = n1 * (commonDenominator / d1); const newN2 = n2 * (commonDenominator / d2); if (d1 !== commonDenominator || d2 !== commonDenominator) { steps.push(`$= \\frac{${newN1}}{${commonDenominator}} + \\frac{${newN2}}{${commonDenominator}}$`); } const sumN = newN1 + newN2; steps.push(`$= \\frac{${sumN}}{${commonDenominator}}$`); const finalGcd = gcd(sumN, commonDenominator); const finalN = sumN / finalGcd; const finalD = commonDenominator / finalGcd; if (finalGcd &gt; 1 &amp;&amp; finalD !== 1) { steps.push(`$= \\frac{${finalN}}{${finalD}}$`); } if (finalD === 1) { steps[steps.length - 1] = `$= \\mathbf{${finalN}}$`; } else { steps[steps.length - 1] = `$= \\mathbf{\\frac{${finalN}}{${finalD}}}$`; } return steps; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>function getFractionSubtractionSteps(n1, d1, n2, d2) { if (!Number.isInteger(n1) || !Number.isInteger(d1) || !Number.isInteger(n2) || !Number.isInteger(d2)) { return ["Error: Please enter whole numbers for fractions."]; } if (d1 === 0 || d2 === 0) return ["Error: Denominators cannot be zero."]; const steps = []; const commonDenominator = lcm(d1, d2); const newN1 = n1 * (commonDenominator / d1); const newN2 = n2 * (commonDenominator / d2); if (newN1 &lt; newN2) { return ["Error: The first fraction must be greater than or equal to the second."]; } if (d1 !== commonDenominator || d2 !== commonDenominator) { steps.push(`$= \\frac{${newN1}}{${commonDenominator}} - \\frac{${newN2}}{${commonDenominator}}$`); } const diffN = newN1 - newN2; steps.push(`$= \\frac{${diffN}}{${commonDenominator}}$`); const finalGcd = gcd(diffN, commonDenominator); const finalN = diffN / finalGcd; const finalD = commonDenominator / finalGcd; if (finalGcd &gt; 1 &amp;&amp; finalD !== 1) { steps.push(`$= \\frac{${finalN}}{${finalD}}$`); } if (finalD === 1) { steps[steps.length - 1] = `$= \\mathbf{${finalN}}$`; } else { steps[steps.length - 1] = `$= \\mathbf{\\frac{${finalN}}{${finalD}}}$`; } return steps; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>function getFractionMultiplicationSteps(n1, d1, n2, d2) { if (!Number.isInteger(n1) || !Number.isInteger(d1) || !Number.isInteger(n2) || !Number.isInteger(d2)) { return ["Error: Please enter whole numbers for fractions."]; } if (d1 === 0 || d2 === 0) return ["Error: Denominators cannot be zero."]; const steps = []; steps.push(`$= \\frac{${n1} \\times ${n2}}{${d1} \\times ${d2}}$`); const prodN = n1 * n2; const prodD = d1 * d2; steps.push(`$= \\frac{${prodN}}{${prodD}}$`); const finalGcd = gcd(prodN, prodD); const finalN = prodN / finalGcd; const finalD = prodD / finalGcd; if (finalGcd &gt; 1 &amp;&amp; finalD !== 1) { steps.push(`$= \\frac{${finalN}}{${finalD}}$`); } if (finalD === 1) { steps[steps.length - 1] = `$= \\mathbf{${finalN}}$`; } else { steps[steps.length - 1] = `$= \\mathbf{\\frac{${finalN}}{${finalD}}}$`; } return steps; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>function getFractionDivisionSteps(n1, d1, n2, d2) { if (!Number.isInteger(n1) || !Number.isInteger(d1) || !Number.isInteger(n2) || !Number.isInteger(d2)) { return ["Error: Please enter whole numbers for fractions."]; } if (d1 === 0 || d2 === 0) return ["Error: Denominators cannot be zero."]; if (n2 === 0) return ["Error: Cannot divide by zero."]; const steps = []; steps.push(`$= \\frac{${n1}}{${d1}} \\div \\frac{${n2}}{${d2}}$`); steps.push(`$= \\frac{${n1}}{${d1}} \\times \\frac{${d2}}{${n2}}$`); const prodN = n1 * d2; const prodD = d1 * n2; steps.push(`$= \\frac{${prodN}}{${prodD}}$`); const finalGcd = gcd(prodN, prodD); const finalN = prodN / finalGcd; const finalD = prodD / finalGcd; if (finalGcd &gt; 1 &amp;&amp; finalD !== 1) { steps.push(`$= \\frac{${finalN}}{${finalD}}$`); } if (finalD === 1) { steps[steps.length - 1] = `$= \\mathbf{${finalN}}$`; } else { steps[steps.length - 1] = `$= \\mathbf{\\frac{${finalN}}{${finalD}}}$`; } return steps; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>function formatMixedNumber(w, n, d) { let result = ''; if (w &gt; 0) result += w; if (n &gt; 0) { if (w &gt; 0) result += ' '; result += `\\frac{${n}}{${d}}`; } return result || '0'; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>function getMixedNumberSteps(w1, n1, d1, w2, n2, d2, operation) { if ([w1, n1, d1, w2, n2, d2].some(v =&gt; !Number.isInteger(v))) { return ["Error: Please enter whole numbers."]; } if (d1 === 0 || d2 === 0) return ["Error: Denominators cannot be zero."]; if (n1 &lt; 0 || d1 &lt;= 0 || n2 &lt; 0 || d2 &lt;= 0) return ["Error: Numerators must be non-negative and denominators must be positive."]; const steps = []; const impN1 = (w1 * d1) + n1; const impN2 = (w2 * d2) + n2; steps.push(`$= \\frac{${impN1}}{${d1}} ${operation.symbol} \\frac{${impN2}}{${d2}}$`); if (operation.name === 'subtraction' &amp;&amp; (impN1 / d1 &lt; impN2 / d2)) { return ["Error: First number must be larger than the second."]; } if (operation.name === 'division' &amp;&amp; impN2 === 0) { return ["Error: Cannot divide by zero."]; } let resN, resD; switch(operation.name) { case 'addition': case 'subtraction': const commonD = lcm(d1, d2); const newImpN1 = impN1 * (commonD / d1); const newImpN2 = impN2 * (commonD / d2); if (d1 !== commonD || d2 !== commonD) { steps.push(`$= \\frac{${newImpN1}}{${commonD}} ${operation.symbol} \\frac{${newImpN2}}{${commonD}}$`); } resN = (operation.name === 'addition') ? newImpN1 + newImpN2 : newImpN1 - newImpN2; resD = commonD; steps.push(`$= \\frac{${resN}}{${resD}}$`); break; case 'multiplication': resN = impN1 * impN2; resD = d1 * d2; steps.push(`$= \\frac{${impN1} \\times ${impN2}}{${d1} \\times ${d2}} = \\frac{${resN}}{${resD}}$`); break; case 'division': steps.push(`$= \\frac{${impN1}}{${d1}} \\times \\frac{${d2}}{${impN2}}$`); resN = impN1 * d2; resD = d1 * impN2; steps.push(`$= \\frac{${resN}}{${resD}}$`); break; } const finalGcd = gcd(resN, resD); const finalN_improper = resN / finalGcd; const finalD = resD / finalGcd; if (finalGcd &gt; 1 &amp;&amp; finalD !== 1) { steps.push(`$= \\frac{${finalN_improper}}{${finalD}}$`); } const finalW = Math.floor(finalN_improper / finalD); const finalN_proper = finalN_improper % finalD; if (finalW &gt; 0 || finalN_proper &gt; 0) { steps[steps.length - 1] = `$= \\mathbf{${formatMixedNumber(finalW, finalN_proper, finalD)}}$`; } else { steps[steps.length-1] = `$= \\mathbf{0}$` } return steps; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>function getNumberlineHTML(start, end, step) { if (isNaN(start) || isNaN(end) || isNaN(step)) { return ["Error: Please enter valid numbers for start, end, and step."]; } if (start &gt;= end) { return ["Error: Start value must be less than end value."]; } if (step &lt;= 0) { return ["Error: Step value must be positive."]; } const range = end - start; const tickCount = range / step; if (tickCount &gt; 100) { return ["Error: Too many steps. Please increase the step value or decrease the range."]; } const svgWidth = 800; const svgHeight = 100; const padding = 40; const lineY = svgHeight / 2; let svgContent = `&lt;svg width="100%" height="${svgHeight}" viewBox="0 0 ${svgWidth} ${svgHeight}" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg"&gt;&lt;defs&gt;&lt;marker id="arrowhead" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto"&gt;&lt;polygon points="0 0, 10 3.5, 0 7" fill="#334155" /&gt;&lt;/marker&gt;&lt;/defs&gt;`; svgContent += `&lt;line x1="${padding}" y1="${lineY}" x2="${svgWidth - padding}" y2="${lineY}" stroke="#334155" stroke-width="2" marker-end="url(#arrowhead)" marker-start="url(#arrowhead)" /&gt;`; for (let i = 0; i &lt;= tickCount; i++) { const value = start + (i * step); const xPos = padding + (i / tickCount) * (svgWidth - 2 * padding); svgContent += `&lt;line x1="${xPos}" y1="${lineY - 5}" x2="${xPos}" y2="${lineY + 5}" stroke="#334155" stroke-width="2" /&gt;`; svgContent += `&lt;text x="${xPos}" y="${lineY + 25}" font-family="Montserrat, sans-serif" font-size="14" fill="#334155" text-anchor="middle"&gt;${Number(value.toFixed(2))}&lt;/text&gt;`; } svgContent += `&lt;/svg&gt;`; return [svgContent]; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>function getLineGraphHTML(data) { if (data.length &lt; 2) return ["&lt;p&gt;Please enter at least two data points for the line graph.&lt;/p&gt;"]; const svgWidth = 800; const svgHeight = 400; const p = 60; const values = data.map(d =&gt; d.value); const minY = Math.min(...values); const maxY = Math.max(...values); const rangeY = maxY - minY || 1; const points = data.map((d, i) =&gt; { const x = p + (i / (data.length - 1)) * (svgWidth - 2 * p); const y = (svgHeight - p) - ((d.value - minY) / rangeY) * (svgHeight - 2 * p); return `${x},${y}`; }).join(' '); let svg = `&lt;svg width="100%" height="100%" viewBox="0 0 ${svgWidth} ${svgHeight}" preserveAspectRatio="xMidYMid meet"&gt;`; svg += `&lt;line x1="${p}" y1="${svgHeight - p}" x2="${svgWidth - p}" y2="${svgHeight - p}" stroke="#334155" stroke-width="2" /&gt;`; svg += `&lt;line x1="${p}" y1="${p}" x2="${p}" y2="${svgHeight - p}" stroke="#334155" stroke-width="2" /&gt;`; svg += `&lt;polyline fill="none" stroke="#2B6DFE" stroke-width="3" points="${points}" /&gt;`; data.forEach((d, i) =&gt; { const x = p + (i / (data.length - 1)) * (svgWidth - 2 * p); const y = (svgHeight - p) - ((d.value - minY) / rangeY) * (svgHeight - 2 * p); svg += `&lt;circle cx="${x}" cy="${y}" r="4" fill="#00F2FF" stroke="#2B6DFE" stroke-width="2" /&gt;`; svg += `&lt;text x="${x}" y="${svgHeight - p + 20}" text-anchor="middle" font-size="14" fill="#334155"&gt;${d.label}&lt;/text&gt;`; }); svg += `&lt;text x="${p - 15}" y="${p - 5}" text-anchor="end" font-size="14" fill="#334155"&gt;${maxY}&lt;/text&gt;`; svg += `&lt;text x="${p - 15}" y="${svgHeight - p + 5}" text-anchor="end" font-size="14" fill="#334155"&gt;${minY}&lt;/text&gt;`; svg += `&lt;/svg&gt;`; return [svg]; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>function getBarGraphHTML(data) { if (data.length === 0) return ["&lt;p&gt;Please enter data for the bar graph.&lt;/p&gt;"]; const svgWidth = 800; const svgHeight = 400; const p = 60; const barGap = 10; const barWidth = (svgWidth - 2 * p - (data.length - 1) * barGap) / data.length; const maxValue = Math.max(...data.map(d =&gt; d.value), 0); let svg = `&lt;svg width="100%" height="100%" viewBox="0 0 ${svgWidth} ${svgHeight}" preserveAspectRatio="xMidYMid meet"&gt;`; svg += `&lt;line x1="${p}" y1="${p}" x2="${p}" y2="${svgHeight - p}" stroke="#334155" stroke-width="2" /&gt;`; svg += `&lt;line x1="${p}" y1="${svgHeight - p}" x2="${svgWidth - p}" y2="${svgHeight - p}" stroke="#334155" stroke-width="2" /&gt;`; svg += `&lt;text x="${p - 10}" y="${p}" text-anchor="end" font-size="14" fill="#334155"&gt;${maxValue}&lt;/text&gt;`; svg += `&lt;text x="${p - 10}" y="${svgHeight - p}" text-anchor="end" font-size="14" fill="#334155"&gt;0&lt;/text&gt;`; data.forEach((d, i) =&gt; { const barHeight = (d.value / maxValue) * (svgHeight - 2 * p); const x = p + i * (barWidth + barGap); const y = svgHeight - p - barHeight; svg += `&lt;rect x="${x}" y="${y}" width="${barWidth}" height="${barHeight}" fill="url(#barGradient)" /&gt;`; svg += `&lt;text x="${x + barWidth / 2}" y="${svgHeight - p + 20}" text-anchor="middle" font-size="14" fill="#334155"&gt;${d.label}&lt;/text&gt;`; }); svg += `&lt;defs&gt;&lt;linearGradient id="barGradient" x1="0%" y1="0%" x2="0%" y2="100%"&gt;&lt;stop offset="0%" style="stop-color:#00F2FF;stop-opacity:1" /&gt;&lt;stop offset="100%" style="stop-color:#2B6DFE;stop-opacity:1" /&gt;&lt;/linearGradient&gt;&lt;/defs&gt;`; svg += `&lt;/svg&gt;`; return [svg]; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>function getPictographHTML(data, emoji) { if (data.length === 0) return ["&lt;p&gt;Please enter data for the pictograph.&lt;/p&gt;"]; let html = `&lt;div class="w-full text-left font-sans text-slate-800"&gt;&lt;table class="w-full"&gt;`; data.forEach(d =&gt; { html += `&lt;tr class="border-b"&gt;&lt;td class="p-2 w-1/4 font-bold text-right"&gt;${d.label}&lt;/td&gt;&lt;td class="p-2 text-2xl"&gt;${emoji.repeat(d.value)}&lt;/td&gt;&lt;/tr&gt;`; }); html += `&lt;/table&gt;&lt;/div&gt;`; return [html]; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>function getStemAndLeafPlotHTML(data) { if (data.length === 0) return ["&lt;p&gt;Please enter numbers for the stem and leaf plot.&lt;/p&gt;"]; const plot = new Map(); const sortedData = data.sort((a,b) =&gt; a - b); sortedData.forEach(num =&gt; { const stem = Math.floor(num / 10); const leaf = num % 10; if (!plot.has(stem)) { plot.set(stem, []); } plot.get(stem).push(leaf); }); let html = `&lt;table class="font-mono text-2xl text-slate-800"&gt;&lt;thead&lt;tr class="border-b-2 border-slate-500"&gt;&lt;th class="p-2"&gt;Stem&lt;/th&gt;&lt;th class="p-2 text-left"&gt;Leaf&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;`; for (let [stem, leaves] of [...plot.entries()].sort((a,b) =&gt; a[0] - b[0])) { html += `&lt;tr class="border-b"&gt;&lt;td class="p-2 text-right font-bold"&gt;${stem}&lt;/td&gt;&lt;td class="p-2 border-l-2 border-slate-500"&gt;${leaves.join(' ')}&lt;/td&gt;&lt;/tr&gt;`; } html += `&lt;/tbody&gt;&lt;/table&gt;`; return [html]; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>function getCurrencyDisplayHTML(currencyType) { let currencyData = []; if (currencyType === 'US') { currencyData = [ { id: 'curr-100', text: '$100 Bill', url: 'https://upload.wikimedia.org/wikipedia/commons/7/7b/Obverse_of_the_series_2009_%24100_Federal_Reserve_Note.jpg', isCoin: false }, { id: 'curr-50', text: '$50 Bill', url: 'https://upload.wikimedia.org/wikipedia/commons/0/09/50_USD_Series_2004_Note_Front.jpg', isCoin: false }, { id: 'curr-20', text: '$20 Bill', url: 'https://upload.wikimedia.org/wikipedia/commons/7/79/US_%2420_Series_2006_Obverse.jpg', isCoin: false }, { id: 'curr-10', text: '$10 Bill', url: 'https://upload.wikimedia.org/wikipedia/commons/f/f6/US_%2410_Series_2003_obverse.jpg', isCoin: false }, { id: 'curr-5', text: '$5 Bill', url: 'https://upload.wikimedia.org/wikipedia/commons/6/69/US-Series-2006G-%245-obverse.jpg', isCoin: false }, { id: 'curr-1', text: '$1 Bill', url: 'https://t4.ftcdn.net/jpg/01/88/70/81/360_F_188708162_yivqUZ5ZVYOxDqdtgkWE7A1GkCaajWJX.jpg', isCoin: false }, { id: 'curr-0.25', text: 'Quarter', url: 'https://www.littletoncoin.com/shop/api/assets/LCCCatalogAssetStore/images/catalog/products/600x600/4385.71_B.png', isCoin: true }, { id: 'curr-0.10', text: 'Dime', url: 'https://upload.wikimedia.org/wikipedia/commons/7/79/Dime_Reverse_13.png', isCoin: true }, { id: 'curr-0.05', text: 'Nickel', url: 'https://upload.wikimedia.org/wikipedia/commons/9/96/US_Nickel_2013_Rev.png', isCoin: true }, { id: 'curr-0.01', text: 'Penny', url: 'https://upload.wikimedia.org/wikipedia/commons/2/2e/US_One_Cent_Obv.png', isCoin: true } ]; } else if (currencyType === 'Canadian') { currencyData = [ { id: 'can-curr-100', text: '$100 Bill', url: 'https://upload.wikimedia.org/wikipedia/en/8/8f/Canadian_%24100_note_specimen_-_face.png', isCoin: false }, { id: 'can-curr-50', text: '$50 Bill', url: 'https://upload.wikimedia.org/wikipedia/en/6/6d/Canadian_%2450_note_specimen_-_face.png', isCoin: false }, { id: 'can-curr-20', text: '$20 Bill', url: 'https://www.bankofcanada.ca/wp-content/uploads/2015/09/20_front.jpg', isCoin: false }, { id: 'can-curr-10', text: '$10 Bill', url: 'https://www.bankofcanada.ca/wp-content/uploads/2015/09/10_front.jpg', isCoin: false }, { id: 'can-curr-5', text: '$5 Bill', url: 'https://www.bankofcanada.ca/wp-content/uploads/2015/09/5_front.jpg', isCoin: false }, { id: 'can-curr-2', text: 'Toonie', url: 'https://upload.wikimedia.org/wikipedia/en/d/d2/Toonie_-_front.png', isCoin: true, scale: 1.25 }, { id: 'can-curr-1', text: 'Loonie', url: 'https://upload.wikimedia.org/wikipedia/en/e/ef/Canadian_Dollar_-_reverse.png', isCoin: true, scale: 1.20 }, { id: 'can-curr-0.25', text: 'Quarter', url: 'https://upload.wikimedia.org/wikipedia/en/3/37/Quarter_Reverse_2010.png', isCoin: true, scale: 1.0 }, { id: 'can-curr-0.10', text: 'Dime', url: 'https://upload.wikimedia.org/wikipedia/commons/f/fb/Canadian_dime_1974_reverse.png', isCoin: true, scale: 0.70 }, { id: 'can-curr-0.05', text: 'Nickel', url: 'https://upload.wikimedia.org/wikipedia/en/b/bb/Canadian_Nickel_-_reverse.png', isCoin: true, scale: 1.0 }, { id: 'can-curr-0.01', text: 'Penny', url: 'https://upload.wikimedia.org/wikipedia/en/c/c5/Canadian_Penny_-_Reverse.png', isCoin: true, scale: 0.70 }, ]; } let totalImages = 0; currencyData.forEach(c =&gt; { const input = document.getElementById(c.id); const quantity = input ? parseInt(input.value) : 0; if (!isNaN(quantity) &amp;&amp; quantity &gt; 0) { totalImages += quantity; } }); let sizeClass = 'h-32'; if (totalImages === 1) { sizeClass = 'h-80'; } else if (totalImages &lt;= 4) { sizeClass = 'h-64'; } else if (totalImages &lt;= 9) { sizeClass = 'h-48'; } else if (totalImages &lt;= 16) { sizeClass = 'h-32'; } else if (totalImages &lt;= 25) { sizeClass = 'h-24'; } else if (totalImages &lt;= 36) { sizeClass = 'h-20'; } else { sizeClass = 'h-16'; } let html = '&lt;div class="flex flex-wrap gap-2 justify-center items-center"&gt;'; currencyData.forEach(c =&gt; { const input = document.getElementById(c.id); const quantity = input ? parseInt(input.value) : 0; if (!isNaN(quantity) &amp;&amp; quantity &gt; 0) { for (let i = 0; i &lt; quantity; i++) { let style = ''; let imageClass = ''; if (c.isCoin) { const scale = c.scale || 1.0; style = ` background-image: url('${c.url}'); background-size: contain; background-position: center; background-repeat: no-repeat; transform: scale(${scale}); margin: 0.5rem; `; imageClass = `${sizeClass} aspect-square`; html += `&lt;div class="${imageClass}" style="${style}" title="${c.text}"&gt;&lt;/div&gt;`; } else { imageClass = `${sizeClass} w-auto rounded`; html += `&lt;img src="${c.url}" class="${imageClass}" alt="${c.text}" onerror="this.onerror=null;this.src='https://placehold.co/100x100/EEE/CCC?text=Image+Not+Found';"&gt;`; } } } }); html += '&lt;/div&gt;'; return html; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>function getCurrencyCalculationHTML(currencyType) { let currencyValues = {}; if (currencyType === 'US') { currencyValues = { 'curr-100': 100, 'curr-50': 50, 'curr-20': 20, 'curr-10': 10, 'curr-5': 5, 'curr-1': 1, 'curr-0.25': 0.25, 'curr-0.10': 0.10, 'curr-0.05': 0.05, 'curr-0.01': 0.01 }; } else if (currencyType === 'Canadian') { currencyValues = { 'can-curr-100': 100, 'can-curr-50': 50, 'can-curr-20': 20, 'can-curr-10': 10, 'can-curr-5': 5, 'can-curr-2': 2, 'can-curr-1': 1, 'can-curr-0.25': 0.25, 'can-curr-0.10': 0.10, 'can-curr-0.05': 0.05, 'can-curr-0.01': 0.01 }; } let total = 0; for (const id in currencyValues) { const input = document.getElementById(id); const quantity = input ? parseInt(input.value) : 0; if (!isNaN(quantity) &amp;&amp; quantity &gt; 0) { total += quantity * currencyValues[id]; } } return [`&lt;p class="text-5xl font-bold text-green-600"&gt;Total: $${total.toFixed(2)}&lt;/p&gt;`]; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>function drawGrid(ctx, centerX, centerY, pixelsPerUnit) { ctx.strokeStyle = colors.grid; ctx.lineWidth = 0.5; for (let x = centerX; x &lt; mathCanvas.width; x += pixelsPerUnit) { ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, mathCanvas.height); ctx.stroke(); } for (let x = centerX; x &gt; 0; x -= pixelsPerUnit) { ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, mathCanvas.height); ctx.stroke(); } for (let y = centerY; y &lt; mathCanvas.height; y += pixelsPerUnit) { ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(mathCanvas.width, y); ctx.stroke(); } for (let y = centerY; y &gt; 0; y -= pixelsPerUnit) { ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(mathCanvas.width, y); ctx.stroke(); } }</p>
<p class="p1"><span class="Apple-converted-space">    </span>function drawGraphingCalculator(graphInputs, currentPixelsPerUnit) { clearCanvas(mathCanvas, ctx); ctx.font = `400 12px Montserrat`; ctx.textAlign = 'center'; ctx.textBaseline = 'middle'; const centerX = mathCanvas.width / 2; const centerY = mathCanvas.height / 2; drawGrid(ctx, centerX, centerY, currentPixelsPerUnit); ctx.strokeStyle = colors.axis; ctx.lineWidth = 1; ctx.beginPath(); ctx.moveTo(0, centerY); ctx.lineTo(mathCanvas.width, centerY); ctx.stroke(); ctx.beginPath(); ctx.moveTo(mathCanvas.width - 10, centerY - 5); ctx.lineTo(mathCanvas.width, centerY); ctx.lineTo(mathCanvas.width - 10, centerY + 5); ctx.fill(); ctx.font = `600 12px Montserrat`; ctx.fillText('x', mathCanvas.width - 15, centerY + 15); ctx.beginPath(); ctx.moveTo(centerX, 0); ctx.lineTo(centerX, mathCanvas.height); ctx.stroke(); ctx.beginPath(); ctx.moveTo(centerX - 5, 10); ctx.lineTo(centerX, 0); ctx.lineTo(centerX + 5, 10); ctx.fill(); ctx.font = `600 12px Montserrat`; ctx.fillText('y', centerX + 15, 15); ctx.font = `400 12px Montserrat`; ctx.fillText('0', centerX - 10, centerY + 10); const calculateOptimalTickInterval = (maxUnits) =&gt; { if (maxUnits &lt;= 0) return 1; const roughInterval = maxUnits / 5; const exp = Math.floor(Math.log10(roughInterval)); const powerOf10 = Math.pow(10, exp); if (roughInterval / powerOf10 &lt; 2) return powerOf10; if (roughInterval / powerOf10 &lt; 5) return powerOf10 * 2; return powerOf10 * 5; }; const tickIntervalX = calculateOptimalTickInterval((mathCanvas.width / currentPixelsPerUnit) / 2); const tickIntervalY = calculateOptimalTickInterval((mathCanvas.height / currentPixelsPerUnit) / 2); ctx.fillStyle = colors.main; ctx.textAlign = 'center'; ctx.textBaseline = 'top'; for (let i = Math.floor(-centerX / currentPixelsPerUnit / tickIntervalX); i &lt;= Math.ceil((mathCanvas.width - centerX) / currentPixelsPerUnit / tickIntervalX); i++) { const value = i * tickIntervalX; if (value === 0) continue; const px = centerX + value * currentPixelsPerUnit; if (px &gt; 0 &amp;&amp; px &lt; mathCanvas.width) { ctx.font = `400 12px Montserrat`; ctx.fillText(Math.abs(value) &lt; 0.001 &amp;&amp; value !== 0 ? value.toExponential(0) : value.toFixed(tickIntervalX &lt; 1 ? 2 : 0), px, centerY + 5); } } ctx.textAlign = 'right'; ctx.textBaseline = 'middle'; for (let i = Math.floor(-(mathCanvas.height - centerY) / currentPixelsPerUnit / tickIntervalY); i &lt;= Math.ceil(centerY / currentPixelsPerUnit / tickIntervalY); i++) { const value = i * tickIntervalY; if (value === 0) continue; const py = centerY - value * currentPixelsPerUnit; if (py &gt; 0 &amp;&amp; py &lt; mathCanvas.height) { ctx.font = `400 12px Montserrat`; ctx.fillText(Math.abs(value) &lt; 0.001 &amp;&amp; value !== 0 ? value.toExponential(0) : value.toFixed(tickIntervalY &lt; 1 ? 2 : 0), centerX - 5, py); } } graphInputs.forEach(inputItem =&gt; { const inputValue = inputItem.value; const inputColor = inputItem.color; const cleanInput = inputValue.replace(/\s+/g, ''); const linearEqMatch = cleanInput.toLowerCase().match(/^y=([+\-]?\d*\.?\d*)?(x)?([+\-]?\d*\.?\d*)?$/); const parabolaYEqMatch = cleanInput.toLowerCase().match(/^y=([+\-]?\d*\.?\d*)?x\^2([+\-]?\d*\.?\d*)?(x)?([+\-]?\d*\.?\d*)?$/); const parabolaXEqMatch = cleanInput.toLowerCase().match(/^x=([+\-]?\d*\.?\d*)?y\^2([+\-]?\d*\.?\d*)?(y)?([+\-]?\d*\.?\d*)?$/); const pointsMatch = cleanInput.match(/^\((-?\d+\.?\d*)\s*,\s*(-?\d+\.?\d*)\)(,\s*\(-?\d+\.?\d*\s*,\s*-?\d+\.?\d*\))*\s*$/); if (linearEqMatch) { let m = 0; let b = 0; const mPart = linearEqMatch[1]; const hasX = linearEqMatch[2]; const bPart = linearEqMatch[3]; if (hasX) { m = (mPart === '') ? 1 : (mPart === '-') ? -1 : parseFloat(mPart); if (isNaN(m)) m = 0; } if (bPart) { b = parseFloat(bPart); if (isNaN(b)) b = 0; } if (!hasX &amp;&amp; !bPart &amp;&amp; cleanInput === 'y=') { m = 0; b = 0; } ctx.strokeStyle = inputColor; ctx.lineWidth = 2; ctx.beginPath(); for (let px = 0; px &lt;= mathCanvas.width; px++) { const x_math = (px - centerX) / currentPixelsPerUnit; const y_math = m * x_math + b; const canvasY = centerY - y_math * currentPixelsPerUnit; if (canvasY &gt; -1000 &amp;&amp; canvasY &lt; mathCanvas.height + 1000) { if (px === 0) { ctx.moveTo(px, canvasY); } else { ctx.lineTo(px, canvasY); } } else if (px &gt; 0) { ctx.stroke(); ctx.beginPath(); } } ctx.stroke(); } else if (parabolaYEqMatch) { let a = 0, b_coeff = 0, c_const = 0; const aPart = parabolaYEqMatch[1]; const bPart = parabolaYEqMatch[2]; const hasLinearX = parabolaYEqMatch[3]; const cPart = parabolaYEqMatch[4]; a = (aPart === '') ? 1 : (aPart === '-') ? -1 : parseFloat(aPart); if (isNaN(a)) a = 0; if (hasLinearX) { b_coeff = (bPart === '') ? 1 : (bPart === '-') ? -1 : parseFloat(bPart); if (isNaN(b_coeff)) b_coeff = 0; } else if (bPart) { c_const = parseFloat(bPart); if (isNaN(c_const)) c_const = 0; } if (cPart) { c_const = parseFloat(cPart); if (isNaN(c_const)) c_const = 0; } ctx.strokeStyle = inputColor; ctx.lineWidth = 2; ctx.beginPath(); for (let px = 0; px &lt;= mathCanvas.width; px++) { const x_math = (px - centerX) / currentPixelsPerUnit; const y_math = a * Math.pow(x_math, 2) + b_coeff * x_math + c_const; const canvasY = centerY - y_math * currentPixelsPerUnit; if (canvasY &gt; -1000 &amp;&amp; canvasY &lt; mathCanvas.height + 1000) { if (px === 0) { ctx.moveTo(px, canvasY); } else { ctx.lineTo(px, canvasY); } } else if (px &gt; 0) { ctx.stroke(); ctx.beginPath(); } } ctx.stroke(); } else if (parabolaXEqMatch) { let a = 0, b_coeff = 0, c_const = 0; const aPart = parabolaXEqMatch[1]; const bPart = parabolaXEqMatch[2]; const hasLinearY = parabolaXEqMatch[3]; const cPart = parabolaXEqMatch[4]; a = (aPart === '') ? 1 : (aPart === '-') ? -1 : parseFloat(aPart); if (isNaN(a)) a = 0; if (hasLinearY) { b_coeff = (bPart === '') ? 1 : (bPart === '-') ? -1 : parseFloat(bPart); if (isNaN(b_coeff)) b_coeff = 0; } else if (bPart) { c_const = parseFloat(bPart); if (isNaN(c_const)) c_const = 0; } if (cPart) { c_const = parseFloat(cPart); if (isNaN(c_const)) c_const = 0; } ctx.strokeStyle = inputColor; ctx.lineWidth = 2; ctx.beginPath(); for (let py = 0; py &lt;= mathCanvas.height; py++) { const y_math = (centerY - py) / currentPixelsPerUnit;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>const x_math = a * Math.pow(y_math, 2) + b_coeff * y_math + c_const;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>const canvasX = centerX + x_math * currentPixelsPerUnit;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>if (canvasX &gt; -1000 &amp;&amp; canvasX &lt; mathCanvas.width + 1000) {</p>
<p class="p1"><span class="Apple-converted-space">                            </span>if (py === 0) { ctx.moveTo(canvasX, py); } else { ctx.lineTo(canvasX, py); }</p>
<p class="p1"><span class="Apple-converted-space">                        </span>} else if (py &gt; 0) {</p>
<p class="p1"><span class="Apple-converted-space">                            </span>ctx.stroke();</p>
<p class="p1"><span class="Apple-converted-space">                            </span>ctx.beginPath();</p>
<p class="p1"><span class="Apple-converted-space">                        </span>}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>ctx.stroke();</p>
<p class="p1"><span class="Apple-converted-space">                </span>} else if (pointsMatch) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>ctx.fillStyle = inputColor;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>ctx.font = `400 12px Montserrat`;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>ctx.textAlign = 'left';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>ctx.textBaseline = 'bottom';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const pointRegex = /\((-?\d+\.?\d*)\s*,\s*(-?\d+\.?\d*)\)/g;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>let match;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>while ((match = pointRegex.exec(cleanInput)) !== null) {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>const x_math = parseFloat(match[1]);</p>
<p class="p1"><span class="Apple-converted-space">                        </span>const y_math = parseFloat(match[2]);</p>
<p class="p1"><span class="Apple-converted-space">                        </span>if (!isNaN(x_math) &amp;&amp; !isNaN(y_math)) {</p>
<p class="p1"><span class="Apple-converted-space">                            </span>const canvasX = centerX + x_math * currentPixelsPerUnit;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>const canvasY = centerY - y_math * currentPixelsPerUnit;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>ctx.beginPath();</p>
<p class="p1"><span class="Apple-converted-space">                            </span>ctx.arc(canvasX, canvasY, 4, 0, Math.PI * 2);</p>
<p class="p1"><span class="Apple-converted-space">                            </span>ctx.fill();</p>
<p class="p1"><span class="Apple-converted-space">                            </span>const labelText = `(${x_math}, ${y_math})`;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>ctx.fillText(labelText, canvasX + 8, canvasY - 8);</p>
<p class="p1"><span class="Apple-converted-space">                        </span>}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>} else if (inputValue.trim() !== '') {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>showMessage(`Could not parse input: "${inputValue}". Try "y = mx + b", "y = ax^2 + bx + c", "x = ay^2 + by + c", or "(x,y)".`, 5000);</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>function parseCoordinates(coordString) { const vertices = []; const regex = /\((-?\d+\.?\d*)\s*,\s*(-?\d+\.?\d*)\)/g; let match; while ((match = regex.exec(coordString)) !== null) { const x = parseFloat(match[1]); const y = parseFloat(match[2]); if (!isNaN(x) &amp;&amp; !isNaN(y)) { vertices.push({ x, y }); } else { showMessage(`Invalid coordinate in list: "${match[0]}". Must be (number,number).`, 5000); return []; } } if (vertices.length &lt; 2 &amp;&amp; coordString.trim() !== '') { showMessage("Please enter at least two valid coordinates for a polygon.", 5000); return []; } return vertices; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>function applyTransformations(vertices, transformations, rotationOrigin = null) { let transformed = JSON.parse(JSON.stringify(vertices)); transformed = transformed.map(v =&gt; ({ x: v.x + transformations.translateX, y: v.y + transformations.translateY })); let currentRotationCenterX, currentRotationCenterY; if (rotationOrigin &amp;&amp; !isNaN(rotationOrigin.x) &amp;&amp; !isNaN(rotationOrigin.y)) { currentRotationCenterX = rotationOrigin.x; currentRotationCenterY = rotationOrigin.y; } else { let minX = Infinity, maxX = -Infinity, minY = Infinity, maxY = -Infinity; transformed.forEach(v =&gt; { minX = Math.min(minX, v.x); maxX = Math.max(maxX, v.x); minY = Math.min(minY, v.y); maxY = Math.max(maxY, v.y); }); currentRotationCenterX = (minX + maxX) / 2; currentRotationCenterY = (minY + maxY) / 2; } if (transformations.rotateAngle !== 0) { const angleRad = transformations.rotateAngle * Math.PI / 180; transformed = transformed.map(v =&gt; { const translatedX = v.x - currentRotationCenterX; const translatedY = v.y - currentRotationCenterY; const rotatedX = translatedX * Math.cos(angleRad) - translatedY * Math.sin(angleRad); const rotatedY = translatedX * Math.sin(angleRad) + translatedY * Math.cos(angleRad); return { x: rotatedX + currentRotationCenterX, y: rotatedY + currentRotationCenterY }; }); } if (transformations.flipX) { transformed = transformed.map(v =&gt; ({ x: v.x, y: -v.y })); } if (transformations.flipY) { transformed = transformed.map(v =&gt; ({ x: -v.x, y: v.y })); } if (transformations.flipYEqualsX) { transformed = transformed.map(v =&gt; ({ x: v.y, y: v.x })); } return transformed; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>function drawPolygon(vertices, color, currentPixelsPerUnit, centerX, centerY) { if (vertices.length &lt; 2) return; ctx.strokeStyle = color; ctx.lineWidth = 2; ctx.beginPath(); let canvasX = centerX + vertices[0].x * currentPixelsPerUnit; let canvasY = centerY - vertices[0].y * currentPixelsPerUnit; ctx.moveTo(canvasX, canvasY); for (let i = 1; i &lt; vertices.length; i++) { canvasX = centerX + vertices[i].x * currentPixelsPerUnit; canvasY = centerY - vertices[i].y * currentPixelsPerUnit; ctx.lineTo(canvasX, canvasY); } ctx.closePath(); ctx.stroke(); ctx.fillStyle = color; vertices.forEach(v =&gt; { const pointCanvasX = centerX + v.x * currentPixelsPerUnit; const pointCanvasY = centerY - v.y * currentPixelsPerUnit; ctx.beginPath(); ctx.arc(pointCanvasX, pointCanvasY, 3, 0, Math.PI * 2); ctx.fill(); }); }</p>
<p class="p1"><span class="Apple-converted-space">        </span>function drawShapeTransformationTool() { drawGraphingCalculator([], pixelsPerUnit); const translateX = parseFloat(document.getElementById('translateX')?.value) || 0; const translateY = parseFloat(document.getElementById('translateY')?.value) || 0; const rotateAngle = parseFloat(document.getElementById('rotateAngle')?.value) || 0; const flipX = document.getElementById('flipX')?.checked; const flipY = document.getElementById('flipY')?.checked; const flipYEqualsX = document.getElementById('flipYEqualsX')?.checked; const rotateOriginX = parseFloat(document.getElementById('rotateOriginX')?.value); const rotateOriginY = parseFloat(document.getElementById('rotateOriginY')?.value);</p>
<p class="p1">let customRotationOrigin = null;</p>
<p class="p1">if (!isNaN(rotateOriginX) &amp;&amp; !isNaN(rotateOriginY)) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>customRotationOrigin = { x: rotateOriginX, y: rotateOriginY };</p>
<p class="p1">}</p>
<p class="p1">shapeTransformations = { translateX, translateY, rotateAngle, flipX, flipY, flipYEqualsX };</p>
<p class="p1">let verticesToDraw = [];</p>
<p class="p1">const polygonInput = document.getElementById('polygonInput');</p>
<p class="p1">if (polygonInput &amp;&amp; polygonInput.value.trim() !== '') {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const parsed = parseCoordinates(polygonInput.value);</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (parsed.length &gt; 0) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>originalShapeVertices = parsed;</p>
<p class="p1"><span class="Apple-converted-space">    </span>} else if (originalShapeVertices.length === 0) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>originalShapeVertices = parseCoordinates(quickShapeCoordinates.square);</p>
<p class="p1"><span class="Apple-converted-space">        </span>polygonInput.value = quickShapeCoordinates.square;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1">} else if (originalShapeVertices.length === 0) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>originalShapeVertices = parseCoordinates(quickShapeCoordinates.square);</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (polygonInput) polygonInput.value = quickShapeCoordinates.square;</p>
<p class="p1">}</p>
<p class="p1">currentShapeVertices = applyTransformations(originalShapeVertices, shapeTransformations, customRotationOrigin);</p>
<p class="p1">drawPolygon(currentShapeVertices, colors.main, pixelsPerUnit, mathCanvas.width / 2, mathCanvas.height / 2);</p>
<p class="p1">}</p>
<p class="p1">function addGraphLineInput(initialValue = '') { const equationLinesContainer = document.getElementById('equationLinesContainer'); if (!equationLinesContainer) return; const newLineDiv = document.createElement('div'); newLineDiv.className = 'flex items-center gap-2 w-full mb-2'; const inputId = `eq_line_${Date.now()}_${Math.random().toString(36).substring(7)}`; const defaultColor = defaultLineColors[nextLineColorIndex % defaultLineColors.length]; nextLineColorIndex++; newLineDiv.innerHTML = `&lt;input type="text" id="${inputId}" value="${initialValue}" placeholder="y = mx + b or (x,y)" class="flex-grow p-2 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition text-sm font-normal"&gt;&lt;input type="color" id="color_${inputId}" value="${defaultColor}" class="w-8 h-8 rounded-md cursor-pointer"&gt;&lt;button type="button" class="remove-line-button"&gt;&amp;times;&lt;/button&gt;`; equationLinesContainer.appendChild(newLineDiv); const newInput = document.getElementById(inputId); const removeButton = newLineDiv.querySelector('.remove-line-button'); const colorInput = document.getElementById(`color_${inputId}`); newInput.addEventListener('input', handleDraw); if (colorInput) { colorInput.addEventListener('input', handleDraw); } if (removeButton) { removeButton.addEventListener('click', () =&gt; { newLineDiv.remove(); handleDraw(); if (equationLinesContainer.children.length === 0) { addGraphLineInput(); } }); } newInput.focus(); }</p>
<p class="p1">function zoomGraph(factor) { return function() { pixelsPerUnit = pixelsPerUnit * factor; handleDraw(); }; }</p>
<p class="p2"><br></p>
<p class="p1">// --- ANIMATION &amp; EVENT HANDLERS ---</p>
<p class="p1">function animate3D() { animationFrameId = requestAnimationFrame(animate3D); if (shapeDisplayFullWidth.classList.contains('hidden-mode')) return; if (controls) controls.update(); if (renderer) renderer.render(scene, camera); if (labelRenderer) labelRenderer.render(scene, camera); }</p>
<p class="p1">function onWindowResize() { setTimeout(handleDraw, 150); }</p>
<p class="p1">function handleModeChange() {</p>
<p class="p1"><span class="Apple-converted-space">    </span>currentMode = modeSelector.value;</p>
<p class="p1"><span class="Apple-converted-space">    </span>pixelsPerUnit = 50;</p>
<p class="p1"><span class="Apple-converted-space">    </span>setupInputsForMode(currentMode);</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">// --- MASTER CONTROL FUNCTIONS ---</p>
<p class="p1">function setupInputsForMode(mode) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const isManipulative = manipulativeModes.includes(mode);</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Hide all major layouts first</p>
<p class="p1"><span class="Apple-converted-space">    </span>oldToolLayout.classList.add('hidden');</p>
<p class="p1"><span class="Apple-converted-space">    </span>newToolLayout.classList.add('hidden');</p>
<p class="p1"><span class="Apple-converted-space">    </span>manipulativeLayout.classList.add('hidden');</p>
<p class="p1"><span class="Apple-converted-space">    </span>dimensionInputsInline.innerHTML = ''; // Clear old inputs</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Show the correct major layout and delegate setup</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (isManipulative) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>manipulativeLayout.classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">        </span>manipulative_handleMasterModeChange();<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">        </span>oldToolLayout.classList.toggle('hidden', newCanvasModes.includes(mode));</p>
<p class="p1"><span class="Apple-converted-space">        </span>newToolLayout.classList.toggle('hidden', !newCanvasModes.includes(mode));</p>
<p class="p1"><span class="Apple-converted-space">        </span>oldToolLayout.classList.toggle('layout-side-by-side', sideBySideModes.includes(mode));</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>graphingInputsPanel.innerHTML = '';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>menuToggleBtn.classList.add('toggle-on');</p>
<p class="p1"><span class="Apple-converted-space">        </span>menuToggleBtn.classList.remove('toggle-off');</p>
<p class="p1"><span class="Apple-converted-space">        </span>menuToggleDot.classList.add('dot-on');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>if (newCanvasModes.includes(mode)) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>answerToggleContainer.classList.add('hidden');</p>
<p class="p1"><span class="Apple-converted-space">            </span>zoomControls.classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">            </span>graphingInputsPanel.classList.remove('panel-hidden');</p>
<p class="p1"><span class="Apple-converted-space">            </span>graphingCanvasWrapper.classList.remove('canvas-expanded');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>switch (mode) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>case 'graphingCalculator':</p>
<p class="p1"><span class="Apple-converted-space">                    </span>graphingInputsPanel.innerHTML = inputTemplates.graphingCalculatorInputs;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const equationLinesContainer = document.getElementById('equationLinesContainer');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (equationLinesContainer) { equationLinesContainer.innerHTML = ''; }</p>
<p class="p1"><span class="Apple-converted-space">                    </span>addGraphLineInput('y = 0.5x + 1');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>addGraphLineInput('(1, 2)');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>addGraphLineInput();</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const addLineButton = document.createElement('button');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>addLineButton.textContent = 'Add Line';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>addLineButton.className = 'bg-blue-500 text-white font-semibold py-2 px-3 rounded-lg hover:bg-blue-600 transition-transform transform hover:scale-105 active:scale-100 shadow-md text-sm md:text-base mt-2';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>addLineButton.onclick = () =&gt; addGraphLineInput();</p>
<p class="p1"><span class="Apple-converted-space">                    </span>graphingInputsPanel.appendChild(addLineButton);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>break;</p>
<p class="p1"><span class="Apple-converted-space">                </span>case 'shapeTransformationTool':</p>
<p class="p1"><span class="Apple-converted-space">                    </span>graphingInputsPanel.innerHTML = inputTemplates.shapeTransformationToolInputs;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const shapeToolInputs = ['polygonInput', 'translateX', 'translateY', 'rotateAngle', 'rotateOriginX', 'rotateOriginY'];</p>
<p class="p1"><span class="Apple-converted-space">                    </span>shapeToolInputs.forEach(id =&gt; { const element = document.getElementById(id); if (element) { element.addEventListener('input', handleDraw); } });</p>
<p class="p1"><span class="Apple-converted-space">                    </span>document.querySelectorAll('input[name="flipAxis"]').forEach(radio =&gt; { radio.addEventListener('change', handleDraw); });</p>
<p class="p1"><span class="Apple-converted-space">                    </span>document.getElementById('squareQuickShape')?.addEventListener('click', () =&gt; { document.getElementById('polygonInput').value = quickShapeCoordinates.square; originalShapeVertices = parseCoordinates(quickShapeCoordinates.square); handleDraw(); });</p>
<p class="p1"><span class="Apple-converted-space">                    </span>document.getElementById('triangleQuickShape')?.addEventListener('click', () =&gt; { document.getElementById('polygonInput').value = quickShapeCoordinates.triangle; originalShapeVertices = parseCoordinates(quickShapeCoordinates.triangle); handleDraw(); });</p>
<p class="p1"><span class="Apple-converted-space">                    </span>document.getElementById('rectangleQuickShape')?.addEventListener('click', () =&gt; { document.getElementById('polygonInput').value = quickShapeCoordinates.rectangle; originalShapeVertices = parseCoordinates(quickShapeCoordinates.rectangle); handleDraw(); });</p>
<p class="p1"><span class="Apple-converted-space">                    </span>document.getElementById('rhombusQuickShape')?.addEventListener('click', () =&gt; { document.getElementById('polygonInput').value = quickShapeCoordinates.rhombus; originalShapeVertices = parseCoordinates(quickShapeCoordinates.rhombus); handleDraw(); });</p>
<p class="p1"><span class="Apple-converted-space">                    </span>document.getElementById('applyShapeTransform').addEventListener('click', handleDraw);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>document.getElementById('resetShapeTransform').addEventListener('click', () =&gt; { document.getElementById('translateX').value = 0; document.getElementById('translateY').value = 0; document.getElementById('rotateAngle').value = 0; document.getElementById('rotateOriginX').value = ''; document.getElementById('rotateOriginY').value = ''; document.getElementById('flipNone').checked = true; currentShapeVertices = []; originalShapeVertices = []; document.getElementById('polygonInput').value = "(1,1),(2,1),(2,2),(1,2)"; handleDraw(); });</p>
<p class="p1"><span class="Apple-converted-space">                    </span>break;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>zoomInButton = document.getElementById('zoomInButton');</p>
<p class="p1"><span class="Apple-converted-space">            </span>zoomOutButton = document.getElementById('zoomOutButton');</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (zoomInButton) zoomInButton.onclick = zoomGraph(1.2);</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (zoomOutButton) zoomOutButton.onclick = zoomGraph(1 / 1.2);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">            </span>answerToggleContainer.classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">            </span>zoomControls.classList.add('hidden');</p>
<p class="p1"><span class="Apple-converted-space">            </span>shapeDisplayFullWidth.classList.add('hidden-mode');</p>
<p class="p1"><span class="Apple-converted-space">            </span>shapeDisplay2D.classList.add('hidden-mode');</p>
<p class="p1"><span class="Apple-converted-space">            </span>equationDisplayContainer.classList.add('hidden-mode');</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>const is3DMode = mode.includes('volumeOf') || (mode.includes('surfaceAreaOf') &amp;&amp; !mode.includes('netOf'));</p>
<p class="p1"><span class="Apple-converted-space">            </span>const is2DMode = mode.includes('netOf') || ['simpleAngle', 'correspondingAngles', 'areaOfRectangle', 'perimeterOfRectangle', 'areaOfTriangle', 'perimeterOfTriangle', 'areaOfCircle', 'circumferenceOfCircle'].includes(mode);</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>if (is3DMode) shapeDisplayFullWidth.classList.remove('hidden-mode');</p>
<p class="p1"><span class="Apple-converted-space">            </span>else if (is2DMode) shapeDisplay2D.classList.remove('hidden-mode');</p>
<p class="p1"><span class="Apple-converted-space">            </span>else equationDisplayContainer.classList.remove('hidden-mode');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>calculationStepsColumn.classList.toggle('hidden-mode', visualDisplayOnlyModes.includes(mode));</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>dimensionInputsInline.innerHTML = inputTemplates[mode] || '';</p>
<p class="p1"><span class="Apple-converted-space">            </span>dimensionInputsInline.querySelectorAll('input, textarea, select').forEach(input =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>input.addEventListener('input', handleDraw);</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>if (mode === 'tableEquation') {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const tableContainer = document.getElementById('table-container');</p>
<p class="p1"><span class="Apple-converted-space">                </span>function addRow(xVal = '', yVal = '') {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const rowDiv = document.createElement('div');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>rowDiv.className = 'flex items-center gap-2 mt-2';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>rowDiv.innerHTML = `&lt;label class="text-sm font-semibold text-slate-700"&gt;x:&lt;/label&gt;&lt;input type="number" value="${xVal}" class="table-x w-16 p-1 border-2 border-slate-300 rounded-lg text-center"&gt;&lt;label class="text-sm font-semibold text-slate-700"&gt;y:&lt;/label&gt;&lt;input type="number" value="${yVal}" class="table-y w-16 p-1 border-2 border-slate-300 rounded-lg text-center"&gt;&lt;button class="remove-table-row bg-red-500 text-white font-bold py-1 px-2 rounded-lg text-xs"&gt;-&lt;/button&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>tableContainer.appendChild(rowDiv);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>rowDiv.querySelector('.remove-table-row').addEventListener('click', () =&gt; { rowDiv.remove(); handleDraw(); });</p>
<p class="p1"><span class="Apple-converted-space">                    </span>rowDiv.querySelectorAll('input').forEach(input =&gt; input.addEventListener('input', handleDraw));</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>document.getElementById('add-table-row').addEventListener('click', () =&gt; addRow());</p>
<p class="p1"><span class="Apple-converted-space">                </span>addRow(3, 9); addRow(5, 15);</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>if (['lineGraph', 'barGraph', 'pictograph'].includes(mode)) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const container = document.getElementById('graph-data-container');</p>
<p class="p1"><span class="Apple-converted-space">                </span>let rowHtml = '';</p>
<p class="p1"><span class="Apple-converted-space">                </span>switch(mode) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>case 'lineGraph': rowHtml = `&lt;div class="flex items-center gap-2 mt-2"&gt;&lt;label&gt;Year:&lt;/label&gt;&lt;input type="text" class="graph-label w-24 p-1 border-2 rounded-lg text-center" value="2023"&gt;&lt;label&gt;Value:&lt;/label&gt;&lt;input type="number" class="graph-value w-16 p-1 border-2 rounded-lg text-center" value="10"&gt;&lt;button class="remove-row-btn bg-red-500 text-white font-bold py-1 px-2 rounded-lg text-xs"&gt;-&lt;/button&gt;&lt;/div&gt;`; break;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>case 'barGraph': case 'pictograph': rowHtml = `&lt;div class="flex items-center gap-2 mt-2"&gt;&lt;label&gt;Label:&lt;/label&gt;&lt;input type="text" class="graph-label w-24 p-1 border-2 rounded-lg" value="Category"&gt;&lt;label&gt;Value:&lt;/label&gt;&lt;input type="number" class="graph-value w-16 p-1 border-2 rounded-lg text-center" value="10"&gt;&lt;button class="remove-row-btn bg-red-500 text-white font-bold py-1 px-2 rounded-lg text-xs"&gt;-&lt;/button&gt;&lt;/div&gt;`; break;</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>const addRow = () =&gt; { const rowDiv = document.createElement('div'); rowDiv.innerHTML = rowHtml; rowDiv.querySelectorAll('input').forEach(i =&gt; i.addEventListener('input', handleDraw)); rowDiv.querySelector('.remove-row-btn').addEventListener('click', () =&gt; { rowDiv.remove(); handleDraw(); }); container.appendChild(rowDiv); };</p>
<p class="p1"><span class="Apple-converted-space">                </span>document.getElementById('add-graph-row').addEventListener('click', addRow);</p>
<p class="p1"><span class="Apple-converted-space">                </span>addRow(); if(mode === 'lineGraph') { addRow(); addRow(); }</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>handleDraw();</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function handleDraw() {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const mode = modeSelector.value;</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (manipulativeModes.includes(mode)) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>manipulative_handleDraw();</p>
<p class="p1"><span class="Apple-converted-space">        </span>return;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>if (newCanvasModes.includes(mode)) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>const parent = mathCanvas.parentElement;</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (parent &amp;&amp; (mathCanvas.width !== parent.clientWidth || mathCanvas.height !== parent.clientHeight)) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>mathCanvas.width = parent.clientWidth;</p>
<p class="p1"><span class="Apple-converted-space">            </span>mathCanvas.height = parent.clientHeight;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>switch (mode) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>case 'graphingCalculator':</p>
<p class="p1"><span class="Apple-converted-space">                </span>let graphInputs = [];</p>
<p class="p1"><span class="Apple-converted-space">                </span>const container = document.getElementById('equationLinesContainer');</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (container) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>Array.from(container.children).forEach(lineDiv =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>const eqInput = lineDiv.querySelector('input[type="text"]');</p>
<p class="p1"><span class="Apple-converted-space">                        </span>const colorInput = lineDiv.querySelector('input[type="color"]');</p>
<p class="p1"><span class="Apple-converted-space">                        </span>if (eqInput &amp;&amp; eqInput.value.trim() !== '') {</p>
<p class="p1"><span class="Apple-converted-space">                            </span>graphInputs.push({ value: eqInput.value.trim(), color: colorInput ? colorInput.value : '#000000' });</p>
<p class="p1"><span class="Apple-converted-space">                        </span>}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>});</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>drawGraphingCalculator(graphInputs, pixelsPerUnit);</p>
<p class="p1"><span class="Apple-converted-space">                </span>break;</p>
<p class="p1"><span class="Apple-converted-space">            </span>case 'shapeTransformationTool':</p>
<p class="p1"><span class="Apple-converted-space">                </span>drawShapeTransformationTool();</p>
<p class="p1"><span class="Apple-converted-space">                </span>break;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">        </span>let stepsToDisplay = [];</p>
<p class="p1"><span class="Apple-converted-space">        </span>let displayContent = '';</p>
<p class="p1"><span class="Apple-converted-space">        </span>stepsContentContainer.innerHTML = '';</p>
<p class="p1"><span class="Apple-converted-space">        </span>equationDisplay.innerHTML = '';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>try {</p>
<p class="p1"><span class="Apple-converted-space">            </span>switch (mode) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>case 'simpleAngle': { const angle = parseFloat(document.getElementById('angleValue')?.value); drawSimpleAngle(angle); stepsToDisplay = calculateSimpleAngleSteps(angle); break; }</p>
<p class="p1"><span class="Apple-converted-space">                </span>case 'correspondingAngles': { const angle = parseFloat(document.getElementById('corrAngleValue')?.value); const isMystery = document.getElementById('mysteryAngleToggle')?.checked; drawCorrespondingAngles(angle, isMystery); stepsToDisplay = calculateCorrespondingAnglesSteps(angle, isMystery); break; }</p>
<p class="p1"><span class="Apple-converted-space">                </span>case 'volumeOfTriangularPrism': { const b = parseFloat(document.getElementById('triangleBase')?.value), h = parseFloat(document.getElementById('triangleHeight')?.value), l = parseFloat(document.getElementById('prismLength')?.value); if (b &gt; 0 &amp;&amp; h &gt; 0 &amp;&amp; l &gt; 0) { drawTriangularPrism3D(b, h, l); stepsToDisplay = calculateTriangularPrismVolumeSteps(b, h, l); } else { stepsToDisplay = ["Enter positive dimensions."]; } break; }</p>
<p class="p1"><span class="Apple-converted-space">                </span>case 'surfaceAreaOfTriangularPrism': { const b = parseFloat(document.getElementById('saTriBase')?.value), h = parseFloat(document.getElementById('saTriHeight')?.value), s1 = parseFloat(document.getElementById('saTriSide1')?.value), s2 = parseFloat(document.getElementById('saTriSide2')?.value), s3 = parseFloat(document.getElementById('saTriSide3')?.value), H = parseFloat(document.getElementById('saPrismHeight')?.value); if (b &gt; 0 &amp;&amp; h &gt; 0 &amp;&amp; s1 &gt; 0 &amp;&amp; s2 &gt; 0 &amp;&amp; s3 &gt; 0 &amp;&amp; H &gt; 0) { drawTriangularPrism3D(b, h, H); stepsToDisplay = calculateTriangularPrismSurfaceAreaSteps(b, h, s1, s2, s3, H); } else { stepsToDisplay = ["Enter positive dimensions."]; } break; }</p>
<p class="p1"><span class="Apple-converted-space">                </span>case 'netOfTriangularPrism': { const b = parseFloat(document.getElementById('netTriBase')?.value), h = parseFloat(document.getElementById('netTriHeight')?.value), l = parseFloat(document.getElementById('netPrismLength')?.value); if (b &gt; 0 &amp;&amp; h &gt; 0 &amp;&amp; l &gt; 0) { drawTriangularPrismNet2D(b, h, l); stepsToDisplay = ["Net diagram of a triangular prism."]; } else { stepsToDisplay = ["Enter positive dimensions."]; } break; }</p>
<p class="p1"><span class="Apple-converted-space">                </span>case 'volumeOfRectangularPrism': { const b = parseFloat(document.getElementById('rectBase')?.value), h = parseFloat(document.getElementById('rectHeightBase')?.value), d = parseFloat(document.getElementById('rectDepthPrism')?.value); if (b &gt; 0 &amp;&amp; h &gt; 0 &amp;&amp; d &gt; 0) { drawRectangularPrism3D(b, h, d); stepsToDisplay = calculateRectangularPrismVolumeSteps(b, h, d); } else { stepsToDisplay = ["Enter positive dimensions."]; } break; }</p>
<p class="p1"><span class="Apple-converted-space">                </span>case 'surfaceAreaOfRectangularPrism': { const w = parseFloat(document.getElementById('saRectWidth')?.value), d = parseFloat(document.getElementById('saRectDepth')?.value), h = parseFloat(document.getElementById('saRectHeight')?.value); if (w &gt; 0 &amp;&amp; d &gt; 0 &amp;&amp; h &gt; 0) { drawRectangularPrism3D(w, h, d); stepsToDisplay = calculateRectangularPrismSurfaceAreaSteps(w, h, d); } else { stepsToDisplay = ["Enter positive dimensions."]; } break; }</p>
<p class="p1"><span class="Apple-converted-space">                </span>case 'netOfRectangularPrism': { const b = parseFloat(document.getElementById('netRectBase')?.value), h = parseFloat(document.getElementById('netRectHeight')?.value), d = parseFloat(document.getElementById('netRectDepth')?.value); if (b &gt; 0 &amp;&amp; h &gt; 0 &amp;&amp; d &gt; 0) { drawRectangularPrismNet2D(b, h, d); stepsToDisplay = ["Net diagram of a rectangular prism."]; } else { stepsToDisplay = ["Enter positive dimensions."]; } break; }</p>
<p class="p1"><span class="Apple-converted-space">                </span>case 'volumeOfCylinder': { const r = parseFloat(document.getElementById('cylinderRadius')?.value), h = parseFloat(document.getElementById('cylinderHeight')?.value); if (r &gt; 0 &amp;&amp; h &gt; 0) { drawCylinder3D(r, h); stepsToDisplay = calculateCylinderVolumeSteps(r, h); } else { stepsToDisplay = ["Enter positive dimensions."]; } break; }</p>
<p class="p1"><span class="Apple-converted-space">                </span>case 'surfaceAreaOfCylinder': { const r = parseFloat(document.getElementById('saCylinderRadius')?.value), h = parseFloat(document.getElementById('saCylinderHeight')?.value); if (r &gt; 0 &amp;&amp; h &gt; 0) { drawCylinder3D(r, h); stepsToDisplay = calculateCylinderSurfaceAreaSteps(r, h); } else { stepsToDisplay = ["Enter positive dimensions."]; } break; }</p>
<p class="p1"><span class="Apple-converted-space">                </span>case 'netOfCylinder': { const r = parseFloat(document.getElementById('netCylinderRadius')?.value), h = parseFloat(document.getElementById('netCylinderHeight')?.value); if (r &gt; 0 &amp;&amp; h &gt; 0) { drawCylinderNet2D(r, h); stepsToDisplay = ["Net diagram of a cylinder."]; } else { stepsToDisplay = ["Enter positive dimensions."]; } break; }</p>
<p class="p1"><span class="Apple-converted-space">                </span>case 'volumeOfCone': { const r = parseFloat(document.getElementById('coneRadius')?.value), h = parseFloat(document.getElementById('coneHeight')?.value); if (r &gt; 0 &amp;&amp; h &gt; 0) { drawCone3D(r, h); stepsToDisplay = calculateConeVolumeSteps(r, h); } else { stepsToDisplay = ["Enter positive dimensions."]; } break; }</p>
<p class="p1"><span class="Apple-converted-space">                </span>case 'surfaceAreaOfCone': { const r = parseFloat(document.getElementById('coneSARadius')?.value), h = parseFloat(document.getElementById('coneSAHeight')?.value); if (r &gt; 0 &amp;&amp; h &gt; 0) { const l = Math.sqrt(r*r+h*h); document.getElementById('coneSASlantHeight').value = l.toFixed(2); drawCone3D(r,h,l); stepsToDisplay = calculateConeSurfaceAreaSteps(r, h); } else { stepsToDisplay = ["Enter positive dimensions."]; } break; }</p>
<p class="p1"><span class="Apple-converted-space">                </span>case 'netOfCone': { const r = parseFloat(document.getElementById('netConeRadius')?.value), h = parseFloat(document.getElementById('netConeHeight')?.value); if (r &gt; 0 &amp;&amp; h &gt; 0) { drawConeNet2D(r, h); stepsToDisplay = ["Net diagram of a cone."]; } else { stepsToDisplay = ["Enter positive dimensions."]; } break; }</p>
<p class="p1"><span class="Apple-converted-space">                </span>case 'volumeOfSquarePyramid': { const b = parseFloat(document.getElementById('pyramidBaseSide')?.value), h = parseFloat(document.getElementById('pyramidHeight')?.value); if (b &gt; 0 &amp;&amp; h &gt; 0) { drawSquarePyramid3D(b, h); stepsToDisplay = calculateSquarePyramidVolumeSteps(b, h); } else { stepsToDisplay = ["Enter positive dimensions."]; } break; }</p>
<p class="p1"><span class="Apple-converted-space">                </span>case 'surfaceAreaOfSquarePyramid': { const b = parseFloat(document.getElementById('pyramidSABaseSide')?.value), h = parseFloat(document.getElementById('pyramidSAHeight')?.value); if (b &gt; 0 &amp;&amp; h &gt; 0) { const l = Math.sqrt((b/2)**2+h**2); document.getElementById('pyramidSASlantHeight').value = l.toFixed(2); drawSquarePyramid3D(b,h,l); stepsToDisplay = calculateSquarePyramidSurfaceAreaSteps(b, h); } else { stepsToDisplay = ["Enter positive dimensions."]; } break; }</p>
<p class="p1"><span class="Apple-converted-space">     </span>case 'netOfSquarePyramid': { const b = parseFloat(document.getElementById('netPyramidBaseSide')?.value), h = parseFloat(document.getElementById('netPyramidHeight')?.value); if (b &gt; 0 &amp;&amp; h &gt; 0) { drawSquarePyramidNet2D(b, h); stepsToDisplay = ["Net diagram of a square pyramid."]; } else { stepsToDisplay = ["Enter positive dimensions."]; } break; }</p>
<p class="p1"><span class="Apple-converted-space">                </span>case 'areaOfRectangle': { const l = parseFloat(document.getElementById('rectAreaLength')?.value), w = parseFloat(document.getElementById('rectAreaWidth')?.value); if (l &gt; 0 &amp;&amp; w &gt; 0) { drawRectangle2D(l, w); stepsToDisplay = calculateRectangleAreaSteps(l, w); } else { stepsToDisplay = ["Enter positive dimensions."]; } break; }</p>
<p class="p1"><span class="Apple-converted-space">                </span>case 'perimeterOfRectangle': { const l = parseFloat(document.getElementById('rectPerimeterLength')?.value), w = parseFloat(document.getElementById('rectPerimeterWidth')?.value); if (l &gt; 0 &amp;&amp; w &gt; 0) { drawRectangle2D(l, w); stepsToDisplay = calculateRectanglePerimeterSteps(l, w); } else { stepsToDisplay = ["Enter positive dimensions."]; } break; }</p>
<p class="p1"><span class="Apple-converted-space">                </span>case 'areaOfTriangle': { const b = parseFloat(document.getElementById('triAreaBase')?.value), h = parseFloat(document.getElementById('triAreaHeight')?.value); if (b &gt; 0 &amp;&amp; h &gt; 0) { drawTriangle2D(b, h, null, mode); stepsToDisplay = calculateTriangleAreaSteps(b, h); } else { stepsToDisplay = ["Enter positive dimensions."]; } break; }</p>
<p class="p1"><span class="Apple-converted-space">                </span>case 'perimeterOfTriangle': { const sA = parseFloat(document.getElementById('triPerimeterSideA')?.value), sB = parseFloat(document.getElementById('triPerimeterSideB')?.value), sC = parseFloat(document.getElementById('triPerimeterSideC')?.value); if (sA &gt; 0 &amp;&amp; sB &gt; 0 &amp;&amp; sC &gt; 0) { drawTriangle2D(sA, sB, sC, mode); stepsToDisplay = calculateTrianglePerimeterSteps(sA, sB, sC); } else { stepsToDisplay = ["Enter positive dimensions."]; } break; }</p>
<p class="p1"><span class="Apple-converted-space">                </span>case 'areaOfCircle': { const r = parseFloat(document.getElementById('circleAreaRadius')?.value); if (r &gt; 0) { drawCircle2D(r); stepsToDisplay = calculateCircleAreaSteps(r); } else { stepsToDisplay = ["Enter positive radius."]; } break; }</p>
<p class="p1"><span class="Apple-converted-space">                </span>case 'circumferenceOfCircle': { const r = parseFloat(document.getElementById('circleCircumferenceRadius')?.value); if (r &gt; 0) { drawCircle2D(r); stepsToDisplay = calculateCircleCircumferenceSteps(r); } else { stepsToDisplay = ["Enter positive radius."]; } break; }</p>
<p class="p1"><span class="Apple-converted-space">                </span>case 'linearEquationSolver': { const a = parseFloat(document.getElementById('coeffA')?.value); const b = parseFloat(document.getElementById('coeffB')?.value); const c = parseFloat(document.getElementById('coeffC')?.value); let displayContentStr = a === 1 ? 'x' : (a === -1 ? '-x' : `${a}x`); if (b !== 0) { displayContentStr += b &lt; 0 ? ` - ${Math.abs(b)}` : ` + ${Math.abs(b)}`; } displayContentStr += ` = ${c}`; displayContent = `$${displayContentStr}$`; stepsToDisplay = solveLinearEquationSteps(a, b, c); break; }</p>
<p class="p1"><span class="Apple-converted-space">                </span>case 'additionAlgorithm': case 'subtractionAlgorithm': case 'multiplicationAlgorithm': { const num1 = parseFloat(document.getElementById('num1')?.value); const num2 = parseFloat(document.getElementById('num2')?.value); const opMap = { additionAlgorithm: '+', subtractionAlgorithm: '-', multiplicationAlgorithm: '\\times' }; displayContent = `$${num1} ${opMap[mode]} ${num2}$`; const funcMap = { additionAlgorithm: getAdditionSteps, subtractionAlgorithm: getSubtractionSteps, multiplicationAlgorithm: getMultiplicationSteps }; stepsToDisplay = funcMap[mode](num1, num2); break; }</p>
<p class="p1"><span class="Apple-converted-space">                </span>case 'longDivision': { const dividend = parseInt(document.getElementById('dividend')?.value, 10); const divisor = parseInt(document.getElementById('divisor')?.value, 10); if (!isNaN(dividend) &amp;&amp; !isNaN(divisor)) { displayContent = `$${dividend} \\div ${divisor}$`; stepsToDisplay = [`&lt;div class="w-full h-full" style="min-height: 400px;"&gt;&lt;canvas id="divisionCanvas" class="w-full h-full"&gt;&lt;/canvas&gt;&lt;/div&gt;`]; } break; }</p>
<p class="p1"><span class="Apple-converted-space">                </span>case 'bedmasCalculator': { const expression = document.getElementById('expression')?.value; displayContent = `$${expression.replace(/\*/g, ' \\times ').replace(/\//g, ' \\div ')}$`; stepsToDisplay = getBedmasSteps(expression); break; }</p>
<p class="p1"><span class="Apple-converted-space">                </span>case 'tableEquation': { const rows = Array.from(document.querySelectorAll('#table-container .flex, #dimensionInputsInline &gt; .flex')); let tableLatex = `$$\\begin{array}{|c|c|} \\hline x &amp; y \\\\ \\hline`; rows.forEach(row =&gt; { const xInput = row.querySelector('.table-x'); const yInput = row.querySelector('.table-y'); if(xInput &amp;&amp; yInput) { const x = xInput.value; const y = yInput.value; if(x &amp;&amp; y) tableLatex += ` ${x} &amp; ${y} \\\\ \\hline`; } }); tableLatex += `\\end{array}$$`; displayContent = tableLatex; stepsToDisplay = getTableEquationSteps(); break; }</p>
<p class="p1"><span class="Apple-converted-space">                </span>case 'fractionAddition': case 'fractionSubtraction': case 'fractionMultiplication': case 'fractionDivision': { const n1 = parseInt(document.getElementById('num1')?.value); const d1 = parseInt(document.getElementById('den1')?.value); const n2 = parseInt(document.getElementById('num2')?.value); const d2 = parseInt(document.getElementById('den2')?.value); let opDetails = {}; if (mode === 'fractionAddition') opDetails = { name: 'addition', symbol: '+' }; else if (mode === 'fractionSubtraction') opDetails = { name: 'subtraction', symbol: '-' }; else if (mode === 'fractionMultiplication') opDetails = { name: 'multiplication', symbol: '\\times' }; else opDetails = { name: 'division', symbol: '\\div' }; const initialExpression = `$\\frac{${n1}}{${d1}} ${opDetails.symbol} \\frac{${n2}}{${d2}}$`; displayContent = initialExpression; const funcMap = { 'addition': getFractionAdditionSteps, 'subtraction': getFractionSubtractionSteps, 'multiplication': getFractionMultiplicationSteps, 'division': getFractionDivisionSteps }; stepsToDisplay = [initialExpression, ...funcMap[opDetails.name](n1, d1, n2, d2)]; break; }</p>
<p class="p1"><span class="Apple-converted-space">                </span>case 'mixedAddition': case 'mixedSubtraction': case 'mixedMultiplication': case 'mixedDivision': { const w1 = parseInt(document.getElementById('whole1')?.value); const n1 = parseInt(document.getElementById('num1')?.value); const d1 = parseInt(document.getElementById('den1')?.value); const w2 = parseInt(document.getElementById('whole2')?.value); const n2 = parseInt(document.getElementById('num2')?.value); const d2 = parseInt(document.getElementById('den2')?.value); let opDetails = {}; if (mode === 'mixedAddition') opDetails = { name: 'addition', symbol: '+' }; else if (mode === 'mixedSubtraction') opDetails = { name: 'subtraction', symbol: '-' }; else if (mode === 'mixedMultiplication') opDetails = { name: 'multiplication', symbol: '\\times' }; else opDetails = { name: 'division', symbol: '\\div' }; const initialExpression = `$${w1} \\frac{${n1}}{${d1}} ${opDetails.symbol} ${w2} \\frac{${n2}}{${d2}}$`; displayContent = initialExpression; stepsToDisplay = [initialExpression, ...getMixedNumberSteps(w1, n1, d1, w2, n2, d2, opDetails)]; break; }</p>
<p class="p1"><span class="Apple-converted-space">                </span>case 'numberline': { const start = parseFloat(document.getElementById('numStart')?.value); const end = parseFloat(document.getElementById('numEnd')?.value); const stepVal = parseFloat(document.getElementById('numStep')?.value); displayContent = getNumberlineHTML(start, end, stepVal).join(''); stepsToDisplay = []; break; }</p>
<p class="p1"><span class="Apple-converted-space">                </span>case 'lineGraph': { const lineData = Array.from(document.querySelectorAll('#graph-data-container &gt; div')).map(row =&gt; ({ label: row.querySelector('.graph-label').value, value: parseFloat(row.querySelector('.graph-value').value) })).filter(d =&gt; d.label &amp;&amp; !isNaN(d.value)); displayContent = getLineGraphHTML(lineData).join(''); break; }</p>
<p class="p1"><span class="Apple-converted-space">                </span>case 'barGraph': { const barData = Array.from(document.querySelectorAll('#graph-data-container &gt; div')).map(row =&gt; ({ label: row.querySelector('.graph-label').value, value: parseFloat(row.querySelector('.graph-value').value) })).filter(d =&gt; d.label &amp;&amp; !isNaN(d.value)); displayContent = getBarGraphHTML(barData).join(''); break; }</p>
<p class="p1"><span class="Apple-converted-space">                </span>case 'pictograph': { const emoji = document.getElementById('pico-emoji').value; const picoData = Array.from(document.querySelectorAll('#graph-data-container &gt; div')).map(row =&gt; ({ label: row.querySelector('.graph-label').value, value: parseInt(row.querySelector('.graph-value').value) })).filter(d =&gt; d.label &amp;&amp; !isNaN(d.value) &amp;&amp; d.value &gt; 0); displayContent = getPictographHTML(picoData, emoji).join(''); break; }</p>
<p class="p1"><span class="Apple-converted-space">                </span>case 'stemAndLeafPlot': { const stemLeafData = document.getElementById('stem-leaf-data').value.split(',').map(s =&gt; parseFloat(s.trim())).filter(n =&gt; !isNaN(n)); displayContent = getStemAndLeafPlotHTML(stemLeafData).join(''); break; }</p>
<p class="p1"><span class="Apple-converted-space">                </span>case 'currencyCalculator': { displayContent = getCurrencyDisplayHTML('US'); stepsToDisplay = getCurrencyCalculationHTML('US'); break; }</p>
<p class="p1"><span class="Apple-converted-space">                </span>case 'canadianCurrencyCalculator': { displayContent = getCurrencyDisplayHTML('Canadian'); stepsToDisplay = getCurrencyCalculationHTML('Canadian'); break; }</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>} catch (e) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>stepsToDisplay = [`Error: ${e.message}`];</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>if (displayContent) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>equationDisplay.innerHTML = displayContent;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>stepsContentContainer.innerHTML = stepsToDisplay.map((step, index, arr) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const isFinal = index === arr.length - 1 &amp;&amp; !step.startsWith("Error") &amp;&amp; !step.includes("solutions");</p>
<p class="p1"><span class="Apple-converted-space">            </span>const colorClass = isFinal ? 'text-green-600' : (step.startsWith("Error") ? 'text-red-500' : 'text-slate-800');</p>
<p class="p1"><span class="Apple-converted-space">            </span>const finalClass = isFinal ? 'font-bold' : 'font-semibold';</p>
<p class="p1"><span class="Apple-converted-space">            </span>return `&lt;p class="text-5xl my-1 text-left ${colorClass} ${finalClass}"&gt;${step}&lt;/p&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}).join('');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>if (mode === 'longDivision') {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const divisionCanvas = document.getElementById('divisionCanvas');</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (divisionCanvas) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const dividend = parseInt(dimensionInputsInline.querySelector('#dividend')?.value, 10);</p>
<p class="p1"><span class="Apple-converted-space">                </span>const divisor = parseInt(dimensionInputsInline.querySelector('#divisor')?.value, 10);</p>
<p class="p1"><span class="Apple-converted-space">                </span>const divisionCtx = divisionCanvas.getContext('2d');</p>
<p class="p1"><span class="Apple-converted-space">                </span>drawLongDivision(dividend, divisor, divisionCanvas, divisionCtx);</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>if (window.MathJax &amp;&amp; window.MathJax.typesetPromise) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>window.MathJax.typesetPromise([equationDisplay, stepsContentContainer, dimensionInputsInline]).catch(err =&gt; console.error('MathJax typeset error:', err));</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">// --- INITIALIZATION &amp; EVENT LISTENERS ---</p>
<p class="p1">document.addEventListener('DOMContentLoaded', () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>modeSelector.addEventListener('change', handleModeChange);</p>
<p class="p1"><span class="Apple-converted-space">    </span>window.addEventListener('resize', onWindowResize);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>menuToggleBtn.addEventListener('click', () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (manipulativeModes.includes(currentMode)) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>manipulative_handleMenuToggle();</p>
<p class="p1"><span class="Apple-converted-space">        </span>} else if (newCanvasModes.includes(currentMode)) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const isPanelHidden = graphingInputsPanel.classList.toggle('panel-hidden');</p>
<p class="p1"><span class="Apple-converted-space">            </span>graphingCanvasWrapper.classList.toggle('canvas-expanded', isPanelHidden);</p>
<p class="p1"><span class="Apple-converted-space">            </span>menuToggleBtn.classList.toggle('toggle-on', !isPanelHidden);</p>
<p class="p1"><span class="Apple-converted-space">            </span>menuToggleBtn.classList.toggle('toggle-off', isPanelHidden);</p>
<p class="p1"><span class="Apple-converted-space">            </span>menuToggleDot.classList.toggle('dot-on', !isPanelHidden);</p>
<p class="p1"><span class="Apple-converted-space">            </span>setTimeout(() =&gt; { handleDraw(); }, 300);</p>
<p class="p1"><span class="Apple-converted-space">        </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const isHidden = menuControls.classList.toggle('hidden');</p>
<p class="p1"><span class="Apple-converted-space">            </span>menuToggleBtn.classList.toggle('toggle-on', !isHidden);</p>
<p class="p1"><span class="Apple-converted-space">            </span>menuToggleBtn.classList.toggle('toggle-off', isHidden);</p>
<p class="p1"><span class="Apple-converted-space">            </span>menuToggleDot.classList.toggle('dot-on', !isHidden);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>answerToggleBtn.addEventListener('click', () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (manipulativeModes.includes(currentMode)) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>manipulative_handleAnswerToggle();</p>
<p class="p1"><span class="Apple-converted-space">        </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const isHidden = calculationStepsColumn.classList.toggle('hidden-mode');</p>
<p class="p1"><span class="Apple-converted-space">            </span>answerToggleBtn.classList.toggle('toggle-on', !isHidden);</p>
<p class="p1"><span class="Apple-converted-space">            </span>answerToggleBtn.classList.toggle('toggle-off', isHidden);</p>
<p class="p1"><span class="Apple-converted-space">            </span>answerToggleDot.classList.toggle('dot-on', !isHidden);</p>
<p class="p1"><span class="Apple-converted-space">            </span>setTimeout(() =&gt; { handleDraw(); }, 150);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>});</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>manipulative_initialize();</p>
<p class="p1"><span class="Apple-converted-space">    </span>setupInputsForMode(currentMode);</p>
<p class="p1">});</p>
<p class="p2"><br></p>
<p class="p1">// --- MANIPULATIVE MACHINE SCRIPT (RENAMED) ---</p>
<p class="p1">function manipulative_hexToRgb(hex) { const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex); return result ? { r: parseInt(result[1], 16), g: parseInt(result[2], 16), b: parseInt(result[3], 16) } : null;}</p>
<p class="p1">function manipulative_lightenColor(hex, percent) { const rgb = manipulative_hexToRgb(hex); if (!rgb) return hex; const factor = 1 + percent/100; return `rgb(${Math.min(255,rgb.r*factor)},${Math.min(255,rgb.g*factor)},${Math.min(255,rgb.b*factor)})`;}</p>
<p class="p1">function manipulative_darkenColor(hex, percent) { const rgb = manipulative_hexToRgb(hex); if (!rgb) return hex; const factor = 1 - percent/100; return `rgb(${Math.max(0,rgb.r*factor)},${Math.max(0,rgb.g*factor)},${Math.max(0,rgb.b*factor)})`;}</p>
<p class="p1">function manipulative_isPrime(num) { if (num &lt;= 1) return false; for (let i = 2; i &lt;= Math.sqrt(num); i++) { if (num % i === 0) return false; } return true; }</p>
<p class="p1">function manipulative_getFactors(num) { const factors = new Set(); for (let i = 1; i &lt;= Math.sqrt(num); i++) { if (num % i === 0) { factors.add(i); factors.add(num / i); } } return Array.from(factors).sort((a, b) =&gt; a - b); }</p>
<p class="p1">function manipulative_getPrimeFactorsList(n) { let factors = [], tempN = n; for (let i = 2; i * i &lt;= tempN; i++) { while (tempN % i === 0) { factors.push(i); tempN /= i; } } if (tempN &gt; 1) { factors.push(tempN); } return factors; }</p>
<p class="p1">function manipulative_renderAlgebraTile(ctx_param, tile) { if (!ctx_param) return; const {x, y, width, height, color, label} = tile; ctx_param.save(); ctx_param.translate(x, y); ctx_param.beginPath(); ctx_param.rect(-width / 2, -height / 2, width, height); ctx_param.fillStyle = color; ctx_param.fill(); ctx_param.strokeStyle = manipulative_mainOutlineColor; ctx_param.lineWidth = manipulative_mainOutlineWidth; ctx_param.stroke(); ctx_param.fillStyle = 'white'; ctx_param.font = `bold ${Math.min(width, height) * 0.5}px Montserrat`; ctx_param.textAlign = 'center'; ctx_param.textBaseline = 'middle'; ctx_param.fillText(label, 0, 0); ctx_param.restore(); }</p>
<p class="p1">function manipulative_renderUnitCube(ctx_param, cube) { if(!ctx_param)return;ctx_param.save();ctx_param.globalAlpha=manipulative_baseTenTransparency;ctx_param.translate(cube.x,cube.y);ctx_param.strokeStyle=manipulative_mainOutlineColor;ctx_param.lineWidth=manipulative_mainOutlineWidth;const faceSize=cube.size;const po=faceSize*manipulative_DEPTH_PERSPECTIVE_RATIO;ctx_param.beginPath();ctx_param.fillStyle=cube.color;ctx_param.rect(-faceSize/2,-faceSize/2,faceSize,faceSize);ctx_param.fill();ctx_param.stroke();ctx_param.beginPath();ctx_param.fillStyle=manipulative_lightenColor(cube.color,20);ctx_param.moveTo(-faceSize/2,-faceSize/2);ctx_param.lineTo(-faceSize/2+po,-faceSize/2-po);ctx_param.lineTo(faceSize/2+po,-faceSize/2-po);ctx_param.lineTo(faceSize/2,-faceSize/2);ctx_param.closePath();ctx_param.fill();ctx_param.stroke();ctx_param.beginPath();ctx_param.fillStyle=manipulative_darkenColor(cube.color,20);ctx_param.moveTo(faceSize/2,-faceSize/2);ctx_param.lineTo(faceSize/2+po,-faceSize/2-po);ctx_param.lineTo(faceSize/2+po,faceSize/2-po);ctx_param.lineTo(faceSize/2,faceSize/2);ctx_param.closePath();ctx_param.fill();ctx_param.stroke();ctx_param.restore(); }</p>
<p class="p1">function manipulative_renderRod(ctx_param, rodObject) { if(!ctx_param)return;const{x,y,width:w,height:h,color:c,depth:d}=rodObject;ctx_param.save();ctx_param.globalAlpha=manipulative_baseTenTransparency;ctx_param.translate(x,y);ctx_param.strokeStyle=manipulative_mainOutlineColor;ctx_param.lineWidth=manipulative_mainOutlineWidth;const po=d*manipulative_DEPTH_PERSPECTIVE_RATIO;const segW=w/10;ctx_param.beginPath();ctx_param.fillStyle=c;ctx_param.rect(-w/2,-h/2,w,h);ctx_param.fill();ctx_param.stroke();ctx_param.strokeStyle=manipulative_internalLineColor;ctx_param.lineWidth=manipulative_internalLineWidth;for(let k=1;k&lt;10;k++){const lx=-w/2+k*segW;ctx_param.beginPath();ctx_param.moveTo(lx,-h/2);ctx_param.lineTo(lx,h/2);ctx_param.stroke();} ctx_param.beginPath();ctx_param.fillStyle=manipulative_lightenColor(c,20);ctx_param.moveTo(-w/2,-h/2);ctx_param.lineTo(-w/2+po,-h/2-po);ctx_param.lineTo(w/2+po,-h/2-po);ctx_param.lineTo(w/2,-h/2);ctx_param.closePath();ctx_param.fill();ctx_param.stroke();for(let k=1;k&lt;10;k++){const p1x=-w/2+k*segW,p1y=-h/2,p2x=-w/2+po+k*segW,p2y=-h/2-po;ctx_param.beginPath();ctx_param.moveTo(p1x,p1y);ctx_param.lineTo(p2x,p2y);ctx_param.stroke();} ctx_param.beginPath();ctx_param.fillStyle=manipulative_darkenColor(c,20);ctx_param.moveTo(w/2,-h/2);ctx_param.lineTo(w/2+po,-h/2-po);ctx_param.lineTo(w/2+po,h/2-po);ctx_param.lineTo(w/2,h/2);ctx_param.closePath();ctx_param.fill();ctx_param.stroke();ctx_param.restore(); }</p>
<p class="p1">function manipulative_renderFlat(ctx_param, flatObject) { if(!ctx_param)return;const{x,y,sideLength:s,thickness:th,color:c}=flatObject;ctx_param.save();ctx_param.globalAlpha=manipulative_baseTenTransparency;ctx_param.translate(x,y);ctx_param.strokeStyle=manipulative_mainOutlineColor;ctx_param.lineWidth=manipulative_mainOutlineWidth;const po=th*manipulative_DEPTH_PERSPECTIVE_RATIO;const segS=s/10;ctx_param.beginPath();ctx_param.fillStyle=manipulative_lightenColor(c,15);ctx_param.moveTo(-s/2,-s/2);ctx_param.lineTo(-s/2+po,-s/2-po);ctx_param.lineTo(s/2+po,-s/2-po);ctx_param.lineTo(s/2,-s/2);ctx_param.closePath();ctx_param.fill();ctx_param.stroke();ctx_param.beginPath();ctx_param.fillStyle=manipulative_darkenColor(c,15);ctx_param.moveTo(s/2,-s/2);ctx_param.lineTo(s/2+po,-s/2-po);ctx_param.lineTo(s/2+po,s/2-po);ctx_param.lineTo(s/2,s/2);ctx_param.closePath();ctx_param.fill();ctx_param.stroke();ctx_param.beginPath();ctx_param.fillStyle=c;ctx_param.rect(-s/2,-s/2,s,s);ctx_param.fill();ctx_param.stroke();ctx_param.strokeStyle=manipulative_internalLineColor;ctx_param.lineWidth=manipulative_internalLineWidth;for(let i=1;i&lt;10;i++){const l=-s/2+i*segS;ctx_param.beginPath();ctx_param.moveTo(l,-s/2);ctx_param.lineTo(l,s/2);ctx_param.stroke();ctx_param.beginPath();ctx_param.moveTo(-s/2,l);ctx_param.lineTo(s/2,l);ctx_param.stroke();} ctx_param.restore();}</p>
<p class="p1">function manipulative_renderBlock1000(ctx_param, blockObject) {if(!ctx_param)return;const{x,y,sideLength:s,color:c}=blockObject;const d=s;ctx_param.save();ctx_param.globalAlpha=manipulative_baseTenTransparency;ctx_param.translate(x,y);ctx_param.strokeStyle=manipulative_mainOutlineColor;ctx_param.lineWidth=manipulative_mainOutlineWidth;const po=d*manipulative_DEPTH_PERSPECTIVE_RATIO;const seg=s/10;ctx_param.beginPath();ctx_param.fillStyle=manipulative_lightenColor(c,20);ctx_param.moveTo(-s/2,-s/2);ctx_param.lineTo(-s/2+po,-s/2-po);ctx_param.lineTo(s/2+po,-s/2-po);ctx_param.lineTo(s/2,-s/2);ctx_param.closePath();ctx_param.fill();ctx_param.stroke();ctx_param.beginPath();ctx_param.fillStyle=manipulative_darkenColor(c,20);ctx_param.moveTo(s/2,-s/2);ctx_param.lineTo(s/2+po,-s/2-po);ctx_param.lineTo(s/2+po,s/2-po);ctx_param.lineTo(s/2,s/2);ctx_param.closePath();ctx_param.fill();ctx_param.stroke();ctx_param.beginPath();ctx_param.fillStyle=c;ctx_param.rect(-s/2,-s/2,s,s);ctx_param.fill();ctx_param.stroke();ctx_param.strokeStyle=manipulative_internalLineColor;ctx_param.lineWidth=manipulative_internalLineWidth;for(let i=1;i&lt;10;i++){ctx_param.beginPath();ctx_param.moveTo(-s/2+i*seg,-s/2);ctx_param.lineTo(-s/2+i*seg,s/2);ctx_param.stroke();ctx_param.beginPath();ctx_param.moveTo(-s/2,-s/2+i*seg);ctx_param.lineTo(s/2,-s/2+i*seg);ctx_param.stroke();} ctx_param.restore();}</p>
<p class="p1">function manipulative_getEffectiveBlockDimensions(type, currentBaseSize) {let w_ratio,h_ratio,d_ratio;if(type==='block1000'){w_ratio=10;h_ratio=10;d_ratio=10;}else if(type==='flat'){w_ratio=10;h_ratio=10;d_ratio=1;}else if(type==='rod'){w_ratio=10;h_ratio=1;d_ratio=1;}else{w_ratio=1;h_ratio=1;d_ratio=1;} const currentBlockWidth=w_ratio*currentBaseSize;const currentBlockHeight=h_ratio*currentBaseSize;const currentBlockDepth=d_ratio*currentBaseSize;const effectiveVisualWidth=currentBlockWidth+(currentBlockDepth*manipulative_DEPTH_PERSPECTIVE_RATIO);const effectiveVisualHeight=currentBlockHeight+(currentBlockDepth*manipulative_DEPTH_PERSPECTIVE_RATIO);return{currentBlockWidth,currentBlockHeight,currentBlockDepth,effectiveVisualWidth,effectiveVisualHeight};}</p>
<p class="p1">function manipulative_renderFractionStrip(ctx_param, strip) {if(!ctx_param)return;const{x,y,width,height,denominator,numerator,color,showNotation}=strip;ctx_param.save();ctx_param.globalAlpha=manipulative_geometricShapeTransparency;ctx_param.translate(x,y);ctx_param.strokeStyle=manipulative_mainOutlineColor;ctx_param.lineWidth=manipulative_mainOutlineWidth;ctx_param.beginPath();ctx_param.rect(-width/2,-height/2,width,height);ctx_param.stroke();const segmentWidth=width/denominator;for(let i=0;i&lt;denominator;i++){ctx_param.beginPath();ctx_param.rect(-width/2+i*segmentWidth,-height/2,segmentWidth,height);ctx_param.fillStyle=i&lt;numerator?color:manipulative_fractionUnfilledColor;ctx_param.fill();ctx_param.stroke();} if(showNotation&amp;&amp;denominator&gt;0){ctx_param.fillStyle=manipulative_mainOutlineColor;ctx_param.font=`${height*0.4}px Montserrat`;ctx_param.textAlign='center';ctx_param.textBaseline='middle';const labelText=`1/${denominator}`;for(let i=0;i&lt;denominator;i++){ctx_param.fillText(labelText,-width/2+(i*segmentWidth)+(segmentWidth/2),0);}} ctx_param.restore();}</p>
<p class="p1">function manipulative_renderFractionCircle(ctx_param, circle) {if(!ctx_param)return;const{x,y,radius,denominator,numerator,color,showNotation}=circle;ctx_param.save();ctx_param.globalAlpha=manipulative_geometricShapeTransparency;ctx_param.translate(x,y);ctx_param.strokeStyle=manipulative_mainOutlineColor;ctx_param.lineWidth=manipulative_mainOutlineWidth;const anglePerSegment=(2*Math.PI)/denominator;for(let i=0;i&lt;denominator;i++){ctx_param.beginPath();ctx_param.moveTo(0,0);ctx_param.arc(0,0,radius,i*anglePerSegment,(i+1)*anglePerSegment);ctx_param.closePath();ctx_param.fillStyle=i&lt;numerator?color:manipulative_fractionUnfilledColor;ctx_param.fill();ctx_param.stroke();} if(showNotation&amp;&amp;denominator&gt;0){ctx_param.fillStyle=manipulative_mainOutlineColor;ctx_param.font=`${radius*0.375}px Montserrat`;ctx_param.textAlign='center';ctx_param.textBaseline='middle';const labelText=`1/${denominator}`;for(let i=0;i&lt;denominator;i++){const angle=(i*anglePerSegment)+(anglePerSegment/2);ctx_param.fillText(labelText,radius*0.65*Math.cos(angle),radius*0.65*Math.sin(angle));}} ctx_param.restore();}</p>
<p class="p1">function manipulative_renderMultiplicationArray(ctx_param, array) {if(!ctx_param)return;const{x,y,cellSize,rows,cols,color}=array;ctx_param.save();ctx_param.globalAlpha=manipulative_geometricShapeTransparency;ctx_param.translate(x,y);const totalWidth=cols*cellSize;const totalHeight=rows*cellSize;ctx_param.strokeStyle=manipulative_mainOutlineColor;ctx_param.lineWidth=manipulative_mainOutlineWidth;ctx_param.beginPath();ctx_param.rect(-totalWidth/2,-totalHeight/2,totalWidth,totalHeight);ctx_param.fillStyle=color;ctx_param.fill();ctx_param.stroke();ctx_param.strokeStyle=manipulative_internalLineColor;ctx_param.lineWidth=manipulative_internalLineWidth;for(let i=1;i&lt;rows;i++){ctx_param.beginPath();ctx_param.moveTo(-totalWidth/2,-totalHeight/2+i*cellSize);ctx_param.lineTo(totalWidth/2,-totalHeight/2+i*cellSize);ctx_param.stroke();} for(let i=1;i&lt;cols;i++){ctx_param.beginPath();ctx_param.moveTo(-totalWidth/2+i*cellSize,-totalHeight/2);ctx_param.lineTo(-totalWidth/2+i*cellSize,totalHeight/2);ctx_param.stroke();} ctx_param.restore();}</p>
<p class="p1">function manipulative_renderTenFrameOnCanvas(ctx_param, frame) { if(!ctx_param)return;const{x,y,cellSize,rows,cols,numDots}=frame;ctx_param.save();ctx_param.translate(x,y);const totalWidth=cols*cellSize;const totalHeight=rows*cellSize;for(let r=0;r&lt;rows;r++){for(let c=0;c&lt;cols;c++){const cellIndex=r*cols+c;const cellX=-totalWidth/2+c*cellSize;const cellY=-totalHeight/2+r*cellSize;ctx_param.beginPath();ctx_param.rect(cellX,cellY,cellSize,cellSize);ctx_param.fillStyle=manipulative_chartCellColor;ctx_param.fill();ctx_param.strokeStyle=manipulative_chartBorderColor;ctx_param.lineWidth=manipulative_internalLineWidth;ctx_param.stroke();if(cellIndex&lt;numDots){ctx_param.beginPath();ctx_param.arc(cellX+cellSize/2,cellY+cellSize/2,cellSize*0.35,0,2*Math.PI);ctx_param.fillStyle=manipulative_tenFrameDotColor;ctx_param.fill();}}} ctx_param.restore();}</p>
<p class="p1">function manipulative_renderHundredsChartOnCanvas(ctx_param, chart) { if(!ctx_param)return;const{x,y,cellSize,rows,cols,highlightType,highlightNumber}=chart;ctx_param.save();ctx_param.translate(x,y);const totalWidth=cols*cellSize;const totalHeight=rows*cellSize;for(let i=1;i&lt;=100;i++){const r=Math.floor((i-1)/cols);const c=(i-1)%cols;const cellX=-totalWidth/2+c*cellSize;const cellY=-totalHeight/2+r*cellSize;let cellFillColor=manipulative_chartCellColor,textColor='#333';if(highlightType==='prime'&amp;&amp;manipulative_isPrime(i)){cellFillColor=manipulative_highlightPrimeColor;}else if(highlightType==='even'&amp;&amp;i%2===0){cellFillColor=manipulative_highlightEvenColor;textColor='white';}else if(highlightType==='odd'&amp;&amp;i%2!==0){cellFillColor=manipulative_highlightOddColor;textColor='white';}else if(highlightType==='multiples'&amp;&amp;highlightNumber&gt;0&amp;&amp;i%highlightNumber===0){cellFillColor=manipulative_highlightMultipleColor;textColor='white';}else if(highlightType==='factors'&amp;&amp;highlightNumber&gt;0&amp;&amp;highlightNumber%i===0){cellFillColor=manipulative_highlightFactorColor;textColor='white';} ctx_param.beginPath();ctx_param.rect(cellX,cellY,cellSize,cellSize);ctx_param.fillStyle=cellFillColor;ctx_param.fill();ctx_param.strokeStyle=manipulative_chartBorderColor;ctx_param.lineWidth=manipulative_internalLineWidth;ctx_param.stroke();ctx_param.fillStyle=textColor;ctx_param.font=`bold ${cellSize*0.4}px Montserrat`;ctx_param.textAlign='center';ctx_param.textBaseline='middle';ctx_param.fillText(i,cellX+cellSize/2,cellY+cellSize/2);} ctx_param.restore();}</p>
<p class="p1">function manipulative_renderAnalogClock(ctx_param, clock) { if(!ctx_param)return;const{x,y,radius,hour,minute}=clock;ctx_param.save();ctx_param.translate(x,y);ctx_param.beginPath();ctx_param.arc(0,0,radius,0,2*Math.PI);ctx_param.fillStyle='white';ctx_param.fill();ctx_param.strokeStyle=manipulative_mainOutlineColor;ctx_param.lineWidth=manipulative_mainOutlineWidth*2;ctx_param.stroke();ctx_param.beginPath();ctx_param.arc(0,0,5,0,2*Math.PI);ctx_param.fillStyle=manipulative_mainOutlineColor;ctx_param.fill();ctx_param.font=`bold ${radius*0.15}px Montserrat`;ctx_param.textAlign='center';ctx_param.textBaseline='middle';for(let num=1;num&lt;=12;num++){const angle=num*Math.PI/6;const numX=radius*0.85*Math.sin(angle);const numY=-radius*0.85*Math.cos(angle);ctx_param.fillText(num,numX,numY);} for(let i=0;i&lt;60;i++){const angle=(i/60)*2*Math.PI;const startRadius=i%5===0?radius*0.9:radius*0.95;const endRadius=radius;ctx_param.beginPath();ctx_param.moveTo(startRadius*Math.sin(angle),-startRadius*Math.cos(angle));ctx_param.lineTo(endRadius*Math.sin(angle),-endRadius*Math.cos(angle));ctx_param.lineWidth=(i%5===0)?2:1;ctx_param.stroke();} const hourAngle=(hour%12+minute/60)*Math.PI/6;const minuteAngle=(minute/60)*2*Math.PI;ctx_param.beginPath();ctx_param.moveTo(0,0);ctx_param.rotate(hourAngle);ctx_param.lineTo(0,-radius*0.5);ctx_param.lineWidth=6;ctx_param.stroke();ctx_param.rotate(-hourAngle);ctx_param.beginPath();ctx_param.moveTo(0,0);ctx_param.rotate(minuteAngle);ctx_param.lineTo(0,-radius*0.8);ctx_param.lineWidth=4;ctx_param.stroke();ctx_param.rotate(-minuteAngle);ctx_param.restore();}</p>
<p class="p1">function manipulative_findPrimeFactors(n) { if (n &lt; 2) return { value: n, children: [] }; const node = { value: n, children: [], isPrime: false }; let tempN = n, foundFactor = false; for (let i = 2; i * i &lt;= tempN; i++) { if (tempN % i === 0) { node.children.push(manipulative_findPrimeFactors(i)); node.children.push(manipulative_findPrimeFactors(tempN / i)); foundFactor = true; break; } } if (!foundFactor) { node.isPrime = true; } return node; }</p>
<p class="p1">function manipulative_measureSubtreeLayout(node, baseNodeRadius, baseVerticalSpacing, baseHorizontalNodeGap) { if (node.children.length === 0) return { width: baseNodeRadius * 2, height: baseNodeRadius * 2 }; const leftChildLayout = manipulative_measureSubtreeLayout(node.children[0], baseNodeRadius, baseVerticalSpacing, baseHorizontalNodeGap); const rightChildLayout = manipulative_measureSubtreeLayout(node.children[1], baseNodeRadius, baseVerticalSpacing, baseHorizontalNodeGap); const childrenTotalWidth = leftChildLayout.width + rightChildLayout.width + baseHorizontalNodeGap; const subtreeWidth = Math.max(baseNodeRadius * 2, childrenTotalWidth); const subtreeHeight = (baseNodeRadius * 2) + baseVerticalSpacing + Math.max(leftChildLayout.height, rightChildLayout.height); return { width: subtreeWidth, height: subtreeHeight }; }</p>
<p class="p1">function manipulative_drawFactorTreeRecursive(ctx, node, x, y, nodeRadius, verticalSpacing, horizontalGapBetweenSiblings) { manipulative_drawCircleNode(ctx, x, y, nodeRadius, manipulative_factorTreeNodeColor, node.value); if (node.children.length &gt; 0) { const childY = y + verticalSpacing + nodeRadius * 2; const leftChildLayout = manipulative_measureSubtreeLayout(node.children[0], nodeRadius, verticalSpacing, horizontalGapBetweenSiblings); const rightChildLayout = manipulative_measureSubtreeLayout(node.children[1], nodeRadius, verticalSpacing, horizontalGapBetweenSiblings); const totalChildrenSpan = leftChildLayout.width + horizontalGapBetweenSiblings + rightChildLayout.width; const child1X = x - totalChildrenSpan / 2 + leftChildLayout.width / 2; const child2X = x + totalChildrenSpan / 2 - rightChildLayout.width / 2; ctx.beginPath(); ctx.strokeStyle = manipulative_numberBondLineColor; ctx.lineWidth = manipulative_internalLineWidth; ctx.moveTo(x, y + nodeRadius); ctx.lineTo(child1X, childY - nodeRadius); ctx.moveTo(x, y + nodeRadius); ctx.lineTo(child2X, childY - nodeRadius); ctx.stroke(); manipulative_drawFactorTreeRecursive(ctx, node.children[0], child1X, childY, nodeRadius, verticalSpacing, horizontalGapBetweenSiblings); manipulative_drawFactorTreeRecursive(ctx, node.children[1], child2X, childY, nodeRadius, verticalSpacing, horizontalGapBetweenSiblings); } }</p>
<p class="p1">function manipulative_drawFactorTreeOnCanvas(canvasElement, numberToFactorize) { const ctx_param = canvasElement.getContext('2d'); ctx_param.clearRect(0, 0, canvasElement.width, canvasElement.height); if (isNaN(numberToFactorize) || numberToFactorize &lt; 2) return; const treeData = manipulative_findPrimeFactors(numberToFactorize); const baseNodeRadius = 30, baseVerticalSpacing = 20, baseHorizontalNodeGap = 15; const treeLayout = manipulative_measureSubtreeLayout(treeData, baseNodeRadius, baseVerticalSpacing, baseHorizontalNodeGap); canvasElement.width = treeLayout.width + manipulative_padding * 2; canvasElement.height = treeLayout.height + manipulative_padding * 2; requestAnimationFrame(() =&gt; { ctx_param.clearRect(0, 0, canvasElement.width, canvasElement.height); manipulative_drawFactorTreeRecursive(ctx_param, treeData, canvasElement.width / 2, baseNodeRadius + manipulative_padding, baseNodeRadius, baseVerticalSpacing, baseHorizontalNodeGap); }); }</p>
<p class="p1">function manipulative_drawCircleNode(ctx, x, y, radius, color, text) { ctx.beginPath(); ctx.arc(x, y, radius, 0, 2 * Math.PI); ctx.fillStyle = color; ctx.fill(); ctx.strokeStyle = manipulative_mainOutlineColor; ctx.lineWidth = manipulative_mainOutlineWidth; ctx.stroke(); ctx.fillStyle = manipulative_mainOutlineColor; ctx.font = `bold ${radius * 0.6}px Montserrat`; ctx.textAlign = 'center'; ctx.textBaseline = 'middle'; ctx.fillText(text, x, y); }</p>
<p class="p1">function manipulative_drawNumberBondOnCanvas(canvasElement, value1, value2, result, operation, bondColor, drawOnlyProblem = false) { const ctx_param = canvasElement.getContext('2d'); ctx_param.clearRect(0, 0, canvasElement.width, canvasElement.height); if (isNaN(value1) || isNaN(value2)) return; const nodeRadius = manipulative_NUMBER_BOND_NODE_RADIUS, hSpacing = manipulative_NUMBER_BOND_HORIZONTAL_SPACING, vSpacing = manipulative_NUMBER_BOND_VERTICAL_SPACING; const totalWidth = nodeRadius * 4 + hSpacing, totalHeight = nodeRadius * 4 + vSpacing; canvasElement.width = totalWidth + manipulative_padding * 2; canvasElement.height = totalHeight + manipulative_padding * 2; const centerX = canvasElement.width / 2; const wholeY = manipulative_padding + nodeRadius; const partY = wholeY + vSpacing; const part1X = centerX - hSpacing / 2; const part2X = centerX + hSpacing / 2; ctx_param.strokeStyle = manipulative_numberBondLineColor; ctx_param.lineWidth = manipulative_internalLineWidth; ctx_param.beginPath(); ctx_param.moveTo(centerX, wholeY + nodeRadius); ctx_param.lineTo(part1X, partY - nodeRadius); ctx_param.moveTo(centerX, wholeY + nodeRadius); ctx_param.lineTo(part2X, partY - nodeRadius); ctx_param.stroke(); manipulative_drawCircleNode(ctx_param, part1X, partY, nodeRadius, bondColor, value1); manipulative_drawCircleNode(ctx_param, part2X, partY, nodeRadius, bondColor, value2); manipulative_drawCircleNode(ctx_param, centerX, wholeY, nodeRadius, bondColor, drawOnlyProblem ? '?' : result); }</p>
<p class="p1">function manipulative_drawPolygon(ctx, x, y, radius, sides) { if (sides &lt; 3) return; const angle = 2 * Math.PI / sides; const startAngle = -Math.PI / 2 + (sides % 2 === 0 ? angle / 2 : 0); ctx.beginPath(); ctx.moveTo(x + radius * Math.cos(startAngle), y + radius * Math.sin(startAngle)); for (let i = 1; i &lt;= sides; i++) { ctx.lineTo(x + radius * Math.cos(startAngle + i * angle), y + radius * Math.sin(startAngle + i * angle)); } ctx.closePath(); }</p>
<p class="p1">function manipulative_easeOutCubic(t) { return 1 - Math.pow(1 - t, 3); }</p>
<p class="p2"><br></p>
<p class="p1">// --- LAYOUT ENGINE &amp; MASTER DRAWING ---</p>
<p class="p1">function manipulative_layoutAndRenderManipulatives(currentBaseUnitSize, canvasWidth, itemsToRender, ctx_param = null, isDrawingPass = false, canvasContainer) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>let currentY_visual_top = manipulative_padding, maxOverallDrawingHeight = manipulative_padding, rowsOfItems = [], currentRowItems = [], currentRowWidth = 0, currentRowMaxEffectiveVisualHeight = 0, initialPerspectiveOffset = 0;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const has3DBlocks = itemsToRender.some(item =&gt; ['block1000', 'flat', 'rod', 'cube'].includes(item.type));</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (has3DBlocks) { initialPerspectiveOffset = manipulative_getEffectiveBlockDimensions('block1000', currentBaseUnitSize).currentBlockDepth * manipulative_DEPTH_PERSPECTIVE_RATIO; currentY_visual_top += initialPerspectiveOffset; maxOverallDrawingHeight += initialPerspectiveOffset; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>for (const item of itemsToRender) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>let effectiveVisualWidth, effectiveVisualHeight; let manipulativeProps = {};</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (['block1000', 'flat', 'rod', 'cube'].includes(item.type)) { const dims = manipulative_getEffectiveBlockDimensions(item.type, currentBaseUnitSize); effectiveVisualWidth = dims.effectiveVisualWidth; effectiveVisualHeight = dims.effectiveVisualHeight; manipulativeProps = { size: dims.currentBlockWidth, width: dims.currentBlockWidth, height: dims.currentBlockHeight, sideLength: dims.currentBlockWidth, thickness: dims.currentBlockDepth, depth: dims.currentBlockDepth }; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>else if (item.type === 'fractionStrip') { effectiveVisualWidth = currentBaseUnitSize * 35; effectiveVisualHeight = currentBaseUnitSize * 7; manipulativeProps = { width: effectiveVisualWidth, height: effectiveVisualHeight, ...item }; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>else if (item.type === 'fractionCircle') { effectiveVisualWidth = currentBaseUnitSize * 14; effectiveVisualHeight = currentBaseUnitSize * 14; manipulativeProps = { radius: effectiveVisualWidth / 2, ...item }; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>else if (item.type === 'multiplicationArray') { const cellSize = currentBaseUnitSize * 4; effectiveVisualWidth = item.cols * cellSize; effectiveVisualHeight = item.rows * cellSize; manipulativeProps = { cellSize, ...item }; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>else if (item.type === 'tenFrame') { const cellSize = currentBaseUnitSize * 5; effectiveVisualWidth = item.cols * cellSize; effectiveVisualHeight = item.rows * cellSize; manipulativeProps = { cellSize, ...item }; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>else if (item.type === 'hundredsChart') { const cellSize = currentBaseUnitSize * 5; effectiveVisualWidth = item.cols * cellSize; effectiveVisualHeight = item.rows * cellSize; manipulativeProps = { cellSize, ...item }; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>else if (item.type === 'algebraTile') { const xSide = (currentBaseUnitSize * 8) * 1.7, oneSide = (currentBaseUnitSize * 2) * 1.7; if (item.tileType === 'x2') { effectiveVisualWidth = xSide; effectiveVisualHeight = xSide; } else if (item.tileType === 'x') { effectiveVisualWidth = xSide; effectiveVisualHeight = oneSide; } else { effectiveVisualWidth = oneSide; effectiveVisualHeight = oneSide; } manipulativeProps = { width: effectiveVisualWidth, height: effectiveVisualHeight, ...item }; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>else { continue; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>const itemWidthWithPadding = effectiveVisualWidth + manipulative_padding;</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (currentRowItems.length &gt; 0 &amp;&amp; (currentRowWidth + itemWidthWithPadding - manipulative_padding) &gt; (canvasWidth - 2 * manipulative_padding)) { rowsOfItems.push({ items: currentRowItems, width: currentRowWidth - manipulative_padding, height: currentRowMaxEffectiveVisualHeight }); currentY_visual_top += currentRowMaxEffectiveVisualHeight + manipulative_padding; currentRowItems = []; currentRowWidth = 0; currentRowMaxEffectiveVisualHeight = 0; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>currentRowItems.push({ item, effectiveVisualWidth, effectiveVisualHeight, manipulativeProps }); currentRowWidth += itemWidthWithPadding; currentRowMaxEffectiveVisualHeight = Math.max(currentRowMaxEffectiveVisualHeight, effectiveVisualHeight);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (currentRowItems.length &gt; 0) { rowsOfItems.push({ items: currentRowItems, width: currentRowWidth - manipulative_padding, height: currentRowMaxEffectiveVisualHeight }); maxOverallDrawingHeight = currentY_visual_top + currentRowMaxEffectiveVisualHeight; } else { maxOverallDrawingHeight = currentY_visual_top; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>let currentDrawingY = manipulative_padding;</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(has3DBlocks) currentDrawingY += initialPerspectiveOffset;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>for (const row of rowsOfItems) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>const startX = (canvasWidth - row.width) / 2;</p>
<p class="p1"><span class="Apple-converted-space">        </span>let currentXInRow = startX;</p>
<p class="p1"><span class="Apple-converted-space">        </span>for (const itemInfo of row.items) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>let yAdjust = (['block1000', 'flat', 'rod', 'cube'].includes(itemInfo.item.type)) ? manipulative_getEffectiveBlockDimensions(itemInfo.item.type, currentBaseUnitSize).currentBlockDepth * manipulative_DEPTH_PERSPECTIVE_RATIO / 2 + manipulative_getEffectiveBlockDimensions(itemInfo.item.type, currentBaseUnitSize).currentBlockHeight / 2 : itemInfo.effectiveVisualHeight / 2;</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (isDrawingPass) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const manipulativeObj = { ...itemInfo.item, ...itemInfo.manipulativeProps, x: currentXInRow + itemInfo.effectiveVisualWidth / 2, y: currentDrawingY + yAdjust };</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (manipulativeObj.type === 'cube') manipulative_renderUnitCube(ctx_param, manipulativeObj);</p>
<p class="p1"><span class="Apple-converted-space">                </span>else if (manipulativeObj.type === 'rod') manipulative_renderRod(ctx_param, manipulativeObj); else if (manipulativeObj.type === 'flat') manipulative_renderFlat(ctx_param, manipulativeObj); else if (manipulativeObj.type === 'block1000') manipulative_renderBlock1000(ctx_param, manipulativeObj); else if (manipulativeObj.type === 'fractionStrip') manipulative_renderFractionStrip(ctx_param, manipulativeObj); else if (manipulativeObj.type === 'fractionCircle') manipulative_renderFractionCircle(ctx_param, manipulativeObj); else if (manipulativeObj.type === 'multiplicationArray') manipulative_renderMultiplicationArray(ctx_param, manipulativeObj); else if (manipulativeObj.type === 'tenFrame') manipulative_renderTenFrameOnCanvas(ctx_param, manipulativeObj); else if (manipulativeObj.type === 'hundredsChart') manipulative_renderHundredsChartOnCanvas(ctx_param, manipulativeObj); else if (manipulativeObj.type === 'algebraTile') manipulative_renderAlgebraTile(ctx_param, manipulativeObj);</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>currentXInRow += itemInfo.effectiveVisualWidth + manipulative_padding;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>currentDrawingY += row.height + manipulative_padding;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>return { totalContentWidth: Math.max(...rowsOfItems.map(r =&gt; r.width), 0) + manipulative_padding * 2, totalDrawingHeight: maxOverallDrawingHeight + manipulative_padding };</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function manipulative_drawSingleManipulative() {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const currentMode = manipulative_currentMasterMode;</p>
<p class="p1"><span class="Apple-converted-space">    </span>manipulative_ctx.clearRect(0, 0, manipulative_mathCanvas.width, manipulative_mathCanvas.height);</p>
<p class="p1"><span class="Apple-converted-space">    </span>manipulative_mathCanvas.style.backgroundColor = 'transparent';</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (currentMode === 'factorTree') { manipulative_drawFactorTreeOnCanvas(manipulative_mathCanvas, parseInt(document.getElementById('manipulative_factorTreeNumberInput_single')?.value) || 0); return; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (currentMode === 'multiplicationNumberBond') { const f1 = parseInt(document.getElementById('manipulative_multFactor1Input_single')?.value) || 0, f2 = parseInt(document.getElementById('manipulative_multFactor2Input_single')?.value) || 0; manipulative_drawNumberBondOnCanvas(manipulative_mathCanvas, f1, f2, f1 * f2, '×', manipulative_multiplicationBondColor, false); return; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (currentMode === 'additionNumberBond') { const a1 = parseInt(document.getElementById('manipulative_addAddend1Input_single')?.value) || 0, a2 = parseInt(document.getElementById('manipulative_addAddend2Input_single')?.value) || 0; manipulative_drawNumberBondOnCanvas(manipulative_mathCanvas, a1, a2, a1 + a2, '+', manipulative_additionBondColor, false); return; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (currentMode === 'analogClock') { const hour = parseInt(document.getElementById('manipulative_clockHour_single')?.value) || 12; const minute = parseInt(document.getElementById('manipulative_clockMinute_single')?.value) || 0; const radius = Math.min(manipulative_mathCanvas.width, manipulative_mathCanvas.height) / 2 - manipulative_padding; manipulative_renderAnalogClock(manipulative_ctx, { x: manipulative_mathCanvas.width / 2, y: manipulative_mathCanvas.height / 2, radius, hour, minute }); return; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (currentMode === 'probabilitySpinner' || currentMode === 'diceRoller') { if (!manipulative_isAnimating.single) manipulative_drawProbabilityTool('single'); return; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>let itemsToRender = []; let totalItemCount = 0;</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (currentMode === 'baseTenBlocks') { const q = { '1000': parseInt(document.getElementById('manipulative_block-1000_single')?.value)||0, '100': parseInt(document.getElementById('manipulative_block-100_single')?.value)||0, '10': parseInt(document.getElementById('manipulative_block-10_single')?.value)||0, '1': parseInt(document.getElementById('manipulative_block-1_single')?.value)||0 }; totalItemCount = Object.values(q).reduce((a, b) =&gt; a + b, 0); for(let i=0;i&lt;q['1000'];i++)itemsToRender.push({type:'block1000',color:manipulative_block1000Color}); for(let i=0;i&lt;q['100'];i++)itemsToRender.push({type:'flat',color:manipulative_flatColor}); for(let i=0;i&lt;q['10'];i++)itemsToRender.push({type:'rod',color:manipulative_rodColor}); for(let i=0;i&lt;q['1'];i++)itemsToRender.push({type:'cube',color:manipulative_unitCubeColor}); }</p>
<p class="p1"><span class="Apple-converted-space">    </span>else if (currentMode === 'algebraTiles') { const tiles = {'x2': {q: parseInt(document.getElementById(`manipulative_tile-x2_single`)?.value)||0, c: manipulative_algebraTilePositiveX2Color, l: 'x²'}, 'x': {q: parseInt(document.getElementById(`manipulative_tile-x_single`)?.value)||0, c: manipulative_algebraTilePositiveXColor, l: 'x'}, '1': {q: parseInt(document.getElementById(`manipulative_tile-1_single`)?.value)||0, c: manipulative_algebraTilePositiveOneColor, l: '1'}, 'neg-x2': {q: parseInt(document.getElementById(`manipulative_tile-neg-x2_single`)?.value)||0, c: manipulative_algebraTileNegativeColor, l: '-x²'}, 'neg-x': {q: parseInt(document.getElementById(`manipulative_tile-neg-x_single`)?.value)||0, c: manipulative_algebraTileNegativeColor, l: '-x'}, 'neg-1': {q: parseInt(document.getElementById(`manipulative_tile-neg-1_single`)?.value)||0, c: manipulative_algebraTileNegativeColor, l: '-1'}}; for (const [key, val] of Object.entries(tiles)) { for (let i = 0; i &lt; val.q; i++) { itemsToRender.push({type: 'algebraTile', tileType: key.replace('neg-', ''), color: val.c, label: val.l}); totalItemCount++; } } }</p>
<p class="p1"><span class="Apple-converted-space">       </span>else if (currentMode === 'fractionStrips' || currentMode === 'fractionCircles') { const type = currentMode === 'fractionStrips' ? 'fractionStrip' : 'fractionCircle'; const color = type === 'fractionStrip' ? manipulative_fractionStripColor : manipulative_fractionCircleColor; const container = document.getElementById('manipulative_' + type + 'InputsContainer_single'); if (container) { Array.from(container.children).forEach(row =&gt; { const num = parseInt(row.querySelector('.fraction-numerator')?.value)||0, den = parseInt(row.querySelector('.fraction-denominator')?.value)||1, showNotation = row.querySelector('.show-notation-checkbox')?.checked||false; if (den &gt; 0) { itemsToRender.push({type, numerator: num, denominator: den, color, showNotation}); totalItemCount++; } }); } }</p>
<p class="p1"><span class="Apple-converted-space">    </span>else if (currentMode === 'multiplicationArray') { const rows = parseInt(document.getElementById('manipulative_arrayRows_single')?.value) || 0, cols = parseInt(document.getElementById('manipulative_arrayCols_single')?.value) || 0; if (rows &gt; 0 &amp;&amp; cols &gt; 0) { itemsToRender.push({type: 'multiplicationArray', rows, cols, color: manipulative_unitCubeColor}); totalItemCount = 1; } }</p>
<p class="p1"><span class="Apple-converted-space">    </span>else if (currentMode === 'tenFrame') { const frameSize = parseInt(document.getElementById('manipulative_tenFrameSize_single')?.value) || 10; const numDots = parseInt(document.getElementById('manipulative_tenFrameDots_single')?.value) || 0; let rows, cols; if (frameSize === 10) { rows = 2; cols = 5; } else { rows = frameSize / 10; cols = 10; } itemsToRender.push({type: 'tenFrame', rows, cols, numDots}); totalItemCount = 1; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>else if (currentMode === 'hundredsChart') { const highlightType = document.getElementById('manipulative_hundredsChartHighlight_single')?.value||'none'; const highlightNumber = parseInt(document.getElementById('manipulative_hundredsChartNumberInput_single')?.value)||0; itemsToRender.push({type: 'hundredsChart', rows: 10, cols: 10, highlightType, highlightNumber}); totalItemCount = 1; }</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>let calculatedBaseSize = manipulative_baseSize; let iterationLimit = 50;</p>
<p class="p1"><span class="Apple-converted-space">    </span>while(iterationLimit-- &gt; 0) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>const canvasContentWidth = manipulative_mathCanvas.width - 2 * manipulative_padding; const availableDrawingHeight = manipulative_singleCanvasContainer.clientHeight - (2 * 16) - 2 * manipulative_padding;</p>
<p class="p1"><span class="Apple-converted-space">        </span>const simulatedLayout = manipulative_layoutAndRenderManipulatives(calculatedBaseSize, manipulative_mathCanvas.width, itemsToRender, null, false, manipulative_singleCanvasContainer);</p>
<p class="p1"><span class="Apple-converted-space">        </span>let needsShrink = simulatedLayout.totalContentWidth &gt; canvasContentWidth + 1 || simulatedLayout.totalDrawingHeight &gt; availableDrawingHeight + 1;</p>
<p class="p1"><span class="Apple-converted-space">        </span>let needsGrow = totalItemCount &gt; 0 &amp;&amp; simulatedLayout.totalContentWidth &lt; canvasContentWidth * 0.8 &amp;&amp; simulatedLayout.totalDrawingHeight &lt; availableDrawingHeight * 0.8;</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (needsShrink) { calculatedBaseSize *= 0.98; if (calculatedBaseSize &lt; manipulative_minEffectiveBlockUnit) { calculatedBaseSize = manipulative_minEffectiveBlockUnit; break; } }</p>
<p class="p1"><span class="Apple-converted-space">        </span>else if (needsGrow) { calculatedBaseSize *= 1.02; if (calculatedBaseSize &gt; manipulative_maxEffectiveBlockUnit) { calculatedBaseSize = manipulative_maxEffectiveBlockUnit; break; } }</p>
<p class="p1"><span class="Apple-converted-space">        </span>else { break; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>let finalBaseSize = Math.floor(calculatedBaseSize); finalBaseSize = Math.max(manipulative_minEffectiveBlockUnit, Math.min(manipulative_maxEffectiveBlockUnit, finalBaseSize));</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>const finalLayout = manipulative_layoutAndRenderManipulatives(finalBaseSize, manipulative_mathCanvas.width, itemsToRender, null, false, manipulative_singleCanvasContainer);</p>
<p class="p1"><span class="Apple-converted-space">    </span>const finalRequiredCanvasHeight = Math.max(manipulative_singleCanvasContainer.clientHeight - (2 * 16), finalLayout.totalDrawingHeight);</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (manipulative_mathCanvas.height !== finalRequiredCanvasHeight) { manipulative_mathCanvas.height = finalRequiredCanvasHeight; requestAnimationFrame(manipulative_handleDraw); return; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>manipulative_layoutAndRenderManipulatives(finalBaseSize, manipulative_mathCanvas.width, itemsToRender, manipulative_ctx, true, manipulative_singleCanvasContainer);</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function manipulative_getCalculationOrSummaryHTML() {</p>
<p class="p1"><span class="Apple-converted-space">    </span>let contentHtml = '';</p>
<p class="p1"><span class="Apple-converted-space">    </span>const currentMode = manipulative_currentMasterMode;</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (currentMode === 'baseTenBlocks') { const total = (parseInt(document.getElementById('manipulative_block-1000_single')?.value)||0)*1000+(parseInt(document.getElementById('manipulative_block-100_single')?.value)||0)*100+(parseInt(document.getElementById('manipulative_block-10_single')?.value)||0)*10+(parseInt(document.getElementById('manipulative_block-1_single')?.value)||0); manipulative_totalValueTitle.textContent='Total Value:'; contentHtml=`&lt;p class="text-5xl font-bold"&gt;$${total}$&lt;/p&gt;`;}</p>
<p class="p1"><span class="Apple-converted-space">    </span>else if (currentMode === 'algebraTiles') {</p>
<p class="p1"><span class="Apple-converted-space">        </span>manipulative_totalValueTitle.textContent = 'Algebraic Expression:';</p>
<p class="p1"><span class="Apple-converted-space">        </span>const x2 = (document.getElementById('manipulative_tile-x2_single')?.value||0) - (document.getElementById('manipulative_tile-neg-x2_single')?.value||0);</p>
<p class="p1"><span class="Apple-converted-space">        </span>const x = (document.getElementById('manipulative_tile-x_single')?.value||0) - (document.getElementById('manipulative_tile-neg-x_single')?.value||0);</p>
<p class="p1"><span class="Apple-converted-space">        </span>const one = (document.getElementById('manipulative_tile-1_single')?.value||0) - (document.getElementById('manipulative_tile-neg-1_single')?.value||0);</p>
<p class="p1"><span class="Apple-converted-space">        </span>let terms = [];</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (x2 !== 0) terms.push((x2 === 1 ? '' : (x2 === -1 ? '-' : x2)) + 'x^2');</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (x !== 0) terms.push((x &gt; 0 ? (terms.length &gt; 0 ? ' + ' : '') : ' - ') + (Math.abs(x) === 1 ? '' : Math.abs(x)) + 'x');</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (one !== 0) terms.push((one &gt; 0 ? (terms.length &gt; 0 ? ' + ' : '') : ' - ') + Math.abs(one));</p>
<p class="p1"><span class="Apple-converted-space">        </span>contentHtml = `&lt;p class="text-4xl font-bold"&gt;$${terms.join('') || '0'}$&lt;/p&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>else if (currentMode === 'fractionStrips' || currentMode === 'fractionCircles') {</p>
<p class="p1"><span class="Apple-converted-space">        </span>manipulative_totalValueTitle.textContent = 'Total Value:';</p>
<p class="p1"><span class="Apple-converted-space">        </span>const type = currentMode === 'fractionStrips' ? 'fractionStrip' : 'fractionCircle';</p>
<p class="p1"><span class="Apple-converted-space">        </span>const container = document.getElementById('manipulative_' + type + 'InputsContainer_single');</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>if (!container || container.children.length === 0) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>contentHtml = '&lt;p class="text-xl"&gt;Add a fraction to begin.&lt;/p&gt;';</p>
<p class="p1"><span class="Apple-converted-space">        </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">            </span>let totalN = 0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>let totalD = 1;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>Array.from(container.children).forEach(row =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const num = parseInt(row.querySelector('.fraction-numerator')?.value) || 0;</p>
<p class="p1"><span class="Apple-converted-space">                </span>const den = parseInt(row.querySelector('.fraction-denominator')?.value) || 1;</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>if (den &gt; 0) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>totalN = totalN * den + num * totalD;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>totalD = totalD * den;</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>if (totalN === 0) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>contentHtml = '&lt;p class="text-5xl font-bold"&gt;$0$&lt;/p&gt;';</p>
<p class="p1"><span class="Apple-converted-space">            </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const commonDivisor = gcd(totalN, totalD);</p>
<p class="p1"><span class="Apple-converted-space">                </span>let simpN = totalN / commonDivisor;</p>
<p class="p1"><span class="Apple-converted-space">                </span>let simpD = totalD / commonDivisor;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>if (simpD &lt; 0) { // Ensure denominator is positive</p>
<p class="p1"><span class="Apple-converted-space">                    </span>simpD = -simpD;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>simpN = -simpN;</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>if (simpD === 1) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>contentHtml = `&lt;p class="text-5xl font-bold"&gt;$${simpN}$&lt;/p&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">                </span>} else if (Math.abs(simpN) &gt;= simpD) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const whole = Math.trunc(simpN / simpD);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const remN = Math.abs(simpN % simpD);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (remN === 0) {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>contentHtml = `&lt;p class="text-5xl font-bold"&gt;$${whole}$&lt;/p&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>contentHtml = `&lt;p class="text-5xl font-bold"&gt;$${whole} \\frac{${remN}}{${simpD}}$&lt;/p&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>contentHtml = `&lt;p class="text-5xl font-bold"&gt;$\\frac{${simpN}}{${simpD}}$&lt;/p&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>}<span class="Apple-converted-space">    </span>else if (currentMode === 'analogClock') { manipulative_totalValueTitle.textContent = 'Digital Time:'; const hour = parseInt(document.getElementById('manipulative_clockHour_single')?.value) || 12; const minute = parseInt(document.getElementById('manipulative_clockMinute_single')?.value) || 0; contentHtml = `&lt;p class="text-5xl font-mono font-bold"&gt;$${String(hour).padStart(2, '0')}:${String(minute).padStart(2, '0')}$&lt;/p&gt;`;}</p>
<p class="p1"><span class="Apple-converted-space">    </span>else if (currentMode === 'probabilitySpinner') { manipulative_totalValueTitle.textContent = 'Spinner Result:'; contentHtml = `&lt;p class="text-5xl font-bold"&gt;$${manipulative_lastSpinnerResult.single !== null ? manipulative_lastSpinnerResult.single : '...'}$&lt;/p&gt;`; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>else if (currentMode === 'diceRoller') { manipulative_totalValueTitle.textContent = 'Dice Roll:'; contentHtml = `&lt;p class="text-5xl font-bold"&gt;$${manipulative_lastDiceResult.single !== null ? manipulative_lastDiceResult.single : '...'}$&lt;/p&gt;`; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>else if (currentMode === 'multiplicationArray') { const rows=parseInt(document.getElementById('manipulative_arrayRows_single')?.value)||0, cols=parseInt(document.getElementById('manipulative_arrayCols_single')?.value)||0; manipulative_totalValueTitle.textContent='Multiplication Array:'; contentHtml=rows&gt;0&amp;&amp;cols&gt;0?`&lt;p class="text-5xl font-bold"&gt;$${rows} \\times ${cols} = ${rows*cols}$&lt;/p&gt;`:`&lt;p class="text-xl"&gt;Enter rows and columns.&lt;/p&gt;`;}</p>
<p class="p1"><span class="Apple-converted-space">    </span>else if (currentMode === 'tenFrame') { const frameSize=parseInt(document.getElementById('manipulative_tenFrameSize_single')?.value)||0, numDots=parseInt(document.getElementById('manipulative_tenFrameDots_single')?.value)||0; manipulative_totalValueTitle.textContent='Ten Frame:'; contentHtml=`&lt;p class="text-5xl font-bold"&gt;$${numDots} \\text{ in a } ${frameSize}\\text{-frame}$&lt;/p&gt;`;}</p>
<p class="p1"><span class="Apple-converted-space">    </span>else if (currentMode === 'hundredsChart') { const highlightType=document.getElementById('manipulative_hundredsChartHighlight_single')?.value||'none';const highlightNumber=parseInt(document.getElementById('manipulative_hundredsChartNumberInput_single')?.value)||0;manipulative_totalValueTitle.textContent='Hundreds Chart:';let description='Displaying 1-100.';if(highlightType==='prime')description='Highlighting Prime Numbers.';else if(highlightType==='even')description='Highlighting Even Numbers.';else if(highlightType==='odd')description='Highlighting Odd Numbers.';else if(highlightType==='multiples')description=`Highlighting Multiples of ${highlightNumber}.`;else if(highlightType==='factors'){const factors=manipulative_getFactors(highlightNumber);description=`Highlighting Factors of ${highlightNumber}: ${factors.join(', ')}.`;} contentHtml=`&lt;p class="text-4xl font-semibold"&gt;$${description.replace(/:/g,':\\\\ ')}$&lt;/p&gt;`;}</p>
<p class="p1"><span class="Apple-converted-space">    </span>else if (currentMode === 'factorTree') { const num = parseInt(document.getElementById('manipulative_factorTreeNumberInput_single')?.value) || 0; manipulative_totalValueTitle.textContent = 'Prime Factorization:'; if (isNaN(num) || num &lt; 2) { contentHtml = `&lt;p class="text-xl"&gt;Enter a number ≥ 2.&lt;/p&gt;`; } else { const factors = manipulative_getPrimeFactorsList(num); let fString = factors.length === 1 &amp;&amp; factors[0] === num ? `${num} \\text{ is prime.}` : `${num} = ${factors.join(' \\times ')}`; contentHtml = `&lt;p class="text-4xl font-bold mt-4"&gt;$${fString}$&lt;/p&gt;`; } }</p>
<p class="p1"><span class="Apple-converted-space">    </span>else if (currentMode === 'multiplicationNumberBond' || currentMode === 'additionNumberBond') { const isMult = currentMode === 'multiplicationNumberBond'; const v1 = parseInt(document.getElementById(isMult ? 'manipulative_multFactor1Input_single' : 'manipulative_addAddend1Input_single')?.value) || 0; const v2 = parseInt(document.getElementById(isMult ? 'manipulative_multFactor2Input_single' : 'manipulative_addAddend2Input_single')?.value) || 0; const result = isMult ? v1 * v2 : v1 + v2; const op = isMult ? '\\times' : '+'; manipulative_totalValueTitle.textContent = isMult ? 'Multiplication Number Bond:' : 'Addition Number Bond:'; contentHtml = `&lt;p class="text-4xl font-bold mt-4"&gt;$${v1} ${op} ${v2} = ${result}$&lt;/p&gt;`;}</p>
<p class="p1"><span class="Apple-converted-space">    </span>return contentHtml;</p>
<p class="p1">}<span class="Apple-converted-space"> </span></p>
<p class="p2"><br></p>
<p class="p1">function manipulative_handleDraw() {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const currentMode = manipulative_currentMasterMode;</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (currentMode === 'focusStatement') {</p>
<p class="p1"><span class="Apple-converted-space">        </span>// No canvas drawing needed</p>
<p class="p1"><span class="Apple-converted-space">    </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">        </span>manipulative_drawSingleManipulative();</p>
<p class="p1"><span class="Apple-converted-space">        </span>const contentHtml = manipulative_getCalculationOrSummaryHTML();</p>
<p class="p1"><span class="Apple-converted-space">        </span>manipulative_stepsContentContainer.innerHTML = contentHtml;</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (window.MathJax &amp;&amp; window.MathJax.startup) { MathJax.startup.promise.then(() =&gt; { MathJax.typesetPromise([manipulative_stepsContentContainer, manipulative_dimensionInputsInline]).catch((err) =&gt; console.error("MathJax typesetting error:", err)); }); }</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function manipulative_setupInputsForSide(side) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>let mode, container, suffix;</p>
<p class="p1"><span class="Apple-converted-space">    </span>mode = manipulative_currentMasterMode; container = manipulative_dimensionInputsInline; suffix = 'single';</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>manipulative_isAnimating[side] = false;</p>
<p class="p1"><span class="Apple-converted-space">    </span>container.innerHTML = (inputTemplates[mode] || '').replaceAll('{SIDE}', suffix);</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>const drawFunc = () =&gt; manipulative_handleDraw();</p>
<p class="p1"><span class="Apple-converted-space">    </span>container.querySelectorAll('input, select').forEach(el =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">        </span>el.addEventListener('input', drawFunc);</p>
<p class="p1"><span class="Apple-converted-space">        </span>el.addEventListener('change', drawFunc);</p>
<p class="p1"><span class="Apple-converted-space">    </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>if (mode === 'fractionStrips') { document.getElementById(`manipulative_addFractionStrip_${suffix}`).onclick = () =&gt; manipulative_addFractionInputRow(`manipulative_fractionStripInputsContainer_${suffix}`, suffix); if (!document.getElementById(`manipulative_fractionStripInputsContainer_${suffix}`)?.children.length) manipulative_addFractionInputRow(`manipulative_fractionStripInputsContainer_${suffix}`, suffix); }</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (mode === 'fractionCircles') { document.getElementById(`manipulative_addFractionCircle_${suffix}`).onclick = () =&gt; manipulative_addFractionInputRow(`manipulative_fractionCircleInputsContainer_${suffix}`, suffix, 1, 4); if (!document.getElementById(`manipulative_fractionCircleInputsContainer_${suffix}`)?.children.length) manipulative_addFractionInputRow(`manipulative_fractionCircleInputsContainer_${suffix}`, suffix, 1, 4); }</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (mode === 'factorTree') { document.getElementById(`manipulative_factorizeButton_${suffix}`).onclick = drawFunc; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (mode === 'hundredsChart') { const hs = document.getElementById(`manipulative_hundredsChartHighlight_${suffix}`), ni = document.getElementById(`manipulative_hundredsChartNumberInput_${suffix}`); hs.addEventListener('change', () =&gt; { ni.classList.toggle('hidden', !['multiples', 'factors'].includes(hs.value)); drawFunc(); }); }</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (mode === 'tenFrame') { const di = document.getElementById(`manipulative_tenFrameDots_${suffix}`); di.addEventListener('input', () =&gt; { const fs = parseInt(document.getElementById(`manipulative_tenFrameSize_${suffix}`).value); let v = parseInt(di.value); di.value = isNaN(v)?0:Math.max(0, Math.min(v, fs)); drawFunc(); }); }</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (mode === 'probabilitySpinner') { manipulative_lastSpinnerRotation[side] = 0; manipulative_lastSpinnerResult[side] = null; document.getElementById(`manipulative_spinButton_${suffix}`).onclick = () =&gt; manipulative_startSpinnerAnimation(side); }</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (mode === 'diceRoller') { manipulative_lastDiceResult[side] = null; document.getElementById(`manipulative_rollButton_${suffix}`).onclick = () =&gt; manipulative_startDiceAnimation(side); }</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>if (window.MathJax &amp;&amp; window.MathJax.startup) { MathJax.startup.promise.then(() =&gt; { MathJax.typesetPromise([container]).catch(console.error); }); }</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>manipulative_resizeCanvases();</p>
<p class="p1"><span class="Apple-converted-space">    </span>manipulative_handleDraw();</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function manipulative_addFractionInputRow(containerId, side, num = 1, den = 2) { const container=document.getElementById(containerId);if(!container)return;const rowDiv=document.createElement('div');rowDiv.className='fraction-input-row';rowDiv.innerHTML=`&lt;label class="text-sm font-semibold text-slate-700"&gt;Num:&lt;/label&gt;&lt;input type="number" class="fraction-numerator w-16 p-1 border-2 border-slate-300 rounded-lg text-center" value="${num}" min="0"&gt;&lt;label class="text-sm font-semibold text-slate-700"&gt;Den:&lt;/label&gt;&lt;input type="number" class="fraction-denominator w-16 p-1 border-2 border-slate-300 rounded-lg text-center" value="${den}" min="1"&gt;&lt;div class="flex items-center gap-1"&gt;&lt;input type="checkbox" class="show-notation-checkbox" checked&gt;&lt;label class="text-sm font-semibold text-slate-700"&gt;Notation&lt;/label&gt;&lt;/div&gt;&lt;button type="button" class="remove-fraction-button"&gt;X&lt;/button&gt;`;container.appendChild(rowDiv);const numInput=rowDiv.querySelector('.fraction-numerator');const denInput=rowDiv.querySelector('.fraction-denominator');const showNotationCheckbox=rowDiv.querySelector('.show-notation-checkbox');const removeButton=rowDiv.querySelector('.remove-fraction-button');const drawFunc=manipulative_handleDraw;numInput.addEventListener('input',drawFunc);denInput.addEventListener('input',drawFunc);showNotationCheckbox.addEventListener('change',drawFunc);numInput.addEventListener('blur',()=&gt;{const currentDenominator=parseInt(denInput.value)||1;numInput.value=Math.min(currentDenominator,Math.max(0,parseInt(numInput.value)||0));drawFunc();});denInput.addEventListener('blur',()=&gt;{const newDenominator=Math.max(1,parseInt(denInput.value)||1);denInput.value=newDenominator;numInput.value=Math.min(newDenominator,Math.max(0,parseInt(numInput.value)||0));drawFunc();});removeButton.addEventListener('click',()=&gt;{rowDiv.remove();if(container.children.length===0){manipulative_addFractionInputRow(containerId,side);} drawFunc();});drawFunc();}</p>
<p class="p2"><br></p>
<p class="p1">function manipulative_handleMasterModeChange() {</p>
<p class="p1"><span class="Apple-converted-space">    </span>manipulative_currentMasterMode = modeSelector.value;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const isFocusStatement = manipulative_currentMasterMode === 'focusStatement';</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Control Panels</p>
<p class="p1"><span class="Apple-converted-space">    </span>manipulative_singleModeControls.classList.toggle('hidden', isFocusStatement);</p>
<p class="p1"><span class="Apple-converted-space">    </span>manipulative_focusStatementModeControls.classList.toggle('hidden', !isFocusStatement);</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Display Panels</p>
<p class="p1"><span class="Apple-converted-space">    </span>manipulative_singleCanvasContainer.classList.toggle('hidden', isFocusStatement);</p>
<p class="p1"><span class="Apple-converted-space">    </span>manipulative_focusStatementDisplayContainer.classList.toggle('hidden', !isFocusStatement);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// UI Toggles</p>
<p class="p1"><span class="Apple-converted-space">    </span>manipulative_totalValueSection.classList.toggle('hidden', isFocusStatement || !answerToggleBtn.classList.contains('toggle-on'));</p>
<p class="p1"><span class="Apple-converted-space">    </span>answerToggleContainer.classList.toggle('hidden', isFocusStatement);</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>let controlsToToggle;</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (isFocusStatement) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>controlsToToggle = manipulative_focusStatementModeControls;</p>
<p class="p1"><span class="Apple-converted-space">    </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">        </span>controlsToToggle = manipulative_singleModeControls;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>controlsToToggle.classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">    </span>menuControls.classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">    </span>menuToggleBtn.classList.add('toggle-on');</p>
<p class="p1"><span class="Apple-converted-space">    </span>menuToggleBtn.classList.remove('toggle-off');</p>
<p class="p1"><span class="Apple-converted-space">    </span>menuToggleDot.classList.add('dot-on');</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>if (isFocusStatement) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>manipulative_focusStatementTextArea.value = "Welcome to Focus Statement Mode.";</p>
<p class="p1"><span class="Apple-converted-space">        </span>manipulative_focusStatementLiveText.innerHTML = manipulative_focusStatementTextArea.value;</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (window.MathJax &amp;&amp; window.MathJax.startup) { MathJax.startup.promise.then(() =&gt; { MathJax.typesetPromise([manipulative_focusStatementLiveText]).catch((err) =&gt; console.error("MathJax typesetting error:", err)); }); }</p>
<p class="p1"><span class="Apple-converted-space">    </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">        </span>manipulative_setupInputsForSide('single');</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>manipulative_handleDraw();</p>
<p class="p1">}<span class="Apple-converted-space"> </span></p>
<p class="p2"><br></p>
<p class="p1">function manipulative_resizeCanvases() {</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (manipulative_currentMasterMode !== 'focusStatement') {</p>
<p class="p1"><span class="Apple-converted-space">        </span>manipulative_mathCanvas.width = manipulative_singleCanvasContainer.clientWidth;</p>
<p class="p1"><span class="Apple-converted-space">        </span>manipulative_mathCanvas.height = manipulative_singleCanvasContainer.clientHeight;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>manipulative_handleDraw();</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function manipulative_drawProbabilityTool(side) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const mode = manipulative_currentMasterMode;</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (mode === 'probabilitySpinner') manipulative_drawSpinner(side);</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (mode === 'diceRoller') manipulative_drawDice(side);</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function manipulative_getCanvasForSide(side) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>return manipulative_mathCanvas;</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function manipulative_drawSpinner(side) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const canvasEl = manipulative_getCanvasForSide(side);</p>
<p class="p1"><span class="Apple-converted-space">    </span>const ctx_param = canvasEl.getContext('2d');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const suffix = 'single';</p>
<p class="p1"><span class="Apple-converted-space">    </span>const rotation = manipulative_lastSpinnerRotation[side] || 0;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const sections = parseInt(document.getElementById(`manipulative_spinnerSections_${suffix}`)?.value) || 6;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const radius = Math.min(canvasEl.width, canvasEl.height) / 2 - manipulative_padding;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const centerX = canvasEl.width / 2;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const centerY = canvasEl.height / 2;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const anglePerSection = (2 * Math.PI) / sections;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>ctx_param.clearRect(0, 0, canvasEl.width, canvasEl.height);</p>
<p class="p1"><span class="Apple-converted-space">    </span>ctx_param.save();</p>
<p class="p1"><span class="Apple-converted-space">    </span>ctx_param.translate(centerX, centerY);</p>
<p class="p1"><span class="Apple-converted-space">    </span>ctx_param.rotate(rotation);</p>
<p class="p1"><span class="Apple-converted-space">    </span>for (let i = 0; i &lt; sections; i++) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>ctx_param.beginPath();</p>
<p class="p1"><span class="Apple-converted-space">        </span>ctx_param.moveTo(0, 0);</p>
<p class="p1"><span class="Apple-converted-space">        </span>ctx_param.arc(0, 0, radius, i * anglePerSection, (i + 1) * anglePerSection);</p>
<p class="p1"><span class="Apple-converted-space">        </span>ctx_param.closePath();</p>
<p class="p1"><span class="Apple-converted-space">        </span>ctx_param.fillStyle = manipulative_spinnerColors[i % manipulative_spinnerColors.length];</p>
<p class="p1"><span class="Apple-converted-space">        </span>ctx_param.fill();</p>
<p class="p1"><span class="Apple-converted-space">        </span>ctx_param.stroke();</p>
<p class="p1"><span class="Apple-converted-space">        </span>ctx_param.save();</p>
<p class="p1"><span class="Apple-converted-space">        </span>ctx_param.rotate((i + 0.5) * anglePerSection);</p>
<p class="p1"><span class="Apple-converted-space">        </span>ctx_param.fillStyle = (manipulative_spinnerColors[i % manipulative_spinnerColors.length] === '#ffffff' || manipulative_spinnerColors[i % manipulative_spinnerColors.length] === '#f59e0b') ? 'black' : 'white';</p>
<p class="p1"><span class="Apple-converted-space">        </span>ctx_param.font = `bold ${radius * 0.15}px Montserrat`;</p>
<p class="p1"><span class="Apple-converted-space">        </span>ctx_param.textAlign = 'center';</p>
<p class="p1"><span class="Apple-converted-space">        </span>ctx_param.fillText(i + 1, radius * 0.7, 0);</p>
<p class="p1"><span class="Apple-converted-space">        </span>ctx_param.restore();</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>ctx_param.restore();</p>
<p class="p1"><span class="Apple-converted-space">    </span>ctx_param.fillStyle = manipulative_mainOutlineColor;</p>
<p class="p1"><span class="Apple-converted-space">    </span>ctx_param.beginPath();</p>
<p class="p1"><span class="Apple-converted-space">    </span>ctx_param.moveTo(centerX + radius + 5, centerY);</p>
<p class="p1"><span class="Apple-converted-space">    </span>ctx_param.lineTo(centerX + radius + 25, centerY - 10);</p>
<p class="p1"><span class="Apple-converted-space">    </span>ctx_param.lineTo(centerX + radius + 25, centerY + 10);</p>
<p class="p1"><span class="Apple-converted-space">    </span>ctx_param.closePath();</p>
<p class="p1"><span class="Apple-converted-space">    </span>ctx_param.fill();</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function manipulative_drawDice(side) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const canvasEl = manipulative_getCanvasForSide(side);</p>
<p class="p1"><span class="Apple-converted-space">    </span>const ctx_param = canvasEl.getContext('2d');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const suffix = 'single';</p>
<p class="p1"><span class="Apple-converted-space">    </span>const value = manipulative_lastDiceResult[side] || 1;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const sides = parseInt(document.getElementById(`manipulative_diceSides_${suffix}`)?.value) || 6;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const size = Math.min(canvasEl.width, canvasEl.height) * 0.4;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const radius = size / 2;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const centerX = canvasEl.width / 2;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const centerY = canvasEl.height / 2;</p>
<p class="p1"><span class="Apple-converted-space">    </span>ctx_param.clearRect(0, 0, canvasEl.width, canvasEl.height);</p>
<p class="p1"><span class="Apple-converted-space">    </span>ctx_param.fillStyle = 'white';</p>
<p class="p1"><span class="Apple-converted-space">    </span>ctx_param.strokeStyle = manipulative_mainOutlineColor;</p>
<p class="p1"><span class="Apple-converted-space">    </span>ctx_param.lineWidth = 4;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>let shapeSides = 0;</p>
<p class="p1"><span class="Apple-converted-space">    </span>switch(sides) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>case 4: shapeSides = 3; break; case 6: shapeSides = 4; break; case 8: shapeSides = 8; break;</p>
<p class="p1"><span class="Apple-converted-space">        </span>case 10: shapeSides = 10; break; case 12: shapeSides = 12; break; case 20: shapeSides = 20; break;</p>
<p class="p1"><span class="Apple-converted-space">        </span>default: shapeSides = 0;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>if (shapeSides === 4 &amp;&amp; sides === 6) { ctx_param.beginPath(); ctx_param.roundRect(centerX - radius, centerY - radius, size, size, [size * 0.1]);</p>
<p class="p1"><span class="Apple-converted-space">    </span>} else if (shapeSides &gt; 0) { manipulative_drawPolygon(ctx_param, centerX, centerY, radius, shapeSides);</p>
<p class="p1"><span class="Apple-converted-space">    </span>} else { ctx_param.beginPath(); ctx_param.arc(centerX, centerY, radius, 0, 2 * Math.PI); }</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>ctx_param.fill();</p>
<p class="p1"><span class="Apple-converted-space">    </span>ctx_param.stroke();</p>
<p class="p1"><span class="Apple-converted-space">    </span>ctx_param.fillStyle = manipulative_mainOutlineColor;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>if (sides === 6) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>const dotRadius = size * 0.08;</p>
<p class="p1"><span class="Apple-converted-space">        </span>const positions = { 1: [[0.5, 0.5]], 2: [[0.25, 0.25], [0.75, 0.75]], 3: [[0.25, 0.25], [0.5, 0.5], [0.75, 0.75]], 4: [[0.25, 0.25], [0.75, 0.25], [0.25, 0.75], [0.75, 0.75]], 5: [[0.25, 0.25], [0.75, 0.25], [0.5, 0.5], [0.25, 0.75], [0.75, 0.75]], 6: [[0.25, 0.25], [0.75, 0.25], [0.25, 0.5], [0.75, 0.5], [0.25, 0.75], [0.75, 0.75]], };</p>
<p class="p1"><span class="Apple-converted-space">        </span>const dotPositions = positions[value] || [];</p>
<p class="p1"><span class="Apple-converted-space">        </span>dotPositions.forEach(pos =&gt; { ctx_param.beginPath(); ctx_param.arc(centerX - radius + pos[0] * size, centerY - radius + pos[1] * size, dotRadius, 0, 2 * Math.PI); ctx_param.fill(); });</p>
<p class="p1"><span class="Apple-converted-space">    </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">        </span>ctx_param.font = `bold ${size * 0.4}px Montserrat`;</p>
<p class="p1"><span class="Apple-converted-space">        </span>ctx_param.textAlign = 'center';</p>
<p class="p1"><span class="Apple-converted-space">        </span>ctx_param.textBaseline = 'middle';</p>
<p class="p1"><span class="Apple-converted-space">        </span>ctx_param.fillText(value, centerX, centerY);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function manipulative_startSpinnerAnimation(side) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (manipulative_isAnimating[side]) return;</p>
<p class="p1"><span class="Apple-converted-space">    </span>manipulative_isAnimating[side] = true;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const suffix = 'single';</p>
<p class="p1"><span class="Apple-converted-space">    </span>document.getElementById(`manipulative_spinButton_${suffix}`).disabled = true;</p>
<p class="p1"><span class="Apple-converted-space">    </span>manipulative_lastSpinnerResult[side] = null;</p>
<p class="p1"><span class="Apple-converted-space">    </span>manipulative_handleDraw();</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>const sections = parseInt(document.getElementById(`manipulative_spinnerSections_${suffix}`)?.value) || 6;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const targetSection = Math.floor(Math.random() * sections);</p>
<p class="p1"><span class="Apple-converted-space">    </span>const anglePerSection = 2 * Math.PI / sections;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const finalAngle = (2 * Math.PI) - (targetSection + 0.5) * anglePerSection;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const totalRotation = finalAngle + (2 * Math.PI) * (Math.floor(Math.random() * 3) + 3);</p>
<p class="p1"><span class="Apple-converted-space">    </span>const duration = 3000;</p>
<p class="p1"><span class="Apple-converted-space">    </span>let startTime = null;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>function animationLoop(timestamp) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (!startTime) startTime = timestamp;</p>
<p class="p1"><span class="Apple-converted-space">        </span>const elapsed = timestamp - startTime;</p>
<p class="p1"><span class="Apple-converted-space">        </span>const progress = Math.min(elapsed / duration, 1);</p>
<p class="p1"><span class="Apple-converted-space">        </span>const easedProgress = manipulative_easeOutCubic(progress);</p>
<p class="p1"><span class="Apple-converted-space">        </span>const currentRotation = easedProgress * totalRotation;</p>
<p class="p1"><span class="Apple-converted-space">        </span>manipulative_lastSpinnerRotation[side] = currentRotation;</p>
<p class="p1"><span class="Apple-converted-space">        </span>manipulative_drawProbabilityTool(side);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>if (progress &lt; 1) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>requestAnimationFrame(animationLoop);</p>
<p class="p1"><span class="Apple-converted-space">        </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">            </span>manipulative_lastSpinnerRotation[side] = finalAngle;</p>
<p class="p1"><span class="Apple-converted-space">            </span>manipulative_isAnimating[side] = false;</p>
<p class="p1"><span class="Apple-converted-space">            </span>document.getElementById(`manipulative_spinButton_${suffix}`).disabled = false;</p>
<p class="p1"><span class="Apple-converted-space">            </span>manipulative_lastSpinnerResult[side] = targetSection + 1;</p>
<p class="p1"><span class="Apple-converted-space">            </span>manipulative_handleDraw();</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>requestAnimationFrame(animationLoop);</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function manipulative_startDiceAnimation(side) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (manipulative_isAnimating[side]) return;</p>
<p class="p1"><span class="Apple-converted-space">    </span>manipulative_isAnimating[side] = true;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const suffix = 'single';</p>
<p class="p1"><span class="Apple-converted-space">    </span>document.getElementById(`manipulative_rollButton_${suffix}`).disabled = true;</p>
<p class="p1"><span class="Apple-converted-space">    </span>manipulative_lastDiceResult[side] = null;</p>
<p class="p1"><span class="Apple-converted-space">    </span>manipulative_handleDraw();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>const sides = parseInt(document.getElementById(`manipulative_diceSides_${suffix}`)?.value) || 6;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const finalResult = Math.floor(Math.random() * sides) + 1;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const duration = 1500;</p>
<p class="p1"><span class="Apple-converted-space">    </span>let startTime = null;</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>function animationLoop(timestamp) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (!startTime) startTime = timestamp;</p>
<p class="p1"><span class="Apple-converted-space">        </span>const elapsed = timestamp - startTime;</p>
<p class="p1"><span class="Apple-converted-space">        </span>if(elapsed &lt; duration) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>manipulative_lastDiceResult[side] = Math.floor(Math.random() * sides) + 1;</p>
<p class="p1"><span class="Apple-converted-space">            </span>manipulative_drawProbabilityTool(side);</p>
<p class="p1"><span class="Apple-converted-space">            </span>requestAnimationFrame(animationLoop);</p>
<p class="p1"><span class="Apple-converted-space">        </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">            </span>manipulative_isAnimating[side] = false;</p>
<p class="p1"><span class="Apple-converted-space">            </span>document.getElementById(`manipulative_rollButton_${suffix}`).disabled = false;</p>
<p class="p1"><span class="Apple-converted-space">            </span>manipulative_lastDiceResult[side] = finalResult;</p>
<p class="p1"><span class="Apple-converted-space">            </span>manipulative_handleDraw();</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>requestAnimationFrame(animationLoop);</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function manipulative_handleMenuToggle() {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const currentMode = manipulative_currentMasterMode;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const isFocusStatement = currentMode === 'focusStatement';</p>
<p class="p1"><span class="Apple-converted-space">    </span>let controlsToToggle;</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (isFocusStatement) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>controlsToToggle = manipulative_focusStatementModeControls;</p>
<p class="p1"><span class="Apple-converted-space">    </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">        </span>controlsToToggle = manipulative_singleModeControls;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>const isHidden = controlsToToggle.classList.toggle('hidden');</p>
<p class="p1"><span class="Apple-converted-space">    </span>menuControls.classList.toggle('hidden', isHidden);</p>
<p class="p1"><span class="Apple-converted-space">    </span>menuToggleBtn.classList.toggle('toggle-on', !isHidden);</p>
<p class="p1"><span class="Apple-converted-space">    </span>menuToggleBtn.classList.toggle('toggle-off', isHidden);</p>
<p class="p1"><span class="Apple-converted-space">    </span>menuToggleDot.classList.toggle('dot-on', !isHidden);</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function manipulative_handleAnswerToggle() {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const isHidden = manipulative_totalValueSection.classList.toggle('hidden');</p>
<p class="p1"><span class="Apple-converted-space">    </span>answerToggleBtn.classList.toggle('toggle-on', !isHidden);</p>
<p class="p1"><span class="Apple-converted-space">    </span>answerToggleBtn.classList.toggle('toggle-off', isHidden);</p>
<p class="p1"><span class="Apple-converted-space">    </span>answerToggleDot.classList.toggle('dot-on', !isHidden);</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(manipulative_currentMasterMode !== 'focusStatement') {</p>
<p class="p1"><span class="Apple-converted-space">        </span>manipulative_handleDraw();</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function manipulative_initialize() {</p>
<p class="p1"><span class="Apple-converted-space">    </span>manipulative_focusStatementTextArea.addEventListener('input', (e) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">        </span>manipulative_focusStatementLiveText.innerHTML = e.target.value;</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (window.MathJax &amp;&amp; window.MathJax.startup) { MathJax.startup.promise.then(() =&gt; { MathJax.typesetPromise([manipulative_focusStatementLiveText]).catch((err) =&gt; console.error("MathJax typesetting error:", err)); }); }</p>
<p class="p1"><span class="Apple-converted-space">    </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>window.addEventListener('resize', manipulative_resizeCanvases);</p>
<p class="p1">}</p>
<p class="p1">&lt;/script&gt;</p>
<p class="p1">&lt;/body&gt;</p>
<p class="p1">&lt;/html&gt;</p>
</body>
</html>
